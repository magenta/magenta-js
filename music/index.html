<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>@magenta/music - v1.18.0</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.js" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">@magenta/music - v1.18.0</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="globals.html">Globals</a>
				</li>
			</ul>
			<h1>@magenta/music - v1.18.0</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#magentamusic" id="magentamusic" style="color: inherit; text-decoration: none;">
					<h1>@magenta/music</h1>
				</a>
				<p><a href="https://badge.fury.io/js/%40magenta%2Fmusic"><img src="https://badge.fury.io/js/%40magenta%2Fmusic.svg" alt="npm version"></a> <a href="https://www.jsdelivr.com/package/npm/@magenta/music"><img src="https://data.jsdelivr.com/v1/package/npm/@magenta/music/badge?style=rounded" alt=""></a></p>
				<p>This JavaScript implementation of Magenta&#39;s musical note-based models uses <a href="https://js.tensorflow.org">TensorFlow.js</a> for GPU-accelerated inference. For the Python TensorFlow implementations, see the <a href="https://github.com/tensorflow/magenta">main Magenta repo</a>.</p>
				<p>Complete API documentation is available <a href="https://magenta.github.io/magenta-js/music">here</a>.</p>
				<a href="#table-of-contents" id="table-of-contents" style="color: inherit; text-decoration: none;">
					<h1>Table of Contents</h1>
				</a>
				<ul>
					<li><a href="#getting-started">Getting started</a></li>
					<li><a href="#usage">Usage</a><ul>
							<li><a href="#in-the-browser">In the browser</a></li>
							<li><a href="#in-node">In Node</a></li>
						</ul>
					</li>
					<li><a href="https://magenta.github.io/magenta-js/music">API docs</a></li>
					<li><a href="#supported-models">Supported Models</a><ul>
							<li><a href="#piano-transcription-w-onsets-and-frames">Onsets and Frames</a></li>
							<li><a href="#musicrnn">MusicRNN</a></li>
							<li><a href="#musicvae">MusicVAE</a></li>
							<li><a href="#midime">MidiMe</a></li>
							<li><a href="#piano-genie">Piano Genie</a></li>
							<li><a href="#gansynth">GANSynth</a></li>
						</ul>
					</li>
					<li><a href="#model-checkpoints">Model Checkpoints</a><ul>
							<li><a href="#pre-trained-hosted-checkpoints">Pre-trained hosted checkpoints</a></li>
							<li><a href="#your-own-checkpoints">Your own checkpoints</a></li>
						</ul>
					</li>
					<li><a href="#soundfonts">Soundfonts</a></li>
					<li><a href="#how-to">How To</a><ul>
							<li><a href="#use-with-a-web-worker">Use with a WebWorker</a></li>
							<li><a href="#use-with-a-service-worker">Use with a ServiceWorker</a></li>
							<li><a href="#use-with-typescript">Use with TypeScript</a></li>
						</ul>
					</li>
				</ul>
				<a href="#getting-started" id="getting-started" style="color: inherit; text-decoration: none;">
					<h2>Getting started</h2>
				</a>
				<p>If you want to get hands-on with Magenta, we&#39;ve put together a small
					<a href="https://hello-magenta.glitch.me/">interactive tutorial</a> that takes you through
				generating a small melody in the browser using a Machine Learning model.</p>
				<p>Here are some examples of applications that have been built with <code>@magenta/music</code>. A
				more complete list is available on the <a href="https://magenta.tensorflow.org/demos">Magenta site</a>.</p>
				<ul>
					<li><a href="https://magenta.tensorflow.org/fruitgenie">Fruit Genie</a> by <a href="https://www.deeplocal.com/">Deeplocal</a></li>
					<li><a href="https://drumbot.glitch.me">Drumbot</a> by <a href="https://github.com/notwaldorf">Monica Dinculescu</a></li>
					<li><a href="https://goo.gl/magenta/neuraldrum">Neural Drum Machine</a> by <a href="https://github.com/teropa">Tero Parviainen</a></li>
					<li><a href="https://piano-scribe.glitch.me">Piano Scribe</a> by <a href="https://github.com/notwaldorf">Monica Dinculescu</a> and <a href="https://github.com/adarob">Adam Roberts</a></li>
					<li><a href="https://g.co/beatblender">Beat Blender</a> by <a href="https://github.com/googlecreativelab">Google Creative Lab</a></li>
					<li><a href="https://g.co/melodymixer">Melody Mixer</a> by <a href="https://github.com/googlecreativelab">Google Creative Lab</a></li>
					<li><a href="https://goo.gl/magenta/latent-loops">Latent Loops</a> by <a href="https://github.com/teampieshop">Google Pie Shop</a></li>
				</ul>
				<p>You can also try our <a href="https://magenta.github.io/magenta-js/music/demos">hosted demos</a> for each model and have a look at their <a href="./demos">code</a>.</p>
				<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
					<h2>Usage</h2>
				</a>
				<p>There are several ways to get <code>@magenta/music</code> in your JavaScript project,
				either in the browser, or in Node:</p>
				<a href="#in-the-browser" id="in-the-browser" style="color: inherit; text-decoration: none;">
					<h3>In the browser</h3>
				</a>
				<p>The models and the core library is split into smaller ES6 bundles (not ESModules, unfortunately üò¢), so that you can use a model independent of the rest of the
					library. These bundles don&#39;t package the <code>Tone.js</code> or <code>TensorFlow.js</code> dependencies (since
					there would be a risk of downloading multiple copies on the same page). Here is an example (or
				<a href="https://codepen.io/adarob/pen/gzwJZL">click here</a> for a CodePen version):</p>
				<pre><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  ...
  <span class="hljs-comment">&lt;!-- You need to bring your own Tone.js for the player, and tfjs for the model --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdnjs.cloudflare.com/ajax/libs/tone/13.8.21/Tone.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdnjs.cloudflare.com/ajax/libs/tensorflow/1.2.8/tf.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- Core library, since we're going to use a player --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/@magenta/music@^1.0.0/es6/core.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-comment">&lt;!--Model we want to use --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.jsdelivr.net/npm/@magenta/music@^1.0.0/es6/music_vae.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
  <span class="hljs-comment">// Each bundle exports a global object with the name of the bundle.</span>
  <span class="hljs-keyword">const</span> player = <span class="hljs-keyword">new</span> core.Player();
  <span class="hljs-comment">//...</span>
  <span class="hljs-keyword">const</span> mvae = <span class="hljs-keyword">new</span> music_vae.MusicVAE(<span class="hljs-string">'https://storage.googleapis.com/magentadata/js/checkpoints/music_vae/mel_2bar_small'</span>);
  mvae.initialize().then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
    model.sample(<span class="hljs-number">1</span>).then(<span class="hljs-function">(<span class="hljs-params">samples</span>) =&gt;</span> player.start(samples[<span class="hljs-number">0</span>]));
  });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></code></pre>
				<p>We also have an <a href="https://cdn.jsdelivr.net/npm/@magenta/music@%5E1.0.0">ES5 bundle</a> that contains all the models and the core functions, but using in production is not recommended due to its size.</p>
				<a href="#in-node" id="in-node" style="color: inherit; text-decoration: none;">
					<h3>In Node</h3>
				</a>
				<p>You can use <a href="https://www.npmjs.com/package/@magenta/music">@magenta/music</a> in your project using <a href="https://yarnpkg.com/en/">yarn</a>
					(by calling <code>yarn add @magenta/music</code>) <strong>or</strong> <a href="https://docs.npmjs.com/cli/npm">npm</a>
				(by calling <code>npm install --save @magenta/music</code>).</p>
				<p>The node-specific bundles (that don&#39;t transpile the CommonJS modules) are under
				<code>@magenta/music/node</code>. For example:</p>
				<pre><code class="language-js"><span class="hljs-keyword">const</span> mvae = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@magenta/music/node/music_vae'</span>);
<span class="hljs-keyword">const</span> core = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@magenta/music/node/core'</span>);

<span class="hljs-comment">// Your code:</span>
<span class="hljs-keyword">const</span> model = <span class="hljs-keyword">new</span> mvae.MusicVAE(<span class="hljs-string">'/path/to/checkpoint'</span>);
<span class="hljs-keyword">const</span> player = <span class="hljs-keyword">new</span> core.Player();
model
  .initialize()
  .then(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> model.sample(<span class="hljs-number">1</span>))
  .then(<span class="hljs-function"><span class="hljs-params">samples</span> =&gt;</span> {
    player.resumeContext();
    player.start(samples[<span class="hljs-number">0</span>])
  });</code></pre>
				<a href="#example-commands" id="example-commands" style="color: inherit; text-decoration: none;">
					<h4>Example Commands</h4>
				</a>
				<p><code>yarn install</code> to install dependencies.</p>
				<p><code>yarn test</code> to run tests.</p>
				<p><code>yarn build</code> to produce the different bundled versions.</p>
				<p><code>yarn run-demos</code> to build and serve the demos, with live reload.</p>
				<p><em>(Note: the default behavior is to build/watch all demos - specific demos can be built by passing a comma-separated list of specific demo names as follows: <code>yarn run-demos --demos=transcription,visualizer</code>)</em></p>
				<a href="#supported-models" id="supported-models" style="color: inherit; text-decoration: none;">
					<h2>Supported Models</h2>
				</a>
				<p>We have made an effort to port our most useful models, but please file an issue if you think something is
				missing, or feel free to submit a Pull Request!</p>
				<a href="#piano-transcription-w-onsets-and-frames" id="piano-transcription-w-onsets-and-frames" style="color: inherit; text-decoration: none;">
					<h3>Piano Transcription w/ Onsets and Frames</h3>
				</a>
				<p><a href="https://magenta.github.io/magenta-js/music/classes/_transcription_model_.onsetsandframes.html">OnsetsAndFrames</a> implements Magenta&#39;s <a href="g.co/magenta/onsets-frames">piano transcription model</a> for converting raw audio to MIDI in the browser. While it is somewhat flexible, it works best on solo piano recordings. The algorithm takes half the duration of audio to run on most browsers, but due to a <a href="https://github.com/WebKit/webkit/blob/4a4870b75b95a836b516163d45a5cbd6f5222562/Source/WebCore/Modules/webaudio/AudioContext.cpp#L109">Webkit bug</a>, audio resampling will make this significantly slower on Safari.</p>
				<p><strong>‚≠êÔ∏èDemo:</strong> <a href="https://piano-scribe.glitch.me">Piano Scribe</a></p>
				<a href="#musicrnn" id="musicrnn" style="color: inherit; text-decoration: none;">
					<h3>MusicRNN</h3>
				</a>
				<p><a href="https://magenta.github.io/magenta-js/music/classes/_music_rnn_model_.musicrnn.html">MusicRNN</a> implements Magenta&#39;s LSTM-based language models. These include <a href="https://github.com/tensorflow/magenta/tree/master/magenta/models/melody_rnn">MelodyRNN</a>, <a href="https://github.com/tensorflow/magenta/tree/master/magenta/models/drums_rnn">DrumsRNN</a>, <a href="https://github.com/tensorflow/magenta/tree/master/magenta/models/improv_rnn">ImprovRNN</a>, and <a href="https://github.com/tensorflow/magenta/tree/master/magenta/models/performance_rnn">PerformanceRNN</a>.</p>
				<p><strong>‚≠êÔ∏èDemo:</strong> <a href="https://goo.gl/magenta/neuraldrum">Neural Drum Machine</a></p>
				<a href="#musicvae" id="musicvae" style="color: inherit; text-decoration: none;">
					<h3>MusicVAE</h3>
				</a>
				<p><a href="https://magenta.github.io/magenta-js/music/classes/_music_vae_model_.musicvae.html">MusicVAE</a> implements several configurations of Magenta&#39;s variational autoencoder model called <a href="https://g.co/magenta/musicvae">MusicVAE</a> including melody and drum &quot;loop&quot; models, 4- and 16-bar &quot;trio&quot; models, chord-conditioned <a href="https://g.co/magenta/multitrack">multi-track</a> models, and drum performance &quot;humanizations&quot; with <a href="https://g.co/magenta/groovae">GrooVAE</a>.</p>
				<p><strong>‚≠êÔ∏èDemo:</strong> <a href="https://goo.gl/magenta/endless-trios">Endless Trios</a></p>
				<a href="#midime" id="midime" style="color: inherit; text-decoration: none;">
					<h3>MidiMe</h3>
				</a>
				<p><a href="https://g.co/magenta/pianogenie">MidiMe</a> allows you to personalize a pre-trained
					MusicVAE model by quickly training a smaller model directly in the browser,
				with very little user data.</p>
				<p><strong>‚≠êÔ∏èDemo:</strong> <a href="https://midi-me.glitch.me/">MidiMe</a></p>
				<a href="#piano-genie" id="piano-genie" style="color: inherit; text-decoration: none;">
					<h3>Piano Genie</h3>
				</a>
				<p><a href="https://g.co/magenta/pianogenie">Piano Genie</a> is a VQ-VAE model that maps 8-button input to a full 88-key piano in real time.</p>
				<p><strong>‚≠êÔ∏èDemo:</strong> <a href="https://goo.gl/magenta/piano-genie">Piano Genie</a></p>
				<a href="#gansynth" id="gansynth" style="color: inherit; text-decoration: none;">
					<h3>GANSynth</h3>
				</a>
				<p><a href="https://magenta.tensorflow.org/gansynth">GANSynth</a> is a method for generating high-fidelity audio with Generative Adversarial Networks (GANs).</p>
				<p><strong>‚≠êÔ∏èDemo:</strong> <a href="https://ganharp.ctpt.co/">GANHarp</a> by <a href="https://ctpt.co/">Counterpoint</a>.</p>
				<a href="#model-checkpoints" id="model-checkpoints" style="color: inherit; text-decoration: none;">
					<h2>Model Checkpoints</h2>
				</a>
				<p>Most <code>@magenta/music</code> models (with the exception of MidiMe) do not support training in the browser
				(because they require a large amount of data, which would take an incredibly long time), and they use weights from a model trained with the Python-based <a href="https://github.com/tensorflow/magenta/tree/master/magenta/models">Magenta models</a>. We are also making available our own hosted pre-trained checkpoints.</p>
				<a href="#pre-trained-hosted-checkpoints" id="pre-trained-hosted-checkpoints" style="color: inherit; text-decoration: none;">
					<h3>Pre-trained hosted checkpoints</h3>
				</a>
				<p>Several pre-trained checkpoints for all of our models are available and hosted on GCS. The full list is available in <a href="https://github.com/tensorflow/magenta-js/blob/master/music/checkpoints/README.md#table">this table</a> and can be accessed programmatically via a JSON index <a href="https://goo.gl/magenta/js-checkpoints-json">here</a>.</p>
				<a href="#your-own-checkpoints" id="your-own-checkpoints" style="color: inherit; text-decoration: none;">
					<h3>Your own checkpoints</h3>
				</a>
				<a href="#dumping-your-weights" id="dumping-your-weights" style="color: inherit; text-decoration: none;">
					<h4>Dumping your weights</h4>
				</a>
				<p>To use your own checkpoints with one of our models, you must first convert the weights to the appropriate format using the provided <a href="https://github.com/tensorflow/magenta-js/blob/master/scripts/checkpoint_converter.py">checkpoint_converter</a> script.</p>
				<p>This tool is dependent on <a href="https://github.com/tensorflow/tfjs-converter">tfjs-converter</a>, which you must first install using <code>pip install tensorflowjs</code>. Once installed, you can execute the script as follows:</p>
				<pre><code class="language-bash">../scripts/checkpoint_converter.py /path/to/model.ckpt /path/to/output_dir</code></pre>
				<p>There are additional flags available to reduce the size of the output by removing unused (training) variables or using weight quantization. Call <code>../scripts/checkpoint_converter.py -h</code> to list the available options.</p>
				<a href="#specifying-the-model-configuration" id="specifying-the-model-configuration" style="color: inherit; text-decoration: none;">
					<h4>Specifying the Model Configuration</h4>
				</a>
				<p>The model configuration should be placed in a JSON file named <code>config.json</code> in the same directory as your checkpoint. This configuration file contains all the information needed (besides the weights) to instantiate and run your model: the model type and data converter specification plus optional chord encoding, auxiliary inputs, and attention length. An example <code>config.json</code> file might look like:</p>
				<pre><code class="language-json">{
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"MusicRNN"</span>,
  <span class="hljs-attr">"dataConverter"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"MelodyConverter"</span>,
    <span class="hljs-attr">"args"</span>: {
      <span class="hljs-attr">"minPitch"</span>: <span class="hljs-number">48</span>,
      <span class="hljs-attr">"maxPitch"</span>: <span class="hljs-number">83</span>
    }
  },
  <span class="hljs-attr">"chordEncoder"</span>: <span class="hljs-string">"PitchChordEncoder"</span>
}</code></pre>
				<p>This configuration corresponds to a chord-conditioned melody MusicRNN model.</p>
				<a href="#soundfonts" id="soundfonts" style="color: inherit; text-decoration: none;">
					<h2>SoundFonts</h2>
				</a>
				<p>There are several SoundFonts that you can use with the <code>mm.SoundFontPlayer</code>,
				for more realistic sounding instruments:</p>
				<table>
					<thead>
						<tr>
							<th>Instrument</th>
							<th>URL</th>
							<th>License</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>Piano</td>
							<td><a href="https://storage.googleapis.com/magentadata/js/soundfonts/salamander">salamander</a></td>
							<td>Audio samples from <a href="https://archive.org/details/SalamanderGrandPianoV3">Salamander Grand Piano</a></td>
						</tr>
						<tr>
							<td>Multi</td>
							<td><a href="https://storage.googleapis.com/magentadata/js/soundfonts/sgm_plus">sgm_plus</a></td>
							<td>Audio samples based on <a href="https://www.polyphone-soundfonts.com/en/files/27-instrument-sets/256-sgm-v2-01">SGM</a> with modifications by <a href="https://sites.google.com/site/soundfonts4u/">John Nebauer</a></td>
						</tr>
						<tr>
							<td>Percussion</td>
							<td><a href="https://storage.googleapis.com/magentadata/js/soundfonts/jazz_kit">jazz_kit</a></td>
							<td>Audio samples from <a href="https://musical-artifacts.com/artifacts/686">Jazz Kit (EXS)</a> by Lithalean</td>
						</tr>
				</tbody></table>
				<p>You can explore what each of them sounds like on this <a href="https://magenta.github.io/magenta-js/music/demos/player.html#soundfonts">demo page</a>.</p>
				<a href="#how-tos" id="how-tos" style="color: inherit; text-decoration: none;">
					<h2>How Tos</h2>
				</a>
				<a href="#use-with-a-webworker" id="use-with-a-webworker" style="color: inherit; text-decoration: none;">
					<h3>Use with a WebWorker</h3>
				</a>
				<p>A <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Using_web_workers">WebWorker</a> is a script that can run in the background,
					separate from the main UI thread. This allows you to perform expensive computatios (like
					model inference, etc) without blocking any of the user interaction (like animations, scrolling, etc).
					All <code>@magenta/music</code> models should work in a WebWorker,
					<em>except for</em> GANSynth and Onsets and Frames, which need to use the browser&#39;s AudioContext
					to manipulate audio data. (You can work around this by separating the audio processing code
				from the actual inference code, but we don&#39;t currently have an example of this).</p>
				<p>Here is an example of using a MusicVAE model in a WebWorker. In your main <code>app.js</code>,</p>
				<pre><code class="language-js"><span class="hljs-keyword">const</span> worker = <span class="hljs-keyword">new</span> Worker(<span class="hljs-string">'worker.js'</span>);

<span class="hljs-comment">// Tell the worker to use the model</span>
worker.postMessage({<span class="hljs-attr">sequence</span>: someNoteSequence});

<span class="hljs-comment">// Worker returns the result.</span>
worker.onmessage = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (event.data.fyi) {
    <span class="hljs-built_in">console</span>.log(event.data.fyi);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">const</span> sample = event.data.sample;
    <span class="hljs-comment">// Do something with this sample</span>
  }
};</code></pre>
				<p>In your worker, <code>worker.js</code>,</p>
				<pre><code class="language-js">importScripts(<span class="hljs-string">"https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.4.0/dist/tf.min.js"</span>);
importScripts(<span class="hljs-string">"https://cdn.jsdelivr.net/npm/@magenta/music@^1.12.0/es6/core.js"</span>);
importScripts(<span class="hljs-string">"https://cdn.jsdelivr.net/npm/@magenta/music@^1.12.0/es6/music_vae.js"</span>);

<span class="hljs-keyword">const</span> mvae = <span class="hljs-keyword">new</span> music_vae.MusicVAE(<span class="hljs-string">'https://storage.googleapis.com/magentadata/js/checkpoints/music_vae/mel_2bar_small'</span>);

<span class="hljs-comment">// Main script asks for work.</span>
self.onmessage = <span class="hljs-keyword">async</span> (e) =&gt; {
  <span class="hljs-keyword">if</span> (!mvae.isInitialized()) {
    <span class="hljs-keyword">await</span> mvae.initialize();
    postMessage({<span class="hljs-attr">fyi</span>: <span class="hljs-string">'model initialized'</span>});
  }

  <span class="hljs-keyword">const</span> output = <span class="hljs-keyword">await</span> mvae.sample(<span class="hljs-number">1</span>);
  <span class="hljs-comment">// Send main script the result.</span>
  postMessage({<span class="hljs-attr">sample</span>: output[<span class="hljs-number">0</span>]});
};</code></pre>
				<a href="#use-with-a-serviceworker" id="use-with-a-serviceworker" style="color: inherit; text-decoration: none;">
					<h3>Use with a ServiceWorker</h3>
				</a>
				<p>A <a href="https://developers.google.com/web/fundamentals/primers/service-workers">ServiceWorker</a> is a script that your browser runs in the background, separate from a web page. In particular, ServiceWorkers allow
					you to provide offline interactions by controlling what data your browser caches (like soundfont files,
				model checkpoint chunks). For a full example, check out the <a href="https://piano-genie-pwa.glitch.me/">Piano Genie PWA</a> code, that lets you install Piano Genie as a PWA app, and use it entirely offline.</p>
				<p>This is also extremely useful if you want to test a very large model checkpoint, but
				don&#39;t want to download it every time you refresh the page.</p>
				<p>The main things to look out for are the <a href="https://glitch.com/edit/#!/piano-genie-pwa?path=manifest.json:2:12">manifest.json</a> and the <a href="https://glitch.com/edit/#!/piano-genie-pwa?path=index.html:15:4">meta tags</a>. Then, in your main script, load the service worker:</p>
				<pre><code class="language-js">  <span class="hljs-comment">// Force HTTP.</span>
  <span class="hljs-keyword">if</span> (location.protocol == <span class="hljs-string">'http:'</span>) location.protocol = <span class="hljs-string">'https:'</span>;
  <span class="hljs-keyword">if</span>(<span class="hljs-string">'serviceWorker'</span> <span class="hljs-keyword">in</span> navigator) {
    navigator.serviceWorker.register(<span class="hljs-string">'/sw.js'</span>)
      .then(<span class="hljs-function"><span class="hljs-params">reg</span> =&gt;</span> <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Service Worker registered'</span>, reg))
      .catch(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Service Worker **not** registered'</span>, err));
  }
  <span class="hljs-keyword">else</span> {
    <span class="hljs-built_in">console</span>.warn(<span class="hljs-string">'Service Worker not supported in this browser'</span>);
  }</code></pre>
				<p>In <code>sw.js</code>,</p>
				<pre><code class="language-js">self.addEventListener(<span class="hljs-string">'install'</span>, e =&gt; {
  e.waitUntil(
  (<span class="hljs-keyword">async</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">const</span> cache = <span class="hljs-keyword">await</span> caches.open(<span class="hljs-string">"your-app-name-assets"</span>);

    <span class="hljs-keyword">const</span> resources = [
      <span class="hljs-comment">// Static files you want to cache.</span>
      <span class="hljs-string">"index.html"</span>,
      <span class="hljs-string">"style.css"</span>,
      <span class="hljs-string">"script.js"</span>,
      <span class="hljs-string">"helpers.js"</span>,
      <span class="hljs-string">"manifest.json"</span>,
      <span class="hljs-comment">// A built, minified bundle of dependencies.</span>
      <span class="hljs-string">"magenta-1.7.0.js"</span>,
      <span class="hljs-comment">// SoundFont manifest.</span>
      <span class="hljs-string">'https://storage.googleapis.com/magentadata/js/soundfonts/sgm_plus/soundfont.json'</span>,
      <span class="hljs-comment">// Model checkpoint.</span>
      <span class="hljs-string">"https://storage.googleapis.com/magentadata/js/checkpoints/piano_genie/model/epiano/stp_iq_auto_contour_dt_166006/weights_manifest.json"</span>,
      <span class="hljs-string">"https://storage.googleapis.com/magentadata/js/soundfonts/sgm_plus/acoustic_grand_piano/instrument.json"</span>,
      <span class="hljs-comment">// List here all the actual shards of your model.</span>
      <span class="hljs-string">"https://storage.googleapis.com/magentadata/js/checkpoints/piano_genie/model/epiano/stp_iq_auto_contour_dt_166006/group1-shard1of1"</span>
    ];
    <span class="hljs-comment">// The actual SoundFont files you will use.</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">21</span>; i &lt; <span class="hljs-number">105</span>; i++) {
      resources.push(<span class="hljs-string">`https://storage.googleapis.com/magentadata/js/soundfonts/sgm_plus/acoustic_grand_piano/p<span class="hljs-subst">${i}</span>_v79.mp3`</span>)
    }

    <span class="hljs-comment">// Cache all of these</span>
    <span class="hljs-keyword">const</span> local = cache.addAll(resources);
    <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all([local]);
  })()
  );
});

self.addEventListener(<span class="hljs-string">'fetch'</span>, e =&gt; {
  <span class="hljs-comment">// If the resource is cached, send it.</span>
  e.respondWith(caches.match(e.request).then(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r || fetch(e.request)))
});</code></pre>
				<a href="#use-with-typescript" id="use-with-typescript" style="color: inherit; text-decoration: none;">
					<h3>Use with TypeScript</h3>
				</a>
				<p>If you want to use <code>@magenta/music</code> as a dependency in a TypeScript project,
					here is a <a href="https://github.com/notwaldorf/example-magenta-in-ts/">sample project</a>
				that does that and uses webpack to build and transpile it.</p>
				<!-- links -->
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="globals.html"><em>Globals</em></a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_coconet_.html">&quot;coconet&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_coconet_coconet_utils_.html">&quot;coconet/coconet_<wbr>utils&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_coconet_model_.html">&quot;coconet/model&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_core_.html">&quot;core&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_core_audio_utils_.html">&quot;core/audio_<wbr>utils&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_core_aux_inputs_.html">&quot;core/aux_<wbr>inputs&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_core_chords_.html">&quot;core/chords&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_core_compat_global_.html">&quot;core/compat/global&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_core_compat_global_browser_.html">&quot;core/compat/global_<wbr>browser&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_core_compat_global_node_.html">&quot;core/compat/global_<wbr>node&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_core_compat_navigator_node_.html">&quot;core/compat/navigator_<wbr>node&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_core_compat_performance_node_.html">&quot;core/compat/performance_<wbr>node&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_core_constants_.html">&quot;core/constants&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_core_data_.html">&quot;core/data&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_core_logging_.html">&quot;core/logging&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_core_melodies_.html">&quot;core/melodies&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_core_metronome_.html">&quot;core/metronome&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_core_midi_io_.html">&quot;core/midi_<wbr>io&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_core_performance_.html">&quot;core/performance&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_core_player_.html">&quot;core/player&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_core_recorder_.html">&quot;core/recorder&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_core_sequences_.html">&quot;core/sequences&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_core_soundfont_.html">&quot;core/soundfont&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_core_visualizer_.html">&quot;core/visualizer&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_gansynth_.html">&quot;gansynth&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_gansynth_audio_utils_.html">&quot;gansynth/audio_<wbr>utils&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_gansynth_constants_.html">&quot;gansynth/constants&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_gansynth_custom_layers_.html">&quot;gansynth/custom_<wbr>layers&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_gansynth_mel_sparse_coeffs_.html">&quot;gansynth/mel_<wbr>sparse_<wbr>coeffs&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_gansynth_model_.html">&quot;gansynth/model&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_music_rnn_.html">&quot;music_<wbr>rnn&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_music_rnn_attention_.html">&quot;music_<wbr>rnn/attention&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_music_rnn_model_.html">&quot;music_<wbr>rnn/model&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_music_vae_.html">&quot;music_<wbr>vae&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_music_vae_midi_me_.html">&quot;music_<wbr>vae/midi_<wbr>me&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_music_vae_model_.html">&quot;music_<wbr>vae/model&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_piano_genie_.html">&quot;piano_<wbr>genie&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_piano_genie_model_.html">&quot;piano_<wbr>genie/model&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_protobuf_.html">&quot;protobuf&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_transcription_.html">&quot;transcription&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_transcription_audio_utils_.html">&quot;transcription/audio_<wbr>utils&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_transcription_constants_.html">&quot;transcription/constants&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_transcription_model_.html">&quot;transcription/model&quot;</a>
					</li>
					<li class=" tsd-kind-external-module">
						<a href="modules/_transcription_transcription_utils_.html">&quot;transcription/transcription_<wbr>utils&quot;</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-module"><span class="tsd-kind-icon">Module</span></li>
				<li class="tsd-kind-object-literal"><span class="tsd-kind-icon">Object literal</span></li>
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-function tsd-has-type-parameter"><span class="tsd-kind-icon">Function with type parameter</span></li>
				<li class="tsd-kind-index-signature"><span class="tsd-kind-icon">Index signature</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
				<li class="tsd-kind-type-alias tsd-has-type-parameter"><span class="tsd-kind-icon">Type alias with type parameter</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li>
				<li class="tsd-kind-enum-member"><span class="tsd-kind-icon">Enumeration member</span></li>
				<li class="tsd-kind-property tsd-parent-kind-enum"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-enum"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
				<li class="tsd-kind-interface tsd-has-type-parameter"><span class="tsd-kind-icon">Interface with type parameter</span></li>
				<li class="tsd-kind-constructor tsd-parent-kind-interface"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li>
				<li class="tsd-kind-index-signature tsd-parent-kind-interface"><span class="tsd-kind-icon">Index signature</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
				<li class="tsd-kind-class tsd-has-type-parameter"><span class="tsd-kind-icon">Class with type parameter</span></li>
				<li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class"><span class="tsd-kind-icon">Accessor</span></li>
				<li class="tsd-kind-index-signature tsd-parent-kind-class"><span class="tsd-kind-icon">Index signature</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static property</span></li>
				<li class="tsd-kind-call-signature tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="assets/js/search.js"><' + '/script>');</script>
</body>
</html><script> const toc = "core coconet music_rnn music_vae piano_genie protobuf transcription gansynth".split(' '); const links = document.querySelectorAll('.tsd-kind-external-module'); for (let i = 0; i < links.length; i++) { const name = links[i].textContent.trim().replace(/"/g, ''); if (toc.indexOf(name) === -1) { links[i].parentNode.removeChild(links[i]); } } </script>
