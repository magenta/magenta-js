!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.mm=t():e.mm=t()}(global,(function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=39)}([function(e,t){e.exports=require("@tensorflow/tfjs")},function(e,t,n){"use strict";n.r(t),n.d(t,"DEFAULT_QUARTERS_PER_MINUTE",(function(){return i})),n.d(t,"DEFAULT_STEPS_PER_BAR",(function(){return r})),n.d(t,"DEFAULT_STEPS_PER_QUARTER",(function(){return o})),n.d(t,"DEFAULT_STEPS_PER_SECOND",(function(){return s})),n.d(t,"DEFAULT_VELOCITY",(function(){return a})),n.d(t,"DEFAULT_PROGRAM",(function(){return c})),n.d(t,"DEFAULT_TICKS_PER_QUARTER",(function(){return u})),n.d(t,"DEFAULT_CHANNEL",(function(){return l})),n.d(t,"DRUM_CHANNEL",(function(){return h})),n.d(t,"NON_DRUM_CHANNELS",(function(){return p})),n.d(t,"DEFAULT_DRUM_PITCH_CLASSES",(function(){return d})),n.d(t,"MIN_MIDI_VELOCITY",(function(){return m})),n.d(t,"MAX_MIDI_VELOCITY",(function(){return f})),n.d(t,"MIDI_VELOCITIES",(function(){return g})),n.d(t,"NO_CHORD",(function(){return S})),n.d(t,"NUM_PITCH_CLASSES",(function(){return y})),n.d(t,"MIN_MIDI_PITCH",(function(){return w})),n.d(t,"MAX_MIDI_PITCH",(function(){return b})),n.d(t,"MIDI_PITCHES",(function(){return v})),n.d(t,"MIN_PIANO_PITCH",(function(){return N})),n.d(t,"MAX_PIANO_PITCH",(function(){return T})),n.d(t,"MIN_DRUM_PITCH",(function(){return P})),n.d(t,"MAX_DRUM_PITCH",(function(){return O})),n.d(t,"MIN_MIDI_PROGRAM",(function(){return q})),n.d(t,"MAX_MIDI_PROGRAM",(function(){return A})),n.d(t,"LO_CLICK_PITCH",(function(){return E})),n.d(t,"HI_CLICK_PITCH",(function(){return I})),n.d(t,"LO_CLICK_CLASS",(function(){return z})),n.d(t,"HI_CLICK_CLASS",(function(){return _}));const i=120,r=16,o=4,s=100,a=80,c=0,u=220,l=0,h=9,p=[0,1,2,3,4,5,6,7,8,10,11,12,13,14,15],d=[[36,35],[38,27,28,31,32,33,34,37,39,40,56,65,66,75,85],[42,44,54,68,69,70,71,73,78,80],[46,67,72,74,79,81],[45,29,41,61,64,84],[48,47,60,63,77,86,87],[50,30,43,62,76,83],[49,55,57,58],[51,52,53,59,82]],m=0,f=127,g=f-m+1,S="N.C.",y=12,w=0,b=127,v=b-w+1,N=21,T=108,P=35,O=81,q=0,A=127,E=89,I=90,z=9,_=10},function(e,t){e.exports=require("tone")},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var i=n(13),r=i.tensorflow.magenta.NoteSequence},function(e,t,n){"use strict";n.r(t),n.d(t,"Level",(function(){return i})),n.d(t,"verbosity",(function(){return o})),n.d(t,"setVerbosity",(function(){return s})),n.d(t,"log",(function(){return a})),n.d(t,"logWithDuration",(function(){return c}));var i,r=n(6);!function(e){e[e.NONE=0]="NONE",e[e.WARN=5]="WARN",e[e.INFO=10]="INFO",e[e.DEBUG=20]="DEBUG"}(i||(i={}));let o=10;function s(e){e=e}function a(e,t="Magenta.js",n=10){if(0===n)throw Error("Logging level cannot be NONE.");if(o>=n){(5===n?console.warn:console.log)(`%c ${t} `,"background:magenta; color:white",e)}}function c(e,t,n="Magenta.js",i=10){a(`${e} in ${((r.d.now()-t)/1e3).toPrecision(3)}s`,n,i)}},function(e,t,n){"use strict";n.r(t),n.d(t,"MultipleTimeSignatureException",(function(){return o})),n.d(t,"BadTimeSignatureException",(function(){return s})),n.d(t,"NegativeTimeException",(function(){return a})),n.d(t,"MultipleTempoException",(function(){return c})),n.d(t,"QuantizationStatusException",(function(){return u})),n.d(t,"clone",(function(){return l})),n.d(t,"stepsPerQuarterToStepsPerSecond",(function(){return h})),n.d(t,"quantizeToStep",(function(){return p})),n.d(t,"quantizeNoteSequence",(function(){return f})),n.d(t,"isQuantizedSequence",(function(){return g})),n.d(t,"assertIsQuantizedSequence",(function(){return S})),n.d(t,"isRelativeQuantizedSequence",(function(){return y})),n.d(t,"assertIsRelativeQuantizedSequence",(function(){return w})),n.d(t,"isAbsoluteQuantizedSequence",(function(){return b})),n.d(t,"assertIsAbsoluteQuantizedSequence",(function(){return v})),n.d(t,"unquantizeSequence",(function(){return N})),n.d(t,"createQuantizedNoteSequence",(function(){return T})),n.d(t,"mergeInstruments",(function(){return P})),n.d(t,"replaceInstruments",(function(){return O})),n.d(t,"mergeConsecutiveNotes",(function(){return q})),n.d(t,"applySustainControlChanges",(function(){return A})),n.d(t,"concatenate",(function(){return E})),n.d(t,"trim",(function(){return I})),n.d(t,"split",(function(){return C}));var i=n(3),r=n(1);class o extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class s extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class a extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class c extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class u extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}function l(e){return i.a.decode(i.a.encode(e).finish())}function h(e,t){return e*t/60}function p(e,t,n=.5){const i=e*t;return Math.floor(i+(1-n))}function d(e){return e.controlChanges.concat(e.textAnnotations)}function m(e){if(e.tempos&&0!==e.tempos.length){if(e.tempos.sort((e,t)=>e.time-t.time),0!==e.tempos[0].time&&e.tempos[0].qpm!==r.DEFAULT_QUARTERS_PER_MINUTE)throw new c("NoteSequence has an implicit tempo change from initial "+r.DEFAULT_QUARTERS_PER_MINUTE+" qpm to "+`${e.tempos[0].qpm} qpm at ${e.tempos[0].time} seconds.`);for(let t=1;t<e.tempos.length;t++)if(e.tempos[t].qpm!==e.tempos[0].qpm)throw new c(`NoteSequence has at least one tempo change from ${e.tempos[0].qpm} qpm to ${e.tempos[t].qpm}qpm at ${e.tempos[t].time} seconds.`)}}function f(e,t){const n=l(e);if(n.quantizationInfo=i.a.QuantizationInfo.create({stepsPerQuarter:t}),n.timeSignatures.length>0){if(n.timeSignatures.sort((e,t)=>e.time-t.time),0!==n.timeSignatures[0].time&&(4!==n.timeSignatures[0].numerator||4!==n.timeSignatures[0].denominator))throw new o(`NoteSequence has an implicit change from initial 4/4 time signature to ${n.timeSignatures[0].numerator}/`+n.timeSignatures[0].denominator+" at "+n.timeSignatures[0].time+" seconds.");for(let e=1;e<n.timeSignatures.length;e++){const t=n.timeSignatures[e];if(t.numerator!==n.timeSignatures[0].numerator||t.denominator!==n.timeSignatures[0].denominator)throw new o("NoteSequence has at least one time signature change from "+n.timeSignatures[0].numerator+"/"+n.timeSignatures[0].denominator+" to "+`${t.numerator}/${t.denominator} `+`at ${t.time} seconds`)}n.timeSignatures[0].time=0,n.timeSignatures=[n.timeSignatures[0]]}else{const e=i.a.TimeSignature.create({numerator:4,denominator:4,time:0});n.timeSignatures.push(e)}const c=n.timeSignatures[0];if(!(u=c.denominator)||0!=(u&u-1))throw new s(`Denominator is not a power of 2. Time signature: ${c.numerator}/${c.denominator}`);var u;if(0===c.numerator)throw new s(`Numerator is 0. Time signature: ${c.numerator}/${c.denominator}`);if(n.tempos.length>0)m(n),n.tempos[0].time=0,n.tempos=[n.tempos[0]];else{const e=i.a.Tempo.create({qpm:r.DEFAULT_QUARTERS_PER_MINUTE,time:0});n.tempos.push(e)}const f=h(t,n.tempos[0].qpm);return n.totalQuantizedSteps=p(e.totalTime,f),function(e,t){for(const n of e.notes){if(n.quantizedStartStep=p(n.startTime,t),n.quantizedEndStep=p(n.endTime,t),n.quantizedEndStep===n.quantizedStartStep&&(n.quantizedEndStep+=1),n.quantizedStartStep<0||n.quantizedEndStep<0)throw new a("Got negative note time: start_step = "+n.quantizedStartStep+", end_step = "+n.quantizedEndStep);n.quantizedEndStep>e.totalQuantizedSteps&&(e.totalQuantizedSteps=n.quantizedEndStep)}d(e).forEach(e=>{if(e.quantizedStep=p(e.time,t),e.quantizedStep<0)throw new a("Got negative event time: step = "+e.quantizedStep)})}(n,f),n}function g(e){return e.quantizationInfo&&(e.quantizationInfo.stepsPerQuarter>0||e.quantizationInfo.stepsPerSecond>0)}function S(e){if(!g(e))throw new u(`NoteSequence ${e.id} is not quantized (missing quantizationInfo)`)}function y(e){return e.quantizationInfo&&e.quantizationInfo.stepsPerQuarter>0}function w(e){if(!y(e))throw new u(`NoteSequence ${e.id} is not quantized or is quantized based on absolute timing`)}function b(e){return e.quantizationInfo&&e.quantizationInfo.stepsPerSecond>0}function v(e){if(!b(e))throw new u(`NoteSequence ${e.id} is not quantized or is quantized based on relative timing`)}function N(e,t){w(e),m(e);const n=l(e);t?n.tempos&&n.tempos.length>0?n.tempos[0].qpm=t:n.tempos.push(i.a.Tempo.create({time:0,qpm:t})):t=e.tempos&&e.tempos.length>0?n.tempos[0].qpm:r.DEFAULT_QUARTERS_PER_MINUTE;const o=e=>e/n.quantizationInfo.stepsPerQuarter*(60/t);return n.totalTime=o(n.totalQuantizedSteps),n.notes.forEach(e=>{e.startTime=o(e.quantizedStartStep),e.endTime=o(e.quantizedEndStep),n.totalTime=Math.max(n.totalTime,e.endTime),delete e.quantizedStartStep,delete e.quantizedEndStep}),d(n).forEach(e=>{e.time=o(e.time)}),delete n.totalQuantizedSteps,delete n.quantizationInfo,n}function T(e=r.DEFAULT_STEPS_PER_QUARTER,t=r.DEFAULT_QUARTERS_PER_MINUTE){return i.a.create({quantizationInfo:{stepsPerQuarter:e},tempos:[{qpm:t}]})}function P(e){const t=l(e),n=t.notes.concat(t.pitchBends).concat(t.controlChanges),i=Array.from(new Set(n.filter(e=>!e.isDrum).map(e=>e.program)));return n.forEach(e=>{e.isDrum?(e.program=0,e.instrument=i.length):e.instrument=i.indexOf(e.program)}),t}function O(e,t){const n=new Set(e.notes.map(e=>e.instrument)),r=new Set(t.notes.map(e=>e.instrument)),o=[];e.notes.forEach(e=>{r.has(e.instrument)||o.push(i.a.Note.create(e))}),t.notes.forEach(e=>{n.has(e.instrument)&&o.push(i.a.Note.create(e))});const s=l(e);return s.notes=o.sort((e,t)=>{const n=e.instrument-t.instrument;return n||e.quantizedStartStep-t.quantizedStartStep}),s}function q(e){S(e);const t=l(e);t.notes=[];const n=e.notes.sort((e,t)=>{const n=e.instrument-t.instrument;return n||e.quantizedStartStep-t.quantizedStartStep}),r=new i.a.Note;r.pitch=n[0].pitch,r.instrument=n[0].instrument,r.quantizedStartStep=n[0].quantizedStartStep,r.quantizedEndStep=n[0].quantizedEndStep,t.notes.push(r);let o=0;for(let e=1;e<n.length;e++){const r=n[e],s=t.notes[o];if(s.instrument===r.instrument&&s.pitch===r.pitch&&r.quantizedStartStep===s.quantizedEndStep&&r.quantizedStartStep%16!=0)t.notes[o].quantizedEndStep+=r.quantizedEndStep-r.quantizedStartStep;else{const r=new i.a.Note;r.pitch=n[e].pitch,r.instrument=n[e].instrument,r.quantizedStartStep=n[e].quantizedStartStep,r.quantizedEndStep=n[e].quantizedEndStep,t.notes.push(r),o++}}return t}function A(e,t=64){let n;!function(e){e[e.SUSTAIN_ON=0]="SUSTAIN_ON",e[e.SUSTAIN_OFF=1]="SUSTAIN_OFF",e[e.NOTE_ON=2]="NOTE_ON",e[e.NOTE_OFF=3]="NOTE_OFF"}(n||(n={}));if(g(e))throw new Error("Can only apply sustain to unquantized NoteSequence.");const i=l(e),r=[];for(const e of i.notes)!1===e.isDrum&&(null!==e.startTime&&r.push({time:e.startTime,type:n.NOTE_ON,event:e}),null!==e.endTime&&r.push({time:e.endTime,type:n.NOTE_OFF,event:e}));for(const e of i.controlChanges)if(e.controlNumber===t){const t=e.controlValue;t>=64?r.push({time:e.time,type:n.SUSTAIN_ON,event:e}):t<64&&r.push({time:e.time,type:n.SUSTAIN_OFF,event:e})}r.sort((e,t)=>e.time-t.time);const o={},s={};let a=0;for(const e of r){a=e.time;const t=e.type,r=e.event;if(t===n.SUSTAIN_ON)s[r.instrument]=!0;else if(t===n.SUSTAIN_OFF){s[r.instrument]=!1;const e=[];r.instrument in o||(o[r.instrument]=[]);for(const t of o[r.instrument])t.endTime<a?(t.endTime=a,a>i.totalTime&&(i.totalTime=a)):e.push(t);o[r.instrument]=e}else if(t===n.NOTE_ON){if(!0===s[r.instrument]){const e=[];r.instrument in o||(o[r.instrument]=[]);for(const t of o[r.instrument])t.pitch===r.pitch?(t.endTime=a,t.startTime===t.endTime&&i.notes.push(t)):e.push(t);o[r.instrument]=e}r.instrument in o||(o[r.instrument]=[]),o[r.instrument].push(r)}else if(t===n.NOTE_OFF)if(!0===s[r.instrument]);else{const e=o[r.instrument].indexOf(r);e>-1&&o[r.instrument].splice(e,1)}}for(const e of Object.values(o))for(const t of e)t.endTime=a,i.totalTime=a;return i}function E(e,t){if(t&&t.length!==e.length)throw new Error("Number of sequences to concatenate and their individual\n durations does not match.");if(g(e[0])){for(let t=0;t<e.length;++t)if(S(e[t]),e[t].quantizationInfo.stepsPerQuarter!==e[0].quantizationInfo.stepsPerQuarter)throw new Error("Not all sequences have the same quantizationInfo");return z(e,"totalQuantizedSteps","quantizedStartStep","quantizedEndStep",t)}return z(e,"totalTime","startTime","endTime",t)}function I(e,t,n,i){return g(e)?_(e,t,n,"totalQuantizedSteps","quantizedStartStep","quantizedEndStep",i):_(e,t,n,"totalTime","startTime","endTime",i)}function z(e,t,n,r,o){let s,a=0;for(let c=0;c<e.length;++c){const u=o?o[c]:e[c][t];if(0===u)throw Error(`Sequence ${e[c].id} has no ${t}, and no individual duration was provided.`);0===c?s=l(e[0]):Array.prototype.push.apply(s.notes,e[c].notes.map(e=>{const t=i.a.Note.create(e);return t[n]+=a,t[r]+=a,t})),a+=u}return s[t]=a,s}function _(e,t,n,i,r,o,s){const a=l(e);a[i]=n,a.notes=a.notes.filter(e=>e[r]>=t&&e[r]<=n&&(s||e[o]<=n)),a[i]-=t;for(let e=0;e<a.notes.length;e++)a.notes[e][r]-=t,a.notes[e][o]-=t,s&&(a.notes[e][o]=Math.min(a.notes[e][o],a[i]));return a}function C(e,t){S(e);const n=l(e),r=n.notes.sort((e,t)=>e.quantizedStartStep-t.quantizedStartStep),o=[];let s=0,a=[];for(let e=0;e<r.length;e++){const c=r[e],u=c.quantizedStartStep,h=c.quantizedEndStep;if(c.quantizedStartStep-=s,c.quantizedEndStep-=s,!(c.quantizedStartStep<0))if(c.quantizedEndStep<=t)a.push(c);else{if(c.quantizedStartStep<t){const e=i.a.Note.create(c);e.quantizedEndStep=t,e.startTime=e.endTime=void 0,a.push(e),c.quantizedStartStep=s+t,c.quantizedEndStep=h}else c.quantizedStartStep=u,c.quantizedEndStep=h;if((c.quantizedEndStep>t||c.quantizedStartStep>t)&&(e-=1),0!==a.length){const e=l(n);e.notes=a,e.totalQuantizedSteps=t,o.push(e)}a=[],s+=t}}if(0!==a.length){const e=l(n);e.notes=a,e.totalQuantizedSteps=t,o.push(e)}return o}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return s}));const i=n(18),r=n(19);n(21);function o(){throw new Error("Cannot check if Safari in Node.js")}function s(e){throw new Error("Cannot use offline audio context in Node.js")}},function(e,t){e.exports=require("@tensorflow/tfjs-core")},function(e,t,n){"use strict";n.d(t,"e",(function(){return l})),n.d(t,"d",(function(){return h})),n.d(t,"f",(function(){return p})),n.d(t,"i",(function(){return d})),n.d(t,"j",(function(){return f})),n.d(t,"a",(function(){return S})),n.d(t,"h",(function(){return y})),n.d(t,"b",(function(){return v})),n.d(t,"g",(function(){return T})),n.d(t,"c",(function(){return P}));var i=n(0),r=n(17),o=n(22),s=n(27),a=n(6),c=n(4);const u=Object(a.b)(16e3);async function l(e){return Object(a.a)(e).then(e=>e.arrayBuffer()).then(e=>u.decodeAudioData(e))}async function h(e){const t=new FileReader;return new Promise((n,i)=>{t.onerror=()=>{t.abort(),i(new DOMException("Something went wrong reading that file."))},t.onload=()=>{n(t.result)},t.readAsArrayBuffer(e)}).then(e=>u.decodeAudioData(e))}function p(e,t){t.power||(t.power=2);const n=function(e,t){const n=t.nFft||2048,i=t.winLength||n,r=t.hopLength||Math.floor(i/4);let o=v(i);o=y(o,n);const s=function(e,t,n){const i=Math.floor((e.length-t)/n)+1,r=Array.from({length:i},(e,n)=>new Float32Array(t));for(let o=0;o<i;o++){const i=o*n,s=e.slice(i,i+t);r[o].set(s),s.length}return r}(e=function(e,t){const n=w(e,t);for(let e=0;e<t;e++)n[e]=n[2*t-e],n[n.length-e-1]=n[n.length-2*t+e-1];return n}(e,Math.floor(n/2)),n,r),a=[],c=s.length,u=n+2;for(let e=0;e<c;e++){const t=new Float32Array(u);a[e]=t}for(let e=0;e<c;e++){const t=b(S(s[e],o));a[e].set(t.slice(0,u))}return a}(e,t),[i,r]=function(e,t){const n=e.map(e=>function(e,t){return e.map(e=>Math.pow(e,t))}(function(e){const t=new Float32Array(e.length/2);for(let n=0;n<e.length/2;n++)t[n]=Math.sqrt(e[2*n]*e[2*n]+e[2*n+1]*e[2*n+1]);return t}(e),t)),i=e[0].length-1;return[n,i]}(n,t.power);t.nFft=r;return function(e,t){const n=[];for(let i=0;i<e.length;i++)n[i]=g(e[i],t);return n}(i,function(e){const t=e.fMin||0,n=e.fMax||e.sampleRate/2,i=e.nMels||128,r=e.nFft||2048,o=function(e,t){return N(0,e/2,Math.floor(1+t/2))}(e.sampleRate,r),s=function(e,t,n){const i=O(t),r=O(n),o=N(i,r,e);return o.map(e=>function(e){return 700*(Math.exp(e/1125)-1)}(e))}(i+2,t,n),a=function(e){const t=new Float32Array(e.length-1);for(let n=0;n<e.length;n++)t[n]=e[n+1]-e[n];return t}(s),c=function(e,t){const n=[];for(let i=0;i<e.length;i++)n[i]=new Float32Array(t.length);for(let i=0;i<e.length;i++)for(let r=0;r<t.length;r++)n[i][r]=e[i]-t[r];return n}(s,o),u=c[0].length,l=[];for(let e=0;e<i;e++){l[e]=new Float32Array(u);for(let t=0;t<c[e].length;t++){const n=-c[e][t]/a[e],i=c[e+2][t]/a[e+1],r=Math.max(0,Math.min(n,i));l[e][t]=r}}for(let e=0;e<l.length;e++){const t=2/(s[2+e]-s[e]);l[e]=l[e].map(e=>e*t)}return l}(t))}function d(e,t=1e-10,n=80){const i=e.length,r=e[0].length,o=[];for(let e=0;e<i;e++)o[e]=new Float32Array(r);for(let n=0;n<i;n++)for(let i=0;i<r;i++){const r=e[n][i];o[n][i]=10*Math.log10(Math.max(t,r))}if(n){if(n<0)throw new Error("topDb must be non-negative.");for(let e=0;e<i;e++){const t=o[e].reduce((e,t)=>Math.max(e,t));for(let i=0;i<r;i++)o[e][i]=Math.max(o[e][i],t-n)}}return o}function m(e){if(1===e.numberOfChannels)return e.getChannelData(0);if(2!==e.numberOfChannels)throw Error(e.numberOfChannels+" channel audio is not supported.");const t=e.getChannelData(0),n=e.getChannelData(1),i=new Float32Array(e.length);for(let r=0;r<e.length;++r)i[r]=(t[r]+n[r])/2;return i}async function f(e,t=16e3){if(e.sampleRate===t)return m(e);const n=e.sampleRate,i=e.length*t/n;if(a.c){c.log("Safari does not support WebAudio resampling, so this may be slow.","O&F",5);const t=m(e),n=new Float32Array(i);return s(o(n,[i]),o(t,[t.length])),n}{const n=new OfflineAudioContext(e.numberOfChannels,e.duration*t,t),i=n.createBufferSource();return i.buffer=e,i.connect(n.destination),i.start(),n.startRendering().then(e=>e.getChannelData(0))}}function g(e,t){if(e.length!==t[0].length)throw new Error(`Each entry in filterbank should have dimensions matching FFT. |mags| = ${e.length}, |filterbank[0]| = ${t[0].length}.`);const n=new Float32Array(t.length);for(let i=0;i<t.length;i++){const r=S(e,t[i]);n[i]=r.reduce((e,t)=>e+t)}return n}function S(e,t){if(e.length!==t.length)return console.error(`Buffer length ${e.length} != window length ${t.length}.`),null;const n=new Float32Array(e.length);for(let i=0;i<e.length;i++)n[i]=t[i]*e[i];return n}function y(e,t){if(e.length>t)throw new Error("Data is longer than length.");const n=Math.floor((t-e.length)/2);return w(e,[n,t-e.length-n])}function w(e,t){let n,i;"object"==typeof t?[n,i]=t:n=i=t;const r=new Float32Array(e.length+n+i);return r.set(e,n),r}function b(e){const t=new r(e.length),n=t.createComplexArray(),i=t.toComplexArray(e);return t.transform(n,i),n}function v(e){const t=new Float32Array(e);for(let n=0;n<e;n++)t[n]=.5*(1-Math.cos(2*Math.PI*n/(e-1)));return t}function N(e,t,n){const i=(t-e)/(n-1),r=new Float32Array(n);for(let t=0;t<n;t++)r[t]=e+i*t;return r}function T(e){let t=i.sub(e,69);return t=i.div(t,12),t=i.pow(2,t),t=i.mul(440,t),t}async function P(e){let t=i.sub(i.div(i.log(e),i.log(2)),i.div(i.log(440),i.log(2)));t=i.mul(12,t),t=i.add(t,69);return await t.array()}function O(e){return 1125*Math.log(1+e/700)}},function(e,t){e.exports=require("tonal")},function(e,t,n){"use strict";n.r(t),n.d(t,"NO_EVENT",(function(){return s})),n.d(t,"NOTE_OFF",(function(){return a})),n.d(t,"Melody",(function(){return c})),n.d(t,"MelodyRhythm",(function(){return u})),n.d(t,"MelodyShape",(function(){return l})),n.d(t,"MelodyRegister",(function(){return h}));var i=n(0),r=n(3),o=n(5);const s=0,a=1;class c{constructor(e,t,n){this.events=e,this.minPitch=t,this.maxPitch=n}static fromNoteSequence(e,t,n,i=!0,r){o.assertIsQuantizedSequence(e);const s=e.notes.sort((e,t)=>e.quantizedStartStep===t.quantizedStartStep?t.pitch-e.pitch:e.quantizedStartStep-t.quantizedStartStep),u=new Int32Array(r||e.totalQuantizedSteps);let l=-1;return s.forEach(e=>{if(e.quantizedStartStep===l){if(i)return;throw new Error("`NoteSequence` is not monophonic.")}if(e.pitch<t||e.pitch>n)throw Error("`NoteSequence` has a pitch outside of the valid range: "+e.pitch);u[e.quantizedStartStep]=e.pitch-t+2,u[e.quantizedEndStep]=a,l=e.quantizedStartStep}),new c(u,t,n)}toNoteSequence(e,t){const n=o.createQuantizedNoteSequence(e,t);let i=null;for(let e=0;e<this.events.length;++e){const t=this.events[e];switch(t){case s:break;case a:i&&(i.quantizedEndStep=e,n.notes.push(i),i=null);break;default:i&&(i.quantizedEndStep=e,n.notes.push(i)),i=r.a.Note.create({pitch:t-2+this.minPitch,quantizedStartStep:e})}}return i&&(i.quantizedEndStep=this.events.length,n.notes.push(i)),n.totalQuantizedSteps=this.events.length,n}}class u{constructor(){this.depth=1}extract(e){const t=e.events.length,n=i.buffer([t,1]);for(let i=0;i<t;++i)n.set(e.events[i]>=2?1:0,i,0);return n.toTensor().as2D(t,1)}}class l{constructor(){this.depth=3}extract(e){const t=e.events.length,n=i.buffer([t,3]);let r=null,o=null;for(let i=0;i<t;++i)if(e.events[i]>=2){if(null!==r){let t;0===n.get(r,0)&&0===n.get(r,1)&&0===n.get(r,2)&&(r=-1),t=e.events[i]<o?0:e.events[i]>o?2:1;for(let e=i;e>r;--e)n.set(1,e,t)}r=i,o=e.events[i]}if(r!==t-1)if(null===r||0===n.get(r,0)&&0===n.get(r,1)&&0===n.get(r,2))for(let e=0;e<t;++e)n.set(1,e,1);else for(let e=t-1;e>r;--e)for(let t=0;t<3;t++)n.set(n.get(r,t),e,t);return n.toTensor().as2D(t,3)}}class h{constructor(e){this.boundaryPitches=e,this.depth=e.length+1}meanMelodyPitch(e){let t=0,n=0,i=null;for(let r=0;r<e.events.length;++r)e.events[r]===a?i=null:e.events[r]>=2&&(i=e.minPitch+e.events[r]-2),null!==i&&(t+=i,n+=1);return n?t/n:null}extract(e){const t=e.events.length,n=this.meanMelodyPitch(e);if(null===n)return i.zeros([t,this.depth]);let r=0;for(;r<this.boundaryPitches.length&&n>=this.boundaryPitches[r];)r++;const o=i.buffer([t,this.depth]);for(let e=0;e<t;++e)o.set(1,e,r);return o.toTensor().as2D(t,this.depth)}}},function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return a})),n.d(t,"e",(function(){return c})),n.d(t,"f",(function(){return u})),n.d(t,"d",(function(){return l})),n.d(t,"a",(function(){return h})),n.d(t,"h",(function(){return p})),n.d(t,"g",(function(){return d}));var i=n(0),r=n(8);var o=n(16);const s=16e3,a=250,c=25.58,u=63.07,l=.002,h=.7;async function p(e){let t;return t=await i.loadGraphModel(e,{fromTFHub:!0}),t}async function d(e,t,n){if("webgl"!==i.getBackend())throw new Error("Device does not support webgl.");const c=await Object(r.j)(e,s),u=c.length,l=await async function(e){const t=Math.floor(s/a),n=i.tensor1d(e,"float32"),r=e.length;if(null===n)return[];const o=n.mul(n).reshape([r,1]),c=i.conv1d(o,i.ones([1024,1,1]).div(1024),t,"same").sqrt().squeeze(),u=i.mul(i.log(i.maximum(1e-20,c)).div(i.log(10)),20),l=u.sub(20.7),h=i.maximum(l,-120),p=await h.array();return n.dispose(),o.dispose(),c.dispose(),u.dispose(),l.dispose(),h.dispose(),p}(c),{pitches:h,confidences:p}=await Object(o.a)(t,c,n);return{f0_hz:h,loudness_db:l,confidences:p,originalRecordedBufferLength:u}}},function(e,t,n){"use strict";n.r(t),n.d(t,"Performance",(function(){return a}));var i=n(3),r=n(1),o=n(5),s=n(4);class a{constructor(e,t,n,i,r){this.events=e,this.maxShiftSteps=t,this.numVelocityBins=n,this.program=i,this.isDrum=r}static fromNoteSequence(e,t,n,i){o.assertIsQuantizedSequence(e);const s=e.notes.filter((e,t)=>void 0===i||e.instrument===i),c=s.sort((e,t)=>e.startTime===t.startTime?e.pitch-t.pitch:e.startTime-t.startTime),u=c.map((e,t)=>({step:e.quantizedStartStep,index:t,isOffset:0})),l=c.map((e,t)=>({step:e.quantizedEndStep,index:t,isOffset:1})),h=u.concat(l).sort((e,t)=>e.step===t.step?e.index===t.index?e.isOffset-t.isOffset:e.index-t.index:e.step-t.step),p=n?Math.ceil((r.MIDI_VELOCITIES-1)/n):void 0,d=[];let m=0,f=n;for(const e of h){if(e.step>m){for(;e.step>m+t;)d.push({type:"time-shift",steps:t}),m+=t;d.push({type:"time-shift",steps:e.step-m}),m=e.step}if(e.isOffset)d.push({type:"note-off",pitch:c[e.index].pitch});else{if(p){const t=Math.floor((c[e.index].velocity-r.MIN_MIDI_VELOCITY-1)/p)+1;t!==f&&(d.push({type:"velocity-change",velocityBin:t}),f=t)}d.push({type:"note-on",pitch:c[e.index].pitch})}}const g=!!s.some(e=>e.isDrum)&&(!s.some(e=>!e.isDrum)||void 0),S=Array.from(new Set(s.map(e=>e.program))),y=g||1!==S.length?void 0:S[0],w=new a(d,t,n,y,g);return w.setNumSteps(e.totalQuantizedSteps),w}getNumSteps(){return this.events.filter(e=>"time-shift"===e.type).map(e=>e.steps).reduce((e,t)=>e+t,0)}setNumSteps(e){let t=this.getNumSteps();if(t<e){if(this.events.length){const n=this.events[this.events.length-1];if("time-shift"===n.type){const i=Math.min(e-t,this.maxShiftSteps-n.steps);n.steps+=i,t+=i}}for(;t<e;)t+this.maxShiftSteps>e?(this.events.push({type:"time-shift",steps:e-t}),t=e):(this.events.push({type:"time-shift",steps:this.maxShiftSteps}),t+=this.maxShiftSteps)}else if(t>e)for(;this.events.length&&t>e;){const n=this.events[this.events.length-1];"time-shift"===n.type?t-n.steps<e?(n.steps-=t-e,t=e):(this.events.pop(),t-=n.steps):this.events.pop()}}toNoteSequence(e){const t=this.numVelocityBins?Math.ceil((r.MIDI_VELOCITIES-1)/this.numVelocityBins):void 0,n=i.a.create();let o=0,a=void 0;const c=new Map;for(let e=r.MIN_MIDI_PITCH;e<=r.MAX_MIDI_PITCH;++e)c.set(e,[]);for(const u of this.events)switch(u.type){case"note-on":c.get(u.pitch).push([o,a]);break;case"note-off":const l=c.get(u.pitch);if(l.length){const[t,r]=l.shift();o>t?n.notes.push(i.a.Note.create({pitch:u.pitch,velocity:r,instrument:e,quantizedStartStep:t,quantizedEndStep:o,program:this.program,isDrum:this.isDrum})):s.log(`Ignoring zero-length note: (pitch = ${u.pitch}, step = ${o})`,"Performance")}else s.log(`Ignoring note-off with no previous note-on:(pitch = ${u.pitch}, step = ${o})`,"Performance");break;case"time-shift":o+=u.steps;break;case"velocity-change":if(!t)throw new Error("Unexpected velocity change event: "+u);a=r.MIN_MIDI_VELOCITY+(u.velocityBin-1)*t+1;break;default:throw new Error("Unrecognized performance event: "+u)}return c.forEach((t,r)=>{for(const[a,c]of t)o>a?n.notes.push(i.a.Note.create({pitch:r,velocity:c,instrument:e,quantizedStartStep:a,quantizedEndStep:o,program:this.program,isDrum:this.isDrum})):s.log(`Ignoring zero-length note: (pitch = ${r}, step = ${o})`,"Performance")}),n.totalQuantizedSteps=o,n}}},function(e,t,n){"use strict";var i,r,o=n(24),s=o.Reader,a=o.Writer,c=o.util,u=o.roots.default||(o.roots.default={});u.tensorflow=((r={}).magenta=((i={}).NoteSequence=function(){function e(e){if(this.timeSignatures=[],this.keySignatures=[],this.tempos=[],this.notes=[],this.pitchBends=[],this.controlChanges=[],this.partInfos=[],this.textAnnotations=[],this.sectionAnnotations=[],this.sectionGroups=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t,n;return e.prototype.id="",e.prototype.filename="",e.prototype.referenceNumber=c.Long?c.Long.fromBits(0,0,!1):0,e.prototype.collectionName="",e.prototype.ticksPerQuarter=0,e.prototype.timeSignatures=c.emptyArray,e.prototype.keySignatures=c.emptyArray,e.prototype.tempos=c.emptyArray,e.prototype.notes=c.emptyArray,e.prototype.totalTime=0,e.prototype.totalQuantizedSteps=c.Long?c.Long.fromBits(0,0,!1):0,e.prototype.pitchBends=c.emptyArray,e.prototype.controlChanges=c.emptyArray,e.prototype.partInfos=c.emptyArray,e.prototype.sourceInfo=null,e.prototype.textAnnotations=c.emptyArray,e.prototype.sectionAnnotations=c.emptyArray,e.prototype.sectionGroups=c.emptyArray,e.prototype.quantizationInfo=null,e.prototype.subsequenceInfo=null,e.prototype.sequenceMetadata=null,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=a.create()),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(10).string(e.id),null!=e.filename&&e.hasOwnProperty("filename")&&t.uint32(18).string(e.filename),null!=e.collectionName&&e.hasOwnProperty("collectionName")&&t.uint32(26).string(e.collectionName),null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&t.uint32(32).int32(e.ticksPerQuarter),null!=e.timeSignatures&&e.timeSignatures.length)for(var n=0;n<e.timeSignatures.length;++n)u.tensorflow.magenta.NoteSequence.TimeSignature.encode(e.timeSignatures[n],t.uint32(42).fork()).ldelim();if(null!=e.keySignatures&&e.keySignatures.length)for(n=0;n<e.keySignatures.length;++n)u.tensorflow.magenta.NoteSequence.KeySignature.encode(e.keySignatures[n],t.uint32(50).fork()).ldelim();if(null!=e.tempos&&e.tempos.length)for(n=0;n<e.tempos.length;++n)u.tensorflow.magenta.NoteSequence.Tempo.encode(e.tempos[n],t.uint32(58).fork()).ldelim();if(null!=e.notes&&e.notes.length)for(n=0;n<e.notes.length;++n)u.tensorflow.magenta.NoteSequence.Note.encode(e.notes[n],t.uint32(66).fork()).ldelim();if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&t.uint32(73).double(e.totalTime),null!=e.pitchBends&&e.pitchBends.length)for(n=0;n<e.pitchBends.length;++n)u.tensorflow.magenta.NoteSequence.PitchBend.encode(e.pitchBends[n],t.uint32(82).fork()).ldelim();if(null!=e.controlChanges&&e.controlChanges.length)for(n=0;n<e.controlChanges.length;++n)u.tensorflow.magenta.NoteSequence.ControlChange.encode(e.controlChanges[n],t.uint32(90).fork()).ldelim();if(null!=e.partInfos&&e.partInfos.length)for(n=0;n<e.partInfos.length;++n)u.tensorflow.magenta.NoteSequence.PartInfo.encode(e.partInfos[n],t.uint32(98).fork()).ldelim();if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&u.tensorflow.magenta.NoteSequence.SourceInfo.encode(e.sourceInfo,t.uint32(106).fork()).ldelim(),null!=e.textAnnotations&&e.textAnnotations.length)for(n=0;n<e.textAnnotations.length;++n)u.tensorflow.magenta.NoteSequence.TextAnnotation.encode(e.textAnnotations[n],t.uint32(114).fork()).ldelim();if(null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&u.tensorflow.magenta.NoteSequence.QuantizationInfo.encode(e.quantizationInfo,t.uint32(122).fork()).ldelim(),null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&t.uint32(128).int64(e.totalQuantizedSteps),null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&u.tensorflow.magenta.NoteSequence.SubsequenceInfo.encode(e.subsequenceInfo,t.uint32(138).fork()).ldelim(),null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&t.uint32(144).int64(e.referenceNumber),null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&u.tensorflow.magenta.SequenceMetadata.encode(e.sequenceMetadata,t.uint32(154).fork()).ldelim(),null!=e.sectionAnnotations&&e.sectionAnnotations.length)for(n=0;n<e.sectionAnnotations.length;++n)u.tensorflow.magenta.NoteSequence.SectionAnnotation.encode(e.sectionAnnotations[n],t.uint32(162).fork()).ldelim();if(null!=e.sectionGroups&&e.sectionGroups.length)for(n=0;n<e.sectionGroups.length;++n)u.tensorflow.magenta.NoteSequence.SectionGroup.encode(e.sectionGroups[n],t.uint32(170).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new u.tensorflow.magenta.NoteSequence;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.id=e.string();break;case 2:i.filename=e.string();break;case 18:i.referenceNumber=c.Long?e.int64().toNumber():e.int64();break;case 3:i.collectionName=e.string();break;case 4:i.ticksPerQuarter=e.int32();break;case 5:i.timeSignatures&&i.timeSignatures.length||(i.timeSignatures=[]),i.timeSignatures.push(u.tensorflow.magenta.NoteSequence.TimeSignature.decode(e,e.uint32()));break;case 6:i.keySignatures&&i.keySignatures.length||(i.keySignatures=[]),i.keySignatures.push(u.tensorflow.magenta.NoteSequence.KeySignature.decode(e,e.uint32()));break;case 7:i.tempos&&i.tempos.length||(i.tempos=[]),i.tempos.push(u.tensorflow.magenta.NoteSequence.Tempo.decode(e,e.uint32()));break;case 8:i.notes&&i.notes.length||(i.notes=[]),i.notes.push(u.tensorflow.magenta.NoteSequence.Note.decode(e,e.uint32()));break;case 9:i.totalTime=e.double();break;case 16:i.totalQuantizedSteps=c.Long?e.int64().toNumber():e.int64();break;case 10:i.pitchBends&&i.pitchBends.length||(i.pitchBends=[]),i.pitchBends.push(u.tensorflow.magenta.NoteSequence.PitchBend.decode(e,e.uint32()));break;case 11:i.controlChanges&&i.controlChanges.length||(i.controlChanges=[]),i.controlChanges.push(u.tensorflow.magenta.NoteSequence.ControlChange.decode(e,e.uint32()));break;case 12:i.partInfos&&i.partInfos.length||(i.partInfos=[]),i.partInfos.push(u.tensorflow.magenta.NoteSequence.PartInfo.decode(e,e.uint32()));break;case 13:i.sourceInfo=u.tensorflow.magenta.NoteSequence.SourceInfo.decode(e,e.uint32());break;case 14:i.textAnnotations&&i.textAnnotations.length||(i.textAnnotations=[]),i.textAnnotations.push(u.tensorflow.magenta.NoteSequence.TextAnnotation.decode(e,e.uint32()));break;case 20:i.sectionAnnotations&&i.sectionAnnotations.length||(i.sectionAnnotations=[]),i.sectionAnnotations.push(u.tensorflow.magenta.NoteSequence.SectionAnnotation.decode(e,e.uint32()));break;case 21:i.sectionGroups&&i.sectionGroups.length||(i.sectionGroups=[]),i.sectionGroups.push(u.tensorflow.magenta.NoteSequence.SectionGroup.decode(e,e.uint32()));break;case 15:i.quantizationInfo=u.tensorflow.magenta.NoteSequence.QuantizationInfo.decode(e,e.uint32());break;case 17:i.subsequenceInfo=u.tensorflow.magenta.NoteSequence.SubsequenceInfo.decode(e,e.uint32());break;case 19:i.sequenceMetadata=u.tensorflow.magenta.SequenceMetadata.decode(e,e.uint32());break;default:e.skipType(7&r)}}return i},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.id&&e.hasOwnProperty("id")&&!c.isString(e.id))return"id: string expected";if(null!=e.filename&&e.hasOwnProperty("filename")&&!c.isString(e.filename))return"filename: string expected";if(null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&!(c.isInteger(e.referenceNumber)||e.referenceNumber&&c.isInteger(e.referenceNumber.low)&&c.isInteger(e.referenceNumber.high)))return"referenceNumber: integer|Long expected";if(null!=e.collectionName&&e.hasOwnProperty("collectionName")&&!c.isString(e.collectionName))return"collectionName: string expected";if(null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&!c.isInteger(e.ticksPerQuarter))return"ticksPerQuarter: integer expected";if(null!=e.timeSignatures&&e.hasOwnProperty("timeSignatures")){if(!Array.isArray(e.timeSignatures))return"timeSignatures: array expected";for(var t=0;t<e.timeSignatures.length;++t)if(n=u.tensorflow.magenta.NoteSequence.TimeSignature.verify(e.timeSignatures[t]))return"timeSignatures."+n}if(null!=e.keySignatures&&e.hasOwnProperty("keySignatures")){if(!Array.isArray(e.keySignatures))return"keySignatures: array expected";for(t=0;t<e.keySignatures.length;++t)if(n=u.tensorflow.magenta.NoteSequence.KeySignature.verify(e.keySignatures[t]))return"keySignatures."+n}if(null!=e.tempos&&e.hasOwnProperty("tempos")){if(!Array.isArray(e.tempos))return"tempos: array expected";for(t=0;t<e.tempos.length;++t)if(n=u.tensorflow.magenta.NoteSequence.Tempo.verify(e.tempos[t]))return"tempos."+n}if(null!=e.notes&&e.hasOwnProperty("notes")){if(!Array.isArray(e.notes))return"notes: array expected";for(t=0;t<e.notes.length;++t)if(n=u.tensorflow.magenta.NoteSequence.Note.verify(e.notes[t]))return"notes."+n}if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&"number"!=typeof e.totalTime)return"totalTime: number expected";if(null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&!(c.isInteger(e.totalQuantizedSteps)||e.totalQuantizedSteps&&c.isInteger(e.totalQuantizedSteps.low)&&c.isInteger(e.totalQuantizedSteps.high)))return"totalQuantizedSteps: integer|Long expected";if(null!=e.pitchBends&&e.hasOwnProperty("pitchBends")){if(!Array.isArray(e.pitchBends))return"pitchBends: array expected";for(t=0;t<e.pitchBends.length;++t)if(n=u.tensorflow.magenta.NoteSequence.PitchBend.verify(e.pitchBends[t]))return"pitchBends."+n}if(null!=e.controlChanges&&e.hasOwnProperty("controlChanges")){if(!Array.isArray(e.controlChanges))return"controlChanges: array expected";for(t=0;t<e.controlChanges.length;++t)if(n=u.tensorflow.magenta.NoteSequence.ControlChange.verify(e.controlChanges[t]))return"controlChanges."+n}if(null!=e.partInfos&&e.hasOwnProperty("partInfos")){if(!Array.isArray(e.partInfos))return"partInfos: array expected";for(t=0;t<e.partInfos.length;++t)if(n=u.tensorflow.magenta.NoteSequence.PartInfo.verify(e.partInfos[t]))return"partInfos."+n}if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&(n=u.tensorflow.magenta.NoteSequence.SourceInfo.verify(e.sourceInfo)))return"sourceInfo."+n;if(null!=e.textAnnotations&&e.hasOwnProperty("textAnnotations")){if(!Array.isArray(e.textAnnotations))return"textAnnotations: array expected";for(t=0;t<e.textAnnotations.length;++t)if(n=u.tensorflow.magenta.NoteSequence.TextAnnotation.verify(e.textAnnotations[t]))return"textAnnotations."+n}if(null!=e.sectionAnnotations&&e.hasOwnProperty("sectionAnnotations")){if(!Array.isArray(e.sectionAnnotations))return"sectionAnnotations: array expected";for(t=0;t<e.sectionAnnotations.length;++t)if(n=u.tensorflow.magenta.NoteSequence.SectionAnnotation.verify(e.sectionAnnotations[t]))return"sectionAnnotations."+n}if(null!=e.sectionGroups&&e.hasOwnProperty("sectionGroups")){if(!Array.isArray(e.sectionGroups))return"sectionGroups: array expected";for(t=0;t<e.sectionGroups.length;++t){var n;if(n=u.tensorflow.magenta.NoteSequence.SectionGroup.verify(e.sectionGroups[t]))return"sectionGroups."+n}}return null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&(n=u.tensorflow.magenta.NoteSequence.QuantizationInfo.verify(e.quantizationInfo))?"quantizationInfo."+n:null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&(n=u.tensorflow.magenta.NoteSequence.SubsequenceInfo.verify(e.subsequenceInfo))?"subsequenceInfo."+n:null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&(n=u.tensorflow.magenta.SequenceMetadata.verify(e.sequenceMetadata))?"sequenceMetadata."+n:null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence)return e;var t=new u.tensorflow.magenta.NoteSequence;if(null!=e.id&&(t.id=String(e.id)),null!=e.filename&&(t.filename=String(e.filename)),null!=e.referenceNumber&&(c.Long?(t.referenceNumber=c.Long.fromValue(e.referenceNumber)).unsigned=!1:"string"==typeof e.referenceNumber?t.referenceNumber=parseInt(e.referenceNumber,10):"number"==typeof e.referenceNumber?t.referenceNumber=e.referenceNumber:"object"==typeof e.referenceNumber&&(t.referenceNumber=new c.LongBits(e.referenceNumber.low>>>0,e.referenceNumber.high>>>0).toNumber())),null!=e.collectionName&&(t.collectionName=String(e.collectionName)),null!=e.ticksPerQuarter&&(t.ticksPerQuarter=0|e.ticksPerQuarter),e.timeSignatures){if(!Array.isArray(e.timeSignatures))throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: array expected");t.timeSignatures=[];for(var n=0;n<e.timeSignatures.length;++n){if("object"!=typeof e.timeSignatures[n])throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: object expected");t.timeSignatures[n]=u.tensorflow.magenta.NoteSequence.TimeSignature.fromObject(e.timeSignatures[n])}}if(e.keySignatures){if(!Array.isArray(e.keySignatures))throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: array expected");for(t.keySignatures=[],n=0;n<e.keySignatures.length;++n){if("object"!=typeof e.keySignatures[n])throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: object expected");t.keySignatures[n]=u.tensorflow.magenta.NoteSequence.KeySignature.fromObject(e.keySignatures[n])}}if(e.tempos){if(!Array.isArray(e.tempos))throw TypeError(".tensorflow.magenta.NoteSequence.tempos: array expected");for(t.tempos=[],n=0;n<e.tempos.length;++n){if("object"!=typeof e.tempos[n])throw TypeError(".tensorflow.magenta.NoteSequence.tempos: object expected");t.tempos[n]=u.tensorflow.magenta.NoteSequence.Tempo.fromObject(e.tempos[n])}}if(e.notes){if(!Array.isArray(e.notes))throw TypeError(".tensorflow.magenta.NoteSequence.notes: array expected");for(t.notes=[],n=0;n<e.notes.length;++n){if("object"!=typeof e.notes[n])throw TypeError(".tensorflow.magenta.NoteSequence.notes: object expected");t.notes[n]=u.tensorflow.magenta.NoteSequence.Note.fromObject(e.notes[n])}}if(null!=e.totalTime&&(t.totalTime=Number(e.totalTime)),null!=e.totalQuantizedSteps&&(c.Long?(t.totalQuantizedSteps=c.Long.fromValue(e.totalQuantizedSteps)).unsigned=!1:"string"==typeof e.totalQuantizedSteps?t.totalQuantizedSteps=parseInt(e.totalQuantizedSteps,10):"number"==typeof e.totalQuantizedSteps?t.totalQuantizedSteps=e.totalQuantizedSteps:"object"==typeof e.totalQuantizedSteps&&(t.totalQuantizedSteps=new c.LongBits(e.totalQuantizedSteps.low>>>0,e.totalQuantizedSteps.high>>>0).toNumber())),e.pitchBends){if(!Array.isArray(e.pitchBends))throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: array expected");for(t.pitchBends=[],n=0;n<e.pitchBends.length;++n){if("object"!=typeof e.pitchBends[n])throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: object expected");t.pitchBends[n]=u.tensorflow.magenta.NoteSequence.PitchBend.fromObject(e.pitchBends[n])}}if(e.controlChanges){if(!Array.isArray(e.controlChanges))throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: array expected");for(t.controlChanges=[],n=0;n<e.controlChanges.length;++n){if("object"!=typeof e.controlChanges[n])throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: object expected");t.controlChanges[n]=u.tensorflow.magenta.NoteSequence.ControlChange.fromObject(e.controlChanges[n])}}if(e.partInfos){if(!Array.isArray(e.partInfos))throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: array expected");for(t.partInfos=[],n=0;n<e.partInfos.length;++n){if("object"!=typeof e.partInfos[n])throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: object expected");t.partInfos[n]=u.tensorflow.magenta.NoteSequence.PartInfo.fromObject(e.partInfos[n])}}if(null!=e.sourceInfo){if("object"!=typeof e.sourceInfo)throw TypeError(".tensorflow.magenta.NoteSequence.sourceInfo: object expected");t.sourceInfo=u.tensorflow.magenta.NoteSequence.SourceInfo.fromObject(e.sourceInfo)}if(e.textAnnotations){if(!Array.isArray(e.textAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: array expected");for(t.textAnnotations=[],n=0;n<e.textAnnotations.length;++n){if("object"!=typeof e.textAnnotations[n])throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: object expected");t.textAnnotations[n]=u.tensorflow.magenta.NoteSequence.TextAnnotation.fromObject(e.textAnnotations[n])}}if(e.sectionAnnotations){if(!Array.isArray(e.sectionAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: array expected");for(t.sectionAnnotations=[],n=0;n<e.sectionAnnotations.length;++n){if("object"!=typeof e.sectionAnnotations[n])throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: object expected");t.sectionAnnotations[n]=u.tensorflow.magenta.NoteSequence.SectionAnnotation.fromObject(e.sectionAnnotations[n])}}if(e.sectionGroups){if(!Array.isArray(e.sectionGroups))throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: array expected");for(t.sectionGroups=[],n=0;n<e.sectionGroups.length;++n){if("object"!=typeof e.sectionGroups[n])throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: object expected");t.sectionGroups[n]=u.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(e.sectionGroups[n])}}if(null!=e.quantizationInfo){if("object"!=typeof e.quantizationInfo)throw TypeError(".tensorflow.magenta.NoteSequence.quantizationInfo: object expected");t.quantizationInfo=u.tensorflow.magenta.NoteSequence.QuantizationInfo.fromObject(e.quantizationInfo)}if(null!=e.subsequenceInfo){if("object"!=typeof e.subsequenceInfo)throw TypeError(".tensorflow.magenta.NoteSequence.subsequenceInfo: object expected");t.subsequenceInfo=u.tensorflow.magenta.NoteSequence.SubsequenceInfo.fromObject(e.subsequenceInfo)}if(null!=e.sequenceMetadata){if("object"!=typeof e.sequenceMetadata)throw TypeError(".tensorflow.magenta.NoteSequence.sequenceMetadata: object expected");t.sequenceMetadata=u.tensorflow.magenta.SequenceMetadata.fromObject(e.sequenceMetadata)}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.timeSignatures=[],n.keySignatures=[],n.tempos=[],n.notes=[],n.pitchBends=[],n.controlChanges=[],n.partInfos=[],n.textAnnotations=[],n.sectionAnnotations=[],n.sectionGroups=[]),t.defaults){if(n.id="",n.filename="",n.collectionName="",n.ticksPerQuarter=0,n.totalTime=0,n.sourceInfo=null,n.quantizationInfo=null,c.Long){var i=new c.Long(0,0,!1);n.totalQuantizedSteps=t.longs===String?i.toString():t.longs===Number?i.toNumber():i}else n.totalQuantizedSteps=t.longs===String?"0":0;n.subsequenceInfo=null,c.Long?(i=new c.Long(0,0,!1),n.referenceNumber=t.longs===String?i.toString():t.longs===Number?i.toNumber():i):n.referenceNumber=t.longs===String?"0":0,n.sequenceMetadata=null}if(null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.filename&&e.hasOwnProperty("filename")&&(n.filename=e.filename),null!=e.collectionName&&e.hasOwnProperty("collectionName")&&(n.collectionName=e.collectionName),null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&(n.ticksPerQuarter=e.ticksPerQuarter),e.timeSignatures&&e.timeSignatures.length){n.timeSignatures=[];for(var r=0;r<e.timeSignatures.length;++r)n.timeSignatures[r]=u.tensorflow.magenta.NoteSequence.TimeSignature.toObject(e.timeSignatures[r],t)}if(e.keySignatures&&e.keySignatures.length)for(n.keySignatures=[],r=0;r<e.keySignatures.length;++r)n.keySignatures[r]=u.tensorflow.magenta.NoteSequence.KeySignature.toObject(e.keySignatures[r],t);if(e.tempos&&e.tempos.length)for(n.tempos=[],r=0;r<e.tempos.length;++r)n.tempos[r]=u.tensorflow.magenta.NoteSequence.Tempo.toObject(e.tempos[r],t);if(e.notes&&e.notes.length)for(n.notes=[],r=0;r<e.notes.length;++r)n.notes[r]=u.tensorflow.magenta.NoteSequence.Note.toObject(e.notes[r],t);if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&(n.totalTime=t.json&&!isFinite(e.totalTime)?String(e.totalTime):e.totalTime),e.pitchBends&&e.pitchBends.length)for(n.pitchBends=[],r=0;r<e.pitchBends.length;++r)n.pitchBends[r]=u.tensorflow.magenta.NoteSequence.PitchBend.toObject(e.pitchBends[r],t);if(e.controlChanges&&e.controlChanges.length)for(n.controlChanges=[],r=0;r<e.controlChanges.length;++r)n.controlChanges[r]=u.tensorflow.magenta.NoteSequence.ControlChange.toObject(e.controlChanges[r],t);if(e.partInfos&&e.partInfos.length)for(n.partInfos=[],r=0;r<e.partInfos.length;++r)n.partInfos[r]=u.tensorflow.magenta.NoteSequence.PartInfo.toObject(e.partInfos[r],t);if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&(n.sourceInfo=u.tensorflow.magenta.NoteSequence.SourceInfo.toObject(e.sourceInfo,t)),e.textAnnotations&&e.textAnnotations.length)for(n.textAnnotations=[],r=0;r<e.textAnnotations.length;++r)n.textAnnotations[r]=u.tensorflow.magenta.NoteSequence.TextAnnotation.toObject(e.textAnnotations[r],t);if(null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&(n.quantizationInfo=u.tensorflow.magenta.NoteSequence.QuantizationInfo.toObject(e.quantizationInfo,t)),null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&("number"==typeof e.totalQuantizedSteps?n.totalQuantizedSteps=t.longs===String?String(e.totalQuantizedSteps):e.totalQuantizedSteps:n.totalQuantizedSteps=t.longs===String?c.Long.prototype.toString.call(e.totalQuantizedSteps):t.longs===Number?new c.LongBits(e.totalQuantizedSteps.low>>>0,e.totalQuantizedSteps.high>>>0).toNumber():e.totalQuantizedSteps),null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&(n.subsequenceInfo=u.tensorflow.magenta.NoteSequence.SubsequenceInfo.toObject(e.subsequenceInfo,t)),null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&("number"==typeof e.referenceNumber?n.referenceNumber=t.longs===String?String(e.referenceNumber):e.referenceNumber:n.referenceNumber=t.longs===String?c.Long.prototype.toString.call(e.referenceNumber):t.longs===Number?new c.LongBits(e.referenceNumber.low>>>0,e.referenceNumber.high>>>0).toNumber():e.referenceNumber),null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&(n.sequenceMetadata=u.tensorflow.magenta.SequenceMetadata.toObject(e.sequenceMetadata,t)),e.sectionAnnotations&&e.sectionAnnotations.length)for(n.sectionAnnotations=[],r=0;r<e.sectionAnnotations.length;++r)n.sectionAnnotations[r]=u.tensorflow.magenta.NoteSequence.SectionAnnotation.toObject(e.sectionAnnotations[r],t);if(e.sectionGroups&&e.sectionGroups.length)for(n.sectionGroups=[],r=0;r<e.sectionGroups.length;++r)n.sectionGroups[r]=u.tensorflow.magenta.NoteSequence.SectionGroup.toObject(e.sectionGroups[r],t);return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e.Note=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.pitch=0,e.prototype.pitchName=0,e.prototype.velocity=0,e.prototype.startTime=0,e.prototype.quantizedStartStep=c.Long?c.Long.fromBits(0,0,!1):0,e.prototype.endTime=0,e.prototype.quantizedEndStep=c.Long?c.Long.fromBits(0,0,!1):0,e.prototype.numerator=0,e.prototype.denominator=0,e.prototype.instrument=0,e.prototype.program=0,e.prototype.isDrum=!1,e.prototype.part=0,e.prototype.voice=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.pitch&&e.hasOwnProperty("pitch")&&t.uint32(8).int32(e.pitch),null!=e.velocity&&e.hasOwnProperty("velocity")&&t.uint32(16).int32(e.velocity),null!=e.startTime&&e.hasOwnProperty("startTime")&&t.uint32(25).double(e.startTime),null!=e.endTime&&e.hasOwnProperty("endTime")&&t.uint32(33).double(e.endTime),null!=e.numerator&&e.hasOwnProperty("numerator")&&t.uint32(40).int32(e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&t.uint32(48).int32(e.denominator),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(56).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(64).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(72).bool(e.isDrum),null!=e.part&&e.hasOwnProperty("part")&&t.uint32(80).int32(e.part),null!=e.pitchName&&e.hasOwnProperty("pitchName")&&t.uint32(88).int32(e.pitchName),null!=e.voice&&e.hasOwnProperty("voice")&&t.uint32(96).int32(e.voice),null!=e.quantizedStartStep&&e.hasOwnProperty("quantizedStartStep")&&t.uint32(104).int64(e.quantizedStartStep),null!=e.quantizedEndStep&&e.hasOwnProperty("quantizedEndStep")&&t.uint32(112).int64(e.quantizedEndStep),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new u.tensorflow.magenta.NoteSequence.Note;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.pitch=e.int32();break;case 11:i.pitchName=e.int32();break;case 2:i.velocity=e.int32();break;case 3:i.startTime=e.double();break;case 13:i.quantizedStartStep=c.Long?e.int64().toNumber():e.int64();break;case 4:i.endTime=e.double();break;case 14:i.quantizedEndStep=c.Long?e.int64().toNumber():e.int64();break;case 5:i.numerator=e.int32();break;case 6:i.denominator=e.int32();break;case 7:i.instrument=e.int32();break;case 8:i.program=e.int32();break;case 9:i.isDrum=e.bool();break;case 10:i.part=e.int32();break;case 12:i.voice=e.int32();break;default:e.skipType(7&r)}}return i},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.pitch&&e.hasOwnProperty("pitch")&&!c.isInteger(e.pitch))return"pitch: integer expected";if(null!=e.pitchName&&e.hasOwnProperty("pitchName"))switch(e.pitchName){default:return"pitchName: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 32:case 33:case 34:case 35:}return null!=e.velocity&&e.hasOwnProperty("velocity")&&!c.isInteger(e.velocity)?"velocity: integer expected":null!=e.startTime&&e.hasOwnProperty("startTime")&&"number"!=typeof e.startTime?"startTime: number expected":null!=e.quantizedStartStep&&e.hasOwnProperty("quantizedStartStep")&&!(c.isInteger(e.quantizedStartStep)||e.quantizedStartStep&&c.isInteger(e.quantizedStartStep.low)&&c.isInteger(e.quantizedStartStep.high))?"quantizedStartStep: integer|Long expected":null!=e.endTime&&e.hasOwnProperty("endTime")&&"number"!=typeof e.endTime?"endTime: number expected":null!=e.quantizedEndStep&&e.hasOwnProperty("quantizedEndStep")&&!(c.isInteger(e.quantizedEndStep)||e.quantizedEndStep&&c.isInteger(e.quantizedEndStep.low)&&c.isInteger(e.quantizedEndStep.high))?"quantizedEndStep: integer|Long expected":null!=e.numerator&&e.hasOwnProperty("numerator")&&!c.isInteger(e.numerator)?"numerator: integer expected":null!=e.denominator&&e.hasOwnProperty("denominator")&&!c.isInteger(e.denominator)?"denominator: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!c.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!c.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!=typeof e.isDrum?"isDrum: boolean expected":null!=e.part&&e.hasOwnProperty("part")&&!c.isInteger(e.part)?"part: integer expected":null!=e.voice&&e.hasOwnProperty("voice")&&!c.isInteger(e.voice)?"voice: integer expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.Note)return e;var t=new u.tensorflow.magenta.NoteSequence.Note;switch(null!=e.pitch&&(t.pitch=0|e.pitch),e.pitchName){case"UNKNOWN_PITCH_NAME":case 0:t.pitchName=0;break;case"F_FLAT_FLAT":case 1:t.pitchName=1;break;case"C_FLAT_FLAT":case 2:t.pitchName=2;break;case"G_FLAT_FLAT":case 3:t.pitchName=3;break;case"D_FLAT_FLAT":case 4:t.pitchName=4;break;case"A_FLAT_FLAT":case 5:t.pitchName=5;break;case"E_FLAT_FLAT":case 6:t.pitchName=6;break;case"B_FLAT_FLAT":case 7:t.pitchName=7;break;case"F_FLAT":case 8:t.pitchName=8;break;case"C_FLAT":case 9:t.pitchName=9;break;case"G_FLAT":case 10:t.pitchName=10;break;case"D_FLAT":case 11:t.pitchName=11;break;case"A_FLAT":case 12:t.pitchName=12;break;case"E_FLAT":case 13:t.pitchName=13;break;case"B_FLAT":case 14:t.pitchName=14;break;case"F":case 15:t.pitchName=15;break;case"C":case 16:t.pitchName=16;break;case"G":case 17:t.pitchName=17;break;case"D":case 18:t.pitchName=18;break;case"A":case 19:t.pitchName=19;break;case"E":case 20:t.pitchName=20;break;case"B":case 21:t.pitchName=21;break;case"F_SHARP":case 22:t.pitchName=22;break;case"C_SHARP":case 23:t.pitchName=23;break;case"G_SHARP":case 24:t.pitchName=24;break;case"D_SHARP":case 25:t.pitchName=25;break;case"A_SHARP":case 26:t.pitchName=26;break;case"E_SHARP":case 27:t.pitchName=27;break;case"B_SHARP":case 28:t.pitchName=28;break;case"F_SHARP_SHARP":case 29:t.pitchName=29;break;case"C_SHARP_SHARP":case 30:t.pitchName=30;break;case"G_SHARP_SHARP":case 31:t.pitchName=31;break;case"D_SHARP_SHARP":case 32:t.pitchName=32;break;case"A_SHARP_SHARP":case 33:t.pitchName=33;break;case"E_SHARP_SHARP":case 34:t.pitchName=34;break;case"B_SHARP_SHARP":case 35:t.pitchName=35}return null!=e.velocity&&(t.velocity=0|e.velocity),null!=e.startTime&&(t.startTime=Number(e.startTime)),null!=e.quantizedStartStep&&(c.Long?(t.quantizedStartStep=c.Long.fromValue(e.quantizedStartStep)).unsigned=!1:"string"==typeof e.quantizedStartStep?t.quantizedStartStep=parseInt(e.quantizedStartStep,10):"number"==typeof e.quantizedStartStep?t.quantizedStartStep=e.quantizedStartStep:"object"==typeof e.quantizedStartStep&&(t.quantizedStartStep=new c.LongBits(e.quantizedStartStep.low>>>0,e.quantizedStartStep.high>>>0).toNumber())),null!=e.endTime&&(t.endTime=Number(e.endTime)),null!=e.quantizedEndStep&&(c.Long?(t.quantizedEndStep=c.Long.fromValue(e.quantizedEndStep)).unsigned=!1:"string"==typeof e.quantizedEndStep?t.quantizedEndStep=parseInt(e.quantizedEndStep,10):"number"==typeof e.quantizedEndStep?t.quantizedEndStep=e.quantizedEndStep:"object"==typeof e.quantizedEndStep&&(t.quantizedEndStep=new c.LongBits(e.quantizedEndStep.low>>>0,e.quantizedEndStep.high>>>0).toNumber())),null!=e.numerator&&(t.numerator=0|e.numerator),null!=e.denominator&&(t.denominator=0|e.denominator),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),null!=e.part&&(t.part=0|e.part),null!=e.voice&&(t.voice=0|e.voice),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(n.pitch=0,n.velocity=0,n.startTime=0,n.endTime=0,n.numerator=0,n.denominator=0,n.instrument=0,n.program=0,n.isDrum=!1,n.part=0,n.pitchName=t.enums===String?"UNKNOWN_PITCH_NAME":0,n.voice=0,c.Long){var i=new c.Long(0,0,!1);n.quantizedStartStep=t.longs===String?i.toString():t.longs===Number?i.toNumber():i}else n.quantizedStartStep=t.longs===String?"0":0;c.Long?(i=new c.Long(0,0,!1),n.quantizedEndStep=t.longs===String?i.toString():t.longs===Number?i.toNumber():i):n.quantizedEndStep=t.longs===String?"0":0}return null!=e.pitch&&e.hasOwnProperty("pitch")&&(n.pitch=e.pitch),null!=e.velocity&&e.hasOwnProperty("velocity")&&(n.velocity=e.velocity),null!=e.startTime&&e.hasOwnProperty("startTime")&&(n.startTime=t.json&&!isFinite(e.startTime)?String(e.startTime):e.startTime),null!=e.endTime&&e.hasOwnProperty("endTime")&&(n.endTime=t.json&&!isFinite(e.endTime)?String(e.endTime):e.endTime),null!=e.numerator&&e.hasOwnProperty("numerator")&&(n.numerator=e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&(n.denominator=e.denominator),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),null!=e.part&&e.hasOwnProperty("part")&&(n.part=e.part),null!=e.pitchName&&e.hasOwnProperty("pitchName")&&(n.pitchName=t.enums===String?u.tensorflow.magenta.NoteSequence.PitchName[e.pitchName]:e.pitchName),null!=e.voice&&e.hasOwnProperty("voice")&&(n.voice=e.voice),null!=e.quantizedStartStep&&e.hasOwnProperty("quantizedStartStep")&&("number"==typeof e.quantizedStartStep?n.quantizedStartStep=t.longs===String?String(e.quantizedStartStep):e.quantizedStartStep:n.quantizedStartStep=t.longs===String?c.Long.prototype.toString.call(e.quantizedStartStep):t.longs===Number?new c.LongBits(e.quantizedStartStep.low>>>0,e.quantizedStartStep.high>>>0).toNumber():e.quantizedStartStep),null!=e.quantizedEndStep&&e.hasOwnProperty("quantizedEndStep")&&("number"==typeof e.quantizedEndStep?n.quantizedEndStep=t.longs===String?String(e.quantizedEndStep):e.quantizedEndStep:n.quantizedEndStep=t.longs===String?c.Long.prototype.toString.call(e.quantizedEndStep):t.longs===Number?new c.LongBits(e.quantizedEndStep.low>>>0,e.quantizedEndStep.high>>>0).toNumber():e.quantizedEndStep),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.PitchName=(t={},(n=Object.create(t))[t[0]="UNKNOWN_PITCH_NAME"]=0,n[t[1]="F_FLAT_FLAT"]=1,n[t[2]="C_FLAT_FLAT"]=2,n[t[3]="G_FLAT_FLAT"]=3,n[t[4]="D_FLAT_FLAT"]=4,n[t[5]="A_FLAT_FLAT"]=5,n[t[6]="E_FLAT_FLAT"]=6,n[t[7]="B_FLAT_FLAT"]=7,n[t[8]="F_FLAT"]=8,n[t[9]="C_FLAT"]=9,n[t[10]="G_FLAT"]=10,n[t[11]="D_FLAT"]=11,n[t[12]="A_FLAT"]=12,n[t[13]="E_FLAT"]=13,n[t[14]="B_FLAT"]=14,n[t[15]="F"]=15,n[t[16]="C"]=16,n[t[17]="G"]=17,n[t[18]="D"]=18,n[t[19]="A"]=19,n[t[20]="E"]=20,n[t[21]="B"]=21,n[t[22]="F_SHARP"]=22,n[t[23]="C_SHARP"]=23,n[t[24]="G_SHARP"]=24,n[t[25]="D_SHARP"]=25,n[t[26]="A_SHARP"]=26,n[t[27]="E_SHARP"]=27,n[t[28]="B_SHARP"]=28,n[t[29]="F_SHARP_SHARP"]=29,n[t[30]="C_SHARP_SHARP"]=30,n[t[31]="G_SHARP_SHARP"]=31,n[t[32]="D_SHARP_SHARP"]=32,n[t[33]="A_SHARP_SHARP"]=33,n[t[34]="E_SHARP_SHARP"]=34,n[t[35]="B_SHARP_SHARP"]=35,n),e.TimeSignature=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.numerator=0,e.prototype.denominator=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.numerator&&e.hasOwnProperty("numerator")&&t.uint32(16).int32(e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&t.uint32(24).int32(e.denominator),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new u.tensorflow.magenta.NoteSequence.TimeSignature;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.time=e.double();break;case 2:i.numerator=e.int32();break;case 3:i.denominator=e.int32();break;default:e.skipType(7&r)}}return i},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.numerator&&e.hasOwnProperty("numerator")&&!c.isInteger(e.numerator)?"numerator: integer expected":null!=e.denominator&&e.hasOwnProperty("denominator")&&!c.isInteger(e.denominator)?"denominator: integer expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.TimeSignature)return e;var t=new u.tensorflow.magenta.NoteSequence.TimeSignature;return null!=e.time&&(t.time=Number(e.time)),null!=e.numerator&&(t.numerator=0|e.numerator),null!=e.denominator&&(t.denominator=0|e.denominator),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.numerator=0,n.denominator=0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.numerator&&e.hasOwnProperty("numerator")&&(n.numerator=e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&(n.denominator=e.denominator),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.KeySignature=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.key=0,e.prototype.mode=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.key&&e.hasOwnProperty("key")&&t.uint32(16).int32(e.key),null!=e.mode&&e.hasOwnProperty("mode")&&t.uint32(24).int32(e.mode),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new u.tensorflow.magenta.NoteSequence.KeySignature;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.time=e.double();break;case 2:i.key=e.int32();break;case 3:i.mode=e.int32();break;default:e.skipType(7&r)}}return i},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time)return"time: number expected";if(null!=e.key&&e.hasOwnProperty("key"))switch(e.key){default:return"key: enum value expected";case 0:case 1:case 1:case 2:case 3:case 3:case 4:case 5:case 6:case 6:case 7:case 8:case 8:case 9:case 10:case 10:case 11:}if(null!=e.mode&&e.hasOwnProperty("mode"))switch(e.mode){default:return"mode: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:}return null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.KeySignature)return e;var t=new u.tensorflow.magenta.NoteSequence.KeySignature;switch(null!=e.time&&(t.time=Number(e.time)),e.key){case"C":case 0:t.key=0;break;case"C_SHARP":case 1:t.key=1;break;case"D_FLAT":case 1:t.key=1;break;case"D":case 2:t.key=2;break;case"D_SHARP":case 3:t.key=3;break;case"E_FLAT":case 3:t.key=3;break;case"E":case 4:t.key=4;break;case"F":case 5:t.key=5;break;case"F_SHARP":case 6:t.key=6;break;case"G_FLAT":case 6:t.key=6;break;case"G":case 7:t.key=7;break;case"G_SHARP":case 8:t.key=8;break;case"A_FLAT":case 8:t.key=8;break;case"A":case 9:t.key=9;break;case"A_SHARP":case 10:t.key=10;break;case"B_FLAT":case 10:t.key=10;break;case"B":case 11:t.key=11}switch(e.mode){case"MAJOR":case 0:t.mode=0;break;case"MINOR":case 1:t.mode=1;break;case"NOT_SPECIFIED":case 2:t.mode=2;break;case"MIXOLYDIAN":case 3:t.mode=3;break;case"DORIAN":case 4:t.mode=4;break;case"PHRYGIAN":case 5:t.mode=5;break;case"LYDIAN":case 6:t.mode=6;break;case"LOCRIAN":case 7:t.mode=7}return t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.key=t.enums===String?"C":0,n.mode=t.enums===String?"MAJOR":0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.key&&e.hasOwnProperty("key")&&(n.key=t.enums===String?u.tensorflow.magenta.NoteSequence.KeySignature.Key[e.key]:e.key),null!=e.mode&&e.hasOwnProperty("mode")&&(n.mode=t.enums===String?u.tensorflow.magenta.NoteSequence.KeySignature.Mode[e.mode]:e.mode),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e.Key=function(){var e={},t=Object.create(e);return t[e[0]="C"]=0,t[e[1]="C_SHARP"]=1,t.D_FLAT=1,t[e[2]="D"]=2,t[e[3]="D_SHARP"]=3,t.E_FLAT=3,t[e[4]="E"]=4,t[e[5]="F"]=5,t[e[6]="F_SHARP"]=6,t.G_FLAT=6,t[e[7]="G"]=7,t[e[8]="G_SHARP"]=8,t.A_FLAT=8,t[e[9]="A"]=9,t[e[10]="A_SHARP"]=10,t.B_FLAT=10,t[e[11]="B"]=11,t}(),e.Mode=function(){var e={},t=Object.create(e);return t[e[0]="MAJOR"]=0,t[e[1]="MINOR"]=1,t[e[2]="NOT_SPECIFIED"]=2,t[e[3]="MIXOLYDIAN"]=3,t[e[4]="DORIAN"]=4,t[e[5]="PHRYGIAN"]=5,t[e[6]="LYDIAN"]=6,t[e[7]="LOCRIAN"]=7,t}(),e}(),e.Tempo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.qpm=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.qpm&&e.hasOwnProperty("qpm")&&t.uint32(17).double(e.qpm),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new u.tensorflow.magenta.NoteSequence.Tempo;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.time=e.double();break;case 2:i.qpm=e.double();break;default:e.skipType(7&r)}}return i},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.qpm&&e.hasOwnProperty("qpm")&&"number"!=typeof e.qpm?"qpm: number expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.Tempo)return e;var t=new u.tensorflow.magenta.NoteSequence.Tempo;return null!=e.time&&(t.time=Number(e.time)),null!=e.qpm&&(t.qpm=Number(e.qpm)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.qpm=0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.qpm&&e.hasOwnProperty("qpm")&&(n.qpm=t.json&&!isFinite(e.qpm)?String(e.qpm):e.qpm),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.PitchBend=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.bend=0,e.prototype.instrument=0,e.prototype.program=0,e.prototype.isDrum=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.bend&&e.hasOwnProperty("bend")&&t.uint32(16).int32(e.bend),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(24).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(32).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(40).bool(e.isDrum),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new u.tensorflow.magenta.NoteSequence.PitchBend;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.time=e.double();break;case 2:i.bend=e.int32();break;case 3:i.instrument=e.int32();break;case 4:i.program=e.int32();break;case 5:i.isDrum=e.bool();break;default:e.skipType(7&r)}}return i},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.bend&&e.hasOwnProperty("bend")&&!c.isInteger(e.bend)?"bend: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!c.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!c.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!=typeof e.isDrum?"isDrum: boolean expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.PitchBend)return e;var t=new u.tensorflow.magenta.NoteSequence.PitchBend;return null!=e.time&&(t.time=Number(e.time)),null!=e.bend&&(t.bend=0|e.bend),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.bend=0,n.instrument=0,n.program=0,n.isDrum=!1),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.bend&&e.hasOwnProperty("bend")&&(n.bend=e.bend),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.ControlChange=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.quantizedStep=c.Long?c.Long.fromBits(0,0,!1):0,e.prototype.controlNumber=0,e.prototype.controlValue=0,e.prototype.instrument=0,e.prototype.program=0,e.prototype.isDrum=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&t.uint32(16).int32(e.controlNumber),null!=e.controlValue&&e.hasOwnProperty("controlValue")&&t.uint32(24).int32(e.controlValue),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(32).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(40).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(48).bool(e.isDrum),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&t.uint32(56).int64(e.quantizedStep),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new u.tensorflow.magenta.NoteSequence.ControlChange;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.time=e.double();break;case 7:i.quantizedStep=c.Long?e.int64().toNumber():e.int64();break;case 2:i.controlNumber=e.int32();break;case 3:i.controlValue=e.int32();break;case 4:i.instrument=e.int32();break;case 5:i.program=e.int32();break;case 6:i.isDrum=e.bool();break;default:e.skipType(7&r)}}return i},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&!(c.isInteger(e.quantizedStep)||e.quantizedStep&&c.isInteger(e.quantizedStep.low)&&c.isInteger(e.quantizedStep.high))?"quantizedStep: integer|Long expected":null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&!c.isInteger(e.controlNumber)?"controlNumber: integer expected":null!=e.controlValue&&e.hasOwnProperty("controlValue")&&!c.isInteger(e.controlValue)?"controlValue: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!c.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!c.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!=typeof e.isDrum?"isDrum: boolean expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.ControlChange)return e;var t=new u.tensorflow.magenta.NoteSequence.ControlChange;return null!=e.time&&(t.time=Number(e.time)),null!=e.quantizedStep&&(c.Long?(t.quantizedStep=c.Long.fromValue(e.quantizedStep)).unsigned=!1:"string"==typeof e.quantizedStep?t.quantizedStep=parseInt(e.quantizedStep,10):"number"==typeof e.quantizedStep?t.quantizedStep=e.quantizedStep:"object"==typeof e.quantizedStep&&(t.quantizedStep=new c.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber())),null!=e.controlNumber&&(t.controlNumber=0|e.controlNumber),null!=e.controlValue&&(t.controlValue=0|e.controlValue),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,n.controlNumber=0,n.controlValue=0,n.instrument=0,n.program=0,n.isDrum=!1,c.Long){var i=new c.Long(0,0,!1);n.quantizedStep=t.longs===String?i.toString():t.longs===Number?i.toNumber():i}else n.quantizedStep=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&(n.controlNumber=e.controlNumber),null!=e.controlValue&&e.hasOwnProperty("controlValue")&&(n.controlValue=e.controlValue),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&("number"==typeof e.quantizedStep?n.quantizedStep=t.longs===String?String(e.quantizedStep):e.quantizedStep:n.quantizedStep=t.longs===String?c.Long.prototype.toString.call(e.quantizedStep):t.longs===Number?new c.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber():e.quantizedStep),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.PartInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.part=0,e.prototype.name="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.part&&e.hasOwnProperty("part")&&t.uint32(8).int32(e.part),null!=e.name&&e.hasOwnProperty("name")&&t.uint32(18).string(e.name),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new u.tensorflow.magenta.NoteSequence.PartInfo;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.part=e.int32();break;case 2:i.name=e.string();break;default:e.skipType(7&r)}}return i},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.part&&e.hasOwnProperty("part")&&!c.isInteger(e.part)?"part: integer expected":null!=e.name&&e.hasOwnProperty("name")&&!c.isString(e.name)?"name: string expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.PartInfo)return e;var t=new u.tensorflow.magenta.NoteSequence.PartInfo;return null!=e.part&&(t.part=0|e.part),null!=e.name&&(t.name=String(e.name)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.part=0,n.name=""),null!=e.part&&e.hasOwnProperty("part")&&(n.part=e.part),null!=e.name&&e.hasOwnProperty("name")&&(n.name=e.name),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.SourceInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sourceType=0,e.prototype.encodingType=0,e.prototype.parser=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.sourceType&&e.hasOwnProperty("sourceType")&&t.uint32(8).int32(e.sourceType),null!=e.encodingType&&e.hasOwnProperty("encodingType")&&t.uint32(16).int32(e.encodingType),null!=e.parser&&e.hasOwnProperty("parser")&&t.uint32(24).int32(e.parser),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new u.tensorflow.magenta.NoteSequence.SourceInfo;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.sourceType=e.int32();break;case 2:i.encodingType=e.int32();break;case 3:i.parser=e.int32();break;default:e.skipType(7&r)}}return i},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.sourceType&&e.hasOwnProperty("sourceType"))switch(e.sourceType){default:return"sourceType: enum value expected";case 0:case 1:case 2:}if(null!=e.encodingType&&e.hasOwnProperty("encodingType"))switch(e.encodingType){default:return"encodingType: enum value expected";case 0:case 1:case 2:case 3:case 4:}if(null!=e.parser&&e.hasOwnProperty("parser"))switch(e.parser){default:return"parser: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:}return null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.SourceInfo)return e;var t=new u.tensorflow.magenta.NoteSequence.SourceInfo;switch(e.sourceType){case"UNKNOWN_SOURCE_TYPE":case 0:t.sourceType=0;break;case"SCORE_BASED":case 1:t.sourceType=1;break;case"PERFORMANCE_BASED":case 2:t.sourceType=2}switch(e.encodingType){case"UNKNOWN_ENCODING_TYPE":case 0:t.encodingType=0;break;case"MUSIC_XML":case 1:t.encodingType=1;break;case"ABC":case 2:t.encodingType=2;break;case"MIDI":case 3:t.encodingType=3;break;case"MUSICNET":case 4:t.encodingType=4}switch(e.parser){case"UNKNOWN_PARSER":case 0:t.parser=0;break;case"MUSIC21":case 1:t.parser=1;break;case"PRETTY_MIDI":case 2:t.parser=2;break;case"MAGENTA_MUSIC_XML":case 3:t.parser=3;break;case"MAGENTA_MUSICNET":case 4:t.parser=4;break;case"MAGENTA_ABC":case 5:t.parser=5;break;case"TONEJS_MIDI_CONVERT":case 6:t.parser=6}return t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.sourceType=t.enums===String?"UNKNOWN_SOURCE_TYPE":0,n.encodingType=t.enums===String?"UNKNOWN_ENCODING_TYPE":0,n.parser=t.enums===String?"UNKNOWN_PARSER":0),null!=e.sourceType&&e.hasOwnProperty("sourceType")&&(n.sourceType=t.enums===String?u.tensorflow.magenta.NoteSequence.SourceInfo.SourceType[e.sourceType]:e.sourceType),null!=e.encodingType&&e.hasOwnProperty("encodingType")&&(n.encodingType=t.enums===String?u.tensorflow.magenta.NoteSequence.SourceInfo.EncodingType[e.encodingType]:e.encodingType),null!=e.parser&&e.hasOwnProperty("parser")&&(n.parser=t.enums===String?u.tensorflow.magenta.NoteSequence.SourceInfo.Parser[e.parser]:e.parser),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e.SourceType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_SOURCE_TYPE"]=0,t[e[1]="SCORE_BASED"]=1,t[e[2]="PERFORMANCE_BASED"]=2,t}(),e.EncodingType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_ENCODING_TYPE"]=0,t[e[1]="MUSIC_XML"]=1,t[e[2]="ABC"]=2,t[e[3]="MIDI"]=3,t[e[4]="MUSICNET"]=4,t}(),e.Parser=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_PARSER"]=0,t[e[1]="MUSIC21"]=1,t[e[2]="PRETTY_MIDI"]=2,t[e[3]="MAGENTA_MUSIC_XML"]=3,t[e[4]="MAGENTA_MUSICNET"]=4,t[e[5]="MAGENTA_ABC"]=5,t[e[6]="TONEJS_MIDI_CONVERT"]=6,t}(),e}(),e.TextAnnotation=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.quantizedStep=c.Long?c.Long.fromBits(0,0,!1):0,e.prototype.text="",e.prototype.annotationType=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.text&&e.hasOwnProperty("text")&&t.uint32(18).string(e.text),null!=e.annotationType&&e.hasOwnProperty("annotationType")&&t.uint32(24).int32(e.annotationType),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&t.uint32(32).int64(e.quantizedStep),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new u.tensorflow.magenta.NoteSequence.TextAnnotation;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.time=e.double();break;case 4:i.quantizedStep=c.Long?e.int64().toNumber():e.int64();break;case 2:i.text=e.string();break;case 3:i.annotationType=e.int32();break;default:e.skipType(7&r)}}return i},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time)return"time: number expected";if(null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&!(c.isInteger(e.quantizedStep)||e.quantizedStep&&c.isInteger(e.quantizedStep.low)&&c.isInteger(e.quantizedStep.high)))return"quantizedStep: integer|Long expected";if(null!=e.text&&e.hasOwnProperty("text")&&!c.isString(e.text))return"text: string expected";if(null!=e.annotationType&&e.hasOwnProperty("annotationType"))switch(e.annotationType){default:return"annotationType: enum value expected";case 0:case 1:case 2:}return null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.TextAnnotation)return e;var t=new u.tensorflow.magenta.NoteSequence.TextAnnotation;switch(null!=e.time&&(t.time=Number(e.time)),null!=e.quantizedStep&&(c.Long?(t.quantizedStep=c.Long.fromValue(e.quantizedStep)).unsigned=!1:"string"==typeof e.quantizedStep?t.quantizedStep=parseInt(e.quantizedStep,10):"number"==typeof e.quantizedStep?t.quantizedStep=e.quantizedStep:"object"==typeof e.quantizedStep&&(t.quantizedStep=new c.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber())),null!=e.text&&(t.text=String(e.text)),e.annotationType){case"UNKNOWN":case 0:t.annotationType=0;break;case"CHORD_SYMBOL":case 1:t.annotationType=1;break;case"BEAT":case 2:t.annotationType=2}return t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,n.text="",n.annotationType=t.enums===String?"UNKNOWN":0,c.Long){var i=new c.Long(0,0,!1);n.quantizedStep=t.longs===String?i.toString():t.longs===Number?i.toNumber():i}else n.quantizedStep=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.text&&e.hasOwnProperty("text")&&(n.text=e.text),null!=e.annotationType&&e.hasOwnProperty("annotationType")&&(n.annotationType=t.enums===String?u.tensorflow.magenta.NoteSequence.TextAnnotation.TextAnnotationType[e.annotationType]:e.annotationType),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&("number"==typeof e.quantizedStep?n.quantizedStep=t.longs===String?String(e.quantizedStep):e.quantizedStep:n.quantizedStep=t.longs===String?c.Long.prototype.toString.call(e.quantizedStep):t.longs===Number?new c.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber():e.quantizedStep),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e.TextAnnotationType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN"]=0,t[e[1]="CHORD_SYMBOL"]=1,t[e[2]="BEAT"]=2,t}(),e}(),e.QuantizationInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.stepsPerQuarter=0,e.prototype.stepsPerSecond=0,Object.defineProperty(e.prototype,"resolution",{get:c.oneOfGetter(t=["stepsPerQuarter","stepsPerSecond"]),set:c.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&t.uint32(8).int32(e.stepsPerQuarter),null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")&&t.uint32(16).int32(e.stepsPerSecond),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new u.tensorflow.magenta.NoteSequence.QuantizationInfo;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.stepsPerQuarter=e.int32();break;case 2:i.stepsPerSecond=e.int32();break;default:e.skipType(7&r)}}return i},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t={};if(null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&(t.resolution=1,!c.isInteger(e.stepsPerQuarter)))return"stepsPerQuarter: integer expected";if(null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")){if(1===t.resolution)return"resolution: multiple values";if(t.resolution=1,!c.isInteger(e.stepsPerSecond))return"stepsPerSecond: integer expected"}return null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.QuantizationInfo)return e;var t=new u.tensorflow.magenta.NoteSequence.QuantizationInfo;return null!=e.stepsPerQuarter&&(t.stepsPerQuarter=0|e.stepsPerQuarter),null!=e.stepsPerSecond&&(t.stepsPerSecond=0|e.stepsPerSecond),t},e.toObject=function(e,t){t||(t={});var n={};return null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&(n.stepsPerQuarter=e.stepsPerQuarter,t.oneofs&&(n.resolution="stepsPerQuarter")),null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")&&(n.stepsPerSecond=e.stepsPerSecond,t.oneofs&&(n.resolution="stepsPerSecond")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.SubsequenceInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.startTimeOffset=0,e.prototype.endTimeOffset=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&t.uint32(9).double(e.startTimeOffset),null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&t.uint32(17).double(e.endTimeOffset),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new u.tensorflow.magenta.NoteSequence.SubsequenceInfo;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.startTimeOffset=e.double();break;case 2:i.endTimeOffset=e.double();break;default:e.skipType(7&r)}}return i},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&"number"!=typeof e.startTimeOffset?"startTimeOffset: number expected":null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&"number"!=typeof e.endTimeOffset?"endTimeOffset: number expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.SubsequenceInfo)return e;var t=new u.tensorflow.magenta.NoteSequence.SubsequenceInfo;return null!=e.startTimeOffset&&(t.startTimeOffset=Number(e.startTimeOffset)),null!=e.endTimeOffset&&(t.endTimeOffset=Number(e.endTimeOffset)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.startTimeOffset=0,n.endTimeOffset=0),null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&(n.startTimeOffset=t.json&&!isFinite(e.startTimeOffset)?String(e.startTimeOffset):e.startTimeOffset),null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&(n.endTimeOffset=t.json&&!isFinite(e.endTimeOffset)?String(e.endTimeOffset):e.endTimeOffset),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.SectionAnnotation=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.sectionId=c.Long?c.Long.fromBits(0,0,!1):0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&t.uint32(32).int64(e.sectionId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new u.tensorflow.magenta.NoteSequence.SectionAnnotation;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.time=e.double();break;case 4:i.sectionId=c.Long?e.int64().toNumber():e.int64();break;default:e.skipType(7&r)}}return i},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.sectionId&&e.hasOwnProperty("sectionId")&&!(c.isInteger(e.sectionId)||e.sectionId&&c.isInteger(e.sectionId.low)&&c.isInteger(e.sectionId.high))?"sectionId: integer|Long expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.SectionAnnotation)return e;var t=new u.tensorflow.magenta.NoteSequence.SectionAnnotation;return null!=e.time&&(t.time=Number(e.time)),null!=e.sectionId&&(c.Long?(t.sectionId=c.Long.fromValue(e.sectionId)).unsigned=!1:"string"==typeof e.sectionId?t.sectionId=parseInt(e.sectionId,10):"number"==typeof e.sectionId?t.sectionId=e.sectionId:"object"==typeof e.sectionId&&(t.sectionId=new c.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber())),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,c.Long){var i=new c.Long(0,0,!1);n.sectionId=t.longs===String?i.toString():t.longs===Number?i.toNumber():i}else n.sectionId=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&("number"==typeof e.sectionId?n.sectionId=t.longs===String?String(e.sectionId):e.sectionId:n.sectionId=t.longs===String?c.Long.prototype.toString.call(e.sectionId):t.longs===Number?new c.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber():e.sectionId),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.Section=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.sectionId=c.Long?c.Long.fromBits(0,0,!1):0,e.prototype.sectionGroup=null,Object.defineProperty(e.prototype,"sectionType",{get:c.oneOfGetter(t=["sectionId","sectionGroup"]),set:c.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&t.uint32(8).int64(e.sectionId),null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")&&u.tensorflow.magenta.NoteSequence.SectionGroup.encode(e.sectionGroup,t.uint32(18).fork()).ldelim(),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new u.tensorflow.magenta.NoteSequence.Section;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.sectionId=c.Long?e.int64().toNumber():e.int64();break;case 2:i.sectionGroup=u.tensorflow.magenta.NoteSequence.SectionGroup.decode(e,e.uint32());break;default:e.skipType(7&r)}}return i},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t={};if(null!=e.sectionId&&e.hasOwnProperty("sectionId")&&(t.sectionType=1,!(c.isInteger(e.sectionId)||e.sectionId&&c.isInteger(e.sectionId.low)&&c.isInteger(e.sectionId.high))))return"sectionId: integer|Long expected";if(null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")){if(1===t.sectionType)return"sectionType: multiple values";t.sectionType=1;var n=u.tensorflow.magenta.NoteSequence.SectionGroup.verify(e.sectionGroup);if(n)return"sectionGroup."+n}return null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.Section)return e;var t=new u.tensorflow.magenta.NoteSequence.Section;if(null!=e.sectionId&&(c.Long?(t.sectionId=c.Long.fromValue(e.sectionId)).unsigned=!1:"string"==typeof e.sectionId?t.sectionId=parseInt(e.sectionId,10):"number"==typeof e.sectionId?t.sectionId=e.sectionId:"object"==typeof e.sectionId&&(t.sectionId=new c.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber())),null!=e.sectionGroup){if("object"!=typeof e.sectionGroup)throw TypeError(".tensorflow.magenta.NoteSequence.Section.sectionGroup: object expected");t.sectionGroup=u.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(e.sectionGroup)}return t},e.toObject=function(e,t){t||(t={});var n={};return null!=e.sectionId&&e.hasOwnProperty("sectionId")&&("number"==typeof e.sectionId?n.sectionId=t.longs===String?String(e.sectionId):e.sectionId:n.sectionId=t.longs===String?c.Long.prototype.toString.call(e.sectionId):t.longs===Number?new c.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber():e.sectionId,t.oneofs&&(n.sectionType="sectionId")),null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")&&(n.sectionGroup=u.tensorflow.magenta.NoteSequence.SectionGroup.toObject(e.sectionGroup,t),t.oneofs&&(n.sectionType="sectionGroup")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.SectionGroup=function(){function e(e){if(this.sections=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sections=c.emptyArray,e.prototype.numTimes=0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=a.create()),null!=e.sections&&e.sections.length)for(var n=0;n<e.sections.length;++n)u.tensorflow.magenta.NoteSequence.Section.encode(e.sections[n],t.uint32(10).fork()).ldelim();return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&t.uint32(16).int32(e.numTimes),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new u.tensorflow.magenta.NoteSequence.SectionGroup;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.sections&&i.sections.length||(i.sections=[]),i.sections.push(u.tensorflow.magenta.NoteSequence.Section.decode(e,e.uint32()));break;case 2:i.numTimes=e.int32();break;default:e.skipType(7&r)}}return i},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.sections&&e.hasOwnProperty("sections")){if(!Array.isArray(e.sections))return"sections: array expected";for(var t=0;t<e.sections.length;++t){var n=u.tensorflow.magenta.NoteSequence.Section.verify(e.sections[t]);if(n)return"sections."+n}}return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&!c.isInteger(e.numTimes)?"numTimes: integer expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.SectionGroup)return e;var t=new u.tensorflow.magenta.NoteSequence.SectionGroup;if(e.sections){if(!Array.isArray(e.sections))throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: array expected");t.sections=[];for(var n=0;n<e.sections.length;++n){if("object"!=typeof e.sections[n])throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: object expected");t.sections[n]=u.tensorflow.magenta.NoteSequence.Section.fromObject(e.sections[n])}}return null!=e.numTimes&&(t.numTimes=0|e.numTimes),t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.sections=[]),t.defaults&&(n.numTimes=0),e.sections&&e.sections.length){n.sections=[];for(var i=0;i<e.sections.length;++i)n.sections[i]=u.tensorflow.magenta.NoteSequence.Section.toObject(e.sections[i],t)}return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&(n.numTimes=e.numTimes),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e}(),i.SequenceMetadata=function(){function e(e){if(this.genre=[],this.composers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.title="",e.prototype.artist="",e.prototype.genre=c.emptyArray,e.prototype.composers=c.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=a.create()),null!=e.title&&e.hasOwnProperty("title")&&t.uint32(10).string(e.title),null!=e.artist&&e.hasOwnProperty("artist")&&t.uint32(18).string(e.artist),null!=e.genre&&e.genre.length)for(var n=0;n<e.genre.length;++n)t.uint32(26).string(e.genre[n]);if(null!=e.composers&&e.composers.length)for(n=0;n<e.composers.length;++n)t.uint32(34).string(e.composers[n]);return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new u.tensorflow.magenta.SequenceMetadata;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.title=e.string();break;case 2:i.artist=e.string();break;case 3:i.genre&&i.genre.length||(i.genre=[]),i.genre.push(e.string());break;case 4:i.composers&&i.composers.length||(i.composers=[]),i.composers.push(e.string());break;default:e.skipType(7&r)}}return i},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.title&&e.hasOwnProperty("title")&&!c.isString(e.title))return"title: string expected";if(null!=e.artist&&e.hasOwnProperty("artist")&&!c.isString(e.artist))return"artist: string expected";if(null!=e.genre&&e.hasOwnProperty("genre")){if(!Array.isArray(e.genre))return"genre: array expected";for(var t=0;t<e.genre.length;++t)if(!c.isString(e.genre[t]))return"genre: string[] expected"}if(null!=e.composers&&e.hasOwnProperty("composers")){if(!Array.isArray(e.composers))return"composers: array expected";for(t=0;t<e.composers.length;++t)if(!c.isString(e.composers[t]))return"composers: string[] expected"}return null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.SequenceMetadata)return e;var t=new u.tensorflow.magenta.SequenceMetadata;if(null!=e.title&&(t.title=String(e.title)),null!=e.artist&&(t.artist=String(e.artist)),e.genre){if(!Array.isArray(e.genre))throw TypeError(".tensorflow.magenta.SequenceMetadata.genre: array expected");t.genre=[];for(var n=0;n<e.genre.length;++n)t.genre[n]=String(e.genre[n])}if(e.composers){if(!Array.isArray(e.composers))throw TypeError(".tensorflow.magenta.SequenceMetadata.composers: array expected");for(t.composers=[],n=0;n<e.composers.length;++n)t.composers[n]=String(e.composers[n])}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.genre=[],n.composers=[]),t.defaults&&(n.title="",n.artist=""),null!=e.title&&e.hasOwnProperty("title")&&(n.title=e.title),null!=e.artist&&e.hasOwnProperty("artist")&&(n.artist=e.artist),e.genre&&e.genre.length){n.genre=[];for(var i=0;i<e.genre.length;++i)n.genre[i]=e.genre[i]}if(e.composers&&e.composers.length)for(n.composers=[],i=0;i<e.composers.length;++i)n.composers[i]=e.composers[i];return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),i.VelocityRange=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.min=0,e.prototype.max=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.min&&e.hasOwnProperty("min")&&t.uint32(8).int32(e.min),null!=e.max&&e.hasOwnProperty("max")&&t.uint32(16).int32(e.max),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,i=new u.tensorflow.magenta.VelocityRange;e.pos<n;){var r=e.uint32();switch(r>>>3){case 1:i.min=e.int32();break;case 2:i.max=e.int32();break;default:e.skipType(7&r)}}return i},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.min&&e.hasOwnProperty("min")&&!c.isInteger(e.min)?"min: integer expected":null!=e.max&&e.hasOwnProperty("max")&&!c.isInteger(e.max)?"max: integer expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.VelocityRange)return e;var t=new u.tensorflow.magenta.VelocityRange;return null!=e.min&&(t.min=0|e.min),null!=e.max&&(t.max=0|e.max),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.min=0,n.max=0),null!=e.min&&e.hasOwnProperty("min")&&(n.min=e.min),null!=e.max&&e.hasOwnProperty("max")&&(n.max=e.max),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),i),r),e.exports=u},function(e,t,n){"use strict";n.r(t),n.d(t,"ChordQuality",(function(){return a})),n.d(t,"ChordSymbolException",(function(){return c})),n.d(t,"ChordEncodingException",(function(){return u})),n.d(t,"ChordSymbols",(function(){return l})),n.d(t,"ChordEncoder",(function(){return h})),n.d(t,"chordEncoderFromType",(function(){return p})),n.d(t,"MajorMinorChordEncoder",(function(){return d})),n.d(t,"TriadChordEncoder",(function(){return m})),n.d(t,"PitchChordEncoder",(function(){return f}));var i=n(0),r=n(9),o=n(1);const s=[["1P","3M","5P"],["1P","3m","5P"],["1P","3M","5A"],["1P","3m","5d"]];var a;!function(e){e[e.Major=0]="Major",e[e.Minor=1]="Minor",e[e.Augmented=2]="Augmented",e[e.Diminished=3]="Diminished",e[e.Other=4]="Other"}(a||(a={}));class c extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class u extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class l{static pitches(e){if(!r.Chord.tokenize(e)[0]||!r.Chord.exists(e))throw new c("Unrecognized chord symbol: "+e);return r.Chord.notes(e).map(r.Note.chroma)}static root(e){const t=r.Chord.tokenize(e)[0];if(!t)throw new c("Chord symbol has unknown root: "+e);return r.Note.chroma(t)}static quality(e){if(!r.Chord.exists(e))throw new c("Unrecognized chord symbol: "+e);const t=r.Chord.intervals(e),n=s.map(e=>e.every(e=>t.includes(e))),i=n.indexOf(!0),o=n.lastIndexOf(!0);return i>=0&&i===o?i:a.Other}}class h{encodeProgression(e,t){const n=e.map(e=>this.encode(e)),r=Array.from(Array(t).keys()).map(e=>Math.floor(e*n.length/t));return i.stack(r.map(e=>n[e]))}}function p(e){switch(e){case"MajorMinorChordEncoder":return new d;case"TriadChordEncoder":return new m;case"PitchChordEncoder":return new f;default:throw new Error("Unknown chord encoder type: "+e)}}class d extends h{constructor(){super(...arguments),this.depth=1+2*o.NUM_PITCH_CLASSES}index(e){if(e===o.NO_CHORD)return 0;const t=l.root(e),n=1+l.quality(e)*o.NUM_PITCH_CLASSES+t;if(n>=this.depth)throw new u("Chord is neither major nor minor: "+e);return n}encode(e){return i.tidy(()=>i.oneHot(i.tensor1d([this.index(e)],"int32"),this.depth).as1D())}}class m extends h{constructor(){super(...arguments),this.depth=1+4*o.NUM_PITCH_CLASSES}index(e){if(e===o.NO_CHORD)return 0;const t=l.root(e),n=1+l.quality(e)*o.NUM_PITCH_CLASSES+t;if(n>=this.depth)throw new u("Chord is not a standard triad: "+e);return n}encode(e){return i.tidy(()=>i.oneHot(i.tensor1d([this.index(e)],"int32"),this.depth).as1D())}}class f extends h{constructor(){super(...arguments),this.depth=1+3*o.NUM_PITCH_CLASSES}encode(e){return i.tidy(()=>{if(e===o.NO_CHORD)return i.oneHot(i.tensor1d([0],"int32"),this.depth).as1D();const t=l.root(e),n=i.oneHot(i.tensor1d([t],"int32"),o.NUM_PITCH_CLASSES).as1D(),r=i.buffer([o.NUM_PITCH_CLASSES]);l.pitches(e).forEach(e=>r.set(1,e));const s=r.toTensor().as1D(),a=n;return i.concat1d([i.tensor1d([0]),n,s,a])})}}},function(e,t,n){"use strict";n.r(t),n.d(t,"converterFromSpec",(function(){return l})),n.d(t,"DataConverter",(function(){return h})),n.d(t,"DrumsConverter",(function(){return p})),n.d(t,"DrumRollConverter",(function(){return d})),n.d(t,"DrumsOneHotConverter",(function(){return m})),n.d(t,"MelodyConverter",(function(){return f})),n.d(t,"MelodyRhythmConverter",(function(){return S})),n.d(t,"MelodyShapeConverter",(function(){return y})),n.d(t,"TrioConverter",(function(){return w})),n.d(t,"TrioRhythmConverter",(function(){return b})),n.d(t,"MultitrackConverter",(function(){return v})),n.d(t,"GrooveConverter",(function(){return N}));var i=n(0),r=n(3),o=n(1);n.d(t,"DEFAULT_DRUM_PITCH_CLASSES",(function(){return o.DEFAULT_DRUM_PITCH_CLASSES}));var s=n(4),a=n(10),c=n(12),u=n(5);function l(e){switch(e.type){case"MelodyConverter":return new f(e.args);case"MelodyRhythmConverter":return new S(e.args);case"MelodyShapeConverter":return new y(e.args);case"DrumsConverter":return new p(e.args);case"DrumRollConverter":return new d(e.args);case"TrioConverter":return new w(e.args);case"TrioRhythmConverter":return new b(e.args);case"DrumsOneHotConverter":return new m(e.args);case"MultitrackConverter":return new v(e.args);case"GrooveConverter":return new N(e.args);default:throw new Error("Unknown DataConverter type: "+e)}}class h{constructor(e){this.NUM_SPLITS=0,this.SEGMENTED_BY_TRACK=!1,this.numSteps=e.numSteps,this.numSegments=e.numSegments}tensorSteps(e){return i.scalar(e.shape[0],"int32")}}class p extends h{constructor(e){super(e),this.pitchClasses=e.pitchClasses||o.DEFAULT_DRUM_PITCH_CLASSES,this.pitchToClass=new Map;for(let e=0;e<this.pitchClasses.length;++e)this.pitchClasses[e].forEach(t=>{this.pitchToClass.set(t,e)});this.depth=this.pitchClasses.length+1}toTensor(e){u.assertIsQuantizedSequence(e);const t=this.numSteps||e.totalQuantizedSteps,n=i.buffer([t,this.pitchClasses.length+1],"int32");for(let e=0;e<t;++e)n.set(1,e,-1);return e.notes.forEach(e=>{n.set(1,e.quantizedStartStep,this.pitchToClass.get(e.pitch)),n.set(0,e.quantizedStartStep,-1)}),n.toTensor()}async toNoteSequence(e,t,n){const i=u.createQuantizedNoteSequence(t,n),o=e.argMax(1),s=await o.data();o.dispose();for(let e=0;e<s.length;++e)for(let t=0;t<this.pitchClasses.length;t++)s[e]>>t&1&&i.notes.push(r.a.Note.create({pitch:this.pitchClasses[t][0],quantizedStartStep:e,quantizedEndStep:e+1,isDrum:!0}));return i.totalQuantizedSteps=s.length,i}}class d extends p{async toNoteSequence(e,t,n){const i=u.createQuantizedNoteSequence(t,n),o=await e.data();for(let t=0;t<e.shape[0];++t){const e=o.slice(t*this.pitchClasses.length,(t+1)*this.pitchClasses.length);for(let n=0;n<e.length;++n)e[n]&&i.notes.push(r.a.Note.create({pitch:this.pitchClasses[n][0],quantizedStartStep:t,quantizedEndStep:t+1,isDrum:!0}))}return i.totalQuantizedSteps=e.shape[0],i}}class m extends p{constructor(e){super(e),this.depth=Math.pow(2,this.pitchClasses.length)}toTensor(e){u.assertIsRelativeQuantizedSequence(e);const t=this.numSteps||e.totalQuantizedSteps,n=Array(t).fill(0);for(const{pitch:t,quantizedStartStep:i}of e.notes)n[i]+=Math.pow(2,this.pitchToClass.get(t));return i.tidy(()=>i.oneHot(i.tensor1d(n,"int32"),this.depth))}}class f extends h{constructor(e){super(e),this.NOTE_OFF=1,this.FIRST_PITCH=2,this.minPitch=e.minPitch,this.maxPitch=e.maxPitch,this.ignorePolyphony=e.ignorePolyphony,this.depth=e.maxPitch-e.minPitch+1+this.FIRST_PITCH}toTensor(e){const t=a.Melody.fromNoteSequence(e,this.minPitch,this.maxPitch,this.ignorePolyphony,this.numSteps);return i.tidy(()=>i.oneHot(i.tensor(t.events,[t.events.length],"int32"),this.depth))}async toNoteSequence(e,t,n){const i=e.argMax(1),r=await i.data();i.dispose();return new a.Melody(r,this.minPitch,this.maxPitch).toNoteSequence(t,n)}}class g extends h{constructor(e,t){super(e),this.minPitch=e.minPitch,this.maxPitch=e.maxPitch,this.ignorePolyphony=e.ignorePolyphony,this.melodyControl=t,this.depth=t.depth}toTensor(e){const t=a.Melody.fromNoteSequence(e,this.minPitch,this.maxPitch,this.ignorePolyphony,this.numSteps);return this.melodyControl.extract(t)}}class S extends g{constructor(e){super(e,new a.MelodyRhythm)}async toNoteSequence(e,t,n){const i=u.createQuantizedNoteSequence(t,n),s=await e.data();for(let e=0;e<s.length;++e)s[e]&&i.notes.push(r.a.Note.create({pitch:o.DEFAULT_DRUM_PITCH_CLASSES[1][0],quantizedStartStep:e,quantizedEndStep:e+1,isDrum:!0}));return i.totalQuantizedSteps=s.length,i}}class y extends g{constructor(e){super(e,new a.MelodyShape)}async toNoteSequence(e,t,n){const i=u.createQuantizedNoteSequence(t,n),o=e.argMax(1),a=await o.data();o.dispose();let c=Math.round((this.maxPitch+this.minPitch)/2);for(let e=0;e<a.length;++e){switch(a[e]){case 0:c-=1,c<this.minPitch&&(c=this.minPitch,s.log("Pitch range exceeded when creating NoteSequence from shape.","MelodyShapeConverter"));break;case 2:c+=1,c>this.maxPitch&&(c=this.maxPitch,s.log("Pitch range exceeded when creating NoteSequence from shape.","MelodyShapeConverter"))}i.notes.push(r.a.Note.create({pitch:c,quantizedStartStep:e,quantizedEndStep:e+1}))}return i.totalQuantizedSteps=a.length,i}}class w extends h{constructor(e){super(e),this.NUM_SPLITS=3,this.MEL_PROG_RANGE=[0,31],this.BASS_PROG_RANGE=[32,39],e.melArgs.numSteps=e.numSteps,e.bassArgs.numSteps=e.numSteps,e.drumsArgs.numSteps=e.numSteps,this.melConverter=new f(e.melArgs),this.bassConverter=new f(e.bassArgs),this.drumsConverter=new m(e.drumsArgs),this.depth=this.melConverter.depth+this.bassConverter.depth+this.drumsConverter.depth}toTensor(e){u.assertIsQuantizedSequence(e);const t=u.clone(e),n=u.clone(e),r=u.clone(e);return t.notes=e.notes.filter(e=>!e.isDrum&&e.program>=this.MEL_PROG_RANGE[0]&&e.program<=this.MEL_PROG_RANGE[1]),n.notes=e.notes.filter(e=>!e.isDrum&&e.program>=this.BASS_PROG_RANGE[0]&&e.program<=this.BASS_PROG_RANGE[1]),r.notes=e.notes.filter(e=>e.isDrum),i.tidy(()=>i.concat([this.melConverter.toTensor(t),this.bassConverter.toTensor(n),this.drumsConverter.toTensor(r)],-1))}async toNoteSequence(e,t,n){const r=i.split(e,[this.melConverter.depth,this.bassConverter.depth,this.drumsConverter.depth],-1),o=await this.melConverter.toNoteSequence(r[0],t,n);o.notes.forEach(e=>{e.instrument=0,e.program=0});const s=await this.bassConverter.toNoteSequence(r[1],t,n);o.notes.push(...s.notes.map(e=>(e.instrument=1,e.program=this.BASS_PROG_RANGE[0],e)));const a=await this.drumsConverter.toNoteSequence(r[2],t,n);return o.notes.push(...a.notes.map(e=>(e.instrument=2,e))),r.forEach(e=>e.dispose()),o}}class b extends h{constructor(e){super(e),this.NUM_SPLITS=3,this.trioConverter=new w(e),this.depth=3}toTensor(e){return i.tidy(()=>{const t=this.trioConverter.toTensor(e),n=i.split(t,[this.trioConverter.melConverter.depth,this.trioConverter.bassConverter.depth,this.trioConverter.drumsConverter.depth],1),r=i.argMax(n[0],1),o=i.argMax(n[1],1),s=i.argMax(n[2],1),a=i.greater(r,1),c=i.greater(o,1),u=i.greater(s,0);return i.stack([a,c,u],1)})}async toNoteSequence(e,t,n){const s=i.split(e,3,1),a=await Promise.all(s.map(e=>e.data())),c=u.createQuantizedNoteSequence(t,n);for(let e=0;e<this.numSteps;++e)a[0][e]&&c.notes.push(r.a.Note.create({pitch:72,quantizedStartStep:e,quantizedEndStep:e+1,instrument:0,program:0})),a[1][e]&&c.notes.push(r.a.Note.create({pitch:36,quantizedStartStep:e,quantizedEndStep:e+1,instrument:1,program:32})),a[2][e]&&c.notes.push(r.a.Note.create({pitch:o.DEFAULT_DRUM_PITCH_CLASSES[1][0],quantizedStartStep:e,quantizedEndStep:e+1,instrument:2,isDrum:!0}));return c.totalQuantizedSteps=this.numSteps,c}}class v extends h{constructor(e){super(e),this.SEGMENTED_BY_TRACK=!0,this.stepsPerQuarter=e.stepsPerQuarter,this.totalSteps=e.totalSteps,this.numVelocityBins=e.numVelocityBins,this.minPitch=e.minPitch?e.minPitch:o.MIN_MIDI_PITCH,this.maxPitch=e.maxPitch?e.maxPitch:o.MAX_MIDI_PITCH,this.numPitches=this.maxPitch-this.minPitch+1,this.performanceEventDepth=2*this.numPitches+this.totalSteps+this.numVelocityBins,this.numPrograms=o.MAX_MIDI_PROGRAM-o.MIN_MIDI_PROGRAM+2,this.endToken=this.performanceEventDepth+this.numPrograms,this.depth=this.endToken+1,this.endTensor=i.tidy(()=>i.oneHot(i.tensor1d([this.endToken],"int32"),this.depth).as1D())}trackToTensor(e){const t=this.numSteps/this.numSegments;let n=void 0;if(e){for(;e.events.length>t-2;)e.events.pop();n=i.buffer([e.events.length+2],"int32"),n.set(this.performanceEventDepth+(e.isDrum?this.numPrograms-1:e.program),0),e.events.forEach((e,t)=>{switch(e.type){case"note-on":n.set(e.pitch-this.minPitch,t+1);break;case"note-off":n.set(this.numPitches+e.pitch-this.minPitch,t+1);break;case"time-shift":n.set(2*this.numPitches+e.steps-1,t+1);break;case"velocity-change":n.set(2*this.numPitches+this.totalSteps+e.velocityBin-1,t+1);break;default:throw new Error("Unrecognized performance event: "+e)}}),n.set(this.endToken,e.events.length+1)}else n=i.buffer([1],"int32",new Int32Array([this.endToken]));return i.tidy(()=>{const e=i.oneHot(n.toTensor(),this.depth);return e.pad([[0,t-e.shape[0]],[0,0]])})}toTensor(e){if(u.assertIsRelativeQuantizedSequence(e),e.quantizationInfo.stepsPerQuarter!==this.stepsPerQuarter)throw new Error(`Steps per quarter note mismatch: ${e.quantizationInfo.stepsPerQuarter} != ${this.stepsPerQuarter}`);const t=u.clone(e);t.notes=e.notes.filter(e=>e.pitch>=this.minPitch&&e.pitch<=this.maxPitch);const n=new Set(t.notes.map(e=>e.instrument)),r=Array.from(n).map(e=>c.Performance.fromNoteSequence(t,this.totalSteps,this.numVelocityBins,e)).sort((e,t)=>t.isDrum?-1:e.isDrum?1:e.program-t.program);for(;r.length>this.numSegments;)r.pop();for(r.forEach(e=>e.setNumSteps(this.totalSteps));r.length<this.numSegments;)r.push(void 0);return i.tidy(()=>i.concat(r.map(e=>this.trackToTensor(e)),0))}tokensToTrack(e){const t=e.indexOf(this.endToken),n=t>=0?t:e.length,i=e.slice(0,n),r=i.filter(e=>e<this.performanceEventDepth),o=i.filter(e=>e>=this.performanceEventDepth),[s,a]=o.length?o[0]-this.performanceEventDepth<this.numPrograms-1?[o[0]-this.performanceEventDepth,!1]:[0,!0]:[0,!1],u=Array.from(r).map(e=>{if(e<this.numPitches)return{type:"note-on",pitch:this.minPitch+e};if(e<2*this.numPitches)return{type:"note-off",pitch:this.minPitch+e-this.numPitches};if(e<2*this.numPitches+this.totalSteps)return{type:"time-shift",steps:e-2*this.numPitches+1};if(e<2*this.numPitches+this.totalSteps+this.numVelocityBins)return{type:"velocity-change",velocityBin:e-2*this.numPitches-this.totalSteps+1};throw new Error("Invalid performance event token: "+e)});return new c.Performance(u,this.totalSteps,this.numVelocityBins,s,a)}async toNoteSequence(e,t=this.stepsPerQuarter,n){const r=u.createQuantizedNoteSequence(t,n);r.totalQuantizedSteps=this.totalSteps;const o=i.tidy(()=>i.split(e.argMax(1),this.numSegments));return(await Promise.all(o.map(async e=>{const t=await e.data(),n=this.tokensToTrack(t);return e.dispose(),n}))).forEach((e,t)=>{e.setNumSteps(this.totalSteps),r.notes.push(...e.toNoteSequence(t).notes)}),r}}class N extends h{constructor(e){super(e),this.TAPIFY_CHANNEL=3,this.stepsPerQuarter=e.stepsPerQuarter||o.DEFAULT_STEPS_PER_QUARTER,this.pitchClasses=e.pitchClasses||o.DEFAULT_DRUM_PITCH_CLASSES,this.pitchToClass=new Map;for(let e=0;e<this.pitchClasses.length;++e)this.pitchClasses[e].forEach(t=>{this.pitchToClass.set(t,e)});this.humanize=e.humanize||!1,this.tapify=e.tapify||!1,this.splitInstruments=e.splitInstruments||!1,this.depth=3}toTensor(e){const t=u.isRelativeQuantizedSequence(e)?e:u.quantizeNoteSequence(e,this.stepsPerQuarter),n=this.numSteps,r=t.tempos&&t.tempos.length?t.tempos[0].qpm:o.DEFAULT_QUARTERS_PER_MINUTE,s=60/r/this.stepsPerQuarter,a=[];for(let e=0;e<n;++e)a.push(new Map);t.notes.forEach(e=>{if(!this.tapify&&!this.pitchToClass.has(e.pitch))return;const t=e.quantizedStartStep;if(t>=a.length)throw Error(`Model does not support sequences with more than ${n} steps (${n*s} seconds at qpm ${r}).`);const i=this.tapify?this.TAPIFY_CHANNEL:this.pitchToClass.get(e.pitch);(!a[t].has(i)||a[t].get(i).velocity<e.velocity)&&a[t].set(i,e)});const c=this.pitchClasses.length,l=i.buffer([n,c]),h=i.buffer([n,c]),p=i.buffer([n,c]);function d(e){if(void 0===e.startTime)return 0;const t=e.startTime;return 2*(e.quantizedStartStep*s-t)/s}for(let e=0;e<n;++e)for(let t=0;t<c;++t){const n=a[e].get(t);l.set(n?1:0,e,t),this.humanize||this.tapify||h.set(n?n.velocity/o.MAX_MIDI_VELOCITY:0,e,t),this.humanize||p.set(n?d(n):0,e,t)}return i.tidy(()=>{const e=l.toTensor(),t=h.toTensor(),r=p.toTensor(),o=this.splitInstruments?n*c:n;return i.concat([e.as2D(o,-1),t.as2D(o,-1),r.as2D(o,-1)],1)})}async toNoteSequence(e,t,n=o.DEFAULT_QUARTERS_PER_MINUTE){if(t&&t!==this.stepsPerQuarter)throw Error("`stepsPerQuarter` is set by the model.");t=this.stepsPerQuarter;const i=this.splitInstruments?e.shape[0]/this.pitchClasses.length:e.shape[0],s=60/n/this.stepsPerQuarter,a=r.a.create({totalTime:i*s,tempos:[{qpm:n}]}),c=await e.data();function u(e,t,n){return Math.min(Math.max(e,t),n)}const l=this.pitchClasses.length;for(let e=0;e<i;++e){const t=c.slice(e*l*this.depth,(e+1)*l*this.depth);for(let n=0;n<l;++n){const i=t[this.splitInstruments?n*this.depth:n],c=t[this.splitInstruments?n*this.depth+1:l+n],h=t[this.splitInstruments?n*this.depth+2:2*l+n];if(i>.5){const t=u(Math.round(c*o.MAX_MIDI_VELOCITY),o.MIN_MIDI_VELOCITY,o.MAX_MIDI_VELOCITY),i=u(h/2,-.5,.5);a.notes.push(r.a.Note.create({pitch:this.pitchClasses[n][0],startTime:(e-i)*s,endTime:(e-i+1)*s,velocity:t,isDrum:!0}))}}}return a}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return a}));var i=n(0),r=n(8),o=n(11);function s(e,t=0){return i.tidy(()=>{let n=i.mul(e,i.pow(2,t));return n=n.clipByValue(0,Object(r.g)(110).dataSync()[0]),n})}function a(e,t,n){return e.splice(n),function(e,t){const n=[],i=Math.floor(t/e.length),r=t%e.length;for(let t=0;t<e.length;t++){n.push(e[t]);for(let e=1;e<i;e++)n.push(-1);t<r&&n.push(-1)}let o=-1;for(let e=0;e<n.length;e++)if(-1!==n[e]){let t=n[e];const i=o>=0?n[o]:0;-1!==o&&(t-=n[o]);for(let r=o+1;r<e;r++)n[r]=i+t*(r-o)/(e-o);o=e}for(let e=o+1;e<n.length;e++)n[e]=o>=0?n[e-1]:0;return n}(e,t)}function c(e){const t=e*o.f+o.e;return 10*Math.pow(2,1*t/12)}async function u(e,t,n=o.a){const r=[],s=[],a=t.length,u=i.tensor(t),l=512*Math.ceil(a/512),h=u.pad([[0,l-a]]),p=h.size/16e3,d=await e.execute({input_audio_samples:h});let m=await d[0].data();const f=await d[1].data();if(32*(f.length-1)/1e3===p){let e=20;for(let t=0;t<f.length;++t){const n=1-m[t];if(s.push(n),n>=o.a)e=c(f[t]),r.push(e);else{const t=i.truncatedNormal([1],0,o.d),n=1-await t.array();r.push(e*n),t.dispose()}}}else{const t=l/512+1,a=new Float32Array(t);m=new Float32Array(t);for(let t=0;t<l;t+=l/4){const n=h.slice([t],[l/4]),i=await e.execute({input_audio_samples:n}),r=await i[0].data(),o=await i[1].data(),s=Math.floor(t/512);m.set(r,s),a.set(o,s),n.dispose(),i[0].dispose(),i[1].dispose()}let u=20;for(let e=0;e<a.length;++e){const t=1-m[e];if(s.push(t),t>=n)u=c(a[e]),r.push(u);else{const e=i.truncatedNormal([1],0,o.d),t=1-await e.array();r.push(u*t),e.dispose()}}}return d[0].dispose(),d[1].dispose(),u.dispose(),h.dispose(),{pitches:r,confidences:s}}},function(e,t){e.exports=require("fft.js")},function(e,t){e.exports=require("node-fetch")},function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"now",(function(){return r})),n.d(t,"timing",(function(){return o}));const i=e.process.hrtime(),r=()=>{const t=e.process.hrtime(i);return t[0]+t[1]/1e9},o={navigationStart:Date.now()}}.call(this,n(20))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";n.r(t),n.d(t,"userAgent",(function(){return i}));const i=""},function(e,t){e.exports=require("ndarray")},function(e,t,n){"use strict";n.r(t),n.d(t,"auxiliaryInputFromSpec",(function(){return r})),n.d(t,"AuxiliaryInput",(function(){return o})),n.d(t,"BinaryCounter",(function(){return s}));var i=n(0);function r(e){switch(e.type){case"BinaryCounter":return new s(e.args);default:throw new Error("Unknown auxiliary input: "+e)}}class o{constructor(e){this.depth=e}}class s extends o{constructor(e){super(e.numBits)}getTensors(e){const t=i.buffer([e,this.depth]);for(let n=0;n<e;++n)for(let e=0;e<this.depth;++e)t.set(Math.floor((n+1)/Math.pow(2,e))%2?1:-1,n,e);return t.toTensor().as2D(e,this.depth)}}},function(e,t){e.exports=require("protobufjs/minimal")},function(e,t){e.exports=require("@tonejs/midi")},function(e,t,n){"use strict";n.r(t),n.d(t,"aux_inputs",(function(){return i})),n.d(t,"chords",(function(){return r})),n.d(t,"constants",(function(){return o})),n.d(t,"data",(function(){return s})),n.d(t,"logging",(function(){return a})),n.d(t,"melodies",(function(){return c})),n.d(t,"performance",(function(){return u})),n.d(t,"sequences",(function(){return l})),n.d(t,"MetronomeCallbackObject",(function(){return p})),n.d(t,"Metronome",(function(){return d})),n.d(t,"MidiConversionError",(function(){return S})),n.d(t,"midiToSequenceProto",(function(){return y})),n.d(t,"sequenceProtoToMidi",(function(){return w})),n.d(t,"urlToBlob",(function(){return b})),n.d(t,"blobToNoteSequence",(function(){return v})),n.d(t,"urlToNoteSequence",(function(){return N})),n.d(t,"BasePlayerCallback",(function(){return q})),n.d(t,"BasePlayer",(function(){return A})),n.d(t,"Player",(function(){return I})),n.d(t,"SoundFontPlayer",(function(){return z})),n.d(t,"PlayerWithClick",(function(){return _})),n.d(t,"MIDIPlayer",(function(){return C})),n.d(t,"BaseRecorderCallback",(function(){return k})),n.d(t,"Recorder",(function(){return x})),n.d(t,"BaseVisualizer",(function(){return D})),n.d(t,"PianoRollCanvasVisualizer",(function(){return L})),n.d(t,"Visualizer",(function(){return R})),n.d(t,"BaseSVGVisualizer",(function(){return F})),n.d(t,"PianoRollSVGVisualizer",(function(){return j})),n.d(t,"WaterfallSVGVisualizer",(function(){return B})),n.d(t,"ScrollType",(function(){return U})),n.d(t,"StaffSVGVisualizer",(function(){return V}));var i=n(23),r=n(14),o=n(1),s=n(15),a=n(4),c=n(10),u=n(12),l=n(5),h=n(2);class p{}class d{constructor(e,t=1){this.clicksPerQuarter=1,this.muted=!1,this.loClick=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.hiClick=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.loClickNote="c5",this.hiClickNote="g5",this.ticking=!1,this.startedAt=null,this.step=-1,this.reset(),this.callbackObject=e,this.clicksPerQuarter=t}isTicking(){return this.ticking}getStartedAt(){return this.startedAt}getOffsetTime(){return h.immediate()-this.startedAt}start(e=120){this.reset(),this.ticking=!0,this.callbackObject.click||(this.callbackObject.click=()=>{}),this.callbackObject.quarter||(this.callbackObject.quarter=()=>{}),this.callbackObject.bar||(this.callbackObject.bar=()=>{});let t=0;const n=4*this.clicksPerQuarter;h.Transport.scheduleRepeat(e=>{this.startedAt||(this.startedAt=e);const i=e-this.startedAt;this.step++;const r=this.step%n,o=Math.floor(r/this.clicksPerQuarter),s=r%this.clicksPerQuarter;this.callbackObject.click(i,r),0===s&&this.callbackObject.quarter(i,o),this.muted||(0===r?this.hiClick.triggerAttack(this.hiClickNote,e,.1):this.loClick.triggerAttack(this.loClickNote,e,.1)),0===r&&(this.callbackObject.bar(i,t),t++)},n+"n"),h.Transport.bpm.value=e,h.Transport.start()}stop(){this.ticking=!1,h.Transport.cancel(),h.Transport.stop()}reset(){this.muted=!1,this.ticking=!1,this.step=-1,this.startedAt=null}}var m=n(25),f=n(6),g=n(3);class S extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}function y(e){const t=new m.Midi(e),n=g.a.create();n.ticksPerQuarter=t.header.ppq,n.sourceInfo=g.a.SourceInfo.create({parser:g.a.SourceInfo.Parser.TONEJS_MIDI_CONVERT,encodingType:g.a.SourceInfo.EncodingType.MIDI});for(const e of t.header.timeSignatures)n.timeSignatures.push(g.a.TimeSignature.create({time:t.header.ticksToSeconds(e.ticks),numerator:e.timeSignature[0],denominator:e.timeSignature[1]}));n.timeSignatures.length||n.timeSignatures.push(g.a.TimeSignature.create({time:0,numerator:4,denominator:4}));for(const e of t.header.tempos)n.tempos.push(g.a.Tempo.create({time:e.time,qpm:e.bpm}));let i=-1;for(const e of t.tracks){e.notes.length>0&&(i+=1);for(const t of e.notes){const r=t.time,s=r+t.duration;n.notes.push(g.a.Note.create({instrument:i,program:e.instrument.number,startTime:r,endTime:s,pitch:t.midi,velocity:Math.floor(t.velocity*o.MIDI_VELOCITIES),isDrum:e.instrument.percussion})),s>n.totalTime&&(n.totalTime=s)}const t=Object.values(e.controlChanges),r=[].concat.apply([],t);for(const t of r)n.controlChanges.push(g.a.ControlChange.create({time:t.time,controlNumber:t.number,controlValue:Math.floor(t.value*(o.MIDI_VELOCITIES-1)),instrument:i,program:e.instrument.number,isDrum:e.instrument.percussion}))}return n}function w(e){l.isQuantizedSequence(e)&&(e=l.unquantizeSequence(e));const t=new m.Midi;t.fromJSON({header:{name:"",ppq:e.ticksPerQuarter||o.DEFAULT_TICKS_PER_QUARTER,tempos:[],timeSignatures:[],keySignatures:[],meta:[]},tracks:[]});const n=Array.from(e.tempos||[]);0===n.length&&n.push({time:0,qpm:o.DEFAULT_QUARTERS_PER_MINUTE}),n.sort((e,t)=>e.time-t.time);for(const e of n)t.header.tempos.push({ticks:t.header.secondsToTicks(e.time),bpm:e.qpm}),t.header.update();if(e.timeSignatures&&0!==e.timeSignatures.length)for(const n of e.timeSignatures)t.header.timeSignatures.push({ticks:t.header.secondsToTicks(n.time),timeSignature:[n.numerator,n.denominator]});else t.header.timeSignatures.push({ticks:0,timeSignature:[4,4]});t.header.update();const i=new Map;for(const t of e.notes){const e=t.instrument?t.instrument:0,n=void 0===t.program?o.DEFAULT_PROGRAM:t.program,r=!!t.isDrum,s=JSON.stringify([e,n,r]);i.has(s)||i.set(s,{notes:[],controlChanges:[]}),i.get(s).notes.push(t)}for(const t of e.controlChanges){const e=t.instrument?t.instrument:0,n=void 0===t.program?o.DEFAULT_PROGRAM:t.program,r=!!t.isDrum,s=JSON.stringify([e,n,r]);i.has(s)||i.set(s,{notes:[],controlChanges:[]}),i.get(s).controlChanges.push(t)}return i.forEach((e,n)=>{const[i,r]=JSON.parse(n).slice(1),s=t.addTrack();s.channel=r?o.DRUM_CHANNEL:o.NON_DRUM_CHANNELS[(t.tracks.length-1)%o.NON_DRUM_CHANNELS.length],s.instrument.number=i;for(const t of e.notes){const e=void 0===t.velocity?o.DEFAULT_VELOCITY:t.velocity;s.addNote({midi:t.pitch,time:t.startTime,duration:t.endTime-t.startTime,velocity:(e+1)/o.MIDI_VELOCITIES})}for(const t of e.controlChanges)s.addCC({number:t.controlNumber,value:t.controlValue,time:t.time})}),t.toArray()}function b(e){return new Promise((t,n)=>{Object(f.a)(e).then(e=>e.blob()).then(e=>{t(e)}).catch(e=>n(e))})}function v(e){return new Promise((t,n)=>{const i=new FileReader;i.onload=e=>{try{const e=y(i.result);t(e)}catch(e){n(e)}},i.onerror=e=>n(e),i.readAsArrayBuffer(e)})}function N(e){return b(e).then(v)}class T{constructor(e){this.FADE_SECONDS=.1,this.baseURL=e,this.buffers=new h.ToneAudioBuffers,this.sourceMap=new Map,this.initialized=!1}async initialize(){await Object(f.a)(this.baseURL+"/instrument.json").then(e=>e.json()).then(e=>{this.name=e.name,this.minPitch=e.minPitch,this.maxPitch=e.maxPitch,this.durationSeconds=e.durationSeconds,this.releaseSeconds=e.releaseSeconds,this.percussive=e.percussive,this.velocities=e.velocities,this.initialized=!0})}sampleInfoToName(e){return this.velocities?`p${e.pitch}_v${e.velocity}`:"p"+e.pitch}sampleNameToURL(e){return`${this.baseURL}/${e}.mp3`}nearestVelocity(e){if(!this.velocities)return e;e||(e=o.DEFAULT_VELOCITY);let t=void 0,n=o.MIDI_VELOCITIES;return this.velocities.forEach(i=>{const r=Math.abs(i-e);r<n&&(t=i,n=r)}),t}async loadSamples(e){this.initialized||await this.initialize();const t=e.filter(e=>!(e.pitch<this.minPitch||e.pitch>this.maxPitch)||(a.log(`Pitch ${e.pitch} is outside the valid range for ${this.name}, ignoring.`,"SoundFont"),!1)).map(e=>this.sampleInfoToName({pitch:e.pitch,velocity:this.nearestVelocity(e.velocity)})),n=Array.from(new Set(t)).filter(e=>!this.buffers.has(e)).map(e=>({name:e,url:this.sampleNameToURL(e)}));n.length>0&&(n.forEach(e=>this.buffers.add(e.name,e.url)),await h.loaded(),a.log(`Loaded samples for ${this.name}.`,"SoundFont"))}playNote(e,t,n,i,r){const o=this.getBuffer(e,t);if(!o)return;i>this.durationSeconds&&a.log(`Requested note duration longer than sample duration: ${i} > ${this.durationSeconds}`,"SoundFont");const s=new h.ToneBufferSource({url:o,fadeOut:this.FADE_SECONDS}).connect(r);if(s.start(n,0,void 0,1),!this.percussive&&i<this.durationSeconds){const e=new h.ToneBufferSource({url:o,fadeOut:this.FADE_SECONDS}).connect(r);s.stop(n+i+this.FADE_SECONDS),e.start(n+i,this.durationSeconds,void 0,1)}}playNoteDown(e,t,n){const i=this.getBuffer(e,t);if(!i)return;const r=new h.ToneBufferSource(i).connect(n);r.start(0,0,void 0,1),this.sourceMap.has(e)&&this.sourceMap.get(e).stop(h.now()+this.FADE_SECONDS,this.FADE_SECONDS),this.sourceMap.set(e,r)}playNoteUp(e,t,n){if(!this.sourceMap.has(e))return;const i=this.getBuffer(e,t);if(!i)return;new h.ToneBufferSource({url:i,fadeOut:this.FADE_SECONDS}).connect(n).start(0,this.durationSeconds,void 0,1),this.sourceMap.get(e).stop(h.now()+this.FADE_SECONDS,this.FADE_SECONDS),this.sourceMap.delete(e)}getBuffer(e,t){if(!this.initialized)throw new Error("Instrument is not initialized.");if(e<this.minPitch||e>this.maxPitch)return void a.log(`Pitch ${e} is outside the valid range for ${this.name} (${this.minPitch}-${this.maxPitch})`,"SoundFont");const n=this.sampleInfoToName({pitch:e,velocity:this.nearestVelocity(t)});if(!this.buffers.has(n))throw new Error(`Buffer not found for ${this.name}: ${n}`);const i=this.buffers.get(n);if(!i.loaded)throw new Error(`Buffer not loaded for ${this.name}: ${n}`);return i}}class P{constructor(e){this.baseURL=e,this.instruments=new Map,this.initialized=!1}async initialize(){await Object(f.a)(this.baseURL+"/soundfont.json").then(e=>e.json()).then(e=>{this.name=e.name;for(const t in e.instruments){const n=`${this.baseURL}/${e.instruments[t]}`;this.instruments.set("drums"===t?"drums":+t,new T(n))}this.initialized=!0})}async loadSamples(e){this.initialized||await this.initialize();const t=new Map;e.forEach(e=>{e.isDrum=e.isDrum||!1,e.program=e.program||0;const n=e.isDrum?"drums":e.program,i={pitch:e.pitch,velocity:e.velocity};t.has(n)?t.get(n).push(i):this.instruments.has(n)?t.set(n,[i]):a.log(`No instrument in ${this.name} for: program=${e.program}, isDrum=${e.isDrum}`,"SoundFont")}),await Promise.all(Array.from(t.keys()).map(e=>this.instruments.get(e).loadSamples(t.get(e))))}playNote(e,t,n,i,r=0,o=!1,s){const c=o?"drums":r;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(c)?this.instruments.get(c).playNote(e,t,n,i,s):a.log(`No instrument in ${this.name} for: program=${r}, isDrum=${o}`,"SoundFont")}playNoteDown(e,t,n=0,i=!1,r){const o=i?"drums":n;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(o)?this.instruments.get(o).playNoteDown(e,t,r):a.log(`No instrument in ${this.name} for: program=${n}, isDrum=${i}`,"SoundFont")}playNoteUp(e,t,n=0,i=!1,r){const o=i?"drums":n;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(o)?this.instruments.get(o).playNoteUp(e,t,r):a.log(`No instrument in ${this.name} for: program=${n}, isDrum=${i}`,"SoundFont")}}function O(e,t){return e.quantizedStartStep<t.quantizedStartStep?-1:e.quantizedStartStep>t.quantizedStartStep?1:e.pitch<t.pitch?-1:1}class q{}class A{constructor(e=!1,t){this.playClick=e,this.callbackObject=t,this.desiredQPM=void 0}setTempo(e){this.desiredQPM=e,"started"===h.Transport.state&&(h.Transport.bpm.value=e)}makeClickSequence(e){const t=l.clone(e),n=t.notes.map(e=>e.quantizedEndStep),i=Math.max(...n);for(let e=0;e<i;e+=4){const n={pitch:e%16==0?o.LO_CLICK_PITCH:o.HI_CLICK_PITCH,quantizedStartStep:e,isDrum:!0,quantizedEndStep:e+1};t.notes.push(n)}return t.notes.sort(O),t}resumeContext(){h.context.resume()}start(e,t,n=0){if("started"===this.getPlayState())throw new Error("Cannot start playback; player is already playing.");if("paused"===this.getPlayState())throw new Error("Cannot `start()` a paused player; use `resume()`.");if("stopped"!==h.Transport.state)throw new Error("Cannot start playback while `Tone.Transport` is in use.");this.resumeContext();const i=l.isQuantizedSequence(e);if(this.playClick&&i&&(e=this.makeClickSequence(e)),t?h.Transport.bpm.value=t:e.tempos&&e.tempos.length>0&&e.tempos[0].qpm>0?h.Transport.bpm.value=e.tempos[0].qpm:h.Transport.bpm.value=o.DEFAULT_QUARTERS_PER_MINUTE,i)e=l.unquantizeSequence(e,t);else if(t)throw new Error("Cannot specify a `qpm` for a non-quantized sequence.");const r=new h.Part((e,t)=>{this.currentPart===r&&(this.playNote(e,t),this.callbackObject&&h.Draw.schedule(()=>{this.callbackObject.run(t,e)},e))},e.notes.map(e=>[e.startTime,e]));return this.currentPart=r,this.desiredQPM&&(h.Transport.bpm.value=this.desiredQPM),this.currentPart.start(void 0,n),"started"!==h.Transport.state&&h.Transport.start(),new Promise(t=>{this.scheduledStop=h.Transport.schedule(()=>{this.stop(),t(),this.callbackObject&&this.callbackObject.stop()},"+"+e.totalTime)})}stop(){this.isPlaying()&&(this.currentPart.stop(),h.Transport.stop(),this.currentPart=null),h.Transport.clear(this.scheduledStop),this.scheduledStop=void 0,this.desiredQPM=void 0}pause(){if(!this.isPlaying())throw new Error("Cannot pause playback while the player is stopped.");h.Transport.pause()}resume(){if("paused"!==this.getPlayState())throw new Error(`Cannot resume playback while "${this.getPlayState()}".`);h.Transport.start()}seekTo(e){if(!this.isPlaying())throw new Error("Cannot seek while the player is stopped.");h.Transport.seconds=e}isPlaying(){return!!this.currentPart}getPlayState(){return this.isPlaying()?h.Transport.state:"stopped"}}class E{constructor(){this.DRUM_PITCH_TO_CLASS=new Map,this.kick=(new h.MembraneSynth).toDestination(),this.tomLow=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination(),this.tomMid=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination(),this.tomHigh=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination(),this.closedHihat=new h.MetalSynth({frequency:400,envelope:{attack:.001,decay:.1,release:.8},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1}).toDestination(),this.openHihat=new h.MetalSynth({frequency:400,envelope:{attack:.001,decay:.5,release:.8,sustain:1},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1}).toDestination(),this.ride=(new h.MetalSynth).toDestination(),this.crash=new h.MetalSynth({frequency:300,envelope:{attack:.001,decay:1,release:3},harmonicity:5.1,modulationIndex:64,resonance:4e3,octaves:1.5}).toDestination(),this.snare=new h.NoiseSynth({noise:{type:"white"},envelope:{attack:.005,decay:.05,sustain:.1,release:.4}}).toDestination(),this.loClick=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.hiClick=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.pitchPlayers=[(e,t=1)=>this.kick.triggerAttackRelease("C2","8n",e,t),(e,t=1)=>this.snare.triggerAttackRelease("16n",e,t),(e,t=1)=>this.closedHihat.triggerAttack(e,.3,t),(e,t=1)=>this.openHihat.triggerAttack(e,.3,t),(e,t=.5)=>this.tomLow.triggerAttack("G3",e,t),(e,t=.5)=>this.tomMid.triggerAttack("C4",e,t),(e,t=.5)=>this.tomHigh.triggerAttack("F4",e,t),(e,t=1)=>this.crash.triggerAttack(e,1,t),(e,t=1)=>this.ride.triggerAttack(e,.5,t),(e,t=.5)=>this.loClick.triggerAttack("G5",e,t),(e,t=.5)=>this.hiClick.triggerAttack("C6",e,t)];for(let e=0;e<o.DEFAULT_DRUM_PITCH_CLASSES.length;++e)o.DEFAULT_DRUM_PITCH_CLASSES[e].forEach(t=>{this.DRUM_PITCH_TO_CLASS.set(t,e)});this.DRUM_PITCH_TO_CLASS.set(o.LO_CLICK_PITCH,o.LO_CLICK_CLASS),this.DRUM_PITCH_TO_CLASS.set(o.HI_CLICK_PITCH,o.HI_CLICK_CLASS)}static getInstance(){return E.instance||(E.instance=new E),E.instance}playNote(e,t,n){this.pitchPlayers[this.DRUM_PITCH_TO_CLASS.get(e)](t,n)}}class I extends A{constructor(){super(...arguments),this.drumKit=E.getInstance(),this.bassSynth=new h.Synth({volume:5,oscillator:{type:"triangle"}}).toDestination(),this.polySynth=(new h.PolySynth).toDestination()}playNote(e,t){const n=t.hasOwnProperty("velocity")?t.velocity/o.MAX_MIDI_VELOCITY:void 0;if(t.isDrum)this.drumKit.playNote(t.pitch,e,n);else{const i=h.Frequency(t.pitch,"midi").toFrequency(),r=t.endTime-t.startTime;this.getSynth(t.instrument,t.program).triggerAttackRelease(i,r,e,n)}}getSynth(e,t){return void 0!==t&&t>=32&&t<=39?this.bassSynth:this.polySynth}}I.tone=h;class z extends A{constructor(e,t=h.Master,n,i,r){super(!1,r),this.soundFont=new P(e),this.output=t,this.programOutputs=n,this.drumOutputs=i}async loadSamples(e){await this.soundFont.loadSamples(e.notes.map(e=>({pitch:e.pitch,velocity:e.velocity,program:e.program||0,isDrum:e.isDrum||!1})))}async loadAllSamples(e=0,t=!1){const n=g.a.create(),i=t?o.MIN_DRUM_PITCH:o.MIN_PIANO_PITCH,r=t?o.MAX_DRUM_PITCH:o.MAX_PIANO_PITCH;for(let s=i;s<=r;s++)for(let i=o.MIN_MIDI_VELOCITY;i<o.MAX_MIDI_VELOCITY;i++)n.notes.push({pitch:s,velocity:i,program:e,isDrum:t});return this.loadSamples(n)}resumeContext(){h.context.resume()}start(e,t,n=0){return this.resumeContext(),this.loadSamples(e).then(()=>super.start(e,t,n))}playNote(e,t){this.soundFont.playNote(t.pitch,t.velocity,e,t.endTime-t.startTime,t.program,t.isDrum,this.getAudioNodeOutput(t))}playNoteDown(e){this.soundFont.playNoteDown(e.pitch,e.velocity,e.program,e.isDrum,this.getAudioNodeOutput(e))}playNoteUp(e){this.soundFont.playNoteUp(e.pitch,e.velocity,e.program,e.isDrum,this.getAudioNodeOutput(e))}getAudioNodeOutput(e){let t=this.output;return this.programOutputs&&!e.isDrum?this.programOutputs.has(e.program)&&(t=this.programOutputs.get(e.program)):this.drumOutputs&&e.isDrum&&this.drumOutputs.has(e.pitch)&&(t=this.drumOutputs.get(e.pitch)),t}}class _ extends I{constructor(e){super(!0,e)}}class C extends A{constructor(e){super(!1,e),this.outputs=[],this.outputChannel=0,this.availableOutputs=[],this.NOTE_ON=144,this.NOTE_OFF=128}async requestMIDIAccess(){return navigator.requestMIDIAccess?new Promise((e,t)=>{navigator.requestMIDIAccess().then(t=>{t.addEventListener("statechange",e=>this.initOutputs(t)),e(this.initOutputs(t))},e=>console.log("Something went wrong",t(e)))}):null}initOutputs(e){const t=e.outputs.values();for(let e=t.next();e&&!e.done;e=t.next())this.availableOutputs.push(e.value);return this.availableOutputs}playNote(e,t){const n=t.velocity||100,i=1e3*(t.endTime-t.startTime),r=[this.NOTE_ON+this.outputChannel,t.pitch,n],o=[this.NOTE_OFF+this.outputChannel,t.pitch,n],s=this.outputs?this.outputs:this.availableOutputs;for(let e=0;e<s.length;e++)this.sendMessageToOutput(s[e],r),this.sendMessageToOutput(s[e],o,f.d.now()+i)}sendMessageToOutput(e,t,n){e&&e.send(t,n)}playNoteDown(e){const t=[this.NOTE_ON,e.pitch,e.velocity],n=this.outputs?this.outputs:this.availableOutputs;for(let e=0;e<n.length;e++)this.sendMessageToOutput(n[e],t)}playNoteUp(e){const t=[this.NOTE_OFF,e.pitch,e.velocity],n=this.outputs?this.outputs:this.availableOutputs;for(let i=0;i<n.length;i++)this.sendMessageToOutput(n[i],t,e.endTime-e.startTime)}}class k{}class x{constructor(e={},t){this.notes=[],this.midiInputs=[],this.loClick=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.hiClick=new h.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.config={playClick:e.playClick,qpm:e.qpm||o.DEFAULT_QUARTERS_PER_MINUTE,playCountIn:e.playCountIn,startRecordingAtFirstNote:e.startRecordingAtFirstNote||!1},this.callbackObject=t,this.recording=!1,this.onNotes=new Map}async initialize(){await navigator.requestMIDIAccess().then(e=>this.midiReady(e),e=>console.log("Something went wrong",e))}midiReady(e){a.log("Initialized Recorder","Recorder");const t=e.inputs.values();for(let e=t.next();e&&!e.done;e=t.next())this.midiInputs.push(e.value)}isRecording(){return this.recording}setTempo(e){this.config.qpm=e,"started"===h.Transport.state&&(h.Transport.bpm.value=e)}enablePlayClick(e){this.config.playClick=e}enablePlayCountIn(e){this.config.playCountIn=e}initClickLoop(){let e=0;this.clickLoop=new h.Loop(t=>{e%4==0?this.loClick.triggerAttack("G5",t):this.hiClick.triggerAttack("C6",t),e++,this.config.playCountIn&&4===e&&(h.Transport.stop(),this.clickLoop.stop())},"4n")}getMIDIInputs(){return this.midiInputs}start(e){const t=e||this.midiInputs;for(const e of t)e.onmidimessage=e=>{this.midiMessageReceived(e)};if(this.config.playClick||this.config.playCountIn?(this.initClickLoop(),h.Transport.bpm.value=this.config.qpm,h.Transport.start(),this.clickLoop.start()):this.clickLoop=null,this.recording=!0,this.firstNoteTimestamp=void 0,this.notes=[],this.onNotes=new Map,!this.startRecordingAtFirstNote){const e=Date.now();this.firstNoteTimestamp=e}}stop(){this.recording=!1;const e=Date.now();this.onNotes.forEach((t,n)=>{this.noteOff(n,e)});for(const e of this.midiInputs)e.onmidimessage=null;return this.clickLoop&&(h.Transport.stop(),this.clickLoop.stop()),0===this.notes.length?null:this.getNoteSequence()}getNoteSequence(){return 0===this.notes.length?null:g.a.create({notes:this.notes,totalTime:this.notes[this.notes.length-1].endTime})}reset(){const e=this.stop();return this.firstNoteTimestamp=void 0,this.notes=[],this.onNotes=new Map,e}midiMessageReceived(e){if(!this.recording)return;let t;t=void 0!==e.timeStamp&&0!==e.timeStamp?e.timeStamp:f.d.now();const n=t+f.d.timing.navigationStart;void 0===this.firstNoteTimestamp&&(this.firstNoteTimestamp=n);const i=e.data[0]>>4,r=e.data[1],o=e.data.length>2?e.data[2]:1,s=e.srcElement;8===i||9===i&&0===o?(this.callbackObject&&this.callbackObject.noteOff&&this.callbackObject.noteOff(r,o,s),this.noteOff(r,n),this.callbackObject&&this.callbackObject.run&&this.callbackObject.run(this.getNoteSequence())):9===i&&(this.callbackObject&&this.callbackObject.noteOn&&this.callbackObject.noteOn(r,o,s),this.noteOn(r,o,n))}noteOn(e,t,n){const i=new g.a.Note;i.pitch=e,i.startTime=(n-this.firstNoteTimestamp)/1e3,i.velocity=t,this.onNotes.set(e,i)}noteOff(e,t){const n=this.onNotes.get(e);n&&(n.endTime=(t-this.firstNoteTimestamp)/1e3,this.notes.push(n)),this.onNotes.delete(e)}}var M=n(28);class D{constructor(e,t={}){const n=l.isQuantizedSequence(e),i=e.tempos&&e.tempos.length>0?e.tempos[0].qpm:void 0;this.noteSequence=n?l.unquantizeSequence(e,i):e;this.config={noteHeight:t.noteHeight||6,noteSpacing:t.noteSpacing||1,pixelsPerTimeStep:t.pixelsPerTimeStep||30,noteRGB:t.noteRGB||"8, 41, 64",activeNoteRGB:t.activeNoteRGB||"240, 84, 119",minPitch:t.minPitch,maxPitch:t.maxPitch};const r=this.getSize();this.width=r.width,this.height=r.height}updateMinMaxPitches(e=!1){if(!this.config.minPitch||!this.config.maxPitch){void 0===this.config.minPitch&&(this.config.minPitch=o.MAX_MIDI_PITCH),void 0===this.config.maxPitch&&(this.config.maxPitch=o.MIN_MIDI_PITCH);for(const e of this.noteSequence.notes)this.config.minPitch=Math.min(e.pitch,this.config.minPitch),this.config.maxPitch=Math.max(e.pitch,this.config.maxPitch);e||(this.config.minPitch-=2,this.config.maxPitch+=2)}}getSize(){this.updateMinMaxPitches();const e=(this.config.maxPitch-this.config.minPitch)*this.config.noteHeight,t=this.noteSequence.totalTime;if(!t)throw new Error("The sequence you are using with the visualizer does not have a totalQuantizedSteps or totalTime field set, so the visualizer can't be horizontally sized correctly.");return{width:t*this.config.pixelsPerTimeStep,height:e}}getNotePosition(e,t){const n=this.getNoteEndTime(e)-this.getNoteStartTime(e),i=this.getNoteStartTime(e)*this.config.pixelsPerTimeStep,r=Math.max(this.config.pixelsPerTimeStep*n-this.config.noteSpacing,1);return{x:i,y:this.height-(e.pitch-this.config.minPitch)*this.config.noteHeight,w:r,h:this.config.noteHeight}}scrollIntoViewIfNeeded(e,t){if(e&&this.parentElement){const e=this.parentElement.getBoundingClientRect().width;t>this.parentElement.scrollLeft+e&&(this.parentElement.scrollLeft=t-20)}}getNoteStartTime(e){return Math.round(1e8*e.startTime)/1e8}getNoteEndTime(e){return Math.round(1e8*e.endTime)/1e8}isPaintingActiveNote(e,t){const n=this.getNoteStartTime(e)===this.getNoteStartTime(t),i=this.getNoteStartTime(e)<=this.getNoteStartTime(t)&&this.getNoteEndTime(e)>=this.getNoteEndTime(t);return n||i}}class L extends D{constructor(e,t,n={}){super(e,n),this.ctx=t.getContext("2d"),this.parentElement=t.parentElement;const i=window.devicePixelRatio||1;this.ctx&&(this.ctx.canvas.width=i*this.width,this.ctx.canvas.height=i*this.height,t.style.width=this.width+"px",t.style.height=this.height+"px",this.ctx.scale(i,i)),this.redraw()}redraw(e,t){let n;this.clear();for(let t=0;t<this.noteSequence.notes.length;t++){const i=this.noteSequence.notes[t],r=this.getNotePosition(i,t),o=.2,s=i.velocity?i.velocity/100+o:1,a=e&&this.isPaintingActiveNote(i,e),c=`rgba(${a?this.config.activeNoteRGB:this.config.noteRGB},\n  ${s})`;this.redrawNote(r.x,r.y,r.w,r.h,c),a&&i===e&&(n=r.x)}return this.scrollIntoViewIfNeeded(t,n),n}clear(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}clearActiveNotes(){this.redraw()}redrawNote(e,t,n,i,r){this.ctx.fillStyle=r,this.ctx.fillRect(Math.round(e),Math.round(t),Math.round(n),Math.round(i))}}class R extends L{constructor(e,t,n={}){super(e,t,n),a.log("mm.Visualizer is deprecated, and will be removed in a future          version. Please use mm.PianoRollCanvasVisualizer instead","mm.Visualizer",5)}}class F extends D{constructor(e,t={}){super(e,t),this.drawn=!1}redraw(e,t){if(this.drawn||this.draw(),!e)return null;let n;this.unfillActiveRect(this.svg);for(let t=0;t<this.noteSequence.notes.length;t++){const i=this.noteSequence.notes[t];if(!(e&&this.isPaintingActiveNote(i,e)))continue;const r=this.svg.querySelector(`rect[data-index="${t}"]`);this.fillActiveRect(r,i),i===e&&(n=parseFloat(r.getAttribute("x")))}return this.scrollIntoViewIfNeeded(t,n),n}fillActiveRect(e,t){e.setAttribute("fill",this.getNoteFillColor(t,!0)),e.classList.add("active")}unfillActiveRect(e){const t=e.querySelectorAll("rect.active");for(let e=0;e<t.length;++e){const n=t[e],i=this.getNoteFillColor(this.noteSequence.notes[parseInt(n.getAttribute("data-index"),10)],!1);n.setAttribute("fill",i),n.classList.remove("active")}}draw(){for(let e=0;e<this.noteSequence.notes.length;e++){const t=this.noteSequence.notes[e],n=this.getNotePosition(t,e),i=this.getNoteFillColor(t,!1),r=[["index",e],["instrument",t.instrument],["program",t.program],["isDrum",!0===t.isDrum],["pitch",t.pitch]],o=[["--midi-velocity",String(void 0!==t.velocity?t.velocity:127)]];this.drawNote(n.x,n.y,n.w,n.h,i,r,o)}this.drawn=!0}getNoteFillColor(e,t){const n=e.velocity?e.velocity/100+.2:1;return`rgba(${t?this.config.activeNoteRGB:this.config.noteRGB},\n  ${n})`}drawNote(e,t,n,i,r,o,s){if(!this.svg)return;const a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.classList.add("note"),a.setAttribute("fill",r),a.setAttribute("x",""+Math.round(e)),a.setAttribute("y",""+Math.round(t)),a.setAttribute("width",""+Math.round(n)),a.setAttribute("height",""+Math.round(i)),o.forEach(([e,t])=>{void 0!==t&&(a.dataset[e]=""+t)}),s.forEach(([e,t])=>{a.style.setProperty(e,t)}),this.svg.appendChild(a)}clear(){this.svg.innerHTML="",this.drawn=!1}clearActiveNotes(){this.unfillActiveRect(this.svg)}}class j extends F{constructor(e,t,n={}){if(super(e,n),!(t instanceof SVGSVGElement))throw new Error("This visualizer requires an <svg> element to display the visualization");this.svg=t,this.parentElement=t.parentElement;const i=this.getSize();this.width=i.width,this.height=i.height,this.svg.style.width=this.width+"px",this.svg.style.height=this.height+"px",this.clear(),this.draw()}}class B extends F{constructor(e,t,n={}){if(super(e,n),this.NOTES_PER_OCTAVE=12,this.WHITE_NOTES_PER_OCTAVE=7,this.LOW_C=24,this.firstDrawnOctave=0,this.lastDrawnOctave=6,!(t instanceof HTMLDivElement))throw new Error("This visualizer requires a <div> element to display the visualization");this.config.whiteNoteWidth=n.whiteNoteWidth||20,this.config.blackNoteWidth=n.blackNoteWidth||2*this.config.whiteNoteWidth/3,this.config.whiteNoteHeight=n.whiteNoteHeight||70,this.config.blackNoteHeight=n.blackNoteHeight||140/3,this.config.showOnlyOctavesUsed=n.showOnlyOctavesUsed,this.setupDOM(t);const i=this.getSize();this.width=i.width,this.height=i.height,this.svg.style.width=this.width+"px",this.svg.style.height=this.height+"px",this.svgPiano.style.width=this.width+"px",this.svgPiano.style.height=this.config.whiteNoteHeight+"px",this.parentElement.style.width=this.width+this.config.whiteNoteWidth+"px",this.parentElement.scrollTop=this.parentElement.scrollHeight,this.clear(),this.drawPiano(),this.draw()}setupDOM(e){this.parentElement=document.createElement("div"),this.parentElement.classList.add("waterfall-notes-container");const t=Math.max(e.getBoundingClientRect().height,200);this.parentElement.style.paddingTop=t-this.config.whiteNoteHeight+"px",this.parentElement.style.height=t-this.config.whiteNoteHeight+"px",this.parentElement.style.boxSizing="border-box",this.parentElement.style.overflowX="hidden",this.parentElement.style.overflowY="auto",this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgPiano=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.classList.add("waterfall-notes"),this.svgPiano.classList.add("waterfall-piano"),this.parentElement.appendChild(this.svg),e.innerHTML="",e.appendChild(this.parentElement),e.appendChild(this.svgPiano)}redraw(e,t){if(this.drawn||this.draw(),!e)return null;this.clearActiveNotes(),this.parentElement.style.paddingTop=this.parentElement.style.height;for(let t=0;t<this.noteSequence.notes.length;t++){const n=this.noteSequence.notes[t];if(!(e&&this.isPaintingActiveNote(n,e)))continue;const i=this.svg.querySelector(`rect[data-index="${t}"]`);this.fillActiveRect(i,n);const r=this.svgPiano.querySelector(`rect[data-pitch="${n.pitch}"]`);if(this.fillActiveRect(r,n),n===e){const e=parseFloat(i.getAttribute("y")),t=parseFloat(i.getAttribute("height"));return e<this.parentElement.scrollTop-t&&(this.parentElement.scrollTop=e+t),e}}return null}getSize(){this.updateMinMaxPitches(!0);let e=52;if(this.config.showOnlyOctavesUsed){let t=!1,n=!1;for(let e=1;e<7;e++){const i=this.LOW_C+this.NOTES_PER_OCTAVE*e;!t&&i>this.config.minPitch&&(this.firstDrawnOctave=e-1,t=!0),!n&&i>this.config.maxPitch&&(this.lastDrawnOctave=e-1,n=!0)}e=(this.lastDrawnOctave-this.firstDrawnOctave+1)*this.WHITE_NOTES_PER_OCTAVE}const t=e*this.config.whiteNoteWidth,n=this.noteSequence.totalTime;if(!n)throw new Error("The sequence you are using with the visualizer does not have a totalQuantizedSteps or totalTime field set, so the visualizer can't be horizontally sized correctly.");return{width:t,height:Math.max(n*this.config.pixelsPerTimeStep,1)}}getNotePosition(e,t){const n=this.svgPiano.querySelector(`rect[data-pitch="${e.pitch}"]`);if(!n)return null;const i=this.getNoteEndTime(e)-this.getNoteStartTime(e),r=Number(n.getAttribute("x")),o=Number(n.getAttribute("width")),s=Math.max(this.config.pixelsPerTimeStep*i-this.config.noteSpacing,1);return{x:r,y:this.height-this.getNoteStartTime(e)*this.config.pixelsPerTimeStep-s,w:o,h:s}}drawPiano(){this.svgPiano.innerHTML="";const e=this.config.whiteNoteWidth-this.config.blackNoteWidth/2,t=[1,3,6,8,10];let n=0,i=0;this.config.showOnlyOctavesUsed?i=this.firstDrawnOctave*this.NOTES_PER_OCTAVE+this.LOW_C:(i=this.LOW_C-3,this.drawWhiteKey(i,n),this.drawWhiteKey(i+2,this.config.whiteNoteWidth),i+=3,n=2*this.config.whiteNoteWidth);for(let e=this.firstDrawnOctave;e<=this.lastDrawnOctave;e++)for(let e=0;e<this.NOTES_PER_OCTAVE;e++)-1===t.indexOf(e)&&(this.drawWhiteKey(i,n),n+=this.config.whiteNoteWidth),i++;this.config.showOnlyOctavesUsed?(i=this.firstDrawnOctave*this.NOTES_PER_OCTAVE+this.LOW_C,n=-this.config.whiteNoteWidth):(this.drawWhiteKey(i,n),i=this.LOW_C-3,this.drawBlackKey(i+1,e),i+=3,n=this.config.whiteNoteWidth);for(let r=this.firstDrawnOctave;r<=this.lastDrawnOctave;r++)for(let r=0;r<this.NOTES_PER_OCTAVE;r++)-1!==t.indexOf(r)?this.drawBlackKey(i,n+e):n+=this.config.whiteNoteWidth,i++}drawWhiteKey(e,t){const n=document.createElementNS("http://www.w3.org/2000/svg","rect");return n.dataset.pitch=String(e),n.setAttribute("x",String(t)),n.setAttribute("y","0"),n.setAttribute("width",String(this.config.whiteNoteWidth)),n.setAttribute("height",String(this.config.whiteNoteHeight)),n.setAttribute("fill","white"),n.setAttribute("original-fill","white"),n.setAttribute("stroke","black"),n.setAttribute("stroke-width","3px"),n.classList.add("white"),this.svgPiano.appendChild(n),n}drawBlackKey(e,t){const n=document.createElementNS("http://www.w3.org/2000/svg","rect");return n.dataset.pitch=String(e),n.setAttribute("x",String(t)),n.setAttribute("y","0"),n.setAttribute("width",String(this.config.blackNoteWidth)),n.setAttribute("height",String(this.config.blackNoteHeight)),n.setAttribute("fill","black"),n.setAttribute("original-fill","black"),n.setAttribute("stroke","black"),n.setAttribute("stroke-width","3px"),n.classList.add("black"),this.svgPiano.appendChild(n),n}clearActiveNotes(){super.unfillActiveRect(this.svg);const e=this.svgPiano.querySelectorAll("rect.active");for(let t=0;t<e.length;++t){const n=e[t];n.setAttribute("fill",n.getAttribute("original-fill")),n.classList.remove("active")}}}var U;!function(e){e[e.PAGE=0]="PAGE",e[e.NOTE=1]="NOTE",e[e.BAR=2]="BAR"}(U||(U={}));class V extends D{constructor(e,t,n={}){super(e,n),(void 0===n.pixelsPerTimeStep||n.pixelsPerTimeStep<=0)&&(this.config.pixelsPerTimeStep=0),this.instruments=n.instruments||[],this.render=new M.StaffSVGRender(this.getScoreInfo(e),{noteHeight:this.config.noteHeight,noteSpacing:this.config.noteSpacing,pixelsPerTimeStep:this.config.pixelsPerTimeStep,noteRGB:this.config.noteRGB,activeNoteRGB:this.config.activeNoteRGB,defaultKey:n.defaultKey||0,scrollType:n.scrollType||U.PAGE},t),this.drawnNotes=e.notes.length,this.clear(),this.redraw()}clear(){this.render.clear()}redraw(e,t){this.drawnNotes!==this.noteSequence.notes.length&&(this.render.scoreInfo=this.getScoreInfo(this.noteSequence));const n=e?this.getNoteInfo(e):void 0;return this.render.redraw(n,t)}isNoteInInstruments(e){return void 0===e.instrument||0===this.instruments.length||this.instruments.indexOf(e.instrument)>=0}timeToQuarters(e){const t=e*this.noteSequence.tempos[0].qpm/60;return Math.round(16*t)/16}getNoteInfo(e){const t=this.timeToQuarters(e.startTime);return{start:t,length:this.timeToQuarters(e.endTime)-t,pitch:e.pitch,intensity:e.velocity}}getScoreInfo(e){const t=[];return e.notes.forEach(e=>{this.isNoteInInstruments(e)&&t.push(this.getNoteInfo(e))}),{notes:t,tempos:e.tempos?e.tempos.map(e=>({start:this.timeToQuarters(e.time),qpm:e.qpm})):[],keySignatures:e.keySignatures?e.keySignatures.map(e=>({start:this.timeToQuarters(e.time),key:e.key})):[],timeSignatures:e.timeSignatures?e.timeSignatures.map(e=>({start:this.timeToQuarters(e.time),numerator:e.numerator,denominator:e.denominator})):[]}}clearActiveNotes(){this.redraw()}}},function(e,t){e.exports=require("ndarray-resample")},function(e,t){e.exports=require("staffrender")},function(e,t,n){"use strict";n.r(t);var i=n(3);n.d(t,"NoteSequence",(function(){return i.a}))},function(e,t,n){"use strict";n.r(t),n.d(t,"DDSP",(function(){return p}));n(37);var i=n(0),r=n(2),o=n(8),s=n(16),a=n(11);const c=(e,t,n)=>{const i=e.createBuffer(1,t.length,n);return i.copyToChannel(t,0),i};function u(e,t,n,i,r){return new Promise(o=>{const s={loudness_db:[0],f0_hz:[0]};let a=0;for(let o=t;o<n;o++)i&&o>=r?(s.loudness_db[a]=-120,s.f0_hz[a]=-1):(s.loudness_db[a]=e.loudness_db[o],s.f0_hz[a]=e.f0_hz[o]),a+=1;o(s)})}function l(e){return e*a.b}function h(e){return e/a.b}class p{constructor(e,t){this.checkpointUrl=e,t&&(this.settings=t)}async initialize(){let e;i.registerOp("Roll",e=>{const t=i.split(e.inputs[0],2,2),n=i.concat([t[1],t[0]],2);return t.forEach(e=>e.dispose()),n}),i.env().set("WEBGL_PACK",!1),i.env().set("WEBGL_CONV_IM2COL",!1),i.env().set("WEBGL_DELETE_TEXTURE_THRESHOLD",104857600),this.model=await async function(e){return await i.loadGraphModel(e)}(this.checkpointUrl+"/model.json");try{e=await fetch(this.checkpointUrl+"/settings.json").then(e=>e.json())}finally{if(null===this.settings)throw new Error("Passing settings is required if you do not have a settings.json file.")}this.settings={...e,...this.settings},this.initialized=!0}dispose(){this.initialized&&(this.model.dispose(),this.checkpointUrl=null,this.initialized=!1)}isInitialized(){return this.initialized}async memCheck(){return await async function(){const e=window.screen.availWidth*window.screen.availHeight,t=window.devicePixelRatio,n=Math.round(e*t*600/1048576);if(!isNaN(n)&&n<50)throw new Error(`Insufficient memory! Your device has ${n} and recommended memory is 50`);try{if(await i.ready(),"webgl"!==i.getBackend())throw new Error("It looks like your browser does not support webgl.")}catch(e){throw new Error("insufficient memory - "+e)}return!0}()}async synthesize(e,t){null!==t&&(this.settings={...this.settings,...t});const{f0_hz:n,loudness_db:p,confidences:d}=e,m=Object(s.c)(n,p.length,this.settings.modelMaxFrameLength),f=Object(s.c)(d,p.length,this.settings.modelMaxFrameLength),g=await async function(e,t){const n=t.averageMaxLoudness,r=t.meanLoudness,a=t.loudnessThreshold,c=t.meanPitch;let u,l=[];if(e.loudness_db.length>0){const t=i.tidy(()=>{const t=i.tensor1d(e.loudness_db,"float32"),r=t.max(),o=i.sub(n,r),s=i.add(t,o);return t.dispose(),r.dispose(),o.dispose(),s}),o=t.greater(a),s=await i.booleanMaskAsync(t,o),c=await s.array(),h=i.tidy(()=>{const e=c>0?s.mean():t.mean(),o=i.sub(r,e),a=t.add(o).add(0).clipByValue(-120,n),u=a.min(),l=e.sub(u);return a.sub(u).div(l).mul(r- -120).add(-120)}),p=i.reshape(e.confidences,[-1,1,1]),d=i.pool(p,[100,1],"avg","same"),m=d.reshape([-1]),f=i.lessEqual(m,.7);u=i.tidy(()=>{const e=f.mul(-25),t=h.add(e),n=i.maximum(t,-120);return e.dispose(),t.dispose(),n}),l=await u.array(),o.dispose(),t.dispose(),h.dispose(),s.dispose(),d.dispose(),m.dispose(),p.dispose(),f.dispose()}let h=[];if(e.f0_hz.length>0){const t=await Object(o.c)(e.f0_hz),n=i.tidy(()=>{for(let e=0,n=t.length;e<n;++e)t[e]===-1/0&&(t[e]=0);return t}),r=i.lessEqual(e.confidences,.7),l=u.greater(a),p=i.logicalOr(r,l),d=await i.booleanMaskAsync(n,p),m=d.mean(),f=await i.sub(c,m),g=await f.array(),S=i.tidy(()=>{let t=g/12;t=Math.round(t);return Object(s.b)(e.f0_hz,t)});h=await S.array(),u.dispose(),m.dispose(),d.dispose(),f.dispose(),S.dispose(),l.dispose(),p.dispose(),r.dispose()}return{f0_hz:h,loudness_db:l}}({f0_hz:m,loudness_db:p,confidences:f},this.settings),S=[],y=g.loudness_db.length,w=h(y);let b=!1;const v=h(this.settings.modelMaxFrameLength);let N;const T=1*a.c;for(let e=0;e<w;e+=v-1){const t=Math.floor(l(e)),n=l(e+v);n>y&&(b=!0);const{f0_hz:r,loudness_db:o}=await u(g,t,n,b,y),s=i.tensor1d(r,"float32"),a=i.tensor1d(o,"float32"),c=await this.model.predict({f0_hz:s,loudness_db:a}),h=await c.data();S.push(h),c.dispose(),s.dispose(),a.dispose()}if(w<=v)N=S[0];else{const e=[];for(let t=0;t<S.length;t++){const n=S[t];e.push(n)}N=function(e,t){const n=e.reduce((e,t)=>e+t.length,0),i=new Float32Array(n);let r=0;for(let n=0;n<e.length;n++){const c=e[n],u=n<e.length-1;if(0===n&&(i.set(c,r),r+=c.length),u){const u=e[n+1],l=r-t;for(let e=l,n=0,h=c.length-t;e<r&&n<u.length;e++,n++,h++){const t=(e-l)/(r-l);i[e]=(o=c[h],s=u[n],o*(1-(a=t))+s*a)}i.set(u.slice(t),r),r+=u.slice(t).length}}var o,s,a;return i}(e,T)}const P=N.slice(0,e.originalRecordedBufferLength).map(e=>e*(this.settings.postGain||1)),O=new r.Context,q=c(O,P,a.c),A=await Object(o.j)(q,48e3);return await async function({audioCtx:e,arrayBuffer:t,sampleRate:n}){let i;r.setContext(e);let o=c(e,t,n);const s=r.Offline(()=>{const e=new r.Compressor({attack:.001,release:.001,threshold:-6}).toDestination(),t=new r.Reverb({wet:.3,decay:3}).connect(e),n=new r.Filter(8e3,"lowpass",-24).connect(t);return new r.Player({url:o}).connect(n).start(),t.ready},t.length/n);i=await s;const a=i.getChannelData(0);return o=null,i.dispose(),i=null,a}({audioCtx:O,arrayBuffer:A,sampleRate:48e3})}}},function(e,t,n){"use strict";n.r(t),n.d(t,"GANSynth",(function(){return b}));var i=n(0),r=n(4),o=n(6),s=n(17),a=n(8);const c=[[1,1,1.0087615084725814],[2,1,.029087889211125567],[2,2,.958243896036208],[3,2,.5326346877272624],[3,3,.45988057223186607],[4,3,1.0072850129664943],[5,4,1.0050894259864507],[6,4,.016233689242197466],[6,5,.9763230964529687],[7,5,.5149287456976357],[7,6,.48299891928441196],[8,6,1.0020339883784544],[9,7,1.0013940582804204],[10,7,.004285414445239434],[10,8,.9936677765505681],[11,8,.4979349533263788],[11,9,.5020647178266697],[12,9,.9896782321684733],[12,10,.006967080931645349],[13,10,1.0022486641537054],[14,11,1.0033233953996759],[15,11,.4782757843614299],[15,12,.5183887055972138],[16,12,.9736767011426267],[16,13,.01804416217807709],[17,13,1.0056329663266226],[18,14,1.00808642668908],[19,14,.4576416347984229],[19,15,.5340800956534676],[20,15,.9582897445862256],[20,16,.028988367857957848],[21,16,1.008754652772106],[22,17,1.0122552436937966],[23,17,.4380796830853842],[23,18,.5491738237632201],[24,18,.9434838949694413],[24,19,.039794474296176746],[25,19,1.0116287566447584],[26,20,1.0158945544322868],[27,20,.41952402212367873],[27,21,.5637020154076856],[28,21,.9292283399303117],[28,22,.05045785324282485],[29,22,1.0142694870195312],[30,23,1.0190617246342517],[31,23,.40191289323704393],[31,24,.5776942788784806],[32,24,.915494649120402],[32,25,.060974426459003916],[33,25,1.016690283888679],[34,26,1.0218076651124588],[35,26,.3851885348435194],[35,27,.5911779611807773],[36,27,.9022565352474414],[36,28,.07134062388959171],[37,28,1.0189038677945517],[38,29,1.0241776077147466],[39,29,.369297000124277],[39,30,.6041783722578726],[40,30,.8894896443111251],[40,31,.08155334505527755],[41,31,1.0209222848386956],[42,32,1.0262117836546005],[43,32,.35418795675261777],[43,33,.6167189821271176],[44,33,.87717137085618],[44,34,.09160992335204851],[45,34,1.0227569476841007],[46,35,1.0279460165329002],[47,35,.3398144781420294],[47,36,.628821594757742],[48,36,.8652806947525041],[48,37,.10150809298528844],[49,37,1.0244186730654867],[50,38,1.029412240942602],[51,38,.32613283297317347],[51,39,.6405065019041107],[52,39,.8537980365619783],[52,40,.11124595830527892],[53,40,1.0259177162406141],[54,41,1.030638956235277],[55,41,.3131022777355948],[55,42,.6517926196031543],[56,42,.8427051290118196],[56,43,.12082196533877268],[57,43,1.0272638027474759],[58,44,1.031651623831845],[59,44,.3006848555240512],[59,45,.6626976096262132],[60,45,.8319849024715039],[60,46,.13023487533380312],[61,46,1.0284661577762764],[62,47,1.0324730153919173],[63,47,.28884520321029805],[63,48,.6732379878311283],[64,48,.821621382643116],[64,49,.1394837401591093],[65,49,1.0295335334192939],[66,50,1.0331235182054521],[67,50,.27755036829985363],[67,51,.68342922107227],[68,51,.8115995989355603],[68,52,.148567879414825],[69,52,1.0304742340231496],[70,53,1.0336214033370148],[71,53,.2667696361817086],[71,54,.6932858140884962],[72,54,.8019055022130549],[72,55,.1574868591255191],[73,55,1.031296139836255],[74,56,1.0339830613212895],[75,56,.2564743680536822],[75,57,.7028213875855097],[76,57,.7925258907912134],[76,58,.16624047189958738],[77,58,1.032006729117501],[78,59,1.0342232095724524],[79,59,.24663784949713183],[79,60,.7120487485622758],[80,60,.7834483437084975],[80,61,.17482871845079165],[81,61,1.032613098850059],[82,62,1.0343550751159198],[83,62,.2372351494674972],[83,63,.7209799537859948],[84,63,.7746611604312031],[84,64,.18325179038711914],[85,64,1.0331219841851924],[86,65,1.0343905557724016],[87,65,.22824298931879333],[87,66,.7296263672031092],[88,66,.7661533062642226],[88,67,.19151005417692718],[89,67,1.0335397767254908],[90,68,1.0343403625078313],[91,68,.21963962139622123],[91,69,.7379987119645334],[92,69,.7579143628308538],[92,70,.19960403621540457],[93,70,1.0338725417430177],[94,71,1.0342141453043734],[95,71,.21140471667072153],[95,72,.746107117663542],[96,72,.7499344830670268],[96,73,.20753440891552338],[97,73,1.0341260344172454],[98,74,1.034020604597683],[99,74,.20351926086574523],[99,75,.7539611633021215],[100,75,.7422043502477234],[100,76,.2153019777561019],[101,76,1.0343057151671131],[102,77,1.0337675900563705],[103,77,.19596545852169872],[103,78,.7615699164421695],[104,78,.734715140616724],[104,79,.22290766922455862],[105,79,1.034416764143981],[106,80,1.03346218824938],[107,80,.1887266444456389],[107,81,.7689419689404797],[108,81,.7274584892496355],[108,82,.23035251959385997],[109,82,1.0344640949448594],[110,83,1.0331108005456808],[111,83,.18178720201436843],[111,84,.7760854696185804],[112,84,.7204264588178948],[112,85,.23763766448199494],[113,85,1.0344523675990727],[114,86,1.032719212418228],[115,86,.1751324878193402],[115,87,.7830081541774375],[116,87,.7136115109646374],[116,88,.2447643291417676],[117,88,1.0343860008764458],[118,89,1.0322926551739824],[119,89,.16874876216974247],[119,90,.789717372631832],[120,90,.7070064800338803],[120,91,.2517338194331562],[121,91,1.0342691839607763],[122,92,1.0318358610025598],[123,92,.16262312499771858],[123,93,.7962201145052664],[124,93,.7006045489251309],[124,94,.25854751343650967],[125,94,1.0341058875275075],[126,95,1.0313531121234998],[127,95,.15674345673841866],[127,96,.8025230320033012],[128,96,.6943992268713032],[128,97,.2652068536620191],[129,97,1.033899874262366],[130,98,1.030848284714744],[131,98,.1510983637896712],[131,99,.8086324613545763],[132,99,.6883843289574696],[132,100,.2717133398209474],[133,100,1.033654708853177],[134,101,1.0303248882205327],[135,101,.14567712818173575],[135,102,.8145544424922615],[136,102,.6825539572209546],[136,103,.2780685221191216],[137,103,1.033373767485838],[138,104,1.0297861005632643],[139,104,.14046966111762169],[139,105,.8202947372282664],[140,105,.6769024831869065],[140,106,.28427399504058354],[141,106,1.0330602468722847],[142,107,1.029234799720434],[143,107,.13546646006984392],[143,108,.8258588460540109],[144,108,.671424531713726],[144,109,.290331391589362],[145,109,1.0327171728357682],[146,110,1.0286735920712562],[147,110,.13065856914309196],[147,111,.8312520236957351],[148,111,.6661149660273628],[148,112,.2962423779602388],[149,112,1.03234740847843],[150,113,1.0281048378703825],[151,113,.12603754244145],[151,114,.8364792935255917],[152,114,.6609688738465388],[152,115,.30200864860954885],[153,115,1.0319536619522978],[154,116,1.0275306741623285],[155,116,.12159541018943322],[155,117,.8415454609370665],[156,117,.655981554500098],[156,118,.3076319217011811],[157,118,1.031538493855763],[158,119,1.0269530354146845],[159,119,.11732464738966399],[159,120,.846455125764718],[160,120,.6511485069565366],[160,121,.3131139349019227],[161,121,1.0311043242739946],[162,122,1.0263736721146446],[163,122,.11321814480714538],[163,123,.851212693834753],[164,123,.6464654186857061],[164,124,.3184564415055735],[165,124,1.0306534394819706],[166,125,1.0257941675461106],[167,125,.10926918209624069],[167,126,.8558223877141483],[168,126,.6419281552876014],[168,127,.32366120686047056],[169,127,1.0301879983273805],[170,128,1.0252159529388847],[171,128,.10547140289367021],[171,129,.8602882567276612],[172,129,.6375327508240597],[172,130,.32873000508360367],[173,130,1.0297100383091813],[174,131,1.0246403211604227],[175,131,.10181879172477112],[175,132,.8646141862987496],[176,132,.6332753987956673],[176,133,.33366461604209907],[177,133,1.0292214813668379],[178,134,1.0240684391009978],[179,134,.09830565257411007],[179,135,.8688039066707689],[180,135,.6291524437169539],[180,136,.3384668225808326],[181,136,1.0287241393952773],[182,137,1.0235013588866442],[183,137,.0949265889928822],[183,138,.8728610010546515],[184,138,.6251603732380943],[184,139,.3431384079843332],[185,139,1.0282197194980238],[186,140,1.0229400280388043],[187,140,.09167648561647405],[187,141,.8767889132518744],[188,141,.6212958107744541],[188,142,.3476811536535296],[189,142,1.0277098289923983],[190,143,1.0223852986877378],[191,143,.08855049098843445],[191,144,.8805909547856343],[192,144,.6175555086043407],[192,145,.35209683698566024],[193,145,1.0271959801772084],[194,146,1.021837935933431],[195,146,.08554400158179727],[195,147,.8842703115872171],[196,147,.6139363413989273],[196,148,.35638722943949186],[197,148,1.026679594876984],[198,149,1.0212986254395027],[199,149,.082652646931321],[199,150,.8878300502607867],[200,150,.6104353001536761],[200,151,.3605540947783916],[201,151,1.0261620087703698],[202,152,1.020767980334856],[203,152,.07987227578640096],[203,153,.8912731239662092],[204,153,.6070494864912312],[204,154,.364599187472458],[205,154,1.025644475516362],[206,155,1.0202465474911722],[207,155,.07719894321045902],[207,156,.8946023779404728],[208,156,.6037761073076129],[208,157,.36852425125748506],[209,157,1.0251281706842847],[210,158,1.0197348132361097],[211,158,.07462889855138014],[211,159,.8978205546916732],[212,159,.6006124697383151],[212,160,.3723310178292769],[213,160,1.0246141955013988],[214,161,1.0192332085569418],[215,161,.07215857422040488],[215,162,.9009302988805],[216,162,.5975559764226185],[216,163,.37602120567284064],[217,163,1.024103580422386],[218,164,1.018742113842709],[219,164,.06978457521665815],[219,165,.9039341619174114],[220,165,.5946041210439893],[220,166,.3795965190111676],[221,166,1.0235972885322195],[222,167,1.0182618632088625],[223,167,.0675036693443592],[223,168,.9068346062921914],[224,168,.5917544841265701],[224,169,.3830586468674795],[225,169,1.0230962187892327],[226,170,1.0177927484431766],[227,170,.06531277806896706],[227,171,.9096340096561174],[228,171,.5890047290713193],[228,172,.38640926223293437],[229,172,1.0226012091159231],[230,173,1.017335022608167],[231,173,.0632089679653424],[231,174,.9123346686734497],[232,174,.586352598418078],[232,175,.3896500213288084],[233,175,1.0221130393455482],[234,176,1.0168889033326205],[235,176,.06118944272087777],[235,177,.914938802652698],[236,177,.5837959103122896],[236,178,.39278256296329067],[237,178,1.0216324340290364],[238,179,1.0164545758191],[239,179,.05925153564332089],[239,180,.9174485569826359],[240,180,.5813325551691159],[240,181,.3958085079669357],[241,181,1.0211600651125134],[242,182,1.01603219559476],[243,182,.05739270264601734],[243,183,.919866006375456],[244,183,.578960492519135],[244,184,.39872945870775167],[245,184,1.020696554488055],[246,185,1.0156218910279706],[247,185,.055610515672866775],[247,186,.9221931579354511],[248,186,.5766777480237313],[248,187,.4015469986761612],[249,187,1.0202424764259312],[250,188,1.0152237656316911],[251,188,.05390265653168126],[251,189,.9244319540637365],[252,189,.5744824106486663],[252,190,.4042626921377848],[253,190,1.0197983598926021],[254,191,1.0148379001729047],[255,191,.052266911108559244],[255,192,.9265842752073952],[256,192,.5723726299899468],[256,193,.40687808384383367],[257,193,1.0193646907609162],[258,194,1.0144643546050645],[259,194,.05070116393653833],[259,195,.9286519424651887],[260,195,.5703466137364466],[260,196,.4093946987997115],[261,196,1.0189419139168765],[262,197,1.014103169839173],[263,197,.04920339309393266],[263,198,.9306367200572258],[264,198,.5684026252644323],[264,199,.41181404208517797],[265,199,1.0185304352678317],[266,200,1.0137543693675302],[267,200,.04777166540942449],[267,201,.9325403176671191],[268,201,.5665389813575877],[268,202,.4141375987198434],[269,202,1.0181306236573189],[270,203,1.0134179607527265],[271,203,.04640413195303674],[271,204,.934364392667829],[272,204,.5647540500383554],[272,205,.4163668335733731],[273,205,1.017742812691386],[274,206,1.0130939369942324],[275,206,.04509902379599986],[275,207,.9361105522297561],[276,207,.5630462485124229],[276,208,.4185031913161667],[277,208,1.0173673024779883],[278,209,1.0127822777820206],[279,209,.043854648017688035],[279,210,.9377803553285139],[280,210,.5614140412123577],[280,211,.42054809640522234],[281,211,1.0170043612872055],[282,212,1.0124829506474082],[283,212,.042669383945431606],[283,213,.9393753146522579],[284,213,.5598559379382144],[284,214,.42250295310432634],[285,214,1.016654227133528],[286,215,1.0121959120202477],[287,215,.04154167961383383],[287,216,.9408968984130733],[288,216,.5583704920894111],[288,217,.42436914553372207],[289,217,1.0163171092845467],[290,218,1.0119211081990869],[291,218,.04047004842376173],[291,219,.9423465320743504],[292,219,.5569562989809166],[292,220,.4261480377490578],[293,220,1.0159931896995795],[294,221,1.0116584762427925],[295,221,.03945306599345366],[295,222,.9437255999933521],[296,222,.5556119942410062],[296,223,.4278409738424421],[297,223,1.0156826244024533],[298,224,1.0114079447897668],[299,224,.038489367187566605],[299,225,.9450354469842541],[300,225,.5543362522836106],[300,226,.42944927807097044],[301,226,1.015385544788648],[302,227,1.0111694348102989],[303,227,.03757764331096192],[303,228,.9462773798108762],[304,228,.5531277848528364],[304,229,.4309742550012965],[305,229,1.0151020588742643],[306,230,1.010942860298229],[307,230,.036716639459590646],[307,231,.9474526686068676],[308,231,.5519853396352962],[308,232,.4324171896758833],[309,232,1.0148322524854105],[310,233,1.0107281289063446],[311,233,.03590515201636021],[311,234,.9485625482321702],[312,234,.5509076989367998],[312,235,.43377934779319954],[313,235,1.0145761903940136],[314,236,1.0105251425307091],[315,236,.03514202628559325],[315,237,.9496082195647421],[316,237,.5498936784177629],[316,238,.4350619759070698],[317,238,1.014333917399279],[318,239,1.0103337978471305],[319,239,.03442615425358563],[319,240,.9505908507379167],[320,240,.5489421258861396],[320,241,.43626630163460317],[321,241,1.0141054593619083],[322,242,1.01015398680447],[323,242,.03375647247069698],[323,243,.9515115783174108],[324,243,.5480519201477565],[324,244,.43739353387882146],[325,244,1.0138908241879996],[326,245,1.0099855970782285],[327,245,.033131960048180864],[327,246,.9523715084281075],[328,246,.5472219699015581],[328,247,.438444863061944],[329,247,1.013690002769195],[330,248,1.009828512486449],[331,248,.0325516367573507],[331,249,.9531717178331495],[332,249,.5464512126887197],[332,250,.43942146136466664],[333,250,1.0135029698801676],[334,251,1.0096826133725936],[335,251,.03201456123217285],[335,252,.9539132549610332],[336,252,.5457386138858732],[336,253,.4403244829779182],[337,253,1.0133296850325435],[338,254,1.009547776957031],[339,254,.03151982926510845],[339,255,.9545971408911784],[340,255,.5450831657405287],[340,256,.44115506435778573],[341,256,1.0131700932920482],[342,257,1.0094238776594737],[343,257,.031066572189892106],[343,258,.9552243702967873],[344,258,.5444838864501296],[344,259,.44191432448690826],[345,259,1.013024126057376],[346,260,1.0093107873949636],[347,260,.030653955347715485],[347,261,.9557959123477745],[348,261,.5439398192781751],[348,262,.44260336514265247],[349,262,1.01289170180302],[350,263,1.0092083758457435],[351,263,.03028117663272106],[351,264,.956312711573757],[352,264,.5434500317097861],[352,265,.44322327116676213],[353,265,1.012772726788603],[354,266,1.0091165107105933],[355,266,.029947465111254432],[355,267,.9567756886915669],[356,267,.5430136146404813],[356,268,.443775110739594],[357,268,1.0126670957357586],[358,269,1.0090350579329337],[359,269,.02965207970869547],[359,270,.9571857414000476],[360,270,.5426296815994802],[360,271,.44425993565630856],[361,271,1.012574692474406],[362,272,1.0089638819102829],[363,272,.029394307963707546],[363,273,.9575437451393404],[364,273,.5422973680058967],[364,274,.4446787816043237],[365,274,1.0124953905592755],[366,275,1.0089028456858484],[367,275,.029173464843693937],[367,276,.9578505538209541],[368,276,.5420158304528419],[368,277,.44503266844280676],[369,277,1.0124290538587923],[370,278,1.0088518111235036],[371,278,.028988891617224174],[371,279,.9581070005279474],[372,279,.5417842460227992],[372,280,.4453226004830567],[373,280,1.012375537116488],[374,281,1.0088106390682976],[375,281,.028839954783933083],[375,282,.9583138981860433],[376,282,.5416018116287169],[376,283,.4455495667668758],[377,283,1.0123346864882432],[378,284,1.008779189492711],[379,284,.02872604505481853],[379,285,.9584720402070429],[380,285,.5414677433849261],[380,286,.44571454134485444],[381,286,1.0123063400541175],[382,287,1.008757321629678],[383,287,.028646576380597488],[383,288,.9585822011116006],[384,288,.5413812759956369],[384,289,.4458184835568685],[385,289,1.0122903283078832],[386,290,1.0087448940943453],[387,290,.028600985028178233],[387,291,.9586451371206854],[388,291,.541341662177547],[388,292,.44586233830592226],[389,292,1.0122864746237836],[390,293,1.0087417649949195],[391,293,.028588728701898054],[391,294,.9586615867284015],[392,294,.5413481720936798],[392,295,.44584703633543826],[393,295,1.0122945957030358],[394,296,1.0087477920325896],[395,296,.028609285702619672],[395,297,.958632271251788],[396,297,.5414000928186515],[396,298,.44577349450072723],[397,298,1.0123145019997328],[398,299,1.0087628325926643],[399,299,.028662154128659946],[399,300,.9585578953591529],[400,300,.5414967278190544],[400,301,.4456426160405528],[401,301,1.0123459981276965],[402,302,1.0087867438270437],[403,302,.028746851113718195],[403,303,.9584391475775814],[404,303,.5416373964555454],[404,304,.4454552908447334],[405,304,1.0123888832492127],[406,305,1.0088193827286074],[407,305,.02886291209986826],[407,306,.9582767007831089],[408,306,.541821433501071],[408,307,.44521239571891796],[409,307,1.0124429514472502],[410,308,1.0088606061980132],[411,308,.029009890142771087],[411,309,.9580712126699451],[412,309,.5420481886827784],[412,310,.4449147946460895],[413,310,1.01250799207953],[414,311,1.0089102711038211],[415,311,.029187355249536997],[415,312,.9578233262044412],[416,312,.5423170262339921],[416,313,.44456333904778883],[417,313,1.0125837901172945],[418,314,1.0089682343360202],[419,314,.02939489374516595],[419,315,.9575336700623188],[420,315,.5426273244683578],[420,316,.4441588680360723],[421,316,1.0126701264704934],[422,317,1.0090343528545804],[423,317,.029632107670909735],[423,318,.9572028590461733],[424,318,.5429784753662162],[424,319,.44370220866623333],[425,319,1.0127667782967882],[426,320,1.0091084837312583],[427,320,.02989861420426184],[427,321,.9568314944924141],[428,321,.5433698841780775],[428,322,.44319417618582607],[429,322,1.0128735192969558],[430,323,1.0091904841873789],[431,323,.03019404510848359],[431,324,.9564201646615609],[432,324,.5438009690392793],[432,325,.442635574278337],[433,325,1.0129901199984148],[434,326,1.0092802116265451],[435,326,.030518046204357472],[435,327,.9559694451142186],[436,327,.5442711606026257],[436,328,.4420271953022404],[437,328,1.013116348025554],[438,329,1.0093775236632159],[439,329,.030870276865616747],[439,330,.9554798990737882],[440,330,.5447799016825403],[440,331,.4413698205263152],[441,331,1.0132519683584005],[442,332,1.009482278147551],[443,332,.03125040953717358],[443,333,.9549520777754482],[444,333,.5453266469100869],[444,334,.4406642203630321],[445,334,1.0133967435791398],[446,335,1.009594333186143],[447,335,.031658129272365214],[447,336,.9543865208053518],[448,336,.5459108623998897],[448,337,.43991115459682073],[449,337,1.0135504341086077],[450,338,1.0097135471594447],[451,338,.03209313328990995],[451,339,.9537837564264052],[452,339,.5465320254328632],[452,340,.4391113726049666],[453,340,1.013712798432744],[454,341,1.009839778736762],[455,341,.03255513055252836],[455,342,.9531443018899375],[456,342,.5471896241467579],[456,343,.43826561357805704],[457,343,1.0138835933177033],[458,344,1.0099728868869051],[459,344,.033043841357819334],[459,345,.9524686637453139],[460,345,.5478831572348231],[460,346,.437374606734874],[461,346,1.0140625740178375],[462,347,1.0101127308880269],[463,347,.03355899695286791],[463,348,.9517573381261256],[464,348,.5486121336621822],[464,349,.436439071532636],[465,349,1.0142494944714182],[466,350,1.0102591703335964],[467,350,.03410033916008615],[467,351,.9510108110386514],[468,351,.5493760723833191],[468,352,.4354597178717026],[469,352,1.0144441074918717],[470,353,1.0104120651366326],[471,353,.03466762001996195],[471,354,.9502295586328896],[472,354,.5501745020753853],[472,355,.43443724629963687],[473,355,1.0146461649465606],[474,356,1.0105712755316636],[475,356,.035260601448092795],[475,357,.9494140474694148],[476,357,.5510069608761691],[476,358,.43337234820709825],[477,358,1.0148554179311553],[478,359,1.0107366620751033],[479,359,.035879054907258415],[479,360,.9485647347731454],[480,360,.5518729961339426],[480,361,.4322657060211073],[481,361,1.0150716169344107],[482,362,1.0109080856433987],[483,362,.036522761091017805],[483,363,.9476820686815849],[484,363,.5527721641646695],[484,364,.4311179933933358],[485,364,1.0152945119966836],[486,365,1.011085407429963],[487,365,.037191509621709105],[487,366,.9467664884832998],[488,366,.5537040300164661],[488,367,.42992987538427074],[489,367,1.0155238528614574],[490,368,1.0112684889404733],[491,368,.03788509876006132],[491,369,.945818424848663],[492,369,.5546681672409077],[492,370,.42870200864543534],[493,370,1.015759389119438],[494,371,1.0114571919861517],[495,371,.038603335123549486],[495,372,.9448383000574974],[496,372,.5556641576735553],[496,373,.42743504159139284],[497,373,1.016000870349307],[498,374,1.0116513786769457],[499,374,.03934603342038135],[499,375,.9438265282100843],[500,375,.556691591222498],[500,376,.42612961457530607],[501,376,1.0162480462474877],[502,377,1.011850911412824],[503,377,.0401130161915153],[503,378,.9427835154401112],[504,378,.5577500656591832],[504,379,.42478636005357434],[505,379,1.0165006667574357],[506,380,1.012055652873517],[507,380,.04090411356002747],[507,381,.9417096601187289],[508,381,.5588391864205529],[508,382,.4234059027505881],[509,382,1.016758482190165],[510,383,1.0122654660085202],[511,383,.04171916299559172],[511,384,.940605353048487],[512,384,.5599585664146272],[512,385,.4219888598177451],[513,385,1.0170212433404524],[514,386,1.0124802140252198],[515,386,.04255800908365318],[515,387,.9394709776545362],[516,387,.5611078258344457],[516,388,.42053584098827806],[517,388,1.0172887015980372],[518,389,1.0126997603766286],[519,389,.04342050330548295],[519,390,.9383069101697904],[520,390,.5622865919744513],[520,391,.4190474487280153],[521,391,1.0175606090547666],[522,392,1.0129239687479124],[523,392,.044306503823998804],[523,393,.9371135198133816],[524,393,.5634944990567509],[524,394,.41752427838399275],[525,394,1.017836718605313],[526,395,1.0131527030429122],[527,395,.04521587528078427],[527,396,.9358911689630978],[528,396,.5647311880602439],[528,397,.4159669183258934],[529,397,1.0181167840454461],[530,398,1.013385827369556],[531,398,.04614848859869256],[531,399,.9346402133241121],[532,399,.5659963065530312],[532,400,.41437595008823225],[533,400,1.0184005601646522],[534,401,1.0136232060250132],[535,401,.04710422079259773],[535,402,.9333610020906034],[536,402,.5672895085344858],[536,403,.41275194850334485],[537,403,1.0186878028359048],[538,404,1.0138647034793364],[539,404,.048082954782625906],[539,405,.9320538781067357],[540,405,.5686104542795039],[540,406,.4110954818363832],[541,406,1.0189782691001303],[542,407,1.0141101843606544],[543,407,.04908457922335384],[543,408,.9307191780153855],[544,408,.5699588101870642],[544,409,.40940711191046436],[545,409,1.0192717172488233],[546,410,1.0143595134378742],[547,410,.05010898832967291],[547,411,.9293572324099554],[548,411,.571334248633412],[548,412,.4076873942350095],[549,412,1.0195679069010588],[550,413,1.014612555604275],[551,413,.05115608171422347],[551,414,.9279683659767549],[552,414,.5727364478324755],[552,415,.4059368781231612],[553,415,1.0198665990790994],[554,416,1.0148691758602966],[555,416,.05222576422885553],[555,417,.9265528976348417],[556,417,.5741650916958022],[556,418,.40415610681371494],[557,418,1.0201675562784311],[558,419,1.0151292392959954],[559,419,.05331794581129548],[559,420,.9251111406735011],[560,420,.575619869698764],[560,421,.40234561758289383],[561,421,1.020470542537326],[562,422,1.0153926110734461],[563,422,.05443254133751677],[563,423,.9236434028815992],[564,423,.577100476753225],[564,424,.40050594185671334],[565,424,1.0207753235006762],[566,425,1.0156591564087798],[567,425,.05556947047932675],[567,426,.9221499866777003],[568,426,.5786066130792553],[568,427,.3986376053171075],[569,427,1.021081666483685],[570,428,1.0159287405542117],[571,428,.056728657567230105],[571,429,.9206311892316345],[572,429,.5801379840824749],[572,430,.3967411280111777],[573,430,1.0213893405291132],[574,431,1.016201228779567],[575,431,.057910031456259455],[575,432,.9190873025878152],[576,432,.5816943002369833],[576,433,.39481702444623007],[577,433,1.021698116466727],[578,434,1.0164764863538518],[579,434,.05911352539724152],[579,435,.9175186137811212],[580,435,.5832752769689779],[580,436,.3928658036922941],[581,436,1.0220077669657777],[582,437,1.0167543785266802],[583,437,.06033907691219022],[583,438,.9159254049505173],[584,438,.5848806345442068],[584,439,.3908879694785636],[585,439,1.022318066586335],[586,440,1.017034770509633],[587,440,.061586627674206584],[587,441,.914307953451257],[588,441,.58651009795775],[588,442,.3888840202832941],[589,442,1.0226287918300547],[590,443,1.017317527457434],[591,443,.06285612338957339],[591,444,.9126665319603182],[592,444,.5881633968320044],[592,445,.3868544494242516],[593,445,1.0229397211858324],[594,446,1.0176025144493452],[595,446,.06414751368695158],[595,447,.9110014085827639],[596,447,.5898402653081352],[596,448,.3847997451452973],[597,448,1.0232506351759092],[598,449,1.0178895964699735],[599,449,.06546075200505637],[599,450,.9093128469516464],[600,450,.5915404419502857],[600,451,.38272039070347513],[601,451,1.0235613163962847],[602,452,1.018178638390636],[603,452,.06679579548876291],[603,453,.9076011063291527],[604,453,.5932636696450677],[604,454,.3806168644453139],[605,454,1.0238715495601471],[606,455,1.0184695049504477],[607,455,.06815260488510425],[607,456,.9058664416991429],[608,456,.5950096955107654],[608,457,.37848963988927037],[609,457,1.024181121533852],[610,458,1.0187620607370533],[611,458,.06953114444294146],[611,459,.9041091038666588],[612,459,.5967782707982764],[612,460,.3763391858013562],[613,460,1.0244898213757605],[614,461,1.0190561701684775],[615,461,.07093138181829654],[615,462,.9023293395404434],[616,462,.5985691508103589],[616,463,.37416596626748977],[617,463,1.0247974403689852],[618,464,1.0193516974735164],[619,464,.07235328797779521],[619,465,.9005273914292568],[620,465,.6003820948062436],[620,466,.37197044076689306],[621,466,1.0251037720559506],[622,467,1.0196485066733956],[623,467,.07379683710904351],[623,468,.8987034983230944],[624,468,.6022168659211814],[624,469,.3697530642404009],[625,469,1.025408612268551],[626,470,1.01994646156273],[627,470,.07526200653052777],[627,471,.8968578951803935],[628,471,.6040732310832857],[628,472,.36751428715382667],[629,472,1.0257117591594511],[630,473,1.0202454256910738],[631,473,.07674877660715493],[631,474,.8949908132065928],[632,474,.6059509609308075],[632,475,.3652545555682938],[633,475,1.0260130132278693],[634,476,1.0205452623441595],[635,476,.07825713066499564],[635,477,.8931024799348216],[636,477,.6078498297369068],[636,478,.36297431119783957],[637,478,1.026312177347325],[638,479,1.0208458345252258],[639,479,.07978705490923481],[639,480,.8911931193041005],[640,480,.6097696153313106],[640,481,.360673991471839],[641,481,1.0266090567901067],[642,482,1.021147004936792],[643,482,.08133853834681559],[643,483,.8892629517341233],[644,483,.6117100990244927],[644,484,.3583540295921792],[645,484,1.0269034592511874],[646,485,1.0214486359623245],[647,485,.08291157270803175],[647,486,.8873121941972261],[648,486,.6136710655396947],[648,487,.35601485458732646],[649,487,1.0271951948700204],[650,488,1.0217505896477503],[651,488,.08450615237016054],[651,489,.885341060291742],[652,489,.6156523029400911],[652,490,.3536568913681695],[653,490,1.0274840762511013],[654,491,1.022052727683594],[655,491,.08612227428601159],[655,492,.8833497603088218],[656,492,.6176536025590085],[656,493,.3512805607832744],[657,493,1.02776991848203],[658,494,1.0223549113867765],[659,494,.08775993791161714],[659,495,.8813385013049766],[660,495,.6196747589336273],[660,496,.34888627966024516],[661,496,1.028052539155018],[662,497,1.0226570016825074],[663,497,.08941914513388247],[663,498,.8793074871648813],[664,498,.621715569739104],[664,499,.346474460866357],[665,499,1.0283317583791294],[666,500,1.0229588590871557],[667,500,.09109990020637701],[667,501,.8772569186645972],[668,501,.6237758357289777],[668,502,.34404551334349676],[669,502,1.0286073987990987],[670,503,1.023260343690056],[671,503,.09280220968027517],[671,504,.8751869935378795],[672,504,.6258553606671395],[672,505,.3415998421603758],[673,505,1.0288792856085094],[674,506,1.0235613151361742],[675,506,.09452608233896752],[675,507,.8730979065358732],[676,507,.6279539512706841],[676,508,.33913784855416224],[677,508,1.0291472465628844],[678,509,1.0238616326091752],[679,509,.09627152913686766],[679,510,.8709898494841083],[680,510,.6300714171530707],[680,511,.3366599299694516],[681,511,1.0294111119920568],[682,512,1.0241611548135297],[683,512,.09803856313307117],[683,513,.8688630113461538],[684,513,.6322075707612916],[684,514,.3341664801038121],[685,514,1.0296707148107829],[686,515,1.0244597399582411],[687,515,.09982719943517422],[687,516,.8667175782751595],[688,516,.6343622273238361],[688,517,.33165788894132453],[689,517,1.029925890529174],[690,518,1.024757245739534],[691,518,.10163745513498708],[691,519,.864553733672022],[692,519,.6365352047963319],[692,520,.32913454279236454],[693,520,1.0301764772610114],[694,521,1.0250535293244536],[695,521,.10346934925456013],[695,522,.8623716582378126],[696,522,.6387263238040831],[696,523,.32659682433041565],[697,523,1.0304223157317631],[698,524,1.0253484473338592],[699,524,.10532290268142636],[699,525,.8601715300305955],[700,525,.6409354075949926],[700,526,.32404511262442137],[701,526,1.0306632492858765],[702,527,1.0256418558269649],[703,527,.10719813812199533],[703,528,.8579535245094766],[704,528,.6431622819855923],[704,529,.3214797831731655],[705,529,1.0308991238920382],[706,530,1.0259336102845216],[707,530,.10909508003982304],[707,531,.855717814591042],[708,531,.6454067753119441],[708,532,.3189012079363341],[709,532,1.03112978814904],[710,533,1.0262235655929648],[711,533,.11101375459950885],[711,534,.8534645706974212],[712,534,.6476687183847731],[712,535,.31630975536452444],[713,535,1.0313550932895121],[714,536,1.0265115760290215],[715,536,.11295418962138112],[715,537,.8511939607995829],[716,537,.6499479444348513],[716,538,.3137057904341974],[717,538,1.0315748931821125],[718,539,1.0267974952437684],[719,539,.11491641452111552],[719,540,.8489061504692988],[720,540,.6522442890739327],[720,541,.3110896746693046],[721,541,1.0317890443354898],[722,542,1.027081176247435],[723,542,.11690046026072583],[723,543,.8466013029223681],[724,543,.6545575902471419],[724,544,.3084617661720711],[725,544,1.0319974058989068],[726,545,1.0273624713942857],[727,545,.11890635929917114],[727,546,.8442795790631381],[728,546,.6568876881880987],[728,547,.3058224196480645],[729,547,1.0321998396634169],[730,548,1.0276412323675237],[731,548,.12093414553884717],[731,549,.8419411375296247],[732,549,.6592344253774453],[732,550,.3031719864317822],[733,550,1.0323962100616533],[734,551,1.027917310164898],[735,551,.12298385427920393],[735,552,.8395861347312832],[736,552,.661597646501151],[736,553,.30051081451364153],[737,553,1.0325863841657408],[738,554,1.028190555083932],[739,554,.12505552216817234],[739,555,.8372147248951822],[740,555,.6639771984076539],[740,556,.2978392485576317],[741,556,1.0327702316879357],[742,557,1.0284608167076257],[743,557,.12714918714905468],[743,558,.8348270601054527],[744,558,.6663729300704698],[744,559,.2951576299293991],[745,559,1.0329476249762861],[746,560,1.0287279438905246],[747,560,.12926488841857217],[747,561,.8324232903405301],[748,561,.6687846925454237],[748,562,.2924662967182933],[749,562,1.0331184390116956],[750,563,1.0289917847447467],[751,563,.13140266637549056],[751,564,.8300035635173267],[752,564,.6712123389365675],[752,565,.28976558374944045],[753,565,1.033282551406384],[754,566,1.0292521866268258],[755,566,.13356256257828694],[755,567,.8275680255195722],[756,567,.6736557243576808],[756,568,.28705582261488644],[757,568,1.0334398423957492],[758,569,1.0295089961237516],[759,569,.1357446196959754],[759,570,.8251168202441111],[760,570,.6761147058925864],[760,571,.2843373416864493],[761,571,1.0335901948361186],[762,572,1.0297620590403478],[763,572,.13794888146102224],[763,573,.822650089632257],[764,573,.6785891425651428],[764,574,.2816104661359854],[765,574,1.0337334941973482],[766,575,1.0300112203862977],[767,575,.1401753926301894],[767,576,.8201679737037143],[768,576,.6810788952992894],[768,577,.278875517953921],[769,577,1.0338696285566522],[770,578,1.0302563243634062],[771,578,.14242419893016717],[771,579,.8176706105975015],[772,579,.6835838268889712],[772,580,.2761328159639002],[773,580,1.0339984885922306],[774,581,1.0304972143534852],[775,581,.14469534702456693],[775,582,.8151581365963325],[776,582,.6861038019600981],[776,583,.2733826758448351],[777,583,1.0341199675739228],[778,584,1.0307337329063364],[779,584,.14698888445850505],[779,585,.8126306861670012],[780,585,.6886386869453004],[780,586,.2706254101402667],[781,586,1.0342339613562985],[782,587,1.0309657217274584],[783,587,.14930485962229872],[783,588,.810088391991206],[784,588,.6911883500416512],[784,589,.267861328280309],[785,589,1.0343403683692496],[786,590,1.0311930216672842],[787,590,.1516433217043255],[787,591,.80753138499415],[788,591,.6937526611907388],[788,592,.2650907365900638],[789,592,1.0344390896084676],[790,593,1.0314154727094134],[791,593,.1540043206504027],[791,594,.8049597943767033],[792,594,.6963314920402311],[792,595,.2623139383094437],[793,595,1.034530028625162],[794,596,1.0316329139598897],[795,596,.1563879071152346],[795,597,.8023737476471726],[796,597,.6989247159176777],[796,598,.25953123360660696],[797,598,1.0346130915153564],[798,599,1.0318451836365417],[799,599,.15879413242528773],[799,600,.799773370648628],[800,600,.7015322078013413],[800,601,.256742919587031],[801,601,1.0346881869094755],[802,602,1.0320521190584917],[803,602,.16122304853347555],[803,603,.7971587875884961],[804,603,.7041538442893039],[804,604,.2539492903120581],[805,604,1.0347552259598483],[806,605,1.032253556636297],[807,605,.16367470797552194],[807,606,.7945301210672343],[808,606,.7067895035746306],[808,607,.2511506368077842],[809,607,1.0348141223290412],[810,608,1.0324493318619021],[811,608,.16614916382632547],[811,609,.7918874921076472],[812,609,.709439065413448],[812,610,.24834724708249672],[813,610,1.0348647921767888],[814,611,1.032639279299876],[815,611,.1686464696616927],[815,612,.7892310201754584],[816,612,.7121024111062217],[816,613,.24553940613187852],[817,613,1.0349071541468273],[818,614,1.0328232325774014],[819,614,.17116667951302045],[819,615,.7865608232133336],[820,615,.7147794234616441],[820,616,.24272739595679857],[821,616,1.0349411293537],[822,617,1.0330010243763053],[823,617,.17370984782335191],[823,618,.7838770176637189],[824,618,.7174699867799718],[824,619,.23991149556876706],[825,619,1.0349666413686411],[826,620,1.033172486424039],[827,620,.17627602940857415],[827,621,.7811797184924586],[828,621,.720173986819918],[828,622,.23709198101021747],[829,622,1.0349836162040225],[830,623,1.0333374494861536],[831,623,.1788652794118951],[831,624,.7784690392157592],[832,624,.7228913107823544],[832,625,.234269125354749],[833,625,1.0349919822996723],[834,626,1.0334957433581187],[835,626,.18147765326305537],[835,627,.7757450919251534],[836,627,.7256218472813651],[836,628,.23144319872166874],[837,628,1.0349916705072433],[838,629,1.033647196858036],[839,629,.1841132066386375],[839,630,.773007987305413],[840,630,.7283654863202004],[840,631,.22861446829229304],[841,631,1.0349826140730403],[842,632,1.033791637819688],[843,632,.1867719954109858],[843,633,.7702578346682248],[844,633,.7311221192693971],[844,634,.2257831983137577],[845,634,1.0349647486235953],[846,635,1.0339288930859631],[847,635,.18945407561392777],[847,636,.7674947419659374],[848,636,.7338916388459672],[848,637,.22294965011006523],[849,637,1.0349380121480094],[850,638,1.0342420464149167],[851,638,.1924281237940313],[851,639,.5378425839134362],[852,639,.5202524171708031],[852,640,.4568109772775498],[852,641,.05199677850209752],[853,640,.24351254102567055],[853,641,.5225687624093359],[853,642,.2921493228893563],[854,642,.25538328243481595],[854,643,.5241438210153896],[854,644,.23257172527298814],[855,643,.011987787701546808],[855,644,.3172219958151092],[855,645,.4868674616302827],[855,646,.176468024136203],[856,645,.07357769424953754],[856,646,.38294232266815553],[856,647,.4259205416014665],[856,648,.11753224171517974],[857,647,.13246196705929972],[857,648,.4398303708699065],[857,649,.36708371923835004],[857,650,.06067586883292038],[858,649,.18926719214302565],[858,650,.4946697651421086],[858,651,.3040061179704405],[858,652,.005602736230038195],[859,651,.23906249586178907],[859,652,.5231149368578739],[859,653,.2495840468006932],[860,653,.2897970473112013],[860,654,.5026442283960142],[860,655,.20274559579570214],[861,654,.04664315619110009],[861,655,.3473240465998149],[861,656,.4526192727121032],[861,657,.1523595035438806],[862,656,.09766699822939251],[862,657,.3969699779916487],[862,658,.40188113292822186],[862,659,.1034820659161816],[863,658,.14649823031506354],[863,659,.44395391725661004],[863,660,.3530826952522148],[863,661,.056517279244449437],[864,660,.193417537810633],[864,661,.48905272813711814],[864,662,.30196784607077015],[864,663,.011088189502860925],[865,662,.235165441654809],[865,663,.5161755064939912],[865,664,.25593745749264785],[866,664,.27598857145168865],[866,665,.5055165820237347],[866,666,.21733399798014585],[867,665,.03142691535889764],[867,666,.321995701601107],[867,667,.4677769922252197],[867,668,.17692400337387545],[868,667,.07312870986769164],[868,668,.3630952451007391],[868,669,.4264378437134144],[868,670,.13731285791147696],[869,669,.11270032695167025],[869,670,.4009509624326517],[869,671,.38688927555227676],[869,672,.09946833663506985],[870,671,.15050630725355646],[870,672,.43706477714430675],[870,673,.34910378546507886],[870,674,.06336347754327785],[871,673,.1865736616624162],[871,674,.4714631653468664],[871,675,.3125696686315781],[871,676,.028869775846049314],[872,675,.22058655357283705],[872,676,.502393455771382],[872,677,.27458473006488804],[873,677,.24983886475629993],[873,678,.5137748593109537],[873,679,.24315322539257223],[874,678,.0036240101488931717],[874,679,.2812413419420975],[874,680,.49584386088869215],[874,681,.2153614227018543],[875,680,.034735500335029305],[875,681,.3144060917430617],[875,682,.46485314373790926],[875,683,.18595981453922283],[876,682,.0641063484572785],[876,683,.34219859962945964],[876,684,.43549740951782173],[876,685,.15817234633893226],[877,684,.091864261548934],[877,685,.3683988258245694],[877,686,.407752916631107],[877,687,.13197572785525458],[878,686,.11803256264694018],[878,687,.3930296465168421],[878,688,.3815964769154389],[878,689,.10734720976073055],[879,688,.1426340315995158],[879,689,.4161134070872291],[879,690,.35700543857338174],[879,691,.08426456699687354],[880,690,.16569092182506315],[880,691,.43767193845249674],[880,692,.33395766972405766],[880,693,.06270608273067858],[881,692,.1872249764612122],[881,693,.457726572814142],[881,694,.3124315425508366],[881,695,.04265053289025597],[882,694,.20725744392861123],[882,695,.47629815883858434],[882,696,.29240591801936916],[882,697,.024077171256560802],[883,696,.22580909293436022],[883,697,.49340707629100294],[883,698,.272739666255128],[883,699,.006906252371233933],[884,698,.24190643067177103],[884,699,.5047275543873398],[884,700,.2549459812508028],[885,700,.2567100539467806],[885,701,.5031577036963546],[885,702,.24065881914660317],[886,701,.008634717813202674],[886,702,.27224949572145724],[886,703,.49094674236787206],[886,704,.22719544196570912],[887,703,.02292373131969297],[887,704,.28597629401801355],[887,705,.47672398599653515],[887,706,.2143533208320832],[888,705,.035751602096786475],[888,706,.29743237559552355],[888,707,.46390276826706217],[888,708,.20289630196958544],[889,707,.04719579903029385],[889,708,.3075210742305127],[889,709,.45246460115847775],[889,710,.19280622955805915],[890,709,.057274491299496445],[890,710,.3162602301176305],[890,711,.4423913913890736],[890,712,.18406533389761395],[891,711,.0660054606502899],[891,712,.3236673045470217],[891,713,.43366542899845073],[891,714,.17665622026124392],[892,713,.07340611260620647],[892,714,.3297593908476435],[892,715,.4262693763198494],[892,716,.17056185812791913],[893,715,.07949348729590157],[893,716,.33455322495703466],[893,717,.42018625732795906],[893,718,.16576557078065143],[894,717,.0842842699121286],[894,718,.3380651956328206],[894,719,.41539944734620887],[894,720,.16225102525634236],[895,719,.0877948008176482],[895,720,.3403113543186734],[895,721,.41189266310148215],[895,722,.1600022226324315],[896,721,.09004108530992379],[896,722,.3413074246800344],[896,723,.4096499531105413],[896,724,.15900348863810745],[897,723,.0910388030604564],[897,724,.341068811820455],[897,725,.4086556883871424],[897,726,.15923946457791555],[898,725,.09080331723824445],[898,726,.33961061119156805],[898,727,.40889455345709996],[898,728,.16069509855546693],[899,727,.08934968333179105],[899,728,.33694761720865024],[899,729,.41035153766953336],[899,730,.1633556369851302],[900,729,.08669265767999552],[900,730,.33309433158306806],[900,731,.41301192679237225],[900,732,.16720661638248935],[901,731,.08284670572359325],[901,732,.32806497138102175],[901,733,.41686129488304347],[901,734,.17223385542154263],[902,733,.0778260099865808],[902,734,.3218734768206457],[902,735,.421885496422382],[902,736,.17842344724960524],[903,735,.07164447779930824],[903,736,.31453351881588426],[903,737,.42807065870301164],[903,738,.185761752049803],[904,737,.06431574877136567],[904,738,.3060585062772846],[904,739,.435403174462235],[904,740,.19423538984244326],[905,739,.05585320202451507],[905,740,.29646159317816856],[905,741,.4438696947508069],[905,742,.20383123351642937],[906,741,.04626996319383157],[906,742,.2857556853951481],[906,743,.4534571220289279],[906,744,.21453640208174513],[907,743,.03557891120608933],[907,744,.27395344733160587],[907,745,.4640838862781736],[907,746,.2259711147745072],[908,745,.02378916236694485],[908,746,.26064383557298154],[908,747,.4744097020055178],[908,748,.23741469023048611],[908,749,.0029874664482454345],[909,747,.010888485342882084],[909,748,.24524012825579347],[909,749,.47705262348683797],[909,750,.25146343127990345],[909,751,.018030374036361534],[910,750,.23051594568994063],[910,751,.4659638155007443],[910,752,.26789265476733026],[910,753,.034103962104678205],[911,752,.2157780537828917],[911,753,.4490488012027463],[911,754,.28394240197843773],[911,755,.051207169174446954],[912,754,.19869680451466967],[912,755,.4309201309554197],[912,756,.3010279740476113],[912,757,.06933596927309439],[913,756,.18059146729117878],[913,757,.4117775174928008],[913,758,.3191380672559441],[913,759,.08847923890660256],[914,758,.16147315955443303],[914,759,.3916318997027402],[914,760,.33826157637971177],[914,761,.10862604895508292],[915,760,.14135280401108383],[915,761,.37049402581791996],[915,762,.35838758963377015],[915,763,.12976565972904766],[916,762,.12024113359574008],[916,763,.34837445826725],[916,764,.3795053837685538],[916,765,.15188751617588445],[917,764,.0981486962833266],[917,765,.32528357838026745],[917,766,.40160441931520835],[917,767,.17498124323033803],[918,766,.07508585975635881],[918,767,.30123159095005636],[918,768,.42467433597326765],[918,769,.19903664130457108],[919,768,.05106281593203439],[919,769,.2762285286588279],[919,770,.4480441892579001],[919,771,.22091817857346802],[920,770,.02605116606412028],[920,771,.24679268601046497],[920,772,.4613333588465915],[920,773,.24636316696152993],[920,774,.026661594315488448],[921,772,.00017143112777602207],[921,773,.22016507993495968],[921,774,.4450006731455823],[921,775,.27654268563105877],[921,776,.05450703342817279],[922,775,.19537707282293476],[922,776,.4169980825615683],[922,777,.3043455873211709],[922,778,.08322496813649063],[923,777,.16671893224886847],[923,778,.3873911007134449],[923,779,.333032487802997],[923,780,.11284587069811512],[924,779,.1371380798307044],[924,780,.3568813039463011],[924,781,.36262258254682433],[924,782,.14336176762117853],[925,781,.10666365535341012],[925,782,.32548606626333626],[925,783,.39310680323983005],[925,784,.17476372572452537],[926,783,.07530458232966944],[926,784,.2932141772790525],[926,785,.4235343782302751],[926,786,.20429957725699868],[927,785,.04297407877416276],[927,786,.2566282342451322],[927,787,.44609730979381396],[927,788,.23600300007995265],[927,789,.023774697332874434],[928,787,.00973561058609779],[928,788,.22213324067090034],[928,789,.4366882593279592],[928,790,.27231575108916795],[928,791,.058813271383982776],[929,790,.1899112794795718],[929,791,.4051174305988943],[929,792,.3087329260703045],[929,793,.09459113946159277],[930,792,.15536737862587172],[930,793,.36909687837539557],[930,794,.3443998634306182],[930,795,.13113054742980831],[931,794,.11887833690004168],[931,795,.3317399346424034],[931,796,.3809015150071346],[931,797,.1684974582828263],[932,796,.08156315084174257],[932,797,.29356399783457987],[932,798,.4168389957384664],[932,799,.2027189344423823],[933,798,.043285265762028874],[933,799,.2496929999720567],[933,800,.44089395742648096],[933,801,.24052352812737388],[933,802,.03507425254057242],[934,800,.0043335535351657515],[934,801,.21027601904641954],[934,802,.42143856683278325],[934,803,.2844016743443022],[934,804,.07585590645285804],[935,803,.17353832434253885],[935,804,.38262846297038483],[935,805,.3257498632562316],[935,806,.11730189433403454],[936,805,.13268775789077444],[936,806,.3407519309130924],[936,807,.3670972990020704],[936,808,.15947396875496164],[937,807,.09057464650490143],[937,808,.2978183751219168],[937,809,.40749895190525254],[937,810,.19795010289674397],[938,809,.0474866463063797],[938,810,.24850494279526708],[938,811,.4346436181876547],[938,812,.2403211224239381],[938,813,.04014881320170647],[939,811,.003878639500178961],[939,812,.2047038150773143],[939,813,.41157455841171137],[939,814,.28957529821809164],[939,815,.08560320920592149],[940,814,.16385621221760913],[940,815,.36828320787286745],[940,816,.33550406688664397],[940,817,.13164677712134118],[941,816,.11836297424309958],[941,817,.32185871977911545],[941,818,.3799973298161782],[941,819,.17581896778117206],[942,818,.07143918326167292],[942,819,.2705029465809176],[942,820,.4180894904987747],[942,821,.22040151023922497],[942,822,.023261093492508676],[943,820,.023754358875460287],[943,821,.22082957274806367],[943,822,.41735892037093947],[943,823,.26975946681527463],[943,824,.07244459405934162],[944,823,.17462856886910824],[944,824,.376380003235797],[944,825,.32258384746152186],[944,826,.12234695850241085],[945,825,.12764964491952732],[945,826,.32754202842781277],[945,827,.3705351976091778],[945,828,.17002290467196218],[946,827,.07705703864783364],[946,828,.27228373423426855],[946,829,.4119493110954956],[946,830,.21796235075295245],[946,831,.024608216085607083],[947,829,.025780053026113373],[947,830,.2190518649272109],[947,831,.41169318411556594],[947,832,.27077590916361477],[947,833,.07732052594065236],[948,832,.1695115580680664],[948,833,.36773423672329814],[948,834,.3275311475162098],[948,835,.13077893984001213],[949,834,.11922966876699366],[949,835,.31565346594837984],[949,836,.37813100062036553],[949,837,.17991281790206778],[950,836,.06510103041600655],[950,837,.25463712967072577],[950,838,.4162975451493948],[950,839,.23222690463246418],[950,840,.043347365043106205],[951,838,.010682336294089382],[951,839,.20025854636251755],[951,840,.3947874901107556],[951,841,.2917173663646273],[951,842,.09950708368621437],[952,841,.14911244770443477],[952,842,.3431424199239878],[952,843,.3480530442639449],[952,844,.15411315971947762],[953,843,.0934299055238343],[953,844,.2830893937829872],[953,845,.3971235804951196],[953,846,.20716078374370134],[953,847,.020137203526012115],[954,845,.036025540013401365],[954,846,.22261124110739972],[954,847,.40630997808531094],[954,848,.2648205963423913],[954,849,.07872881878459281],[955,848,.16692727676480973],[955,849,.35954874836594064],[955,850,.328443108696204],[955,851,.13751082396144756],[956,850,.11152248261980105],[956,851,.3006327942159715],[956,852,.3829521945790107],[956,853,.1916328343080391],[956,854,.0076262937092498664],[957,852,.0514953905500914],[957,853,.2343500090068106],[957,854,.41021535649217705],[957,855,.25030428726128284],[957,856,.06835964516566889],[958,855,.17563114080501685],[958,856,.3667504924135684],[958,857,.31835263030310357],[958,858,.1299663000321827],[959,857,.11940718803292909],[959,858,.3065438045294419],[959,859,.37569491987401304],[959,860,.18605528589059708],[959,861,.004834820768368334],[960,859,.05684866493974193],[960,860,.2366688077210537],[960,861,.4085057240274029],[960,862,.24678375999468344],[960,863,.06783571840441664],[961,862,.17558642045742334],[961,863,.36451985113857055],[961,864,.3173137388508224],[961,865,.13129392160626782],[962,864,.11725721455632943],[962,865,.3008194332920608],[962,866,.37580301677160466],[962,867,.19024874552861262],[962,868,.011245575393110812],[963,866,.05231298976932004],[963,867,.23017401181136463],[963,868,.40175554736854613],[963,869,.2536595659979476],[963,870,.07679940668774121],[964,869,.16706057585212106],[964,870,.35303258747063304],[964,871,.3251768586309606],[964,872,.14116418004635392],[965,871,.10550294433561781],[965,872,.28424844668945237],[965,873,.38249269088982873],[965,874,.2036626805762719],[965,875,.02684871916582402],[966,873,.03836058116912999],[966,874,.21480488879977247],[966,875,.389260042863657],[966,876,.27095452974310497],[966,877,.09504101254228686],[967,876,.1502807743955375],[967,877,.3328577086192332],[967,878,.3421239629983485],[967,879,.15918522100542254],[968,878,.08474515454977341],[968,879,.25820758590913884],[968,880,.3938397310124852],[968,881,.22523159171338067],[968,882,.05190695217080459],[969,880,.015820211753405387],[969,881,.19007905592596833],[969,882,.36921246833932636],[969,883,.2980889913883655],[969,884,.12132017371569158],[970,883,.1247775639085626],[970,884,.3015570552958629],[970,885,.36552163552482225],[970,886,.18684713857492927],[970,887,.014284415706242481],[971,885,.055013622481818666],[971,886,.2263705108609403],[971,887,.39186593267986564],[971,888,.2561333080985603],[971,889,.08592049273991473],[972,888,.1575841200944441],[972,889,.3370827060887002],[972,890,.33284859953655166],[972,891,.15390042438231766],[973,890,.08972988049108406],[973,891,.2590326783958039],[973,892,.38812639016604245],[973,893,.22348813860080616],[973,894,.054161074977768404],[974,892,.017081968749935856],[974,893,.18740927170107446],[974,894,.3625874079443392],[974,895,.2990263270079478],[974,896,.12613079428882987],[975,895,.11819045745461297],[975,896,.28905735771716573],[975,897,.36789499357104777],[975,898,.19628130377264577],[975,899,.02735424128922767],[976,897,.04494375361325131],[976,898,.21330043570426716],[976,899,.37902147922066165],[976,900,.2697531768133337],[976,901,.10241904377888808],[977,900,.14130067843136315],[977,901,.3150246804904708],[977,902,.3480110183643501],[977,903,.1725701388645175],[977,904,.005966983373903607],[978,902,.06884101502859519],[978,903,.23351128359258333],[978,904,.3898863909020141],[978,905,.24593198700119934],[978,906,.08224765045066],[979,905,.1597942440306211],[979,906,.3346851109670727],[979,907,.3285973743088808],[979,908,.15444027476874822],[980,907,.08792661347585409],[980,908,.2508895640647832],[980,909,.38533070676895603],[980,910,.22893712756876922],[980,911,.06583953763953361],[981,909,.01060737785460527],[981,910,.17530908392596897],[981,911,.34707093920704996],[981,912,.3101853041457825],[981,913,.1404924603408273],[982,912,.1016482122325276],[982,913,.2640331008343238],[982,914,.3757885914855772],[982,915,.21658719088481612],[982,916,.05379076081392352],[983,914,.023321537452804155],[983,915,.1869789080592518],[983,916,.35433193126746176],[983,917,.2960976478285003],[983,918,.13047091456929613],[984,917,.11086010315035294],[984,918,.272590889791831],[984,919,.3683410258652817],[984,920,.20801518542415245],[984,921,.04616290894518408],[985,919,.03202626907959427],[985,920,.1942489952348069],[985,921,.35801621736570555],[985,922,.2871844809716754],[985,923,.12448425960359358],[986,922,.11614980664040801],[986,923,.2769245860037902],[986,924,.3634503371272694],[986,925,.20337777894188264],[986,926,.04278533591281287],[987,924,.036633170664026604],[987,925,.19735437260885233],[987,926,.3585975660673821],[987,927,.28298312203941667],[987,928,.12237172260813765],[988,927,.11761764880185657],[988,928,.2769347836061358],[988,929,.3613222869658947],[988,930,.20269252495682932],[988,931,.04352084243134597],[989,929,.03715658569409518],[989,930,.19646584076452728],[989,931,.3563193376763676],[989,932,.28325914825402143],[989,933,.12401877287718965],[990,932,.11535841088563661],[990,933,.2726772185957825],[990,934,.36193002492598775],[990,935,.2058724789923987],[990,936,.04828585408934835],[991,934,.03368059076582972],[991,935,.19166681871807822],[991,936,.35120102320155516],[991,937,.2879669101334489],[991,938,.12934311950798513],[992,937,.10947528483272252],[992,938,.2643619456949593],[992,939,.36503164238003943],[992,940,.21273290367631378],[992,941,.05704255868679827],[993,939,.026351338857843194],[993,940,.18296002570453515],[993,941,.3430562989307297],[993,942,.29724916938947604],[993,943,.13830626997954892],[994,942,.10006782116457263],[994,943,.2523219642979947],[994,944,.3701807952606593],[994,945,.22297333198451888],[994,946,.06976592160365215],[995,944,.015392306252147629],[995,945,.17030051412165803],[995,946,.33152253946088156],[995,947,.31147369956054877],[995,948,.1509473916728322],[996,947,.087196881644584],[996,948,.2369586950063475],[996,949,.376718339613223],[996,950,.2345765114615184],[996,951,.08521591343298078],[997,949,.0011357385555340561],[997,950,.15263475001807864],[997,951,.311827742306229],[997,952,.32860504822914505],[997,953,.16942021655341175],[997,954,.016626147439510436],[998,952,.07024774813594223],[998,953,.2212622403680772],[998,954,.36621398307130515],[998,955,.2523140266095425],[998,956,.10329850546808812],[999,955,.13345393361930616],[999,956,.2868146645965228],[999,957,.3438149621043634],[999,958,.19052159754051476],[999,959,.038598535306774456],[1e3,957,.04874340776161587],[1e3,958,.20027433884645776],[1e3,959,.35045072214288214],[1e3,960,.2752172040116266],[1e3,961,.1246081801436533],[1001,960,.11153410463061227],[1001,961,.25968030157128735],[1001,962,.3589611456155988],[1001,963,.21376355164890676],[1001,964,.06462574300561937],[1002,962,.024112239164856285],[1002,963,.1744379670887302],[1002,964,.32884307142135794],[1002,965,.3038963549633426],[1002,966,.14989396525089382],[1002,967,.002787631885767016],[1003,965,.08652179776851913],[1003,966,.23158274748299973],[1003,967,.37014802862444746],[1003,968,.23660182809114255],[1003,969,.09233857620429504],[1004,968,.14320871996140178],[1004,969,.2949268298641504],[1004,970,.33370967770704096],[1004,971,.1821563205430922],[1004,972,.03341416685633306],[1005,970,.05691996613850173],[1005,971,.2048164607341282],[1005,972,.34996958396767003],[1005,973,.26846185022737096],[1005,974,.12203613352843197],[1006,973,.11270360292617912],[1006,974,.2573174820670815],[1006,975,.35551075517876596],[1006,976,.21342439841857963],[1006,977,.06808655521031844],[1007,975,.02300584415020569],[1007,976,.1693741701851818],[1007,977,.31909197071849676],[1007,978,.3064750144925845],[1007,979,.1569666027177789],[1007,980,.01237576860780718],[1008,978,.07918600624195261],[1008,979,.22224585329482],[1008,980,.36060022658704466],[1008,981,.24542280629144228],[1008,982,.10372340547250797],[1009,981,.13025049048804305],[1009,982,.2755544084078468],[1009,983,.34173289952302016],[1009,984,.19757209548510224],[1009,985,.052414383405106256],[1010,983,.04055057399599624],[1010,984,.18602861646793578],[1010,985,.3325126760154172],[1010,986,.28836807114447566],[1010,987,.1417402962688462],[1010,988,.0007268068329768394],[1011,986,.0921230324039655],[1011,987,.23132424535108578],[1011,988,.3651955312519228],[1011,989,.23251096307120944],[1011,990,.09383068210249161],[1012,989,.1395300348660987],[1012,990,.2846106560560243],[1012,991,.33325384799782276],[1012,992,.18901293891606955],[1012,993,.045352651706964286],[1013,991,.0492531143811913],[1013,992,.19272260635298227],[1013,993,.33561458168523745],[1013,994,.27986377343343843],[1013,995,.13637852619084528],[1014,994,.09650852938196901],[1014,995,.2338020594070448],[1014,996,.36193613166585775],[1014,997,.22898317334607854],[1014,998,.09193468643195023],[1015,996,.002457496874436509],[1015,997,.14093777570167637],[1015,998,.28368384860268375],[1015,999,.33027760738271117],[1015,1e3,.1884400273628213],[1015,1001,.046968846655108074],[1016,999,.04899295849310335],[1016,1e3,.19034003312195327],[1016,1001,.3313219755276299],[1016,1002,.28105052006571385],[1016,1003,.13948843868730657],[1016,1004,.0023949943264103815],[1017,1002,.09296476581718328],[1017,1003,.22852898102309294],[1017,1004,.35981389159869226],[1017,1005,.23289594529521537],[1017,1006,.09793041579114306],[1018,1005,.13381394889325862],[1018,1006,.27358691892030107],[1018,1007,.33460745416509985],[1018,1008,.1955825556102765],[1018,1009,.05665143264068217],[1019,1007,.040361378819567154],[1019,1008,.17925977203170015],[1019,1009,.31806447498945245],[1019,1010,.2909077306146313],[1019,1011,.1516962543781077],[1019,1012,.01525050343287846],[1020,1010,.08150854362929537],[1020,1011,.21698349128246774],[1020,1012,.3497669475500838],[1020,1013,.24583808157633427],[1020,1014,.11136370502634059],[1021,1013,.1194990282921764],[1021,1014,.25479878825131264],[1021,1015,.34346022054644576],[1021,1016,.20933239464254857],[1021,1017,.07400664151417581],[1022,1015,.023670383811016393],[1022,1016,.1594303860158249],[1022,1017,.29640289279632487],[1022,1018,.3088876485347881],[1022,1019,.17249814489158258],[1022,1020,.03643709112995095],[1023,1018,.062217701784737935],[1023,1019,.19815982330648652],[1023,1020,.3337745723213922],[1023,1021,.3700921432339217],[1023,1022,.3700921432339217]];function u(){const e=i.buffer([1024,1024]);for(let t=0;t<c.length;t++){const n=c[t];e.set(n[2],n[0],n[1])}return e.toTensor()}function l(e,t,n){return i.div(i.sub(e,n),t)}async function h(e){return function(e,t){const n=e.length,i=e[0].length/2,r=t.winLength||i,o=t.hopLength||Math.floor(r/4),s=t.center||!1;let c=Object(a.b)(r);for(let e=0;e<c.length;e++)c[e]=c[e]/1.5;c=Object(a.h)(c,i);const u=i+o*(n-1),l=new Float32Array(u);for(let t=0;t<n;t++){const n=t*o;let r=d(e[t]);r=Object(a.a)(r,c),r=m(r,l.slice(n,n+i)),l.set(r,n)}let h=0,p=u;s?(h=i/2,p=l.length-i/2):(h=u-64e3,p=l.length-h);return l.slice(h,p)}(e,{nFFt:2048,winLength:2048,hopLength:512,sampleRate:16e3,center:!1})}async function p(e){const t=i.tidy(()=>{const t=i.slice(e,[0,0,0,0],[1,-1,-1,1]).reshape([1,128,1024]),n=(r=t,i.tidy(()=>{const e=u().expandDims(0),t=l(r,.0661371661726,.113718730221),n=i.exp(t),o=i.matMul(n,e);return i.sqrt(o)}));var r;const o=function(e){return i.tidy(()=>{const t=u().expandDims(0),n=l(e,.8,0),r=i.cumsum(i.mul(n,Math.PI),1);return i.matMul(r,t)})}(i.slice(e,[0,0,0,1],[1,-1,-1,1]).reshape([1,128,1024]));let s=n.mul(i.cos(o));const a=i.reverse(s.slice([0,0,0],[1,128,1023]),2);s=i.concat([s,a],2);let c=n.mul(i.sin(o));const h=i.reverse(c.slice([0,0,0],[1,128,1023]),2);return c=i.concat([c,i.mul(h,-1)],2),[s,c]}),n=await function(e,t){const n=i.tidy(()=>{let n=i.concat([e,t],0).expandDims(3);n=i.pad(n,[[0,0],[0,0],[1,0],[0,0]]);return i.batchToSpaceND(n,[1,2],[[0,0],[0,0]]).reshape([128,4096])}),r=n.dataSync(),o=[];for(let e=0;e<128;e++)o[e]=r.slice(4096*e,4096*(e+1));return n.dispose(),o}(t[0],t[1]),r=await h(n);return t.forEach(e=>e.dispose()),r}function d(e){const t=e.length/2,n=new s(t),i=n.createComplexArray();n.inverseTransform(i,e);return n.fromComplexArray(i)}function m(e,t){if(e.length!==t.length)return console.error(`Array lengths must be equal to add: ${e.length}, ${e.length}`),null;const n=new Float32Array(e.length);for(let i=0;i<e.length;i++)n[i]=e[i]+t[i];return n}class f extends i.layers.Layer{constructor(e=1e-8,t={}){super(t),this.epsilon=e,this.layerConfig=t,this.supportsMasking=!0}computeOutputShape(e){return[e[0],e[1],e[2],e[3]]}call(e){return i.tidy(()=>{let t=e;Array.isArray(t)&&(t=t[0]);const n=i.mean(i.square(t),[3],!0);return i.mul(t,i.rsqrt(i.add(n,this.epsilon)))})}getClassName(){return"PixelNorm"}}function g(e=1e-8,t={}){return new f(e,t)}class S extends i.layers.Layer{constructor(e=2,t=16,n={}){super(n),this.kernelH=e,this.kernelW=t,this.layerConfig=n,this.supportsMasking=!0}computeOutputShape(e){return[e[0],2*(this.kernelH-1)+e[1],2*(this.kernelW-1)+e[2],e[3]]}call(e){let t=e;Array.isArray(t)&&(t=t[0]);const n=this.kernelH-1,r=this.kernelW-1;return i.pad(t,[[0,0],[n,n],[r,r],[0,0]])}getClassName(){return"InitialPad"}}class y extends i.layers.Layer{constructor(e=2){super({}),this.scale=e,this.supportsMasking=!0}computeOutputShape(e){return[e[0],this.scale*e[1],this.scale*e[2],e[3]]}call(e){return i.tidy(()=>{let t=e;Array.isArray(t)&&(t=t[0]);const n=i.tile(t,[this.scale**2,1,1,1]);return i.batchToSpaceND(n,[this.scale,this.scale],[[0,0],[0,0]])})}getClassName(){return"BoxUpscale"}}function w(e=2){return new y(e)}class b{constructor(e){this.nn=i.sequential(),this.nLatents=256,this.nPitches=61,this.minMidiPitch=24,this.maxMidiPitch=84,this.midiPitches=this.maxMidiPitch-this.minMidiPitch+1,this.checkpointURL=e}async initialize(){const e=o.d.now(),t=await Object(o.a)(this.checkpointURL+"/weights_manifest.json").then(e=>e.json()).then(e=>i.io.loadWeights(e,this.checkpointURL));i.tidy(()=>{for(const e in t)if(e.includes("kernel")){const n=t[e].shape[0]*t[e].shape[1]*t[e].shape[2],r=t[e];t[e]=i.mul(r,i.sqrt(2/n)),r.dispose()}this.build(t),this.initialized=!0,r.logWithDuration("Initialized model",e,"GANSynth")}),Object.keys(t).map(e=>t[e].dispose())}dispose(){this.initialized&&(this.nn.dispose(),this.initialized=!1)}isInitialized(){return this.initialized}build(e){i.tidy(()=>{const t={filters:256,kernelSize:[2,16],strides:[1,1],activation:"linear",useBias:!0,padding:"valid",dilationRate:[1,1],trainable:!1},n={inputShape:[1,1,this.nLatents+this.nPitches]};this.nn.add(g(1e-8,n)),this.nn.add(function(e=2,t=16,n={}){return new S(e,t,n)}(2,16)),this.nn.add(i.layers.conv2d(t)),this.nn.add(i.layers.leakyReLU({alpha:.2})),this.nn.add(g()),t.padding="same",t.kernelSize=[3,3],this.nn.add(i.layers.conv2d(t)),this.nn.add(i.layers.leakyReLU({alpha:.2})),this.nn.add(g());const r=[256,256,256,128,64,32];for(let e=0;e<r.length;e++)this.nn.add(w(2)),t.filters=r[e],this.nn.add(i.layers.conv2d(t)),this.nn.add(i.layers.leakyReLU({alpha:.2})),this.nn.add(g()),this.nn.add(i.layers.conv2d(t)),this.nn.add(i.layers.leakyReLU({alpha:.2})),this.nn.add(g());t.filters=2,t.kernelSize=[1,1],t.activation="tanh",this.nn.add(i.layers.conv2d(t)),this.setWeights(e)})}setWeights(e){function t(t){const n=e[t];if(void 0===n)throw Error("Variable not found: "+t);return n}const n="Generator/progressive_gan_generator/progressive_gan_block_",i=[t(n+"1/conv0/conv2d/kernel/ExponentialMovingAverage"),t(n+"1/conv0/bias/ExponentialMovingAverage"),t(n+"1/conv1/conv2d/kernel/ExponentialMovingAverage"),t(n+"1/conv1/bias/ExponentialMovingAverage"),t(n+"2/conv0/conv2d/kernel/ExponentialMovingAverage"),t(n+"2/conv0/bias/ExponentialMovingAverage"),t(n+"2/conv1/conv2d/kernel/ExponentialMovingAverage"),t(n+"2/conv1/bias/ExponentialMovingAverage"),t(n+"3/conv0/conv2d/kernel/ExponentialMovingAverage"),t(n+"3/conv0/bias/ExponentialMovingAverage"),t(n+"3/conv1/conv2d/kernel/ExponentialMovingAverage"),t(n+"3/conv1/bias/ExponentialMovingAverage"),t(n+"4/conv0/conv2d/kernel/ExponentialMovingAverage"),t(n+"4/conv0/bias/ExponentialMovingAverage"),t(n+"4/conv1/conv2d/kernel/ExponentialMovingAverage"),t(n+"4/conv1/bias/ExponentialMovingAverage"),t(n+"5/conv0/conv2d/kernel/ExponentialMovingAverage"),t(n+"5/conv0/bias/ExponentialMovingAverage"),t(n+"5/conv1/conv2d/kernel/ExponentialMovingAverage"),t(n+"5/conv1/bias/ExponentialMovingAverage"),t(n+"6/conv0/conv2d/kernel/ExponentialMovingAverage"),t(n+"6/conv0/bias/ExponentialMovingAverage"),t(n+"6/conv1/conv2d/kernel/ExponentialMovingAverage"),t(n+"6/conv1/bias/ExponentialMovingAverage"),t(n+"7/conv0/conv2d/kernel/ExponentialMovingAverage"),t(n+"7/conv0/bias/ExponentialMovingAverage"),t(n+"7/conv1/conv2d/kernel/ExponentialMovingAverage"),t(n+"7/conv1/bias/ExponentialMovingAverage"),t(n+"7/to_rgb/conv2d/kernel/ExponentialMovingAverage"),t(n+"7/to_rgb/bias/ExponentialMovingAverage")];this.nn.setWeights(i)}predict(e,t){return this.nn.predict(e,{batchSize:t})}randomSample(e){return i.tidy(()=>{const t=i.randomNormal([1,this.nLatents],0,1,"float32"),n=i.tensor1d([e-this.minMidiPitch],"int32"),r=i.oneHot(n,this.midiPitches),o=i.concat([t,r],1).expandDims(1).expandDims(1);return this.predict(o,1)})}specgramsToAudio(e){return p(e)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"OnsetsAndFrames",(function(){return u}));var i=n(0),r=n(8),o=n(4),s=n(6);var a=n(3);function c(e,t,n){return 1===e.shape[0]?e:i.tidy(()=>{const r=e.slice([0,0],[1,t]);let o=n%t;o<=3&&(o+=t);const s=e.slice([e.shape[0]-1,e.shape[1]-o],[-1,-1]);let a=[r,s];if(e.shape[0]>2){const n=e.shape[0]-2;a=[r,e.slice([1,3],[n,t]).as3D(1,n*t,-1),s]}return i.concat(a,1)})}class u{constructor(e,t=250){this.checkpointURL=e,this.chunkLength=t}async initialize(){this.dispose();const e=s.d.now(),t=await Object(s.a)(this.checkpointURL+"/weights_manifest.json").then(e=>e.json()).then(e=>i.io.loadWeights(e,this.checkpointURL));this.build(t),Object.keys(t).map(e=>t[e].dispose()),this.initialized=!0,o.logWithDuration("Initialized model",e,"O&F")}dispose(){this.initialized&&(this.onsetsCnn.dispose(),this.onsetsRnn.dispose(),this.activationCnn.dispose(),this.frameRnn.dispose(),this.velocityCnn.dispose(),this.initialized=!1)}isInitialized(){return this.initialized}async transcribeFromMelSpec(e,t=4){this.isInitialized()||this.initialize();const n=s.d.now();o.log("Computing onsets, frames, and velocities...","O&F",20);const[r,c,u]=i.tidy(()=>{const n=function(e,t){let n=Math.ceil(e.length/t),r=e.length%t,o=0;if(n>1&&r>0&&r<=3&&(n-=1,o=r,r=0),1===n)return i.tensor2d(e).expandDims(0);const s=t+6,a=i.tensor2d(e.slice(0,s)).expandDims(0),c=i.tensor2d(e.slice(e.length-s)).expandDims(0);if(2===n)return i.concat([a,c],0);let u;u=r?i.tensor2d(e).pad([[0,t-r],[0,0]]).as3D(n,t,-1):i.tensor2d(e.slice(0,e.length-o)).as3D(n,t,-1);const l=i.slice(u,[0,t-3],[n-2,-1]),h=i.slice(u,[2,0],[-1,3]),p=i.concat([l,u.slice(1,n-2),h],1);return i.concat([a,p,c],0)}(e,this.chunkLength);return this.processBatches(n,this.chunkLength,e.length,t)});o.log("Converting to NoteSequence...","O&F",20);const l=async function(e,t,n,r=.5,o=.5){const s=a.a.create(),c=new Uint32Array(88),u=new Uint8Array(88);let l=new Uint8Array(88);function h(e,t){s.notes.push(a.a.Note.create({pitch:e+21,startTime:.032*(c[e]-1),endTime:.032*t,velocity:u[e]})),c[e]=0}function p(e,t,n){c[e]?l[e]||(h(e,t),c[e]=t+1,u[e]=n):(c[e]=t+1,u[e]=n)}const d=i.tidy(()=>{let s=i.greater(t,r),a=i.greater(e,o);return s=s.pad([[0,1],[0,0]]),a=a.pad([[0,1],[0,0]]),n=n.pad([[0,1],[0,0]]),a=i.logicalOr(a,s),[a,s,n]}),[m,f,g]=await Promise.all(d.map(e=>e.data()));d.forEach(e=>e.dispose());const S=e.shape[0];for(let e=0;e<S+1;++e){for(let t=0;t<88;++t){const n=88*e+t;f[n]?p(t,e,g[n]):!m[n]&&c[t]&&h(t,e)}l=f.slice(88*e,88*(e+1))}return s.totalTime=.032*S,s}(r,c,u);return l.then(()=>{r.dispose(),c.dispose(),u.dispose(),o.logWithDuration("Transcribed from mel spec",n,"O&F")}),l}async transcribeFromAudioBuffer(e,t=4){const n=s.d.now(),i=async function(e){const t=await Object(r.j)(e);return Object(r.i)(Object(r.f)(t,{sampleRate:16e3,hopLength:512,nMels:229,nFft:2048,fMin:30}))}(e);return i.then(()=>o.logWithDuration("Converted audio to mel spec",n,"O&F",20)),i.then(e=>this.transcribeFromMelSpec(e.map(e=>Array.from(e),t)))}async transcribeFromAudioFile(e){const t=await Object(r.d)(e);return this.transcribeFromAudioBuffer(t)}async transcribeFromAudioURL(e){const t=await Object(r.e)(e);return this.transcribeFromAudioBuffer(t)}processBatches(e,t,n,r){const o=e=>[this.onsetsCnn.predict(e,r),this.activationCnn.predict(e,r),this.velocityCnn.predict(e,r)];let s,a,u;if(1===e.shape[0])[s,a,u]=o(e.expandDims(-1));else{const i=o(e.expandDims(-1)),r=[];for(let e=0;e<3;++e)r.push(c(i[e],t,n));[s,a,u]=r}const l=this.onsetsRnn.predict(s,this.chunkLength);s.dispose();const h=i.concat3d([l,a],-1);a.dispose();const p=this.frameRnn.predict(h,this.chunkLength),d=i.clipByValue(u,0,1).mul(i.scalar(80)).add(i.scalar(10)).toInt();return u.dispose(),[p.squeeze(),l.squeeze(),d.squeeze()]}build(e){i.tidy(()=>{this.onsetsCnn=new l,this.onsetsCnn.setWeights(e,"onsets"),this.onsetsRnn=new h([null,this.onsetsCnn.outputShape[2]]),this.onsetsRnn.setWeights(e,"onsets","onset_probs"),this.activationCnn=new l("sigmoid"),this.activationCnn.setWeights(e,"frame","activation_probs"),this.frameRnn=new h([null,176]),this.frameRnn.setWeights(e,"frame","frame_probs"),this.velocityCnn=new l("linear"),this.velocityCnn.setWeights(e,"velocity","onset_velocities")})}}class l{constructor(e){this.nn=i.sequential();const t={filters:48,kernelSize:[3,3],activation:"linear",useBias:!1,padding:"same",dilationRate:[1,1],inputShape:[null,229,1],trainable:!1},n={scale:!1,trainable:!1};this.nn.add(i.layers.conv2d(t)),this.nn.add(i.layers.batchNormalization(n)),this.nn.add(i.layers.activation({activation:"relu"})),t.inputShape=null,this.nn.add(i.layers.conv2d(t)),this.nn.add(i.layers.batchNormalization(n)),this.nn.add(i.layers.activation({activation:"relu"})),this.nn.add(i.layers.maxPooling2d({poolSize:[1,2],strides:[1,2]})),t.filters=96,this.nn.add(i.layers.conv2d(t)),this.nn.add(i.layers.batchNormalization(n)),this.nn.add(i.layers.activation({activation:"relu"})),this.nn.add(i.layers.maxPooling2d({poolSize:[1,2],strides:[1,2]}));const r=this.nn.outputShape;this.nn.add(i.layers.reshape({targetShape:[r[1],r[2]*r[3]]})),this.nn.add(i.layers.dense({units:768,activation:"relu",trainable:!1})),e&&this.nn.add(i.layers.dense({units:88,activation:e,trainable:!1})),this.outputShape=this.nn.outputShape}dispose(){this.nn.dispose()}predict(e,t){return this.nn.predict(e,{batchSize:t})}setWeights(e,t,n){function i(t){const n=e[t];if(void 0===n)throw Error("Variable not found: "+t);return n}let r=[i(t+"/conv0/weights"),i(t+"/conv0/BatchNorm/beta"),i(t+"/conv0/BatchNorm/moving_mean"),i(t+"/conv0/BatchNorm/moving_variance"),i(t+"/conv1/weights"),i(t+"/conv1/BatchNorm/beta"),i(t+"/conv1/BatchNorm/moving_mean"),i(t+"/conv1/BatchNorm/moving_variance"),i(t+"/conv2/weights"),i(t+"/conv2/BatchNorm/beta"),i(t+"/conv2/BatchNorm/moving_mean"),i(t+"/conv2/BatchNorm/moving_variance"),i(t+"/fc_end/weights"),i(t+"/fc_end/biases")];n&&(r=r.concat([i(`${t}/${n}/weights`),i(`${t}/${n}/biases`)])),this.nn.setWeights(r)}}class h{constructor(e,t=384){this.dense=i.sequential(),this.units=t,this.lstm=function(){const n=i.layers.lstm({inputShape:e,units:t,returnSequences:!0,recurrentActivation:"sigmoid",returnState:!0,kernelInitializer:"zeros",recurrentInitializer:"zeros",biasInitializer:"zeros",trainable:!1}),r=[i.input({shape:e}),i.input({shape:[t]}),i.input({shape:[t]})],o=n.apply(r);return i.model({inputs:r,outputs:o})}(),this.dense.add(i.layers.dense({inputShape:[null,t],units:88,activation:"sigmoid",trainable:!1}))}dispose(){this.lstm.dispose(),this.dense.dispose()}setWeights(e,t,n){function r(t){const n=e[t];if(void 0===n)throw Error("Variable not found: "+t);return n}const o=(e,t=0)=>{const[n,r,o,s]=i.split(e,4,-1);return i.concat([n,o.add(i.scalar(t)),r,s],-1)},s=e=>i.split(o(e),[e.shape[0]-this.units,this.units]),a="cudnn_lstm/rnn/multi_rnn_cell/cell_0/cudnn_compatible_lstm_cell";this.lstm.setWeights(s(r(`${t}/${a}/kernel`)).concat(o(r(`${t}/${a}/bias`),1))),this.dense.setWeights([r(`${t}/${n}/weights`),r(`${t}/${n}/biases`)])}predict(e,t){return i.tidy(()=>this.predictImpl(e,t))}predictImpl(e,t){const n=e.shape[1],r=Math.ceil(n/t);let o=[i.zeros([1,this.units]),i.zeros([1,this.units])];const s=[];for(let n=0;n<r;++n){const i=e.slice([0,n*t],[-1,n<r-1?t:-1]),a=this.lstm.predict([i,o[0],o[1]]);s.push(this.dense.predict(a[0])),o=a.slice(1)}return 1===s.length?s[0]:i.concat3d(s,1)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"Coconet",(function(){return h}));var i=n(7),r=n(6),o=n(4),s=n(5),a=n(3);const c=/iPad|iPhone|iPod/.test(navigator.userAgent);const u={useSoftmaxLoss:!0,batchNormVarianceEpsilon:1e-7,numInstruments:4,numFilters:128,numLayers:33,numRegularConvLayers:0,dilation:[[1,1],[2,2],[4,4],[8,8],[16,16],[16,32],[1,1],[2,2],[4,4],[8,8],[16,16],[16,32],[1,1],[2,2],[4,4],[8,8],[16,16],[16,32],[1,1],[2,2],[4,4],[8,8],[16,16],[16,32],[1,1],[2,2],[4,4],[8,8],[16,16],[16,32]],layers:null,interleaveSplitEveryNLayers:16,numPointwiseSplits:4};class l{constructor(e,t){this.residualPeriod=2,this.outputForResidual=null,this.residualCounter=-1,this.rawVars=null,this.spec=e,this.rawVars=t}dispose(){null!==this.rawVars&&i.dispose(this.rawVars),this.outputForResidual&&this.outputForResidual.dispose()}predictFromPianoroll(e,t){return i.tidy(()=>{let n=this.getConvnetInput(e,t);const i=this.spec.layers.length;for(let e=0;e<i;e++){this.residualCounter+=1,this.residualSave(n);let t=null;this.spec.interleaveSplitEveryNLayers&&e>0&&e<i-2&&e%(this.spec.interleaveSplitEveryNLayers+1)==0&&(t=this.spec.numPointwiseSplits),n=this.applyConvolution(n,this.spec.layers[e],e,e>=this.spec.numRegularConvLayers,t),n=this.applyResidual(n,0===e,e===i-1,e),n=this.applyActivation(n,this.spec.layers[e],e),n=this.applyPooling(n,this.spec.layers[e],e)}return this.computePredictions(n)})}computePredictions(e){return this.spec.useSoftmaxLoss?e.transpose([0,1,3,2]).softmax().transpose([0,1,3,2]):e.sigmoid()}residualReset(){this.outputForResidual=null,this.residualCounter=0}residualSave(e){this.residualCounter%this.residualPeriod==1&&(this.outputForResidual=e)}applyResidual(e,t,n,i){return null==this.outputForResidual?e:this.outputForResidual.shape[this.outputForResidual.shape.length-1]!==e.shape[e.shape.length-1]?(this.residualReset(),e):(this.residualCounter%this.residualPeriod==0&&(t||n||(e=e.add(this.outputForResidual))),e)}getVar(e,t){const n=`model/conv${t}/${e}`;return this.rawVars[n]}getSepConvVar(e,t){const n=`model/conv${t}/SeparableConv2d/${e}`;return this.rawVars[n]}getPointwiseSplitVar(e,t,n){const i=`model/conv${t}/split_${t}_${n}/${e}`;return this.rawVars[i]}applyConvolution(e,t,n,r,o){if(null==t.filters)return e;const s=t.filters,a=t.convStride||1,c=t.convPad?t.convPad.toLowerCase():"same";let u=null;if(r){const r=this.getSepConvVar("depthwise_weights",n);if(o){u=i.depthwiseConv2d(e,r,[a,a],c,"NHWC",t.dilation);const l=i.split(u,o,u.rank-1),h=[];for(let e=0;e<o;e++){const t=s[3]/o,r=this.getPointwiseSplitVar("kernel",n,e),a=this.getPointwiseSplitVar("bias",n,e),c=i.matMul(l[e].reshape([-1,t]),r,!1,!1),u=i.add(c,a);h.push(u.reshape([l[e].shape[0],l[e].shape[1],l[e].shape[2],t]))}u=i.concat(h,u.rank-1)}else{const o=this.getSepConvVar("pointwise_weights",n),s=this.getSepConvVar("biases",n);u=i.separableConv2d(e,r,o,[a,a],c,t.dilation,"NHWC").add(s)}}else{const r=this.getVar("weights",n),o=t.convStride||1,s=t.convPad?t.convPad.toLowerCase():"same";u=i.conv2d(e,r,[o,o],s,"NHWC",[1,1])}return this.applyBatchnorm(u,n)}applyBatchnorm(e,t){const n=this.getVar("gamma",t),r=this.getVar("beta",t),o=this.getVar("popmean",t),s=this.getVar("popvariance",t);if(c){const t=s.arraySync()[0][0][0],a=i.tensor(t.map(e=>Math.sqrt(e+this.spec.batchNormVarianceEpsilon)));return e.sub(o).mul(n.div(a)).add(r)}return i.batchNorm(e,i.squeeze(o),i.squeeze(s),i.squeeze(r),i.squeeze(n),this.spec.batchNormVarianceEpsilon)}applyActivation(e,t,n){return"identity"===t.activation?e:e.relu()}applyPooling(e,t,n){if(null==t.pooling)return e;const r=t.pooling,o=t.poolPad?t.poolPad.toLowerCase():"same";return i.maxPool(e,[r[0],r[1]],[r[0],r[1]],o)}getConvnetInput(e,t){return e=i.scalar(1,"float32").sub(t).mul(e),t=i.scalar(1,"float32").sub(t),e.concat(t,3)}}class h{constructor(e){this.spec=null,this.initialized=!1,this.checkpointURL=e,this.spec=u}async initialize(){this.dispose();const e=r.d.now();this.instantiateFromSpec();const t=await Object(r.a)(this.checkpointURL+"/weights_manifest.json").then(e=>e.json()).then(e=>i.io.loadWeights(e,this.checkpointURL));this.convnet=new l(this.spec,t),this.initialized=!0,o.logWithDuration("Initialized model",e,"Coconet")}dispose(){this.convnet&&this.convnet.dispose(),this.initialized=!1}isInitialized(){return this.initialized}instantiateFromSpec(){this.spec.layers=[],this.spec.layers.push({filters:[3,3,2*this.spec.numInstruments,this.spec.numFilters]});for(let e=0;e<this.spec.numLayers-3;e++)this.spec.layers.push({filters:[3,3,this.spec.numFilters,this.spec.numFilters],dilation:this.spec.dilation?this.spec.dilation[e]:null});this.spec.layers.push({filters:[2,2,this.spec.numFilters,this.spec.numFilters]}),this.spec.layers.push({filters:[2,2,this.spec.numFilters,this.spec.numInstruments],activation:"identity"})}async infill(e,t){if(s.assertIsRelativeQuantizedSequence(e),0===e.notes.length)throw new Error(`NoteSequence ${e.id} does not have any notes to infill.`);const n=e.totalQuantizedSteps||e.notes[e.notes.length-1].quantizedEndStep,r=function(e,t){const n=i.tidy(()=>i.zeros([t,46,4]).arraySync());return e.notes.forEach(i=>{const r=i.pitch-36,s=i.quantizedStartStep,a=i.quantizedEndStep-i.quantizedStartStep,c=i.instrument;if(c<0||c>=4)o.log(`Found invalid voice ${c}. Skipping.`,"Coconet",5);else{if(s+a>t)throw new Error(`NoteSequence ${e.id} has notes that are longer than the sequence's\n          totalQuantizedSteps.`);for(let e=s;e<s+a;e++)n[e][r][c]=1}}),i.tensor([n])}(e,n);let c,u=.99,l=96;t?(l=t.numIterations||l,u=t.temperature||u,c=this.getCompletionMaskFromInput(t.infillMask,r)):c=this.getCompletionMask(r);const h=await this.run(r,l,u,c),p=function(e,t){const n=i.tidy(()=>e.reshape([t,46,4]).arraySync()),r=a.a.create(),o=[];for(let e=0;e<t;e++)for(let t=0;t<46;t++)for(let i=0;i<4;i++){if(1===n[e][t][i]){const n=a.a.Note.create({pitch:t+36,instrument:i,quantizedStartStep:e,quantizedEndStep:e+1});o.push(n)}}return r.notes=o,r.totalQuantizedSteps=o[o.length-1].quantizedEndStep,r.quantizationInfo={stepsPerQuarter:4},r}(h,n);return r.dispose(),h.dispose(),c.dispose(),p}async run(e,t,n,i){return this.gibbs(e,t,n,i)}getCompletionMaskFromInput(e,t){if(e){const n=i.buffer([t.shape[1],4]);for(let t=0;t<e.length;t++)n.set(1,e[t].step,e[t].voice);return i.tidy(()=>n.toTensor().expandDims(1).tile([1,46,1]).expandDims(0))}return this.getCompletionMask(t)}getCompletionMask(e){return i.tidy(()=>{const t=e.sum(2,!0).equal(i.scalar(0,"float32"));return i.cast(t,"float32").add(i.zerosLike(e))})}async gibbs(e,t,n,r){const o=i.scalar(t,"float32");let s=e.clone();for(let e=0;e<t;e++){const t=this.yaoSchedule(e,o),a=this.bernoulliMask(s.shape,t,r);await i.nextFrame();const c=i.tidy(()=>this.convnet.predictFromPianoroll(s,a));await i.nextFrame(),s=i.tidy(()=>{const e=this.samplePredictions(c,n),r=i.where(i.cast(a,"bool"),e,s);return s.dispose(),c.dispose(),a.dispose(),t.dispose(),r}),await i.nextFrame()}return o.dispose(),s}yaoSchedule(e,t){return i.tidy(()=>{const n=i.scalar(.1,"float32"),r=i.scalar(.9,"float32"),o=i.scalar(.7,"float32"),s=r.sub(n).mul(i.scalar(e,"float32")).div(t),a=r.sub(s).div(o);return n.reshape([1]).concat(a.reshape([1])).max()})}bernoulliMask(e,t,n){return i.tidy(()=>{const[r,o,s,a]=e,c=i.tile(i.randomUniform([r,o,1,a],0,1,"float32"),[1,1,s,1]).less(t);return i.cast(c,"float32").mul(n)})}samplePredictions(e,t){return i.tidy(()=>{e=i.pow(e,i.scalar(1/t,"float32"));const n=i.cumsum(e,2,!1,!1),r=n.slice([0,0,n.shape[2]-1,0],[n.shape[0],n.shape[1],1,n.shape[3]]),o=i.randomUniform(r.shape,0,1,"float32").mul(r).less(n).argMax(2);return i.oneHot(o.flatten(),e.shape[2],1,0).reshape([e.shape[0],e.shape[1],e.shape[3],e.shape[2]]).transpose([0,1,3,2])})}}},function(e,t,n){"use strict";n.r(t),n.d(t,"MusicRNN",(function(){return h}));var i=n(0),r=n(23),o=n(14),s=n(15),a=n(6),c=n(4),u=n(5);class l{constructor(e,t,n){this.cells=e,this.attnLength=t,this.attnSize=n}static isWrapped(e){return"rnn/attention_cell_wrapper/kernel"in e}initialize(e){const t="rnn/attention_cell_wrapper/";this.attnInputMatrix=e[t+"kernel"],this.attnInputBias=e[t+"bias"],this.attnW=e[t+"attention/attn_w"],this.attnV=e[t+"attention/attn_v"],this.attnMatrix=e[t+"attention/kernel"],this.attnBias=e[t+"attention/bias"],this.attnOutputMatrix=e[t+"attention_output_projection/kernel"],this.attnOutputBias=e[t+"attention_output_projection/bias"]}initState(){return{attention:i.zeros([this.attnSize]),attentionState:i.zeros([1,this.attnSize*this.attnLength])}}call(e,t,n,r){const o=i.concat([e,r.attention.as2D(1,-1)],1),s=i.add(i.matMul(o,this.attnInputMatrix),this.attnInputBias.as2D(1,-1));[t,n]=i.multiRNNCell(this.cells,s,t,n);const a=i.reshape(r.attentionState,[-1,this.attnLength,1,this.attnSize]),c=i.conv2d(a,this.attnW,[1,1],"same"),u=[];for(let e=0;e<t.length;e++)u.push(t[e]),u.push(n[e]);const l=i.concat(u,1),h=i.matMul(l,this.attnMatrix).reshape([-1,1,1,this.attnSize]),p=i.sum(i.mul(this.attnV,i.tanh(i.add(c,h))),[2,3]),d=i.softmax(p),m=i.sum(i.mul(i.reshape(d,[-1,this.attnLength,1,1]),a),[1,2]).reshape([-1,this.attnSize]),f=r.attentionState.reshape([-1,this.attnLength,this.attnSize]),g=i.slice(f,[0,1,0],[f.shape[0],f.shape[1]-1,f.shape[2]]),S=i.add(i.matMul(i.concat([n[2],m],1),this.attnOutputMatrix),this.attnOutputBias),y=m.flatten(),w=i.concat([g,S.as3D(S.shape[0],1,S.shape[1])],1).reshape([-1,this.attnLength*this.attnSize]);return{output:S,c:t,h:n,attentionState:{attention:y,attentionState:w}}}}class h{constructor(e,t){this.checkpointURL=e,this.spec=t,this.initialized=!1,this.rawVars={},this.biasShapes=[],this.lstmCells=[]}isInitialized(){return this.initialized}instantiateFromSpec(){this.dataConverter=s.converterFromSpec(this.spec.dataConverter),this.attentionLength=this.spec.attentionLength,this.chordEncoder=this.spec.chordEncoder?o.chordEncoderFromType(this.spec.chordEncoder):void 0,this.auxInputs=this.spec.auxInputs?this.spec.auxInputs.map(e=>r.auxiliaryInputFromSpec(e)):void 0}async initialize(){this.dispose();const e=a.d.now();this.spec||await Object(a.a)(this.checkpointURL+"/config.json").then(e=>e.json()).then(e=>{if("MusicRNN"!==e.type)throw new Error("Attempted to instantiate MusicRNN model with incorrect type:\n                  "+e.type);this.spec=e}),this.instantiateFromSpec();const t=await Object(a.a)(this.checkpointURL+"/weights_manifest.json").then(e=>e.json()).then(e=>i.io.loadWeights(e,this.checkpointURL)),n=l.isWrapped(t),r=n?"rnn/attention_cell_wrapper/":"rnn/";this.forgetBias=i.scalar(1),this.lstmCells.length=0,this.biasShapes.length=0;let o=0;for(;;){const e=r+"multi_rnn_cell/cell_%d/basic_lstm_cell/".replace("%d",o.toString());if(!(e+"kernel"in t))break;this.lstmCells.push((n,r,o)=>i.basicLSTMCell(this.forgetBias,t[e+"kernel"],t[e+"bias"],n,r,o)),this.biasShapes.push(t[e+"bias"].shape[0]),++o}this.lstmFcW=t["fully_connected/weights"],this.lstmFcB=t["fully_connected/biases"],n&&(this.attentionWrapper=new l(this.lstmCells,this.attentionLength,this.biasShapes[0]/4),this.attentionWrapper.initialize(t)),this.rawVars=t,this.initialized=!0,c.logWithDuration("Initialized model",e,"MusicRNN")}dispose(){Object.keys(this.rawVars).forEach(e=>this.rawVars[e].dispose()),this.rawVars={},this.forgetBias&&(this.forgetBias.dispose(),this.forgetBias=void 0),this.initialized=!1}async continueSequence(e,t,n,i){return(await this.continueSequenceImpl(e,t,n,i,!1)).sequence}async continueSequenceAndReturnProbabilities(e,t,n,i){return this.continueSequenceImpl(e,t,n,i,!0)}async continueSequenceImpl(e,t,n,r,o){if(u.assertIsRelativeQuantizedSequence(e),this.chordEncoder&&!r)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&r)throw new Error("Unexpected chord progression provided.");this.initialized||await this.initialize();const s=a.d.now(),l=i.tidy(()=>{const s=this.dataConverter.toTensor(e),a=s.shape[0],c=s.shape[1],u=this.chordEncoder?this.chordEncoder.encodeProgression(r,a+t):void 0,l=this.auxInputs?i.concat(this.auxInputs.map(e=>e.getTensors(a+t)),1):void 0,h=this.sampleRnn(s,t,n,u,l,o),p=h.samples;return{samples:i.stack(p).as2D(p.length,c),probs:h.probs}}),h=await l,p=this.dataConverter.toNoteSequence(h.samples,e.quantizationInfo.stepsPerQuarter),d=[];if(o)for(let e=0;e<h.probs.length;e++)d.push(await h.probs[e].data()),h.probs[e].dispose();return l.samples.dispose(),p.then(()=>c.logWithDuration("Continuation completed",s,"MusicRNN",20)),{sequence:p,probs:d}}sampleRnn(e,t,n,r,o,s){const a=e.shape[0],c=e.shape[1];let u=[],l=[];for(let e=0;e<this.biasShapes.length;e++)u.push(i.zeros([1,this.biasShapes[e]/4])),l.push(i.zeros([1,this.biasShapes[e]/4]));let h,p=this.attentionWrapper?this.attentionWrapper.initState():null;e=e.toFloat();const d=[],m=[],f=i.split(e.toFloat(),a),g=r?i.split(r,r.shape[0]):void 0,S=o?i.split(o,o.shape[0]):void 0;for(let e=0;e<a+t;e++){let r;if(e<a)r=f[e];else{let e,t=h.matMul(this.lstmFcW).add(this.lstmFcB).as1D();n?(t=t.div(i.scalar(n)),e=i.multinomial(t,1).as1D()):e=t.argMax().as1D(),s&&m.push(i.softmax(t)),r=i.oneHot(e,c).toFloat(),d.push(r.as1D())}if(e===a+t-1)break;const o=[];if(g&&o.push(g[e+1]),o.push(r),S&&o.push(S[e]),r=i.concat(o,1),this.attentionWrapper){const e=this.attentionWrapper.call(r,u,l,p);u=e.c,l=e.h,p=e.attentionState,h=e.output}else[u,l]=i.multiRNNCell(this.lstmCells,r,u,l),h=l[l.length-1]}return{samples:d,probs:m}}}},function(e,t,n){"use strict";n.r(t),n.d(t,"MidiMe",(function(){return a})),n.d(t,"Decoder",(function(){return y})),n.d(t,"Encoder",(function(){return d})),n.d(t,"MusicVAE",(function(){return A}));var i=n(0),r=n(4),o=n(6);class s extends i.layers.Layer{constructor(){super({})}computeOutputShape(e){return e[0]}call(e){return i.tidy(()=>{const[t,n]=e;return i.add(i.mul(i.randomNormal(n.shape),n),t)})}getClassName(){return"SamplingLayer"}}class a{constructor(e={}){this.trained=!1,this.initialized=!1,this.config={encoder_layers:e.encoder_layers||[1024,256,64],decoder_layers:e.decoder_layers||[64,256,1024],input_size:e.input_size||256,latent_size:e.latent_size||4,beta:e.beta||1,epochs:e.epochs||10}}dispose(){this.initialized&&(this.encoder.dispose(),this.decoder.dispose(),this.vae.dispose(),this.initialized=!1)}initialize(){this.dispose();const e=o.d.now(),t=i.input({shape:[this.config.input_size]});this.encoder=this.getEncoder(t);const[n,,]=this.encoder.apply(t);this.decoder=this.getDecoder(n.shape.slice(1));const s=this.decoder.apply(n);this.vae=i.model({inputs:t,outputs:s,name:"vae"}),this.initialized=!0,r.logWithDuration("Initialized model",e,"MidiMe")}async train(e,t){const n=o.d.now();this.trained=!1;let s=.001;!1===i.ENV.get("WEBGL_RENDER_FLOAT32_ENABLED")&&!1===i.ENV.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&1===i.ENV.get("WEBGL_VERSION")&&(s=5e-5);const a=i.train.adam(s);for(let n=0;n<this.config.epochs;n++)await i.nextFrame(),await a.minimize(()=>i.tidy(()=>{const[,i,r]=this.encoder.predict(e),o=this.vae.predict(e),s=this.loss(i,r,o,e);return t&&t(n,{y:o,total:s.totalLoss.arraySync(),losses:[s.reconLoss.arraySync(),s.latentLoss.arraySync()]}),s.totalLoss})),await i.nextFrame();r.logWithDuration("Training finished",n,"MidiMe"),this.trained=!0,a.dispose()}async sample(e=1){return this.initialized||await this.initialize(),i.tidy(()=>{const t=i.randomNormal([e,this.config.latent_size]);return this.decoder.predict(t)})}async decode(e){return this.initialized||await this.initialize(),this.decoder.predict(e)}async encode(e){this.initialized||await this.initialize();const[t,,]=this.encoder.predict(e);return t}predict(e){return this.vae.predict(e)}getEncoder(e){let t=e;for(let e=0;e<this.config.encoder_layers.length;e++)t=i.layers.dense({units:this.config.encoder_layers[e],activation:"relu"}).apply(t);const n=this.getAffineLayers(t,this.config.latent_size,e,!1),r=this.getAffineLayers(t,this.config.latent_size,e,!0),o=(new s).apply([n,r]);return i.model({inputs:e,outputs:[o,n,r],name:"encoder"})}getDecoder(e){const t=i.input({shape:e});let n=t;for(let e=0;e<this.config.decoder_layers.length;e++)n=i.layers.dense({units:this.config.decoder_layers[e],activation:"relu"}).apply(n);const r=this.getAffineLayers(n,this.config.input_size,t,!1);return i.model({inputs:t,outputs:r,name:"decoder"})}loss(e,t,n,r){return i.tidy(()=>{const o=this.klLoss(e,t),s=this.reconstructionLoss(r,n);return{latentLoss:o,reconLoss:s,totalLoss:i.add(s,i.mul(o,this.config.beta))}})}reconstructionLoss(e,t){return i.tidy(()=>{const n=i.pow(i.sub(e,t),2),r=i.div(n,i.mul(2,i.pow(i.ones([1]),2)));return i.mean(i.sum(r,-1))})}klLoss(e,t){return i.tidy(()=>{const n=i.pow(e,2),r=i.pow(t,2),o=i.add(1,i.log(r)),s=i.add(n,r),a=i.sub(o,s),c=i.div(i.mean(i.sum(a,-1)),2);return i.mul(-1,c)})}getAffineLayers(e,t,n,r){const o=i.layers.dense({units:t}).apply(e);return r?i.layers.activation({activation:"softplus"}).apply(o):o}}var c=n(14),u=n(1),l=n(15);class h{constructor(e,t){if(void 0===e)throw Error("`kernel` is undefined.");if(void 0===t)throw Error("`bias` is undefined.");this.kernel=e,this.bias=t}}function p(e,t){return t.matMul(e.kernel).add(e.bias)}class d{}class m{constructor(e,t){this.lstmFwVars=e,this.lstmBwVars=t}process(e){return i.tidy(()=>[this.singleDirection(e,!0),this.singleDirection(e,!1)])}singleDirection(e,t){const n=e.shape[0],r=e.shape[1],o=t?this.lstmFwVars:this.lstmBwVars;let s=[i.zeros([n,o.bias.shape[0]/4]),i.zeros([n,o.bias.shape[0]/4])];const a=i.scalar(1),c=(e,t)=>i.basicLSTMCell(a,o.kernel,o.bias,e,t[0],t[1]),u=i.split(e.toFloat(),r,1),l=[];for(const e of t?u:u.reverse())s=c(e.squeeze([1]),s),l.push(s[1]);return t?l:l.reverse()}}class f extends d{constructor(e,t,n){super(),this.bidirectionalLstm=new m(e,t),this.muVars=n,this.zDims=n?this.muVars.bias.shape[0]:null}encode(e,t){if(t)throw new Error("Variable-length segments not supported in flat encoder");return i.tidy(()=>{const[t,n]=this.bidirectionalLstm.process(e),r=i.concat([t[t.length-1],n[0]],1);return this.muVars?p(this.muVars,r):r})}}class g extends d{constructor(e,t,n){super(),this.baseEncoders=e,this.numSteps=t,this.muVars=n,this.zDims=this.muVars.bias.shape[0]}encode(e,t){if(t){if(1!==e.shape[0])throw new Error("When using variable-length segments, batch size must be 1.");if(t.length!==this.numSteps[0])throw new Error("Must provide length for all variable-length segments.")}return i.tidy(()=>{let n=e;for(let e=0;e<this.baseEncoders.length;++e){const r=this.numSteps[e],o=i.split(n,r,1),s=[];for(let n=0;n<r;++n)s.push(this.baseEncoders[e].encode(0===e&&t?i.slice3d(o[n],[0,0,0],[1,t[n],-1]):o[n]));n=i.stack(s,1)}return p(this.muVars,n.squeeze([1]))})}}function S(e,t,n){const r=[],o=[],s=[],a=i.split(p(n,e).tanh(),2*t.length,1);for(let e=0;e<t.length;++e){const n=t[e],c=i.scalar(1);r.push((e,t,r)=>i.basicLSTMCell(c,n.kernel,n.bias,e,t,r)),o.push(a[2*e]),s.push(a[2*e+1])}return{cell:r,c:o,h:s}}class y{}class w extends y{constructor(e,t,n,i,r,o){super(),this.lstmCellVars=e,this.zToInitStateVars=t,this.outputProjectVars=n,this.zDims=this.zToInitStateVars.kernel.shape[0],this.outputDims=i||n.bias.shape[0],r&&o&&(this.controlBidirectionalLstm=new m(r,o))}decode(e,t,n,r,o){const s=e.shape[0];return i.tidy(()=>{const a=S(e,this.lstmCellVars,this.zToInitStateVars);let c=o?i.expandDims(o,0):void 0;const u=[];let l=n||i.zeros([s,this.outputDims]);if(this.controlBidirectionalLstm){const[e,t]=this.controlBidirectionalLstm.process(c);c=i.concat([i.stack(e,1),i.stack(t,1)],2)}const h=c?i.split(i.tile(c,[s,1,1]),o.shape[0],1):void 0;for(let n=0;n<t;++n){const t=h?[l,e,i.squeeze(h[n],[1])]:[l,e];[a.c,a.h]=i.multiRNNCell(a.cell,i.concat(t,1),a.c,a.h);const o=p(this.outputProjectVars,a.h[a.h.length-1]);l=this.sample(o,r),u.push(l)}return i.stack(u,1)})}}class b extends w{sample(e,t){const n=e;return(t?i.greaterEqual(i.sigmoid(n.div(i.scalar(t))),i.randomUniform(n.shape)):i.greaterEqual(n,0)).toFloat()}}class v extends w{sample(e,t){const n=e,r=t?i.multinomial(n.div(i.scalar(t)),1).as1D():n.argMax(1).as1D();return i.oneHot(r,this.outputDims).toFloat()}}class N extends w{constructor(e,t,n,i,r,o){super(e,t,n,i.numDims,r,o),this.nade=i}sample(e,t){const[n,r]=i.split(e,[this.nade.numHidden,this.nade.numDims],1);return this.nade.sample(n,r)}}class T extends w{sample(e,t){let[n,r,o]=i.split(e,3,1);if(r=i.sigmoid(r),o=i.tanh(o),t){n=i.sigmoid(n.div(i.scalar(t)));const e=i.randomUniform(n.shape,0,1);n=i.greater(n,e).toFloat()}else n=i.greater(i.sigmoid(n),.5).toFloat();return i.concat([n,r,o],1)}}class P extends y{constructor(e){super(),this.coreDecoders=e,this.numDecoders=this.coreDecoders.length,this.zDims=this.coreDecoders[0].zDims,this.outputDims=this.coreDecoders.reduce((e,t)=>e+t.outputDims,0)}decodeSeparately(e,t,n,i,r){const o=[];for(let s=0;s<this.coreDecoders.length;++s)o.push(this.coreDecoders[s].decode(e,t,n[s],i,r));return o}decode(e,t,n,r,o){return i.tidy(()=>{const s=this.decodeSeparately(e,t,this.coreDecoders.map(e=>n),r,o);return i.concat(s,-1)})}}class O extends y{constructor(e,t,n,i){super(),this.splitDecoder=new P(e),this.lstmCellVars=t,this.zToInitStateVars=n,this.numSteps=i,this.zDims=this.zToInitStateVars.kernel.shape[0],this.outputDims=this.splitDecoder.outputDims}decode(e,t,n,r,o){const s=e.shape[0];return i.tidy(()=>{const n=S(e,this.lstmCellVars,this.zToInitStateVars),a=[];let c=new Array(this.splitDecoder.numDecoders).fill(void 0);const u=i.zeros([s,1]),l=o?i.split(o,this.numSteps):void 0;for(let e=0;e<this.numSteps;++e){[n.c,n.h]=i.multiRNNCell(n.cell,u,n.c,n.h);const o=this.splitDecoder.decodeSeparately(n.h[n.h.length-1],t/this.numSteps,c,r,l?l[e]:void 0);a.push(i.concat(o,-1)),c=o.map(e=>e.slice([0,e.shape[1]-1,0],[s,1,e.shape[e.rank-1]]).squeeze([1]).toFloat())}return i.concat(a,1)})}}class q{constructor(e,t){this.numDims=e.shape[0],this.numHidden=e.shape[2],this.encWeights=e.as2D(this.numDims,this.numHidden),this.decWeightsT=t.as2D(this.numDims,this.numHidden)}sample(e,t){const n=e.shape[0];return i.tidy(()=>{const r=[];let o=e.clone();for(let e=0;e<this.numDims;e++){const s=i.sigmoid(o),a=this.encWeights.slice([e,0],[1,this.numHidden]).as1D(),c=this.decWeightsT.slice([e,0],[1,this.numHidden]),u=t.slice([0,e],[n,1]).add(i.matMul(s,c,!1,!0)).sigmoid().greaterEqual(i.scalar(.5)).toFloat().as1D();e<this.numDims-1&&(o=o.add(i.outerProduct(u.toFloat(),a))),r.push(u)}return i.stack(r,1)})}}class A{constructor(e,t){this.initialized=!1,this.checkpointURL=e,this.spec=t}instantiateFromSpec(){this.dataConverter=l.converterFromSpec(this.spec.dataConverter),this.chordEncoder=this.spec.chordEncoder?c.chordEncoderFromType(this.spec.chordEncoder):void 0}dispose(){void 0!==this.rawVars&&Object.keys(this.rawVars).forEach(e=>this.rawVars[e].dispose()),this.encoder=void 0,this.decoder=void 0,this.initialized=!1}getLstmLayers(e,t){const n=[];let i=0;for(;;){const r=e.replace("%d",i.toString());if(!(r+"kernel"in t))break;n.push(new h(t[r+"kernel"],t[r+"bias"])),++i}return n}async initialize(){this.dispose();const e=o.d.now();this.spec||await Object(o.a)(this.checkpointURL+"/config.json").then(e=>e.json()).then(e=>{if("MusicVAE"!==e.type)throw new Error("Attempted to instantiate MusicVAE model with incorrect type:\n                  "+e.type);this.spec=e}),this.instantiateFromSpec();const t="cell_%d/bidirectional_rnn/%s/multi_rnn_cell/cell_0/lstm_cell/",n="encoder/"+t,s="encoder/hierarchical_level_%d/"+t.replace("%d","0"),a="control_preprocessing/"+t,c=await Object(o.a)(this.checkpointURL+"/weights_manifest.json").then(e=>e.json()).then(e=>i.io.loadWeights(e,this.checkpointURL));this.rawVars=c;const u=new h(c["encoder/mu/kernel"],c["encoder/mu/bias"]);if(this.dataConverter.numSegments){const e=this.getLstmLayers(s.replace("%s","fw"),c),t=this.getLstmLayers(s.replace("%s","bw"),c);if(e.length!==t.length||2!==e.length)throw Error(`Only 2 hierarchical encoder levels are supported. Got ${e.length} forward and ${t.length} backward.`);const n=[0,1].map(n=>new f(e[n],t[n]));this.encoder=new g(n,[this.dataConverter.numSegments,1],u)}else{const e=this.getLstmLayers(n.replace("%s","fw"),c),t=this.getLstmLayers(n.replace("%s","bw"),c);if(e.length!==t.length||1!==e.length)throw Error(`Only single-layer bidirectional encoders are supported. Got ${e.length} forward and ${t.length} backward.`);this.encoder=new f(e[0],t[0],u)}const l=a.replace("%s","fw").replace("%d","0")+"kernel"in c,p=this.dataConverter.numSegments?"core_decoder/":"",d=[];if(this.dataConverter.NUM_SPLITS)for(let e=0;e<this.dataConverter.NUM_SPLITS;++e)d.push(`${p}core_decoder_${e}/decoder/`);else d.push(p+"decoder/");let m=[null],S=[null];if(l&&(m=this.getLstmLayers(a.replace("%s","fw"),c),S=this.getLstmLayers(a.replace("%s","bw"),c),m.length!==S.length||1!==m.length))throw Error(`Only single-layer bidirectional control preprocessing is supported. Got ${m.length} forward and ${S.length} backward.`);const y=d.map(e=>{const t=this.getLstmLayers(e+"multi_rnn_cell/cell_%d/lstm_cell/",c),n=new h(c[e+"z_to_initial_state/kernel"],c[e+"z_to_initial_state/bias"]),i=new h(c[e+"output_projection/kernel"],c[e+"output_projection/bias"]);return e+"nade/w_enc"in c?new N(t,n,i,new q(c[e+"nade/w_enc"],c[e+"nade/w_dec_t"]),m[0],S[0]):"GrooveConverter"===this.spec.dataConverter.type?new T(t,n,i,void 0,m[0],S[0]):this.spec.useBooleanDecoder?new b(t,n,i,void 0,m[0],S[0]):new v(t,n,i,void 0,m[0],S[0])});if(this.dataConverter.numSegments){const e=this.getLstmLayers("decoder/hierarchical_level_0/cell_%d/lstm_cell/",c),t=new h(c["decoder/hierarchical_level_0/initial_state/kernel"],c["decoder/hierarchical_level_0/initial_state/bias"]);this.decoder=new O(y,e,t,this.dataConverter.numSegments)}else 1===y.length?this.decoder=y[0]:this.decoder=new P(y);this.zDims=this.decoder.zDims,this.initialized=!0,r.logWithDuration("Initialized model",e,"MusicVAE")}isInitialized(){return this.initialized}checkControlArgs(e){const t=(e=e||{}).extraControls||{};if(this.chordEncoder&&!e.chordProgression)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&e.chordProgression)throw new Error("Unexpected chord progression provided.");if(this.chordEncoder&&this.dataConverter.endTensor&&e.chordProgression.length>1)throw new Error("Multiple chords not supported when using variable-length segments.");if(this.spec.conditionOnKey&&null==e.key)throw new Error("Key expected but not provided.");if(!this.spec.conditionOnKey&&null!=e.key)throw new Error("Unexpected key provided.");if(this.spec.extraControls)for(const e of this.spec.extraControls){if(!(e.name in t))throw new Error("Missing control signal: "+e.name);if(t[e.name].shape[1]!==e.depth)throw new Error(`Control signal ${e.name} has invalid depth: ${t[e.name].shape[1]} != ${e.depth}`)}const n=this.spec.extraControls?new Set(this.spec.extraControls.map(e=>e.name)):new Set;for(const e in t)n.has(e)||r.log("Unspecified control signal provided: "+e,"MusicVAE",5)}controlArgsToTensor(e){return e=e||{},i.tidy(()=>{const t=[];if(e.chordProgression){const n=this.encodeChordProgression(e.chordProgression);t.push(n)}if(null!=e.key){const n=i.oneHot(i.fill([this.dataConverter.numSteps],e.key,"int32"),12);t.push(n)}if(e.extraControls)for(const n of this.spec.extraControls)t.push(e.extraControls[n.name]);return t.length?i.concat2d(t,1):void 0})}async interpolateTensors(e,t,n,r){this.initialized||await this.initialize();const o=await this.encodeTensors(e,r),s=i.tidy(()=>this.getInterpolatedZs(o,t));o.dispose();const a=await this.decodeTensors(s,n,r);return s.dispose(),a}async interpolate(e,t,n,o){this.checkControlArgs(o),this.initialized||await this.initialize();const s=await this.encode(e,o),a=i.tidy(()=>this.getInterpolatedZs(s,t));s.dispose();const c=this.decode(a,n,o);return a.dispose(),c.then(()=>r.logWithDuration("Interpolation completed",0,"MusicVAE",20)),c}async getSegmentLengths(e){if(e.shape[0]>1)throw new Error("Variable-length segments not supported for batch size > 1.");const t=this.dataConverter.numSteps,n=this.dataConverter.numSegments,r=i.tidy(()=>i.min(i.equal(e.squeeze([0]),this.dataConverter.endTensor.expandDims(0)),1)),o=await r.data();r.dispose();const s=t/n,a=[];let c=0,u=o.indexOf(1);for(;-1!==u;)a.push(u-c+1),c+=s,u=o.indexOf(1,c);if(a.length!==n)throw new Error(`Incorrect number of segments: ${a.length} != ${n}`);return a}encodeChordProgression(e){const t=this.dataConverter.numSteps,n=this.dataConverter.numSegments,r=this.dataConverter.SEGMENTED_BY_TRACK?t/n:t,o=this.dataConverter.SEGMENTED_BY_TRACK?i.concat2d([this.chordEncoder.encode(u.NO_CHORD).expandDims(0),this.chordEncoder.encodeProgression(e,r-1)],0):this.chordEncoder.encodeProgression(e,r);return this.dataConverter.SEGMENTED_BY_TRACK?i.tile(o,[n,1]):o}async encodeTensors(e,t){this.checkControlArgs(t),this.initialized||await this.initialize();const n=this.dataConverter.endTensor?await this.getSegmentLengths(e):void 0;return i.tidy(()=>{const r=this.controlArgsToTensor(t),o=[e];if(r){const t=i.tile(i.expandDims(r,0),[e.shape[0],1,1]);o.push(t)}const s=i.concat3d(o,2);return this.encoder.encode(s,n)})}async encode(e,t){this.initialized||await this.initialize();const n=o.d.now(),s=i.tidy(()=>i.stack(e.map(e=>this.dataConverter.toTensor(e)))),a=await this.encodeTensors(s,t);return s.dispose(),r.logWithDuration("Encoding completed",n,"MusicVAE",20),a}async decodeTensors(e,t,n){return this.checkControlArgs(n),this.initialized||await this.initialize(),i.tidy(()=>{const i=this.controlArgsToTensor(n);return this.decoder.decode(e,this.dataConverter.numSteps,void 0,t,i)})}async decode(e,t,n,s=u.DEFAULT_STEPS_PER_QUARTER,a=u.DEFAULT_QUARTERS_PER_MINUTE){this.initialized||await this.initialize();const c=o.d.now(),l=await this.decodeTensors(e,t,n),h=i.tidy(()=>i.split(l,l.shape[0]).map(e=>e.squeeze([0]))),p=[];for(const e of h)p.push(await this.dataConverter.toNoteSequence(e,s,a)),e.dispose();return l.dispose(),r.logWithDuration("Decoding completed",c,"MusicVAE",20),p}getInterpolatedZs(e,t){if("number"==typeof t&&(t=[t]),2!==e.shape[0]&&4!==e.shape[0])throw new Error("Invalid number of input sequences. Requires length 2, or 4");if(1!==t.length&&2!==t.length)throw new Error("Invalid number of dimensions. Requires length 1, or 2.");const n=t[0],r=2===t.length?t[1]:n;return i.tidy(()=>{const t=i.linspace(0,1,n),o=e.slice([0,0],[1,e.shape[1]]).as1D(),s=e.slice([1,0],[1,e.shape[1]]).as1D();if(2===e.shape[0]){const e=s.sub(o);return i.outerProduct(t,e).add(o)}if(4===e.shape[0]){const a=i.linspace(0,1,r),c=e.slice([2,0],[1,e.shape[1]]).as1D(),u=e.slice([3,0],[1,e.shape[1]]).as1D(),l=i.scalar(1).sub(t),h=i.scalar(1).sub(a);let p=o.mul(i.outerProduct(h,l).as3D(r,n,1));return p=i.addStrict(p,s.mul(i.outerProduct(a,l).as3D(r,n,1))),p=i.addStrict(p,c.mul(i.outerProduct(h,t).as3D(r,n,1))),p=i.addStrict(p,u.mul(i.outerProduct(a,t).as3D(r,n,1))),p.as2D(n*r,e.shape[1])}throw new Error("Invalid number of note sequences. Requires length 2, or 4")})}async sampleTensors(e,t=.5,n){this.checkControlArgs(n),this.initialized||await this.initialize();const r=i.tidy(()=>i.randomNormal([e,this.decoder.zDims])),o=await this.decodeTensors(r,t,n);return r.dispose(),o}async sample(e,t=.5,n,s=u.DEFAULT_STEPS_PER_QUARTER,a=u.DEFAULT_QUARTERS_PER_MINUTE){this.checkControlArgs(n),this.initialized||await this.initialize();const c=o.d.now(),l=i.tidy(()=>i.randomNormal([e,this.decoder.zDims])),h=this.decode(l,t,n,s,a);return l.dispose(),h.then(()=>r.logWithDuration("Sampling completed",c,"MusicVAE",20)),h}async similarTensors(e,t,n,r,o){if(n<0||n>1)throw new Error("Similarity must be between 0 and 1.");this.initialized||await this.initialize();const s=i.expandDims(e,0),a=await this.encodeTensors(s,o);s.dispose();const c=i.tidy(()=>{const e=i.randomNormal([t,this.decoder.zDims]);return i.add(a.mul(n),e.mul(1-n))});a.dispose();const u=await this.decodeTensors(c,r,o);return c.dispose(),u}async similar(e,t,n,o,s){if(this.checkControlArgs(s),n<0||n>1)throw new Error("Similarity must be between 0 and 1.");this.initialized||await this.initialize();const a=await this.encode([e],s),c=i.tidy(()=>{const e=i.randomNormal([t,this.decoder.zDims]);return i.add(a.mul(n),e.mul(1-n))});a.dispose();const u=this.decode(c,o,s);return c.dispose(),u.then(()=>r.logWithDuration("Similar sequence generation completed",0,"MusicVAE",20)),u}}},function(e,t,n){"use strict";n.r(t),n.d(t,"PianoGenie",(function(){return f})),n.d(t,"PianoGenieKeysig",(function(){return S})),n.d(t,"PianoGenieChord",(function(){return g})),n.d(t,"PianoGenieKeysigChordFamily",(function(){return w})),n.d(t,"PianoGenieKeysigChord",(function(){return y}));var i=n(0),r=n(6),o=n(26);function s(e){for(let t=0;t<2;++t)e.c[t].dispose(),e.h[t].dispose()}function a(e,t,n){if((t=void 0!==t?t:1)<0||t>1)throw new Error("Invalid temperature specified");let r;if(0===t)r=i.argMax(e,0);else{t<1&&(e=i.div(e,i.scalar(t,"float32")));const o=i.reshape(i.softmax(e,0),[1,-1]),s=i.multinomial(o,1,n,!0);r=i.reshape(s,[])}return r}class c extends class{constructor(e){this.checkpointURL=e,this.initialized=!1}isInitialized(){return this.initialized}async initialize(e){if(this.initialized&&this.dispose(),void 0===this.checkpointURL&&void 0===e)throw new Error("Need to specify either URI or static variables");if(void 0===e){const e=await Object(r.a)(this.checkpointURL+"/weights_manifest.json").then(e=>e.json()).then(e=>i.io.loadWeights(e,this.checkpointURL));this.modelVars=e}else this.modelVars=e;this.decLSTMCells=[],this.decForgetBias=i.scalar(1,"float32");for(let e=0;e<2;++e){const t=`phero_model/decoder/rnn/rnn/multi_rnn_cell/cell_${e}/lstm_cell/`;this.decLSTMCells.push((e,n,r)=>i.basicLSTMCell(this.decForgetBias,this.modelVars[t+"kernel"],this.modelVars[t+"bias"],e,n,r))}this.resetState(),this.initialized=!0,this.next(0),this.resetState()}getRnnInputFeats(){return i.tidy(()=>{const e=i.tensor1d([this.button],"float32");return i.sub(i.mul(2,i.div(e,7)),1).as1D()})}next(e,t,n){return this.nextWithCustomSamplingFunction(e,e=>a(e,t,n))}nextFromKeyList(e,t,n,r){return this.nextWithCustomSamplingFunction(e,e=>{const o=i.tensor1d(t,"int32");let s=a(e=i.gather(e,o),n,r);const c=i.gather(o,i.reshape(s,[1]));return s=i.reshape(c,[]),s})}nextFromKeyWhitelist(e,t,n,i){return o.logging.log("nextFromKeyWhitelist() is deprecated, and will be removed in a future          version. Please use nextFromKeyList() instead","PianoGenie",5),this.nextFromKeyList(e,t,n,i)}nextWithCustomSamplingFunction(e,t){const n=this.lastState;this.button=e;const i=this.getRnnInputFeats(),[r,o]=this.evaluateModelAndSample(i,n,t);return i.dispose(),s(this.lastState),this.lastState=r,o}evaluateModelAndSample(e,t,n){if(!this.initialized)throw new Error("Model is not initialized.");const[r,o]=i.tidy(()=>{let r=i.matMul(i.expandDims(e,0),this.modelVars["phero_model/decoder/rnn_input/dense/kernel"]);r=i.add(r,this.modelVars["phero_model/decoder/rnn_input/dense/bias"]);const[o,s]=i.multiRNNCell(this.decLSTMCells,r,t.c,t.h),a={c:o,h:s};let c=i.matMul(s[1],this.modelVars["phero_model/decoder/pitches/dense/kernel"]);c=i.add(c,this.modelVars["phero_model/decoder/pitches/dense/bias"]);const u=i.reshape(c,[88]);return[a,n(u).dataSync()[0]]});return[r,o]}resetState(){void 0!==this.lastState&&s(this.lastState),this.lastState=function(){const e={c:[],h:[]};for(let t=0;t<2;++t)e.c.push(i.zeros([1,128],"float32")),e.h.push(i.zeros([1,128],"float32"));return e}()}dispose(){this.initialized&&(Object.keys(this.modelVars).forEach(e=>this.modelVars[e].dispose()),this.decForgetBias.dispose(),s(this.lastState),this.initialized=!1)}}{getRnnInputFeats(){return i.tidy(()=>{const e=[super.getRnnInputFeats()],t=this.lastOutput,n=this.lastTime,r=this.time;let o;void 0===this.deltaTimeOverride?o=(r.getTime()-n.getTime())/1e3:(o=this.deltaTimeOverride,this.deltaTimeOverride=void 0);const s=i.scalar(t,"int32"),a=i.addStrict(s,i.scalar(1,"int32")),c=i.cast(i.oneHot(a,89),"float32");e.push(c);const u=i.scalar(o,"float32"),l=i.round(i.mul(u,31.25)),h=i.minimum(l,32),p=i.cast(i.add(h,1e-4),"int32"),d=i.oneHot(p,33),m=i.cast(d,"float32");return e.push(m),this.lastTime=r,i.concat1d(e)})}nextWithCustomSamplingFunction(e,t){this.time=new Date;const n=super.nextWithCustomSamplingFunction(e,t);return this.lastOutput=n,this.lastTime=this.time,n}overrideLastOutput(e){this.lastOutput=e}overrideDeltaTime(e){this.deltaTimeOverride=e}resetState(){super.resetState(),this.lastOutput=-1,this.lastTime=new Date,this.lastTime.setSeconds(this.lastTime.getSeconds()-1e5),this.time=new Date}}var u,l;!function(e){e[e.None=0]="None",e[e.C=1]="C",e[e.Cs=2]="Cs",e[e.D=3]="D",e[e.Eb=4]="Eb",e[e.E=5]="E",e[e.F=6]="F",e[e.Fs=7]="Fs",e[e.G=8]="G",e[e.Ab=9]="Ab",e[e.A=10]="A",e[e.Bb=11]="Bb",e[e.B=12]="B"}(u||(u={})),function(e){e[e.None=0]="None",e[e.Maj=1]="Maj",e[e.Min=2]="Min",e[e.Aug=3]="Aug",e[e.Dim=4]="Dim",e[e.Seven=5]="Seven",e[e.Maj7=6]="Maj7",e[e.Min7=7]="Min7",e[e.Min7b5=8]="Min7b5"}(l||(l={}));class h extends c{getRnnInputFeats(){return i.tidy(()=>{const e=[super.getRnnInputFeats()],t=i.scalar(this.chordRoot,"int32"),n=i.subStrict(t,i.scalar(1,"int32")),r=i.cast(i.oneHot(n,12),"float32");e.push(r);const o=i.scalar(this.chordFamily,"int32"),s=i.subStrict(o,i.scalar(1,"int32")),a=i.cast(i.oneHot(s,8),"float32");return e.push(a),i.concat1d(e)})}setChordRoot(e){this.chordRoot=e}setChordFamily(e){this.chordFamily=e}resetState(){super.resetState(),this.chordRoot=u.None,this.chordFamily=l.None}}class p extends c{getRnnInputFeats(){return i.tidy(()=>{const e=[super.getRnnInputFeats()],t=i.scalar(this.keySignature,"int32"),n=i.subStrict(t,i.scalar(1,"int32")),r=i.cast(i.oneHot(n,12),"float32");return e.push(r),i.concat1d(e)})}setKeySignature(e){this.keySignature=e}resetState(){super.resetState(),this.keySignature=u.None}}class d extends p{getRnnInputFeats(){return i.tidy(()=>{const e=[super.getRnnInputFeats()],t=i.scalar(this.chordRoot,"int32"),n=i.subStrict(t,i.scalar(1,"int32")),r=i.cast(i.oneHot(n,12),"float32");e.push(r);const o=i.scalar(this.chordFamily,"int32"),s=i.subStrict(o,i.scalar(1,"int32")),a=i.cast(i.oneHot(s,8),"float32");return e.push(a),i.concat1d(e)})}setChordRoot(e){this.chordRoot=e}setChordFamily(e){this.chordFamily=e}resetState(){super.resetState(),this.chordRoot=u.None,this.chordFamily=l.None}}class m extends p{getRnnInputFeats(){return i.tidy(()=>{const e=[super.getRnnInputFeats()],t=i.scalar(this.chordFamily,"int32"),n=i.subStrict(t,i.scalar(1,"int32")),r=i.cast(i.oneHot(n,8),"float32");return e.push(r),i.concat1d(e)})}setChordFamily(e){this.chordFamily=e}resetState(){super.resetState(),this.chordFamily=l.None}}class f extends c{}class g extends h{}class S extends p{}class y extends d{}class w extends m{}},function(e,t){e.exports=require("@tensorflow/tfjs-backend-webgl")},function(e,t,n){"use strict";n.r(t),n.d(t,"tf",(function(){return i})),n.d(t,"aux_inputs",(function(){return r.aux_inputs})),n.d(t,"chords",(function(){return r.chords})),n.d(t,"constants",(function(){return r.constants})),n.d(t,"data",(function(){return r.data})),n.d(t,"logging",(function(){return r.logging})),n.d(t,"melodies",(function(){return r.melodies})),n.d(t,"performance",(function(){return r.performance})),n.d(t,"sequences",(function(){return r.sequences})),n.d(t,"MetronomeCallbackObject",(function(){return r.MetronomeCallbackObject})),n.d(t,"Metronome",(function(){return r.Metronome})),n.d(t,"MidiConversionError",(function(){return r.MidiConversionError})),n.d(t,"midiToSequenceProto",(function(){return r.midiToSequenceProto})),n.d(t,"sequenceProtoToMidi",(function(){return r.sequenceProtoToMidi})),n.d(t,"urlToBlob",(function(){return r.urlToBlob})),n.d(t,"blobToNoteSequence",(function(){return r.blobToNoteSequence})),n.d(t,"urlToNoteSequence",(function(){return r.urlToNoteSequence})),n.d(t,"BasePlayerCallback",(function(){return r.BasePlayerCallback})),n.d(t,"BasePlayer",(function(){return r.BasePlayer})),n.d(t,"Player",(function(){return r.Player})),n.d(t,"SoundFontPlayer",(function(){return r.SoundFontPlayer})),n.d(t,"PlayerWithClick",(function(){return r.PlayerWithClick})),n.d(t,"MIDIPlayer",(function(){return r.MIDIPlayer})),n.d(t,"BaseRecorderCallback",(function(){return r.BaseRecorderCallback})),n.d(t,"Recorder",(function(){return r.Recorder})),n.d(t,"BaseVisualizer",(function(){return r.BaseVisualizer})),n.d(t,"PianoRollCanvasVisualizer",(function(){return r.PianoRollCanvasVisualizer})),n.d(t,"Visualizer",(function(){return r.Visualizer})),n.d(t,"BaseSVGVisualizer",(function(){return r.BaseSVGVisualizer})),n.d(t,"PianoRollSVGVisualizer",(function(){return r.PianoRollSVGVisualizer})),n.d(t,"WaterfallSVGVisualizer",(function(){return r.WaterfallSVGVisualizer})),n.d(t,"ScrollType",(function(){return r.ScrollType})),n.d(t,"StaffSVGVisualizer",(function(){return r.StaffSVGVisualizer})),n.d(t,"Coconet",(function(){return o.Coconet})),n.d(t,"MusicRNN",(function(){return s.MusicRNN})),n.d(t,"MidiMe",(function(){return a.MidiMe})),n.d(t,"Decoder",(function(){return a.Decoder})),n.d(t,"Encoder",(function(){return a.Encoder})),n.d(t,"MusicVAE",(function(){return a.MusicVAE})),n.d(t,"PianoGenie",(function(){return c.PianoGenie})),n.d(t,"PianoGenieKeysig",(function(){return c.PianoGenieKeysig})),n.d(t,"PianoGenieChord",(function(){return c.PianoGenieChord})),n.d(t,"PianoGenieKeysigChordFamily",(function(){return c.PianoGenieKeysigChordFamily})),n.d(t,"PianoGenieKeysigChord",(function(){return c.PianoGenieKeysigChord})),n.d(t,"NoteSequence",(function(){return u.NoteSequence})),n.d(t,"OnsetsAndFrames",(function(){return l.OnsetsAndFrames})),n.d(t,"GANSynth",(function(){return h.GANSynth})),n.d(t,"SPICE",(function(){return d})),n.d(t,"DDSP",(function(){return m.DDSP}));var i=n(0),r=n(26),o=n(33),s=n(34),a=n(35),c=n(36),u=n(29),l=n(32),h=n(31),p=n(11);class d{constructor(e){this.modelUrl=e||"https://tfhub.dev/google/tfjs-model/spice/2/default/1"}async initialize(){this.spiceModel=await Object(p.h)(this.modelUrl),this.initialized=!0}async getAudioFeatures(e,t){return await Object(p.g)(e,this.spiceModel,t)}dispose(){this.initialized&&(this.spiceModel.dispose(),this.initialized=!1)}isInitialized(){return this.initialized}}var m=n(30)},function(e,t,n){"use strict";n.r(t);var i=n(38);window.mm=i}])}));