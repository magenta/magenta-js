!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.mm=t():e.mm=t()}(global,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=29)}([function(e,t){e.exports=require("@tensorflow/tfjs")},function(e,t,n){"use strict";n.r(t),n.d(t,"DEFAULT_QUARTERS_PER_MINUTE",(function(){return r})),n.d(t,"DEFAULT_STEPS_PER_BAR",(function(){return i})),n.d(t,"DEFAULT_STEPS_PER_QUARTER",(function(){return o})),n.d(t,"DEFAULT_STEPS_PER_SECOND",(function(){return s})),n.d(t,"DEFAULT_VELOCITY",(function(){return a})),n.d(t,"DEFAULT_PROGRAM",(function(){return c})),n.d(t,"DEFAULT_TICKS_PER_QUARTER",(function(){return u})),n.d(t,"DEFAULT_CHANNEL",(function(){return l})),n.d(t,"DRUM_CHANNEL",(function(){return p})),n.d(t,"MIN_MIDI_VELOCITY",(function(){return h})),n.d(t,"MAX_MIDI_VELOCITY",(function(){return d})),n.d(t,"MIDI_VELOCITIES",(function(){return m})),n.d(t,"NO_CHORD",(function(){return f})),n.d(t,"NUM_PITCH_CLASSES",(function(){return g})),n.d(t,"MIN_MIDI_PITCH",(function(){return S})),n.d(t,"MAX_MIDI_PITCH",(function(){return y})),n.d(t,"MIDI_PITCHES",(function(){return w})),n.d(t,"MIN_PIANO_PITCH",(function(){return b})),n.d(t,"MAX_PIANO_PITCH",(function(){return v})),n.d(t,"MIN_DRUM_PITCH",(function(){return N})),n.d(t,"MAX_DRUM_PITCH",(function(){return T})),n.d(t,"MIN_MIDI_PROGRAM",(function(){return P})),n.d(t,"MAX_MIDI_PROGRAM",(function(){return q})),n.d(t,"LO_CLICK_PITCH",(function(){return O})),n.d(t,"HI_CLICK_PITCH",(function(){return I})),n.d(t,"LO_CLICK_CLASS",(function(){return A})),n.d(t,"HI_CLICK_CLASS",(function(){return E}));const r=120,i=16,o=4,s=100,a=80,c=0,u=220,l=0,p=9,h=0,d=127,m=d-h+1,f="N.C.",g=12,S=0,y=127,w=y-S+1,b=21,v=108,N=35,T=81,P=0,q=127,O=89,I=90,A=9,E=10},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(11),i=r.tensorflow.magenta.NoteSequence},function(e,t){e.exports=require("tone")},function(e,t){e.exports=require("@tensorflow/tfjs-core")},function(e,t,n){"use strict";var r;n.r(t),n.d(t,"Level",(function(){return r})),n.d(t,"verbosity",(function(){return i})),n.d(t,"log",(function(){return o})),n.d(t,"logWithDuration",(function(){return s})),function(e){e[e.NONE=0]="NONE",e[e.WARN=5]="WARN",e[e.INFO=10]="INFO",e[e.DEBUG=20]="DEBUG"}(r||(r={}));let i=10;function o(e,t="Magenta.js",n=10){if(0===n)throw Error("Logging level cannot be NONE.");if(i>=n){(5===n?console.warn:console.log)(`%c ${t} `,"background:magenta; color:white",e)}}function s(e,t,n="Magenta.js",r=10){o(`${e} in ${((performance.now()-t)/1e3).toPrecision(3)}s`,n,r)}},function(e,t,n){"use strict";n.r(t),n.d(t,"MultipleTimeSignatureException",(function(){return s})),n.d(t,"BadTimeSignatureException",(function(){return a})),n.d(t,"NegativeTimeException",(function(){return c})),n.d(t,"MultipleTempoException",(function(){return u})),n.d(t,"QuantizationStatusException",(function(){return l})),n.d(t,"clone",(function(){return p})),n.d(t,"stepsPerQuarterToStepsPerSecond",(function(){return h})),n.d(t,"quantizeToStep",(function(){return d})),n.d(t,"quantizeNoteSequence",(function(){return g})),n.d(t,"isQuantizedSequence",(function(){return S})),n.d(t,"assertIsQuantizedSequence",(function(){return y})),n.d(t,"isRelativeQuantizedSequence",(function(){return w})),n.d(t,"assertIsRelativeQuantizedSequence",(function(){return b})),n.d(t,"isAbsoluteQuantizedSequence",(function(){return v})),n.d(t,"assertIsAbsoluteQuantizedSequence",(function(){return N})),n.d(t,"unquantizeSequence",(function(){return T})),n.d(t,"mergeInstruments",(function(){return P})),n.d(t,"replaceInstruments",(function(){return q})),n.d(t,"mergeConsecutiveNotes",(function(){return O})),n.d(t,"concatenate",(function(){return I})),n.d(t,"trim",(function(){return A})),n.d(t,"split",(function(){return k}));var r=n(2),i=n(1);const o=.5;class s extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class a extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class c extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class u extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class l extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}function p(e){return r.a.decode(r.a.encode(e).finish())}function h(e,t){return e*t/60}function d(e,t,n=o){const r=e*t;return Math.floor(r+(1-n))}function m(e){return e.controlChanges.concat(e.textAnnotations)}function f(e){if(e.tempos&&0!==e.tempos.length){if(e.tempos.sort((e,t)=>e.time-t.time),0!==e.tempos[0].time&&e.tempos[0].qpm!==i.DEFAULT_QUARTERS_PER_MINUTE)throw new u("NoteSequence has an implicit tempo change from initial "+`${i.DEFAULT_QUARTERS_PER_MINUTE} qpm to `+`${e.tempos[0].qpm} qpm at ${e.tempos[0].time} seconds.`);for(let t=1;t<e.tempos.length;t++)if(e.tempos[t].qpm!==e.tempos[0].qpm)throw new u("NoteSequence has at least one tempo change from "+`${e.tempos[0].qpm} qpm to ${e.tempos[t].qpm}`+`qpm at ${e.tempos[t].time} seconds.`)}}function g(e,t){const n=p(e);if(n.quantizationInfo=r.a.QuantizationInfo.create({stepsPerQuarter:t}),n.timeSignatures.length>0){if(n.timeSignatures.sort((e,t)=>e.time-t.time),0!==n.timeSignatures[0].time&&(4!==n.timeSignatures[0].numerator||4!==n.timeSignatures[0].denominator))throw new s("NoteSequence has an implicit change from initial 4/4 time "+`signature to ${n.timeSignatures[0].numerator}/`+`${n.timeSignatures[0].denominator} at `+`${n.timeSignatures[0].time} seconds.`);for(let e=1;e<n.timeSignatures.length;e++){const t=n.timeSignatures[e];if(t.numerator!==n.timeSignatures[0].numerator||t.denominator!==n.timeSignatures[0].denominator)throw new s("NoteSequence has at least one time signature change from "+`${n.timeSignatures[0].numerator}/`+`${n.timeSignatures[0].denominator} to `+`${t.numerator}/${t.denominator} `+`at ${t.time} seconds`)}n.timeSignatures[0].time=0,n.timeSignatures=[n.timeSignatures[0]]}else{const e=r.a.TimeSignature.create({numerator:4,denominator:4,time:0});n.timeSignatures.push(e)}const o=n.timeSignatures[0];if(!(u=o.denominator)||0!=(u&u-1))throw new a("Denominator is not a power of 2. Time signature: "+`${o.numerator}/${o.denominator}`);var u;if(0===o.numerator)throw new a("Numerator is 0. Time signature: "+`${o.numerator}/${o.denominator}`);if(n.tempos.length>0)f(n),n.tempos[0].time=0,n.tempos=[n.tempos[0]];else{const e=r.a.Tempo.create({qpm:i.DEFAULT_QUARTERS_PER_MINUTE,time:0});n.tempos.push(e)}const l=h(t,n.tempos[0].qpm);return n.totalQuantizedSteps=d(e.totalTime,l),function(e,t){for(const n of e.notes){if(n.quantizedStartStep=d(n.startTime,t),n.quantizedEndStep=d(n.endTime,t),n.quantizedEndStep===n.quantizedStartStep&&(n.quantizedEndStep+=1),n.quantizedStartStep<0||n.quantizedEndStep<0)throw new c("Got negative note time: start_step = "+`${n.quantizedStartStep}, end_step = `+`${n.quantizedEndStep}`);n.quantizedEndStep>e.totalQuantizedSteps&&(e.totalQuantizedSteps=n.quantizedEndStep)}m(e).forEach(e=>{if(e.quantizedStep=d(e.time,t),e.quantizedStep<0)throw new c(`Got negative event time: step = ${e.quantizedStep}`)})}(n,l),n}function S(e){return e.quantizationInfo&&(e.quantizationInfo.stepsPerQuarter>0||e.quantizationInfo.stepsPerSecond>0)}function y(e){if(!S(e))throw new l(`NoteSequence ${e.id} is not quantized (missing quantizationInfo)`)}function w(e){return e.quantizationInfo&&e.quantizationInfo.stepsPerQuarter>0}function b(e){if(!w(e))throw new l(`NoteSequence ${e.id} is not quantized or is quantized based on absolute timing`)}function v(e){return e.quantizationInfo&&e.quantizationInfo.stepsPerSecond>0}function N(e){if(!v(e))throw new l(`NoteSequence ${e.id} is not quantized or is quantized based on relative timing`)}function T(e,t){b(e),f(e);const n=p(e);t?n.tempos&&n.tempos.length>0?n.tempos[0].qpm=t:n.tempos.push(r.a.Tempo.create({time:0,qpm:t})):t=e.tempos&&e.tempos.length>0?n.tempos[0].qpm:i.DEFAULT_QUARTERS_PER_MINUTE;const o=e=>e/n.quantizationInfo.stepsPerQuarter*(60/t);return n.totalTime=o(n.totalQuantizedSteps),n.notes.forEach(e=>{e.startTime=o(e.quantizedStartStep),e.endTime=o(e.quantizedEndStep),n.totalTime=Math.max(n.totalTime,e.endTime),delete e.quantizedStartStep,delete e.quantizedEndStep}),m(n).forEach(e=>{e.time=o(e.time)}),delete n.totalQuantizedSteps,delete n.quantizationInfo,n}function P(e){const t=p(e),n=t.notes.concat(t.pitchBends).concat(t.controlChanges),r=Array.from(new Set(n.filter(e=>!e.isDrum).map(e=>e.program)));return n.forEach(e=>{e.isDrum?(e.program=0,e.instrument=r.length):e.instrument=r.indexOf(e.program)}),t}function q(e,t){const n=new Set(e.notes.map(e=>e.instrument)),i=new Set(t.notes.map(e=>e.instrument)),o=[];e.notes.forEach(e=>{i.has(e.instrument)||o.push(r.a.Note.create(e))}),t.notes.forEach(e=>{n.has(e.instrument)&&o.push(r.a.Note.create(e))});const s=p(e);return s.notes=o.sort((e,t)=>{const n=e.instrument-t.instrument;return n||e.quantizedStartStep-t.quantizedStartStep}),s}function O(e){y(e);const t=p(e);t.notes=[];const n=e.notes.sort((e,t)=>{const n=e.instrument-t.instrument;return n||e.quantizedStartStep-t.quantizedStartStep}),i=new r.a.Note;i.pitch=n[0].pitch,i.instrument=n[0].instrument,i.quantizedStartStep=n[0].quantizedStartStep,i.quantizedEndStep=n[0].quantizedEndStep,t.notes.push(i);let o=0;for(let e=1;e<n.length;e++){const i=n[e],s=t.notes[o];if(s.instrument===i.instrument&&s.pitch===i.pitch&&i.quantizedStartStep===s.quantizedEndStep&&i.quantizedStartStep%16!=0)t.notes[o].quantizedEndStep+=i.quantizedEndStep-i.quantizedStartStep;else{const i=new r.a.Note;i.pitch=n[e].pitch,i.instrument=n[e].instrument,i.quantizedStartStep=n[e].quantizedStartStep,i.quantizedEndStep=n[e].quantizedEndStep,t.notes.push(i),o++}}return t}function I(e,t){if(t&&t.length!==e.length)throw new Error("Number of sequences to concatenate and their individual\n durations does not match.");if(S(e[0])){for(let t=0;t<e.length;++t)if(y(e[t]),e[t].quantizationInfo.stepsPerQuarter!==e[0].quantizationInfo.stepsPerQuarter)throw new Error("Not all sequences have the same quantizationInfo");return E(e,"totalQuantizedSteps","quantizedStartStep","quantizedEndStep",t)}return E(e,"totalTime","startTime","endTime",t)}function A(e,t,n,r){return S(e)?z(e,t,n,"totalQuantizedSteps","quantizedStartStep","quantizedEndStep",r):z(e,t,n,"totalTime","startTime","endTime",r)}function E(e,t,n,i,o){let s,a=0;for(let c=0;c<e.length;++c){const u=o?o[c]:e[c][t];if(0===u)throw Error(`Sequence ${e[c].id} has no ${t}, and no individual duration was provided.`);0===c?s=p(e[0]):Array.prototype.push.apply(s.notes,e[c].notes.map(e=>{const t=r.a.Note.create(e);return t[n]+=a,t[i]+=a,t})),a+=u}return s[t]=a,s}function z(e,t,n,r,i,o,s){const a=p(e);a[r]=n,a.notes=a.notes.filter(e=>e[i]>=t&&e[i]<=n&&(s||e[o]<=n));for(let e=0;e<a.notes.length;e++)a.notes[e][i]-=t,a.notes[e][o]-=t,s&&(a.notes[e][o]=Math.min(a.notes[e][o],n));return a[r]=Math.min(e[r]-t,n),a}function k(e,t){y(e);const n=p(e),i=n.notes.sort((e,t)=>e.quantizedStartStep-t.quantizedStartStep),o=[];let s=0,a=[];for(let e=0;e<i.length;e++){const c=i[e],u=c.quantizedStartStep,l=c.quantizedEndStep;if(c.quantizedStartStep-=s,c.quantizedEndStep-=s,!(c.quantizedStartStep<0))if(c.quantizedEndStep<=t)a.push(c);else{if(c.quantizedStartStep<t){const e=r.a.Note.create(c);e.quantizedEndStep=t,e.startTime=e.endTime=void 0,a.push(e),c.quantizedStartStep=s+t,c.quantizedEndStep=l}else c.quantizedStartStep=u,c.quantizedEndStep=l;if((c.quantizedEndStep>t||c.quantizedStartStep>t)&&(e-=1),0!==a.length){const e=p(n);e.notes=a,e.totalQuantizedSteps=t,o.push(e)}a=[],s+=t}}if(0!==a.length){const e=p(n);e.notes=a,e.totalQuantizedSteps=t,o.push(e)}return o}},function(e,t){e.exports=require("tonal")},function(e,t,n){"use strict";n.d(t,"d",(function(){return p})),n.d(t,"c",(function(){return h})),n.d(t,"e",(function(){return d})),n.d(t,"g",(function(){return m})),n.d(t,"h",(function(){return g})),n.d(t,"a",(function(){return y})),n.d(t,"f",(function(){return w})),n.d(t,"b",(function(){return N}));var r=n(13),i=n(16),o=n(17),s=n(5);const a=16e3,c=window,u=c.webkitOfflineAudioContext,l=u?new c.webkitOfflineAudioContext(1,44100,44100):new c.OfflineAudioContext(1,a,a);async function p(e){return fetch(e).then(e=>e.arrayBuffer()).then(e=>l.decodeAudioData(e))}async function h(e){const t=new FileReader;return new Promise((n,r)=>{t.onerror=()=>{t.abort(),r(new DOMException("Something went wrong reading that file."))},t.onload=()=>{n(t.result)},t.readAsArrayBuffer(e)}).then(e=>l.decodeAudioData(e))}function d(e,t){t.power||(t.power=2);const n=function(e,t){const n=t.nFft||2048,r=t.winLength||n,i=t.hopLength||Math.floor(r/4);let o=N(r);o=w(o,n);const s=function(e,t,n){const r=Math.floor((e.length-t)/n)+1,i=Array.from({length:r},(e,n)=>new Float32Array(t));for(let o=0;o<r;o++){const r=o*n,s=e.slice(r,r+t);i[o].set(s),s.length}return i}(e=function(e,t){const n=b(e,t);for(let e=0;e<t;e++)n[e]=n[2*t-e],n[n.length-e-1]=n[n.length-2*t+e-1];return n}(e,Math.floor(n/2)),n,i),a=[],c=s.length,u=n+2;for(let e=0;e<c;e++){const t=new Float32Array(u);a[e]=t}for(let e=0;e<c;e++){const t=v(y(s[e],o));a[e].set(t.slice(0,u))}return a}(e,t),[r,i]=function(e,t){const n=e.map(e=>(function(e,t){return e.map(e=>Math.pow(e,t))})(function(e){const t=new Float32Array(e.length/2);for(let n=0;n<e.length/2;n++)t[n]=Math.sqrt(e[2*n]*e[2*n]+e[2*n+1]*e[2*n+1]);return t}(e),t)),r=e[0].length-1;return[n,r]}(n,t.power);return t.nFft=i,function(e,t){const n=[];for(let r=0;r<e.length;r++)n[r]=S(e[r],t);return n}(r,function(e){const t=e.fMin||0,n=e.fMax||e.sampleRate/2,r=e.nMels||128,i=e.nFft||2048,o=function(e,t){return T(0,e/2,Math.floor(1+t/2))}(e.sampleRate,i),s=function(e,t,n){const r=P(t),i=P(n);return T(r,i,e).map(e=>(function(e){return 700*(Math.exp(e/1125)-1)})(e))}(r+2,t,n),a=function(e){const t=new Float32Array(e.length-1);for(let n=0;n<e.length;n++)t[n]=e[n+1]-e[n];return t}(s),c=function(e,t){const n=[];for(let r=0;r<e.length;r++)n[r]=new Float32Array(t.length);for(let r=0;r<e.length;r++)for(let i=0;i<t.length;i++)n[r][i]=e[r]-t[i];return n}(s,o),u=c[0].length,l=[];for(let e=0;e<r;e++){l[e]=new Float32Array(u);for(let t=0;t<c[e].length;t++){const n=-c[e][t]/a[e],r=c[e+2][t]/a[e+1],i=Math.max(0,Math.min(n,r));l[e][t]=i}}for(let e=0;e<l.length;e++){const t=2/(s[2+e]-s[e]);l[e]=l[e].map(e=>e*t)}return l}(t))}function m(e,t=1e-10,n=80){const r=e.length,i=e[0].length,o=[];for(let e=0;e<r;e++)o[e]=new Float32Array(i);for(let n=0;n<r;n++)for(let r=0;r<i;r++){const i=e[n][r];o[n][r]=10*Math.log10(Math.max(t,i))}if(n){if(n<0)throw new Error("topDb must be non-negative.");for(let e=0;e<r;e++){const t=o[e].reduce((e,t)=>Math.max(e,t));for(let r=0;r<i;r++)o[e][r]=Math.max(o[e][r],t-n)}}return o}function f(e){if(1===e.numberOfChannels)return e.getChannelData(0);if(2!==e.numberOfChannels)throw Error(`${e.numberOfChannels} channel audio is not supported.`);const t=e.getChannelData(0),n=e.getChannelData(1),r=new Float32Array(e.length);for(let i=0;i<e.length;++i)r[i]=(t[i]+n[i])/2;return r}async function g(e,t=a){if(e.sampleRate===t)return f(e);const n=e.sampleRate,r=e.length*t/n;if(u){s.log("Safari does not support WebAudio resampling, so this may be slow.","O&F",5);const t=f(e),n=new Float32Array(r);return o(i(n,[r]),i(t,[t.length])),n}{const t=l.createBufferSource();return t.buffer=e,t.connect(l.destination),t.start(),l.startRendering().then(e=>e.getChannelData(0))}}function S(e,t){if(e.length!==t[0].length)throw new Error("Each entry in filterbank should have dimensions "+`matching FFT. |mags| = ${e.length}, `+`|filterbank[0]| = ${t[0].length}.`);const n=new Float32Array(t.length);for(let r=0;r<t.length;r++){const i=y(e,t[r]);n[r]=i.reduce((e,t)=>e+t)}return n}function y(e,t){if(e.length!==t.length)return console.error(`Buffer length ${e.length} != window length ${t.length}.`),null;const n=new Float32Array(e.length);for(let r=0;r<e.length;r++)n[r]=t[r]*e[r];return n}function w(e,t){if(e.length>t)throw new Error("Data is longer than length.");const n=Math.floor((t-e.length)/2);return b(e,[n,t-e.length-n])}function b(e,t){let n,r;"object"==typeof t?[n,r]=t:n=r=t;const i=new Float32Array(e.length+n+r);return i.set(e,n),i}function v(e){const t=new r(e.length),n=t.createComplexArray(),i=t.toComplexArray(e);return t.transform(n,i),n}function N(e){const t=new Float32Array(e);for(let n=0;n<e;n++)t[n]=.5*(1-Math.cos(2*Math.PI*n/(e-1)));return t}function T(e,t,n){const r=(t-e)/(n-1),i=new Float32Array(n);for(let t=0;t<n;t++)i[t]=e+r*t;return i}function P(e){return 1125*Math.log(1+e/700)}},function(e,t,n){"use strict";n.r(t),n.d(t,"DEFAULT_DRUM_PITCH_CLASSES",(function(){return c})),n.d(t,"converterFromSpec",(function(){return u})),n.d(t,"DataConverter",(function(){return l})),n.d(t,"DrumsConverter",(function(){return p})),n.d(t,"DrumRollConverter",(function(){return h})),n.d(t,"DrumsOneHotConverter",(function(){return d})),n.d(t,"MelodyConverter",(function(){return m})),n.d(t,"TrioConverter",(function(){return f})),n.d(t,"MultitrackConverter",(function(){return g})),n.d(t,"GrooveConverter",(function(){return S}));var r=n(0),i=n(2),o=n(1),s=n(10),a=n(6);const c=[[36,35],[38,27,28,31,32,33,34,37,39,40,56,65,66,75,85],[42,44,54,68,69,70,71,73,78,80],[46,67,72,74,79,81],[45,29,41,61,64,84],[48,47,60,63,77,86,87],[50,30,43,62,76,83],[49,55,57,58],[51,52,53,59,82]];function u(e){switch(e.type){case"MelodyConverter":return new m(e.args);case"DrumsConverter":return new p(e.args);case"DrumRollConverter":return new h(e.args);case"TrioConverter":return new f(e.args);case"DrumsOneHotConverter":return new d(e.args);case"MultitrackConverter":return new g(e.args);case"GrooveConverter":return new S(e.args);default:throw new Error(`Unknown DataConverter type: ${e}`)}}class l{constructor(e){this.NUM_SPLITS=0,this.SEGMENTED_BY_TRACK=!1,this.numSteps=e.numSteps,this.numSegments=e.numSegments}tensorSteps(e){return r.scalar(e.shape[0],"int32")}}class p extends l{constructor(e){super(e),this.pitchClasses=e.pitchClasses||c,this.pitchToClass=new Map;for(let e=0;e<this.pitchClasses.length;++e)this.pitchClasses[e].forEach(t=>{this.pitchToClass.set(t,e)});this.depth=this.pitchClasses.length}toTensor(e){a.assertIsQuantizedSequence(e);const t=this.numSteps||e.totalQuantizedSteps,n=r.buffer([t,this.pitchClasses.length+1],"int32");for(let e=0;e<t;++e)n.set(1,e,-1);return e.notes.forEach(e=>{n.set(1,e.quantizedStartStep,this.pitchToClass.get(e.pitch)),n.set(0,e.quantizedStartStep,-1)}),n.toTensor()}async toNoteSequence(e,t,n){const r=y(t,n),o=e.argMax(1),s=await o.data();o.dispose();for(let e=0;e<s.length;++e)for(let t=0;t<this.pitchClasses.length;t++)s[e]>>t&1&&r.notes.push(i.a.Note.create({pitch:this.pitchClasses[t][0],quantizedStartStep:e,quantizedEndStep:e+1,isDrum:!0}));return r.totalQuantizedSteps=s.length,r}}class h extends p{async toNoteSequence(e,t,n){const r=y(t,n),o=await e.data();for(let t=0;t<e.shape[0];++t){const e=o.slice(t*this.depth,(t+1)*this.depth);for(let n=0;n<e.length;++n)e[n]&&r.notes.push(i.a.Note.create({pitch:this.pitchClasses[n][0],quantizedStartStep:t,quantizedEndStep:t+1,isDrum:!0}))}return r.totalQuantizedSteps=e.shape[0],r}}class d extends p{constructor(e){super(e),this.depth=Math.pow(2,this.pitchClasses.length)}toTensor(e){a.assertIsRelativeQuantizedSequence(e);const t=this.numSteps||e.totalQuantizedSteps,n=Array(t).fill(0);for(const{pitch:t,quantizedStartStep:r}of e.notes)n[r]+=Math.pow(2,this.pitchToClass.get(t));return r.tidy(()=>r.oneHot(r.tensor1d(n,"int32"),this.depth))}}class m extends l{constructor(e){super(e),this.NOTE_OFF=1,this.FIRST_PITCH=2,this.minPitch=e.minPitch,this.maxPitch=e.maxPitch,this.ignorePolyphony=void 0===e.ignorePolyphony||e.ignorePolyphony,this.depth=e.maxPitch-e.minPitch+1+this.FIRST_PITCH}toTensor(e){a.assertIsQuantizedSequence(e);const t=this.numSteps||e.totalQuantizedSteps,n=e.notes.sort((e,t)=>e.quantizedStartStep===t.quantizedStartStep?t.pitch-e.pitch:e.quantizedStartStep-t.quantizedStartStep),i=r.buffer([t],"int32");let o=-1;return n.forEach(e=>{if(e.quantizedStartStep===o){if(this.ignorePolyphony)return;throw new Error("`NoteSequence` is not monophonic.")}if(e.pitch<this.minPitch||e.pitch>this.maxPitch)throw Error("`NoteSequence` has a pitch outside of the valid range: "+`${e.pitch}`);i.set(e.pitch-this.minPitch+this.FIRST_PITCH,e.quantizedStartStep),i.set(this.NOTE_OFF,e.quantizedEndStep),o=e.quantizedStartStep}),r.tidy(()=>r.oneHot(i.toTensor(),this.depth))}async toNoteSequence(e,t,n){const r=y(t,n),o=e.argMax(1),s=await o.data();o.dispose();let a=null;for(let e=0;e<s.length;++e){const t=s[e];switch(t){case 0:break;case 1:a&&(a.quantizedEndStep=e,r.notes.push(a),a=null);break;default:a&&(a.quantizedEndStep=e,r.notes.push(a)),a=i.a.Note.create({pitch:t-this.FIRST_PITCH+this.minPitch,quantizedStartStep:e})}}return a&&(a.quantizedEndStep=s.length,r.notes.push(a)),r.totalQuantizedSteps=s.length,r}}class f extends l{constructor(e){super(e),this.NUM_SPLITS=3,this.MEL_PROG_RANGE=[0,31],this.BASS_PROG_RANGE=[32,39],e.melArgs.numSteps=e.numSteps,e.bassArgs.numSteps=e.numSteps,e.drumsArgs.numSteps=e.numSteps,this.melConverter=new m(e.melArgs),this.bassConverter=new m(e.bassArgs),this.drumsConverter=new d(e.drumsArgs),this.depth=this.melConverter.depth+this.bassConverter.depth+this.drumsConverter.depth}toTensor(e){a.assertIsQuantizedSequence(e);const t=a.clone(e),n=a.clone(e),i=a.clone(e);return t.notes=e.notes.filter(e=>!e.isDrum&&e.program>=this.MEL_PROG_RANGE[0]&&e.program<=this.MEL_PROG_RANGE[1]),n.notes=e.notes.filter(e=>!e.isDrum&&e.program>=this.BASS_PROG_RANGE[0]&&e.program<=this.BASS_PROG_RANGE[1]),i.notes=e.notes.filter(e=>e.isDrum),r.tidy(()=>r.concat([this.melConverter.toTensor(t),this.bassConverter.toTensor(n),this.drumsConverter.toTensor(i)],-1))}async toNoteSequence(e,t,n){const i=r.split(e,[this.melConverter.depth,this.bassConverter.depth,this.drumsConverter.depth],-1),o=await this.melConverter.toNoteSequence(i[0],t,n);o.notes.forEach(e=>{e.instrument=0,e.program=0});const s=await this.bassConverter.toNoteSequence(i[1],t,n);o.notes.push(...s.notes.map(e=>(e.instrument=1,e.program=this.BASS_PROG_RANGE[0],e)));const a=await this.drumsConverter.toNoteSequence(i[2],t,n);return o.notes.push(...a.notes.map(e=>(e.instrument=2,e))),i.forEach(e=>e.dispose()),o}}class g extends l{constructor(e){super(e),this.SEGMENTED_BY_TRACK=!0,this.stepsPerQuarter=e.stepsPerQuarter,this.totalSteps=e.totalSteps,this.numVelocityBins=e.numVelocityBins,this.minPitch=e.minPitch?e.minPitch:o.MIN_MIDI_PITCH,this.maxPitch=e.maxPitch?e.maxPitch:o.MAX_MIDI_PITCH,this.numPitches=this.maxPitch-this.minPitch+1,this.performanceEventDepth=2*this.numPitches+this.totalSteps+this.numVelocityBins,this.numPrograms=o.MAX_MIDI_PROGRAM-o.MIN_MIDI_PROGRAM+2,this.endToken=this.performanceEventDepth+this.numPrograms,this.depth=this.endToken+1,this.endTensor=r.tidy(()=>r.oneHot(r.tensor1d([this.endToken],"int32"),this.depth).as1D())}trackToTensor(e){const t=this.numSteps/this.numSegments;let n=void 0;if(e){for(;e.events.length>t-2;)e.events.pop();(n=r.buffer([e.events.length+2],"int32")).set(this.performanceEventDepth+(e.isDrum?this.numPrograms-1:e.program),0),e.events.forEach((e,t)=>{switch(e.type){case"note-on":n.set(e.pitch-this.minPitch,t+1);break;case"note-off":n.set(this.numPitches+e.pitch-this.minPitch,t+1);break;case"time-shift":n.set(2*this.numPitches+e.steps-1,t+1);break;case"velocity-change":n.set(2*this.numPitches+this.totalSteps+e.velocityBin-1,t+1);break;default:throw new Error(`Unrecognized performance event: ${e}`)}}),n.set(this.endToken,e.events.length+1)}else n=r.buffer([1],"int32",new Int32Array([this.endToken]));return r.tidy(()=>{const e=r.oneHot(n.toTensor(),this.depth);return e.pad([[0,t-e.shape[0]],[0,0]])})}toTensor(e){if(a.assertIsRelativeQuantizedSequence(e),e.quantizationInfo.stepsPerQuarter!==this.stepsPerQuarter)throw new Error(`Steps per quarter note mismatch: ${e.quantizationInfo.stepsPerQuarter} != ${this.stepsPerQuarter}`);const t=a.clone(e);t.notes=e.notes.filter(e=>e.pitch>=this.minPitch&&e.pitch<=this.maxPitch);const n=new Set(t.notes.map(e=>e.instrument)),i=Array.from(n).map(e=>s.Performance.fromNoteSequence(t,this.totalSteps,this.numVelocityBins,e)).sort((e,t)=>t.isDrum?-1:e.isDrum?1:e.program-t.program);for(;i.length>this.numSegments;)i.pop();for(i.forEach(e=>e.setNumSteps(this.totalSteps));i.length<this.numSegments;)i.push(void 0);return r.tidy(()=>r.concat(i.map(e=>this.trackToTensor(e)),0))}tokensToTrack(e){const t=e.indexOf(this.endToken),n=t>=0?t:e.length,r=e.slice(0,n),i=r.filter(e=>e<this.performanceEventDepth),o=r.filter(e=>e>=this.performanceEventDepth),[a,c]=o.length?o[0]-this.performanceEventDepth<this.numPrograms-1?[o[0]-this.performanceEventDepth,!1]:[0,!0]:[0,!1],u=Array.from(i).map(e=>{if(e<this.numPitches)return{type:"note-on",pitch:this.minPitch+e};if(e<2*this.numPitches)return{type:"note-off",pitch:this.minPitch+e-this.numPitches};if(e<2*this.numPitches+this.totalSteps)return{type:"time-shift",steps:e-2*this.numPitches+1};if(e<2*this.numPitches+this.totalSteps+this.numVelocityBins)return{type:"velocity-change",velocityBin:e-2*this.numPitches-this.totalSteps+1};throw new Error(`Invalid performance event token: ${e}`)});return new s.Performance(u,this.totalSteps,this.numVelocityBins,a,c)}async toNoteSequence(e,t=this.stepsPerQuarter,n){const i=y(t,n);i.totalQuantizedSteps=this.totalSteps;const o=r.tidy(()=>r.split(e.argMax(1),this.numSegments));return(await Promise.all(o.map(async e=>{const t=await e.data(),n=this.tokensToTrack(t);return e.dispose(),n}))).forEach((e,t)=>{e.setNumSteps(this.totalSteps),i.notes.push(...e.toNoteSequence(t).notes)}),i}}class S extends l{constructor(e){super(e),this.TAPIFY_CHANNEL=3,this.stepsPerQuarter=e.stepsPerQuarter||o.DEFAULT_STEPS_PER_QUARTER,this.pitchClasses=e.pitchClasses||c,this.pitchToClass=new Map;for(let e=0;e<this.pitchClasses.length;++e)this.pitchClasses[e].forEach(t=>{this.pitchToClass.set(t,e)});this.humanize=e.humanize||!1,this.tapify=e.tapify||!1,this.splitInstruments=e.splitInstruments||!1,this.depth=3}toTensor(e){const t=a.isRelativeQuantizedSequence(e)?e:a.quantizeNoteSequence(e,this.stepsPerQuarter),n=this.numSteps,i=t.tempos&&t.tempos.length?t.tempos[0].qpm:o.DEFAULT_QUARTERS_PER_MINUTE,s=60/i/this.stepsPerQuarter,c=[];for(let e=0;e<n;++e)c.push(new Map);t.notes.forEach(e=>{if(!this.tapify&&!this.pitchToClass.has(e.pitch))return;const t=e.quantizedStartStep;if(t>=c.length)throw Error(`Model does not support sequences with more than ${n} steps (${n*s} seconds at qpm ${i}).`);const r=this.tapify?this.TAPIFY_CHANNEL:this.pitchToClass.get(e.pitch);(!c[t].has(r)||c[t].get(r).velocity<e.velocity)&&c[t].set(r,e)});const u=this.pitchClasses.length,l=r.buffer([n,u]),p=r.buffer([n,u]),h=r.buffer([n,u]);function d(e){if(void 0===e.startTime)return 0;const t=e.startTime;return 2*(e.quantizedStartStep*s-t)/s}for(let e=0;e<n;++e)for(let t=0;t<u;++t){const n=c[e].get(t);l.set(n?1:0,e,t),this.humanize||this.tapify||p.set(n?n.velocity/o.MAX_MIDI_VELOCITY:0,e,t),this.humanize||h.set(n?d(n):0,e,t)}return r.tidy(()=>{const e=l.toTensor(),t=p.toTensor(),i=h.toTensor(),o=this.splitInstruments?n*u:n;return r.concat([e.as2D(o,-1),t.as2D(o,-1),i.as2D(o,-1)],1)})}async toNoteSequence(e,t,n=o.DEFAULT_QUARTERS_PER_MINUTE){if(t&&t!==this.stepsPerQuarter)throw Error("`stepsPerQuarter` is set by the model.");t=this.stepsPerQuarter;const r=this.splitInstruments?e.shape[0]/this.pitchClasses.length:e.shape[0],s=60/n/this.stepsPerQuarter,a=i.a.create({totalTime:r*s,tempos:[{qpm:n}]}),c=await e.data();function u(e,t,n){return Math.min(Math.max(e,t),n)}const l=this.pitchClasses.length;for(let e=0;e<r;++e){const t=c.slice(e*l*this.depth,(e+1)*l*this.depth);for(let n=0;n<l;++n){const r=t[this.splitInstruments?n*this.depth:n],c=t[this.splitInstruments?n*this.depth+1:l+n],p=t[this.splitInstruments?n*this.depth+2:2*l+n];if(r>.5){const t=u(Math.round(c*o.MAX_MIDI_VELOCITY),o.MIN_MIDI_VELOCITY,o.MAX_MIDI_VELOCITY),r=u(p/2,-.5,.5);a.notes.push(i.a.Note.create({pitch:this.pitchClasses[n][0],startTime:(e-r)*s,endTime:(e-r+1)*s,velocity:t,isDrum:!0}))}}}return a}}function y(e=o.DEFAULT_STEPS_PER_QUARTER,t=o.DEFAULT_QUARTERS_PER_MINUTE){return i.a.create({quantizationInfo:{stepsPerQuarter:e},tempos:[{qpm:t}]})}},function(e,t,n){"use strict";n.r(t),n.d(t,"Performance",(function(){return a}));var r=n(2),i=n(1),o=n(6),s=n(5);class a{constructor(e,t,n,r,i){this.events=e,this.maxShiftSteps=t,this.numVelocityBins=n,this.program=r,this.isDrum=i}static fromNoteSequence(e,t,n,r){o.assertIsQuantizedSequence(e);const s=e.notes.filter((e,t)=>void 0===r||e.instrument===r),c=s.sort((e,t)=>e.startTime===t.startTime?e.pitch-t.pitch:e.startTime-t.startTime),u=c.map((e,t)=>({step:e.quantizedStartStep,index:t,isOffset:0})),l=c.map((e,t)=>({step:e.quantizedEndStep,index:t,isOffset:1})),p=u.concat(l).sort((e,t)=>e.step===t.step?e.index===t.index?e.isOffset-t.isOffset:e.index-t.index:e.step-t.step),h=n?Math.ceil((i.MIDI_VELOCITIES-1)/n):void 0,d=[];let m=0,f=n;for(const e of p){if(e.step>m){for(;e.step>m+t;)d.push({type:"time-shift",steps:t}),m+=t;d.push({type:"time-shift",steps:e.step-m}),m=e.step}if(e.isOffset)d.push({type:"note-off",pitch:c[e.index].pitch});else{if(h){const t=Math.floor((c[e.index].velocity-i.MIN_MIDI_VELOCITY-1)/h)+1;t!==f&&(d.push({type:"velocity-change",velocityBin:t}),f=t)}d.push({type:"note-on",pitch:c[e.index].pitch})}}const g=!!s.some(e=>e.isDrum)&&(!s.some(e=>!e.isDrum)||void 0),S=Array.from(new Set(s.map(e=>e.program))),y=g||1!==S.length?void 0:S[0],w=new a(d,t,n,y,g);return w.setNumSteps(e.totalQuantizedSteps),w}getNumSteps(){return this.events.filter(e=>"time-shift"===e.type).map(e=>e.steps).reduce((e,t)=>e+t,0)}setNumSteps(e){let t=this.getNumSteps();if(t<e){if(this.events.length){const n=this.events[this.events.length-1];if("time-shift"===n.type){const r=Math.min(e-t,this.maxShiftSteps-n.steps);n.steps+=r,t+=r}}for(;t<e;)t+this.maxShiftSteps>e?(this.events.push({type:"time-shift",steps:e-t}),t=e):(this.events.push({type:"time-shift",steps:this.maxShiftSteps}),t+=this.maxShiftSteps)}else if(t>e)for(;this.events.length&&t>e;){const n=this.events[this.events.length-1];"time-shift"===n.type?t-n.steps<e?(n.steps-=t-e,t=e):(this.events.pop(),t-=n.steps):this.events.pop()}}toNoteSequence(e){const t=this.numVelocityBins?Math.ceil((i.MIDI_VELOCITIES-1)/this.numVelocityBins):void 0,n=r.a.create();let o=0,a=void 0;const c=new Map;for(let e=i.MIN_MIDI_PITCH;e<=i.MAX_MIDI_PITCH;++e)c.set(e,[]);for(const u of this.events)switch(u.type){case"note-on":c.get(u.pitch).push([o,a]);break;case"note-off":const l=c.get(u.pitch);if(l.length){const[t,i]=l.shift();o>t?n.notes.push(r.a.Note.create({pitch:u.pitch,velocity:i,instrument:e,quantizedStartStep:t,quantizedEndStep:o,program:this.program,isDrum:this.isDrum})):s.log("Ignoring zero-length note: "+`(pitch = ${u.pitch}, step = ${o})`,"Performance")}else s.log("Ignoring note-off with no previous note-on:"+`(pitch = ${u.pitch}, step = ${o})`,"Performance");break;case"time-shift":o+=u.steps;break;case"velocity-change":if(!t)throw new Error(`Unexpected velocity change event: ${u}`);a=i.MIN_MIDI_VELOCITY+(u.velocityBin-1)*t+1;break;default:throw new Error(`Unrecognized performance event: ${u}`)}return c.forEach((t,i)=>{for(const[a,c]of t)o>a?n.notes.push(r.a.Note.create({pitch:i,velocity:c,instrument:e,quantizedStartStep:a,quantizedEndStep:o,program:this.program,isDrum:this.isDrum})):s.log("Ignoring zero-length note: "+`(pitch = ${i}, step = ${o})`,"Performance")}),n.totalQuantizedSteps=o,n}}},function(e,t,n){"use strict";var r,i,o=n(14),s=o.Reader,a=o.Writer,c=o.util,u=o.roots.default||(o.roots.default={});u.tensorflow=((i={}).magenta=((r={}).NoteSequence=function(){function e(e){if(this.timeSignatures=[],this.keySignatures=[],this.tempos=[],this.notes=[],this.pitchBends=[],this.controlChanges=[],this.partInfos=[],this.textAnnotations=[],this.sectionAnnotations=[],this.sectionGroups=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t,n;return e.prototype.id="",e.prototype.filename="",e.prototype.referenceNumber=c.Long?c.Long.fromBits(0,0,!1):0,e.prototype.collectionName="",e.prototype.ticksPerQuarter=0,e.prototype.timeSignatures=c.emptyArray,e.prototype.keySignatures=c.emptyArray,e.prototype.tempos=c.emptyArray,e.prototype.notes=c.emptyArray,e.prototype.totalTime=0,e.prototype.totalQuantizedSteps=c.Long?c.Long.fromBits(0,0,!1):0,e.prototype.pitchBends=c.emptyArray,e.prototype.controlChanges=c.emptyArray,e.prototype.partInfos=c.emptyArray,e.prototype.sourceInfo=null,e.prototype.textAnnotations=c.emptyArray,e.prototype.sectionAnnotations=c.emptyArray,e.prototype.sectionGroups=c.emptyArray,e.prototype.quantizationInfo=null,e.prototype.subsequenceInfo=null,e.prototype.sequenceMetadata=null,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=a.create()),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(10).string(e.id),null!=e.filename&&e.hasOwnProperty("filename")&&t.uint32(18).string(e.filename),null!=e.collectionName&&e.hasOwnProperty("collectionName")&&t.uint32(26).string(e.collectionName),null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&t.uint32(32).int32(e.ticksPerQuarter),null!=e.timeSignatures&&e.timeSignatures.length)for(var n=0;n<e.timeSignatures.length;++n)u.tensorflow.magenta.NoteSequence.TimeSignature.encode(e.timeSignatures[n],t.uint32(42).fork()).ldelim();if(null!=e.keySignatures&&e.keySignatures.length)for(n=0;n<e.keySignatures.length;++n)u.tensorflow.magenta.NoteSequence.KeySignature.encode(e.keySignatures[n],t.uint32(50).fork()).ldelim();if(null!=e.tempos&&e.tempos.length)for(n=0;n<e.tempos.length;++n)u.tensorflow.magenta.NoteSequence.Tempo.encode(e.tempos[n],t.uint32(58).fork()).ldelim();if(null!=e.notes&&e.notes.length)for(n=0;n<e.notes.length;++n)u.tensorflow.magenta.NoteSequence.Note.encode(e.notes[n],t.uint32(66).fork()).ldelim();if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&t.uint32(73).double(e.totalTime),null!=e.pitchBends&&e.pitchBends.length)for(n=0;n<e.pitchBends.length;++n)u.tensorflow.magenta.NoteSequence.PitchBend.encode(e.pitchBends[n],t.uint32(82).fork()).ldelim();if(null!=e.controlChanges&&e.controlChanges.length)for(n=0;n<e.controlChanges.length;++n)u.tensorflow.magenta.NoteSequence.ControlChange.encode(e.controlChanges[n],t.uint32(90).fork()).ldelim();if(null!=e.partInfos&&e.partInfos.length)for(n=0;n<e.partInfos.length;++n)u.tensorflow.magenta.NoteSequence.PartInfo.encode(e.partInfos[n],t.uint32(98).fork()).ldelim();if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&u.tensorflow.magenta.NoteSequence.SourceInfo.encode(e.sourceInfo,t.uint32(106).fork()).ldelim(),null!=e.textAnnotations&&e.textAnnotations.length)for(n=0;n<e.textAnnotations.length;++n)u.tensorflow.magenta.NoteSequence.TextAnnotation.encode(e.textAnnotations[n],t.uint32(114).fork()).ldelim();if(null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&u.tensorflow.magenta.NoteSequence.QuantizationInfo.encode(e.quantizationInfo,t.uint32(122).fork()).ldelim(),null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&t.uint32(128).int64(e.totalQuantizedSteps),null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&u.tensorflow.magenta.NoteSequence.SubsequenceInfo.encode(e.subsequenceInfo,t.uint32(138).fork()).ldelim(),null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&t.uint32(144).int64(e.referenceNumber),null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&u.tensorflow.magenta.SequenceMetadata.encode(e.sequenceMetadata,t.uint32(154).fork()).ldelim(),null!=e.sectionAnnotations&&e.sectionAnnotations.length)for(n=0;n<e.sectionAnnotations.length;++n)u.tensorflow.magenta.NoteSequence.SectionAnnotation.encode(e.sectionAnnotations[n],t.uint32(162).fork()).ldelim();if(null!=e.sectionGroups&&e.sectionGroups.length)for(n=0;n<e.sectionGroups.length;++n)u.tensorflow.magenta.NoteSequence.SectionGroup.encode(e.sectionGroups[n],t.uint32(170).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.id=e.string();break;case 2:r.filename=e.string();break;case 18:r.referenceNumber=c.Long?e.int64().toNumber():e.int64();break;case 3:r.collectionName=e.string();break;case 4:r.ticksPerQuarter=e.int32();break;case 5:r.timeSignatures&&r.timeSignatures.length||(r.timeSignatures=[]),r.timeSignatures.push(u.tensorflow.magenta.NoteSequence.TimeSignature.decode(e,e.uint32()));break;case 6:r.keySignatures&&r.keySignatures.length||(r.keySignatures=[]),r.keySignatures.push(u.tensorflow.magenta.NoteSequence.KeySignature.decode(e,e.uint32()));break;case 7:r.tempos&&r.tempos.length||(r.tempos=[]),r.tempos.push(u.tensorflow.magenta.NoteSequence.Tempo.decode(e,e.uint32()));break;case 8:r.notes&&r.notes.length||(r.notes=[]),r.notes.push(u.tensorflow.magenta.NoteSequence.Note.decode(e,e.uint32()));break;case 9:r.totalTime=e.double();break;case 16:r.totalQuantizedSteps=c.Long?e.int64().toNumber():e.int64();break;case 10:r.pitchBends&&r.pitchBends.length||(r.pitchBends=[]),r.pitchBends.push(u.tensorflow.magenta.NoteSequence.PitchBend.decode(e,e.uint32()));break;case 11:r.controlChanges&&r.controlChanges.length||(r.controlChanges=[]),r.controlChanges.push(u.tensorflow.magenta.NoteSequence.ControlChange.decode(e,e.uint32()));break;case 12:r.partInfos&&r.partInfos.length||(r.partInfos=[]),r.partInfos.push(u.tensorflow.magenta.NoteSequence.PartInfo.decode(e,e.uint32()));break;case 13:r.sourceInfo=u.tensorflow.magenta.NoteSequence.SourceInfo.decode(e,e.uint32());break;case 14:r.textAnnotations&&r.textAnnotations.length||(r.textAnnotations=[]),r.textAnnotations.push(u.tensorflow.magenta.NoteSequence.TextAnnotation.decode(e,e.uint32()));break;case 20:r.sectionAnnotations&&r.sectionAnnotations.length||(r.sectionAnnotations=[]),r.sectionAnnotations.push(u.tensorflow.magenta.NoteSequence.SectionAnnotation.decode(e,e.uint32()));break;case 21:r.sectionGroups&&r.sectionGroups.length||(r.sectionGroups=[]),r.sectionGroups.push(u.tensorflow.magenta.NoteSequence.SectionGroup.decode(e,e.uint32()));break;case 15:r.quantizationInfo=u.tensorflow.magenta.NoteSequence.QuantizationInfo.decode(e,e.uint32());break;case 17:r.subsequenceInfo=u.tensorflow.magenta.NoteSequence.SubsequenceInfo.decode(e,e.uint32());break;case 19:r.sequenceMetadata=u.tensorflow.magenta.SequenceMetadata.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.id&&e.hasOwnProperty("id")&&!c.isString(e.id))return"id: string expected";if(null!=e.filename&&e.hasOwnProperty("filename")&&!c.isString(e.filename))return"filename: string expected";if(null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&!(c.isInteger(e.referenceNumber)||e.referenceNumber&&c.isInteger(e.referenceNumber.low)&&c.isInteger(e.referenceNumber.high)))return"referenceNumber: integer|Long expected";if(null!=e.collectionName&&e.hasOwnProperty("collectionName")&&!c.isString(e.collectionName))return"collectionName: string expected";if(null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&!c.isInteger(e.ticksPerQuarter))return"ticksPerQuarter: integer expected";if(null!=e.timeSignatures&&e.hasOwnProperty("timeSignatures")){if(!Array.isArray(e.timeSignatures))return"timeSignatures: array expected";for(var t=0;t<e.timeSignatures.length;++t)if(n=u.tensorflow.magenta.NoteSequence.TimeSignature.verify(e.timeSignatures[t]))return"timeSignatures."+n}if(null!=e.keySignatures&&e.hasOwnProperty("keySignatures")){if(!Array.isArray(e.keySignatures))return"keySignatures: array expected";for(t=0;t<e.keySignatures.length;++t)if(n=u.tensorflow.magenta.NoteSequence.KeySignature.verify(e.keySignatures[t]))return"keySignatures."+n}if(null!=e.tempos&&e.hasOwnProperty("tempos")){if(!Array.isArray(e.tempos))return"tempos: array expected";for(t=0;t<e.tempos.length;++t)if(n=u.tensorflow.magenta.NoteSequence.Tempo.verify(e.tempos[t]))return"tempos."+n}if(null!=e.notes&&e.hasOwnProperty("notes")){if(!Array.isArray(e.notes))return"notes: array expected";for(t=0;t<e.notes.length;++t)if(n=u.tensorflow.magenta.NoteSequence.Note.verify(e.notes[t]))return"notes."+n}if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&"number"!=typeof e.totalTime)return"totalTime: number expected";if(null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&!(c.isInteger(e.totalQuantizedSteps)||e.totalQuantizedSteps&&c.isInteger(e.totalQuantizedSteps.low)&&c.isInteger(e.totalQuantizedSteps.high)))return"totalQuantizedSteps: integer|Long expected";if(null!=e.pitchBends&&e.hasOwnProperty("pitchBends")){if(!Array.isArray(e.pitchBends))return"pitchBends: array expected";for(t=0;t<e.pitchBends.length;++t)if(n=u.tensorflow.magenta.NoteSequence.PitchBend.verify(e.pitchBends[t]))return"pitchBends."+n}if(null!=e.controlChanges&&e.hasOwnProperty("controlChanges")){if(!Array.isArray(e.controlChanges))return"controlChanges: array expected";for(t=0;t<e.controlChanges.length;++t)if(n=u.tensorflow.magenta.NoteSequence.ControlChange.verify(e.controlChanges[t]))return"controlChanges."+n}if(null!=e.partInfos&&e.hasOwnProperty("partInfos")){if(!Array.isArray(e.partInfos))return"partInfos: array expected";for(t=0;t<e.partInfos.length;++t)if(n=u.tensorflow.magenta.NoteSequence.PartInfo.verify(e.partInfos[t]))return"partInfos."+n}if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&(n=u.tensorflow.magenta.NoteSequence.SourceInfo.verify(e.sourceInfo)))return"sourceInfo."+n;if(null!=e.textAnnotations&&e.hasOwnProperty("textAnnotations")){if(!Array.isArray(e.textAnnotations))return"textAnnotations: array expected";for(t=0;t<e.textAnnotations.length;++t)if(n=u.tensorflow.magenta.NoteSequence.TextAnnotation.verify(e.textAnnotations[t]))return"textAnnotations."+n}if(null!=e.sectionAnnotations&&e.hasOwnProperty("sectionAnnotations")){if(!Array.isArray(e.sectionAnnotations))return"sectionAnnotations: array expected";for(t=0;t<e.sectionAnnotations.length;++t)if(n=u.tensorflow.magenta.NoteSequence.SectionAnnotation.verify(e.sectionAnnotations[t]))return"sectionAnnotations."+n}if(null!=e.sectionGroups&&e.hasOwnProperty("sectionGroups")){if(!Array.isArray(e.sectionGroups))return"sectionGroups: array expected";for(t=0;t<e.sectionGroups.length;++t){var n;if(n=u.tensorflow.magenta.NoteSequence.SectionGroup.verify(e.sectionGroups[t]))return"sectionGroups."+n}}return null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&(n=u.tensorflow.magenta.NoteSequence.QuantizationInfo.verify(e.quantizationInfo))?"quantizationInfo."+n:null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&(n=u.tensorflow.magenta.NoteSequence.SubsequenceInfo.verify(e.subsequenceInfo))?"subsequenceInfo."+n:null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&(n=u.tensorflow.magenta.SequenceMetadata.verify(e.sequenceMetadata))?"sequenceMetadata."+n:null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence)return e;var t=new u.tensorflow.magenta.NoteSequence;if(null!=e.id&&(t.id=String(e.id)),null!=e.filename&&(t.filename=String(e.filename)),null!=e.referenceNumber&&(c.Long?(t.referenceNumber=c.Long.fromValue(e.referenceNumber)).unsigned=!1:"string"==typeof e.referenceNumber?t.referenceNumber=parseInt(e.referenceNumber,10):"number"==typeof e.referenceNumber?t.referenceNumber=e.referenceNumber:"object"==typeof e.referenceNumber&&(t.referenceNumber=new c.LongBits(e.referenceNumber.low>>>0,e.referenceNumber.high>>>0).toNumber())),null!=e.collectionName&&(t.collectionName=String(e.collectionName)),null!=e.ticksPerQuarter&&(t.ticksPerQuarter=0|e.ticksPerQuarter),e.timeSignatures){if(!Array.isArray(e.timeSignatures))throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: array expected");t.timeSignatures=[];for(var n=0;n<e.timeSignatures.length;++n){if("object"!=typeof e.timeSignatures[n])throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: object expected");t.timeSignatures[n]=u.tensorflow.magenta.NoteSequence.TimeSignature.fromObject(e.timeSignatures[n])}}if(e.keySignatures){if(!Array.isArray(e.keySignatures))throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: array expected");for(t.keySignatures=[],n=0;n<e.keySignatures.length;++n){if("object"!=typeof e.keySignatures[n])throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: object expected");t.keySignatures[n]=u.tensorflow.magenta.NoteSequence.KeySignature.fromObject(e.keySignatures[n])}}if(e.tempos){if(!Array.isArray(e.tempos))throw TypeError(".tensorflow.magenta.NoteSequence.tempos: array expected");for(t.tempos=[],n=0;n<e.tempos.length;++n){if("object"!=typeof e.tempos[n])throw TypeError(".tensorflow.magenta.NoteSequence.tempos: object expected");t.tempos[n]=u.tensorflow.magenta.NoteSequence.Tempo.fromObject(e.tempos[n])}}if(e.notes){if(!Array.isArray(e.notes))throw TypeError(".tensorflow.magenta.NoteSequence.notes: array expected");for(t.notes=[],n=0;n<e.notes.length;++n){if("object"!=typeof e.notes[n])throw TypeError(".tensorflow.magenta.NoteSequence.notes: object expected");t.notes[n]=u.tensorflow.magenta.NoteSequence.Note.fromObject(e.notes[n])}}if(null!=e.totalTime&&(t.totalTime=Number(e.totalTime)),null!=e.totalQuantizedSteps&&(c.Long?(t.totalQuantizedSteps=c.Long.fromValue(e.totalQuantizedSteps)).unsigned=!1:"string"==typeof e.totalQuantizedSteps?t.totalQuantizedSteps=parseInt(e.totalQuantizedSteps,10):"number"==typeof e.totalQuantizedSteps?t.totalQuantizedSteps=e.totalQuantizedSteps:"object"==typeof e.totalQuantizedSteps&&(t.totalQuantizedSteps=new c.LongBits(e.totalQuantizedSteps.low>>>0,e.totalQuantizedSteps.high>>>0).toNumber())),e.pitchBends){if(!Array.isArray(e.pitchBends))throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: array expected");for(t.pitchBends=[],n=0;n<e.pitchBends.length;++n){if("object"!=typeof e.pitchBends[n])throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: object expected");t.pitchBends[n]=u.tensorflow.magenta.NoteSequence.PitchBend.fromObject(e.pitchBends[n])}}if(e.controlChanges){if(!Array.isArray(e.controlChanges))throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: array expected");for(t.controlChanges=[],n=0;n<e.controlChanges.length;++n){if("object"!=typeof e.controlChanges[n])throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: object expected");t.controlChanges[n]=u.tensorflow.magenta.NoteSequence.ControlChange.fromObject(e.controlChanges[n])}}if(e.partInfos){if(!Array.isArray(e.partInfos))throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: array expected");for(t.partInfos=[],n=0;n<e.partInfos.length;++n){if("object"!=typeof e.partInfos[n])throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: object expected");t.partInfos[n]=u.tensorflow.magenta.NoteSequence.PartInfo.fromObject(e.partInfos[n])}}if(null!=e.sourceInfo){if("object"!=typeof e.sourceInfo)throw TypeError(".tensorflow.magenta.NoteSequence.sourceInfo: object expected");t.sourceInfo=u.tensorflow.magenta.NoteSequence.SourceInfo.fromObject(e.sourceInfo)}if(e.textAnnotations){if(!Array.isArray(e.textAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: array expected");for(t.textAnnotations=[],n=0;n<e.textAnnotations.length;++n){if("object"!=typeof e.textAnnotations[n])throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: object expected");t.textAnnotations[n]=u.tensorflow.magenta.NoteSequence.TextAnnotation.fromObject(e.textAnnotations[n])}}if(e.sectionAnnotations){if(!Array.isArray(e.sectionAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: array expected");for(t.sectionAnnotations=[],n=0;n<e.sectionAnnotations.length;++n){if("object"!=typeof e.sectionAnnotations[n])throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: object expected");t.sectionAnnotations[n]=u.tensorflow.magenta.NoteSequence.SectionAnnotation.fromObject(e.sectionAnnotations[n])}}if(e.sectionGroups){if(!Array.isArray(e.sectionGroups))throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: array expected");for(t.sectionGroups=[],n=0;n<e.sectionGroups.length;++n){if("object"!=typeof e.sectionGroups[n])throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: object expected");t.sectionGroups[n]=u.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(e.sectionGroups[n])}}if(null!=e.quantizationInfo){if("object"!=typeof e.quantizationInfo)throw TypeError(".tensorflow.magenta.NoteSequence.quantizationInfo: object expected");t.quantizationInfo=u.tensorflow.magenta.NoteSequence.QuantizationInfo.fromObject(e.quantizationInfo)}if(null!=e.subsequenceInfo){if("object"!=typeof e.subsequenceInfo)throw TypeError(".tensorflow.magenta.NoteSequence.subsequenceInfo: object expected");t.subsequenceInfo=u.tensorflow.magenta.NoteSequence.SubsequenceInfo.fromObject(e.subsequenceInfo)}if(null!=e.sequenceMetadata){if("object"!=typeof e.sequenceMetadata)throw TypeError(".tensorflow.magenta.NoteSequence.sequenceMetadata: object expected");t.sequenceMetadata=u.tensorflow.magenta.SequenceMetadata.fromObject(e.sequenceMetadata)}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.timeSignatures=[],n.keySignatures=[],n.tempos=[],n.notes=[],n.pitchBends=[],n.controlChanges=[],n.partInfos=[],n.textAnnotations=[],n.sectionAnnotations=[],n.sectionGroups=[]),t.defaults){if(n.id="",n.filename="",n.collectionName="",n.ticksPerQuarter=0,n.totalTime=0,n.sourceInfo=null,n.quantizationInfo=null,c.Long){var r=new c.Long(0,0,!1);n.totalQuantizedSteps=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.totalQuantizedSteps=t.longs===String?"0":0;n.subsequenceInfo=null,c.Long?(r=new c.Long(0,0,!1),n.referenceNumber=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.referenceNumber=t.longs===String?"0":0,n.sequenceMetadata=null}if(null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.filename&&e.hasOwnProperty("filename")&&(n.filename=e.filename),null!=e.collectionName&&e.hasOwnProperty("collectionName")&&(n.collectionName=e.collectionName),null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&(n.ticksPerQuarter=e.ticksPerQuarter),e.timeSignatures&&e.timeSignatures.length){n.timeSignatures=[];for(var i=0;i<e.timeSignatures.length;++i)n.timeSignatures[i]=u.tensorflow.magenta.NoteSequence.TimeSignature.toObject(e.timeSignatures[i],t)}if(e.keySignatures&&e.keySignatures.length)for(n.keySignatures=[],i=0;i<e.keySignatures.length;++i)n.keySignatures[i]=u.tensorflow.magenta.NoteSequence.KeySignature.toObject(e.keySignatures[i],t);if(e.tempos&&e.tempos.length)for(n.tempos=[],i=0;i<e.tempos.length;++i)n.tempos[i]=u.tensorflow.magenta.NoteSequence.Tempo.toObject(e.tempos[i],t);if(e.notes&&e.notes.length)for(n.notes=[],i=0;i<e.notes.length;++i)n.notes[i]=u.tensorflow.magenta.NoteSequence.Note.toObject(e.notes[i],t);if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&(n.totalTime=t.json&&!isFinite(e.totalTime)?String(e.totalTime):e.totalTime),e.pitchBends&&e.pitchBends.length)for(n.pitchBends=[],i=0;i<e.pitchBends.length;++i)n.pitchBends[i]=u.tensorflow.magenta.NoteSequence.PitchBend.toObject(e.pitchBends[i],t);if(e.controlChanges&&e.controlChanges.length)for(n.controlChanges=[],i=0;i<e.controlChanges.length;++i)n.controlChanges[i]=u.tensorflow.magenta.NoteSequence.ControlChange.toObject(e.controlChanges[i],t);if(e.partInfos&&e.partInfos.length)for(n.partInfos=[],i=0;i<e.partInfos.length;++i)n.partInfos[i]=u.tensorflow.magenta.NoteSequence.PartInfo.toObject(e.partInfos[i],t);if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&(n.sourceInfo=u.tensorflow.magenta.NoteSequence.SourceInfo.toObject(e.sourceInfo,t)),e.textAnnotations&&e.textAnnotations.length)for(n.textAnnotations=[],i=0;i<e.textAnnotations.length;++i)n.textAnnotations[i]=u.tensorflow.magenta.NoteSequence.TextAnnotation.toObject(e.textAnnotations[i],t);if(null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&(n.quantizationInfo=u.tensorflow.magenta.NoteSequence.QuantizationInfo.toObject(e.quantizationInfo,t)),null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&("number"==typeof e.totalQuantizedSteps?n.totalQuantizedSteps=t.longs===String?String(e.totalQuantizedSteps):e.totalQuantizedSteps:n.totalQuantizedSteps=t.longs===String?c.Long.prototype.toString.call(e.totalQuantizedSteps):t.longs===Number?new c.LongBits(e.totalQuantizedSteps.low>>>0,e.totalQuantizedSteps.high>>>0).toNumber():e.totalQuantizedSteps),null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&(n.subsequenceInfo=u.tensorflow.magenta.NoteSequence.SubsequenceInfo.toObject(e.subsequenceInfo,t)),null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&("number"==typeof e.referenceNumber?n.referenceNumber=t.longs===String?String(e.referenceNumber):e.referenceNumber:n.referenceNumber=t.longs===String?c.Long.prototype.toString.call(e.referenceNumber):t.longs===Number?new c.LongBits(e.referenceNumber.low>>>0,e.referenceNumber.high>>>0).toNumber():e.referenceNumber),null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&(n.sequenceMetadata=u.tensorflow.magenta.SequenceMetadata.toObject(e.sequenceMetadata,t)),e.sectionAnnotations&&e.sectionAnnotations.length)for(n.sectionAnnotations=[],i=0;i<e.sectionAnnotations.length;++i)n.sectionAnnotations[i]=u.tensorflow.magenta.NoteSequence.SectionAnnotation.toObject(e.sectionAnnotations[i],t);if(e.sectionGroups&&e.sectionGroups.length)for(n.sectionGroups=[],i=0;i<e.sectionGroups.length;++i)n.sectionGroups[i]=u.tensorflow.magenta.NoteSequence.SectionGroup.toObject(e.sectionGroups[i],t);return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e.Note=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.pitch=0,e.prototype.pitchName=0,e.prototype.velocity=0,e.prototype.startTime=0,e.prototype.quantizedStartStep=c.Long?c.Long.fromBits(0,0,!1):0,e.prototype.endTime=0,e.prototype.quantizedEndStep=c.Long?c.Long.fromBits(0,0,!1):0,e.prototype.numerator=0,e.prototype.denominator=0,e.prototype.instrument=0,e.prototype.program=0,e.prototype.isDrum=!1,e.prototype.part=0,e.prototype.voice=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.pitch&&e.hasOwnProperty("pitch")&&t.uint32(8).int32(e.pitch),null!=e.velocity&&e.hasOwnProperty("velocity")&&t.uint32(16).int32(e.velocity),null!=e.startTime&&e.hasOwnProperty("startTime")&&t.uint32(25).double(e.startTime),null!=e.endTime&&e.hasOwnProperty("endTime")&&t.uint32(33).double(e.endTime),null!=e.numerator&&e.hasOwnProperty("numerator")&&t.uint32(40).int32(e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&t.uint32(48).int32(e.denominator),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(56).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(64).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(72).bool(e.isDrum),null!=e.part&&e.hasOwnProperty("part")&&t.uint32(80).int32(e.part),null!=e.pitchName&&e.hasOwnProperty("pitchName")&&t.uint32(88).int32(e.pitchName),null!=e.voice&&e.hasOwnProperty("voice")&&t.uint32(96).int32(e.voice),null!=e.quantizedStartStep&&e.hasOwnProperty("quantizedStartStep")&&t.uint32(104).int64(e.quantizedStartStep),null!=e.quantizedEndStep&&e.hasOwnProperty("quantizedEndStep")&&t.uint32(112).int64(e.quantizedEndStep),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.Note;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.pitch=e.int32();break;case 11:r.pitchName=e.int32();break;case 2:r.velocity=e.int32();break;case 3:r.startTime=e.double();break;case 13:r.quantizedStartStep=c.Long?e.int64().toNumber():e.int64();break;case 4:r.endTime=e.double();break;case 14:r.quantizedEndStep=c.Long?e.int64().toNumber():e.int64();break;case 5:r.numerator=e.int32();break;case 6:r.denominator=e.int32();break;case 7:r.instrument=e.int32();break;case 8:r.program=e.int32();break;case 9:r.isDrum=e.bool();break;case 10:r.part=e.int32();break;case 12:r.voice=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.pitch&&e.hasOwnProperty("pitch")&&!c.isInteger(e.pitch))return"pitch: integer expected";if(null!=e.pitchName&&e.hasOwnProperty("pitchName"))switch(e.pitchName){default:return"pitchName: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 32:case 33:case 34:case 35:}return null!=e.velocity&&e.hasOwnProperty("velocity")&&!c.isInteger(e.velocity)?"velocity: integer expected":null!=e.startTime&&e.hasOwnProperty("startTime")&&"number"!=typeof e.startTime?"startTime: number expected":null!=e.quantizedStartStep&&e.hasOwnProperty("quantizedStartStep")&&!(c.isInteger(e.quantizedStartStep)||e.quantizedStartStep&&c.isInteger(e.quantizedStartStep.low)&&c.isInteger(e.quantizedStartStep.high))?"quantizedStartStep: integer|Long expected":null!=e.endTime&&e.hasOwnProperty("endTime")&&"number"!=typeof e.endTime?"endTime: number expected":null!=e.quantizedEndStep&&e.hasOwnProperty("quantizedEndStep")&&!(c.isInteger(e.quantizedEndStep)||e.quantizedEndStep&&c.isInteger(e.quantizedEndStep.low)&&c.isInteger(e.quantizedEndStep.high))?"quantizedEndStep: integer|Long expected":null!=e.numerator&&e.hasOwnProperty("numerator")&&!c.isInteger(e.numerator)?"numerator: integer expected":null!=e.denominator&&e.hasOwnProperty("denominator")&&!c.isInteger(e.denominator)?"denominator: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!c.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!c.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!=typeof e.isDrum?"isDrum: boolean expected":null!=e.part&&e.hasOwnProperty("part")&&!c.isInteger(e.part)?"part: integer expected":null!=e.voice&&e.hasOwnProperty("voice")&&!c.isInteger(e.voice)?"voice: integer expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.Note)return e;var t=new u.tensorflow.magenta.NoteSequence.Note;switch(null!=e.pitch&&(t.pitch=0|e.pitch),e.pitchName){case"UNKNOWN_PITCH_NAME":case 0:t.pitchName=0;break;case"F_FLAT_FLAT":case 1:t.pitchName=1;break;case"C_FLAT_FLAT":case 2:t.pitchName=2;break;case"G_FLAT_FLAT":case 3:t.pitchName=3;break;case"D_FLAT_FLAT":case 4:t.pitchName=4;break;case"A_FLAT_FLAT":case 5:t.pitchName=5;break;case"E_FLAT_FLAT":case 6:t.pitchName=6;break;case"B_FLAT_FLAT":case 7:t.pitchName=7;break;case"F_FLAT":case 8:t.pitchName=8;break;case"C_FLAT":case 9:t.pitchName=9;break;case"G_FLAT":case 10:t.pitchName=10;break;case"D_FLAT":case 11:t.pitchName=11;break;case"A_FLAT":case 12:t.pitchName=12;break;case"E_FLAT":case 13:t.pitchName=13;break;case"B_FLAT":case 14:t.pitchName=14;break;case"F":case 15:t.pitchName=15;break;case"C":case 16:t.pitchName=16;break;case"G":case 17:t.pitchName=17;break;case"D":case 18:t.pitchName=18;break;case"A":case 19:t.pitchName=19;break;case"E":case 20:t.pitchName=20;break;case"B":case 21:t.pitchName=21;break;case"F_SHARP":case 22:t.pitchName=22;break;case"C_SHARP":case 23:t.pitchName=23;break;case"G_SHARP":case 24:t.pitchName=24;break;case"D_SHARP":case 25:t.pitchName=25;break;case"A_SHARP":case 26:t.pitchName=26;break;case"E_SHARP":case 27:t.pitchName=27;break;case"B_SHARP":case 28:t.pitchName=28;break;case"F_SHARP_SHARP":case 29:t.pitchName=29;break;case"C_SHARP_SHARP":case 30:t.pitchName=30;break;case"G_SHARP_SHARP":case 31:t.pitchName=31;break;case"D_SHARP_SHARP":case 32:t.pitchName=32;break;case"A_SHARP_SHARP":case 33:t.pitchName=33;break;case"E_SHARP_SHARP":case 34:t.pitchName=34;break;case"B_SHARP_SHARP":case 35:t.pitchName=35}return null!=e.velocity&&(t.velocity=0|e.velocity),null!=e.startTime&&(t.startTime=Number(e.startTime)),null!=e.quantizedStartStep&&(c.Long?(t.quantizedStartStep=c.Long.fromValue(e.quantizedStartStep)).unsigned=!1:"string"==typeof e.quantizedStartStep?t.quantizedStartStep=parseInt(e.quantizedStartStep,10):"number"==typeof e.quantizedStartStep?t.quantizedStartStep=e.quantizedStartStep:"object"==typeof e.quantizedStartStep&&(t.quantizedStartStep=new c.LongBits(e.quantizedStartStep.low>>>0,e.quantizedStartStep.high>>>0).toNumber())),null!=e.endTime&&(t.endTime=Number(e.endTime)),null!=e.quantizedEndStep&&(c.Long?(t.quantizedEndStep=c.Long.fromValue(e.quantizedEndStep)).unsigned=!1:"string"==typeof e.quantizedEndStep?t.quantizedEndStep=parseInt(e.quantizedEndStep,10):"number"==typeof e.quantizedEndStep?t.quantizedEndStep=e.quantizedEndStep:"object"==typeof e.quantizedEndStep&&(t.quantizedEndStep=new c.LongBits(e.quantizedEndStep.low>>>0,e.quantizedEndStep.high>>>0).toNumber())),null!=e.numerator&&(t.numerator=0|e.numerator),null!=e.denominator&&(t.denominator=0|e.denominator),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),null!=e.part&&(t.part=0|e.part),null!=e.voice&&(t.voice=0|e.voice),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(n.pitch=0,n.velocity=0,n.startTime=0,n.endTime=0,n.numerator=0,n.denominator=0,n.instrument=0,n.program=0,n.isDrum=!1,n.part=0,n.pitchName=t.enums===String?"UNKNOWN_PITCH_NAME":0,n.voice=0,c.Long){var r=new c.Long(0,0,!1);n.quantizedStartStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedStartStep=t.longs===String?"0":0;c.Long?(r=new c.Long(0,0,!1),n.quantizedEndStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.quantizedEndStep=t.longs===String?"0":0}return null!=e.pitch&&e.hasOwnProperty("pitch")&&(n.pitch=e.pitch),null!=e.velocity&&e.hasOwnProperty("velocity")&&(n.velocity=e.velocity),null!=e.startTime&&e.hasOwnProperty("startTime")&&(n.startTime=t.json&&!isFinite(e.startTime)?String(e.startTime):e.startTime),null!=e.endTime&&e.hasOwnProperty("endTime")&&(n.endTime=t.json&&!isFinite(e.endTime)?String(e.endTime):e.endTime),null!=e.numerator&&e.hasOwnProperty("numerator")&&(n.numerator=e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&(n.denominator=e.denominator),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),null!=e.part&&e.hasOwnProperty("part")&&(n.part=e.part),null!=e.pitchName&&e.hasOwnProperty("pitchName")&&(n.pitchName=t.enums===String?u.tensorflow.magenta.NoteSequence.PitchName[e.pitchName]:e.pitchName),null!=e.voice&&e.hasOwnProperty("voice")&&(n.voice=e.voice),null!=e.quantizedStartStep&&e.hasOwnProperty("quantizedStartStep")&&("number"==typeof e.quantizedStartStep?n.quantizedStartStep=t.longs===String?String(e.quantizedStartStep):e.quantizedStartStep:n.quantizedStartStep=t.longs===String?c.Long.prototype.toString.call(e.quantizedStartStep):t.longs===Number?new c.LongBits(e.quantizedStartStep.low>>>0,e.quantizedStartStep.high>>>0).toNumber():e.quantizedStartStep),null!=e.quantizedEndStep&&e.hasOwnProperty("quantizedEndStep")&&("number"==typeof e.quantizedEndStep?n.quantizedEndStep=t.longs===String?String(e.quantizedEndStep):e.quantizedEndStep:n.quantizedEndStep=t.longs===String?c.Long.prototype.toString.call(e.quantizedEndStep):t.longs===Number?new c.LongBits(e.quantizedEndStep.low>>>0,e.quantizedEndStep.high>>>0).toNumber():e.quantizedEndStep),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.PitchName=(t={},(n=Object.create(t))[t[0]="UNKNOWN_PITCH_NAME"]=0,n[t[1]="F_FLAT_FLAT"]=1,n[t[2]="C_FLAT_FLAT"]=2,n[t[3]="G_FLAT_FLAT"]=3,n[t[4]="D_FLAT_FLAT"]=4,n[t[5]="A_FLAT_FLAT"]=5,n[t[6]="E_FLAT_FLAT"]=6,n[t[7]="B_FLAT_FLAT"]=7,n[t[8]="F_FLAT"]=8,n[t[9]="C_FLAT"]=9,n[t[10]="G_FLAT"]=10,n[t[11]="D_FLAT"]=11,n[t[12]="A_FLAT"]=12,n[t[13]="E_FLAT"]=13,n[t[14]="B_FLAT"]=14,n[t[15]="F"]=15,n[t[16]="C"]=16,n[t[17]="G"]=17,n[t[18]="D"]=18,n[t[19]="A"]=19,n[t[20]="E"]=20,n[t[21]="B"]=21,n[t[22]="F_SHARP"]=22,n[t[23]="C_SHARP"]=23,n[t[24]="G_SHARP"]=24,n[t[25]="D_SHARP"]=25,n[t[26]="A_SHARP"]=26,n[t[27]="E_SHARP"]=27,n[t[28]="B_SHARP"]=28,n[t[29]="F_SHARP_SHARP"]=29,n[t[30]="C_SHARP_SHARP"]=30,n[t[31]="G_SHARP_SHARP"]=31,n[t[32]="D_SHARP_SHARP"]=32,n[t[33]="A_SHARP_SHARP"]=33,n[t[34]="E_SHARP_SHARP"]=34,n[t[35]="B_SHARP_SHARP"]=35,n),e.TimeSignature=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.numerator=0,e.prototype.denominator=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.numerator&&e.hasOwnProperty("numerator")&&t.uint32(16).int32(e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&t.uint32(24).int32(e.denominator),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.TimeSignature;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 2:r.numerator=e.int32();break;case 3:r.denominator=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.numerator&&e.hasOwnProperty("numerator")&&!c.isInteger(e.numerator)?"numerator: integer expected":null!=e.denominator&&e.hasOwnProperty("denominator")&&!c.isInteger(e.denominator)?"denominator: integer expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.TimeSignature)return e;var t=new u.tensorflow.magenta.NoteSequence.TimeSignature;return null!=e.time&&(t.time=Number(e.time)),null!=e.numerator&&(t.numerator=0|e.numerator),null!=e.denominator&&(t.denominator=0|e.denominator),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.numerator=0,n.denominator=0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.numerator&&e.hasOwnProperty("numerator")&&(n.numerator=e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&(n.denominator=e.denominator),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.KeySignature=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.key=0,e.prototype.mode=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.key&&e.hasOwnProperty("key")&&t.uint32(16).int32(e.key),null!=e.mode&&e.hasOwnProperty("mode")&&t.uint32(24).int32(e.mode),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.KeySignature;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 2:r.key=e.int32();break;case 3:r.mode=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time)return"time: number expected";if(null!=e.key&&e.hasOwnProperty("key"))switch(e.key){default:return"key: enum value expected";case 0:case 1:case 1:case 2:case 3:case 3:case 4:case 5:case 6:case 6:case 7:case 8:case 8:case 9:case 10:case 10:case 11:}if(null!=e.mode&&e.hasOwnProperty("mode"))switch(e.mode){default:return"mode: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:}return null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.KeySignature)return e;var t=new u.tensorflow.magenta.NoteSequence.KeySignature;switch(null!=e.time&&(t.time=Number(e.time)),e.key){case"C":case 0:t.key=0;break;case"C_SHARP":case 1:t.key=1;break;case"D_FLAT":case 1:t.key=1;break;case"D":case 2:t.key=2;break;case"D_SHARP":case 3:t.key=3;break;case"E_FLAT":case 3:t.key=3;break;case"E":case 4:t.key=4;break;case"F":case 5:t.key=5;break;case"F_SHARP":case 6:t.key=6;break;case"G_FLAT":case 6:t.key=6;break;case"G":case 7:t.key=7;break;case"G_SHARP":case 8:t.key=8;break;case"A_FLAT":case 8:t.key=8;break;case"A":case 9:t.key=9;break;case"A_SHARP":case 10:t.key=10;break;case"B_FLAT":case 10:t.key=10;break;case"B":case 11:t.key=11}switch(e.mode){case"MAJOR":case 0:t.mode=0;break;case"MINOR":case 1:t.mode=1;break;case"NOT_SPECIFIED":case 2:t.mode=2;break;case"MIXOLYDIAN":case 3:t.mode=3;break;case"DORIAN":case 4:t.mode=4;break;case"PHRYGIAN":case 5:t.mode=5;break;case"LYDIAN":case 6:t.mode=6;break;case"LOCRIAN":case 7:t.mode=7}return t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.key=t.enums===String?"C":0,n.mode=t.enums===String?"MAJOR":0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.key&&e.hasOwnProperty("key")&&(n.key=t.enums===String?u.tensorflow.magenta.NoteSequence.KeySignature.Key[e.key]:e.key),null!=e.mode&&e.hasOwnProperty("mode")&&(n.mode=t.enums===String?u.tensorflow.magenta.NoteSequence.KeySignature.Mode[e.mode]:e.mode),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e.Key=function(){var e={},t=Object.create(e);return t[e[0]="C"]=0,t[e[1]="C_SHARP"]=1,t.D_FLAT=1,t[e[2]="D"]=2,t[e[3]="D_SHARP"]=3,t.E_FLAT=3,t[e[4]="E"]=4,t[e[5]="F"]=5,t[e[6]="F_SHARP"]=6,t.G_FLAT=6,t[e[7]="G"]=7,t[e[8]="G_SHARP"]=8,t.A_FLAT=8,t[e[9]="A"]=9,t[e[10]="A_SHARP"]=10,t.B_FLAT=10,t[e[11]="B"]=11,t}(),e.Mode=function(){var e={},t=Object.create(e);return t[e[0]="MAJOR"]=0,t[e[1]="MINOR"]=1,t[e[2]="NOT_SPECIFIED"]=2,t[e[3]="MIXOLYDIAN"]=3,t[e[4]="DORIAN"]=4,t[e[5]="PHRYGIAN"]=5,t[e[6]="LYDIAN"]=6,t[e[7]="LOCRIAN"]=7,t}(),e}(),e.Tempo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.qpm=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.qpm&&e.hasOwnProperty("qpm")&&t.uint32(17).double(e.qpm),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.Tempo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 2:r.qpm=e.double();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.qpm&&e.hasOwnProperty("qpm")&&"number"!=typeof e.qpm?"qpm: number expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.Tempo)return e;var t=new u.tensorflow.magenta.NoteSequence.Tempo;return null!=e.time&&(t.time=Number(e.time)),null!=e.qpm&&(t.qpm=Number(e.qpm)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.qpm=0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.qpm&&e.hasOwnProperty("qpm")&&(n.qpm=t.json&&!isFinite(e.qpm)?String(e.qpm):e.qpm),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.PitchBend=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.bend=0,e.prototype.instrument=0,e.prototype.program=0,e.prototype.isDrum=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.bend&&e.hasOwnProperty("bend")&&t.uint32(16).int32(e.bend),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(24).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(32).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(40).bool(e.isDrum),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.PitchBend;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 2:r.bend=e.int32();break;case 3:r.instrument=e.int32();break;case 4:r.program=e.int32();break;case 5:r.isDrum=e.bool();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.bend&&e.hasOwnProperty("bend")&&!c.isInteger(e.bend)?"bend: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!c.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!c.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!=typeof e.isDrum?"isDrum: boolean expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.PitchBend)return e;var t=new u.tensorflow.magenta.NoteSequence.PitchBend;return null!=e.time&&(t.time=Number(e.time)),null!=e.bend&&(t.bend=0|e.bend),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.bend=0,n.instrument=0,n.program=0,n.isDrum=!1),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.bend&&e.hasOwnProperty("bend")&&(n.bend=e.bend),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.ControlChange=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.quantizedStep=c.Long?c.Long.fromBits(0,0,!1):0,e.prototype.controlNumber=0,e.prototype.controlValue=0,e.prototype.instrument=0,e.prototype.program=0,e.prototype.isDrum=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&t.uint32(16).int32(e.controlNumber),null!=e.controlValue&&e.hasOwnProperty("controlValue")&&t.uint32(24).int32(e.controlValue),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(32).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(40).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(48).bool(e.isDrum),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&t.uint32(56).int64(e.quantizedStep),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.ControlChange;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 7:r.quantizedStep=c.Long?e.int64().toNumber():e.int64();break;case 2:r.controlNumber=e.int32();break;case 3:r.controlValue=e.int32();break;case 4:r.instrument=e.int32();break;case 5:r.program=e.int32();break;case 6:r.isDrum=e.bool();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&!(c.isInteger(e.quantizedStep)||e.quantizedStep&&c.isInteger(e.quantizedStep.low)&&c.isInteger(e.quantizedStep.high))?"quantizedStep: integer|Long expected":null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&!c.isInteger(e.controlNumber)?"controlNumber: integer expected":null!=e.controlValue&&e.hasOwnProperty("controlValue")&&!c.isInteger(e.controlValue)?"controlValue: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!c.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!c.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!=typeof e.isDrum?"isDrum: boolean expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.ControlChange)return e;var t=new u.tensorflow.magenta.NoteSequence.ControlChange;return null!=e.time&&(t.time=Number(e.time)),null!=e.quantizedStep&&(c.Long?(t.quantizedStep=c.Long.fromValue(e.quantizedStep)).unsigned=!1:"string"==typeof e.quantizedStep?t.quantizedStep=parseInt(e.quantizedStep,10):"number"==typeof e.quantizedStep?t.quantizedStep=e.quantizedStep:"object"==typeof e.quantizedStep&&(t.quantizedStep=new c.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber())),null!=e.controlNumber&&(t.controlNumber=0|e.controlNumber),null!=e.controlValue&&(t.controlValue=0|e.controlValue),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,n.controlNumber=0,n.controlValue=0,n.instrument=0,n.program=0,n.isDrum=!1,c.Long){var r=new c.Long(0,0,!1);n.quantizedStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedStep=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&(n.controlNumber=e.controlNumber),null!=e.controlValue&&e.hasOwnProperty("controlValue")&&(n.controlValue=e.controlValue),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&("number"==typeof e.quantizedStep?n.quantizedStep=t.longs===String?String(e.quantizedStep):e.quantizedStep:n.quantizedStep=t.longs===String?c.Long.prototype.toString.call(e.quantizedStep):t.longs===Number?new c.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber():e.quantizedStep),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.PartInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.part=0,e.prototype.name="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.part&&e.hasOwnProperty("part")&&t.uint32(8).int32(e.part),null!=e.name&&e.hasOwnProperty("name")&&t.uint32(18).string(e.name),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.PartInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.part=e.int32();break;case 2:r.name=e.string();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.part&&e.hasOwnProperty("part")&&!c.isInteger(e.part)?"part: integer expected":null!=e.name&&e.hasOwnProperty("name")&&!c.isString(e.name)?"name: string expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.PartInfo)return e;var t=new u.tensorflow.magenta.NoteSequence.PartInfo;return null!=e.part&&(t.part=0|e.part),null!=e.name&&(t.name=String(e.name)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.part=0,n.name=""),null!=e.part&&e.hasOwnProperty("part")&&(n.part=e.part),null!=e.name&&e.hasOwnProperty("name")&&(n.name=e.name),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.SourceInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sourceType=0,e.prototype.encodingType=0,e.prototype.parser=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.sourceType&&e.hasOwnProperty("sourceType")&&t.uint32(8).int32(e.sourceType),null!=e.encodingType&&e.hasOwnProperty("encodingType")&&t.uint32(16).int32(e.encodingType),null!=e.parser&&e.hasOwnProperty("parser")&&t.uint32(24).int32(e.parser),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.SourceInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.sourceType=e.int32();break;case 2:r.encodingType=e.int32();break;case 3:r.parser=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.sourceType&&e.hasOwnProperty("sourceType"))switch(e.sourceType){default:return"sourceType: enum value expected";case 0:case 1:case 2:}if(null!=e.encodingType&&e.hasOwnProperty("encodingType"))switch(e.encodingType){default:return"encodingType: enum value expected";case 0:case 1:case 2:case 3:case 4:}if(null!=e.parser&&e.hasOwnProperty("parser"))switch(e.parser){default:return"parser: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:}return null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.SourceInfo)return e;var t=new u.tensorflow.magenta.NoteSequence.SourceInfo;switch(e.sourceType){case"UNKNOWN_SOURCE_TYPE":case 0:t.sourceType=0;break;case"SCORE_BASED":case 1:t.sourceType=1;break;case"PERFORMANCE_BASED":case 2:t.sourceType=2}switch(e.encodingType){case"UNKNOWN_ENCODING_TYPE":case 0:t.encodingType=0;break;case"MUSIC_XML":case 1:t.encodingType=1;break;case"ABC":case 2:t.encodingType=2;break;case"MIDI":case 3:t.encodingType=3;break;case"MUSICNET":case 4:t.encodingType=4}switch(e.parser){case"UNKNOWN_PARSER":case 0:t.parser=0;break;case"MUSIC21":case 1:t.parser=1;break;case"PRETTY_MIDI":case 2:t.parser=2;break;case"MAGENTA_MUSIC_XML":case 3:t.parser=3;break;case"MAGENTA_MUSICNET":case 4:t.parser=4;break;case"MAGENTA_ABC":case 5:t.parser=5;break;case"TONEJS_MIDI_CONVERT":case 6:t.parser=6}return t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.sourceType=t.enums===String?"UNKNOWN_SOURCE_TYPE":0,n.encodingType=t.enums===String?"UNKNOWN_ENCODING_TYPE":0,n.parser=t.enums===String?"UNKNOWN_PARSER":0),null!=e.sourceType&&e.hasOwnProperty("sourceType")&&(n.sourceType=t.enums===String?u.tensorflow.magenta.NoteSequence.SourceInfo.SourceType[e.sourceType]:e.sourceType),null!=e.encodingType&&e.hasOwnProperty("encodingType")&&(n.encodingType=t.enums===String?u.tensorflow.magenta.NoteSequence.SourceInfo.EncodingType[e.encodingType]:e.encodingType),null!=e.parser&&e.hasOwnProperty("parser")&&(n.parser=t.enums===String?u.tensorflow.magenta.NoteSequence.SourceInfo.Parser[e.parser]:e.parser),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e.SourceType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_SOURCE_TYPE"]=0,t[e[1]="SCORE_BASED"]=1,t[e[2]="PERFORMANCE_BASED"]=2,t}(),e.EncodingType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_ENCODING_TYPE"]=0,t[e[1]="MUSIC_XML"]=1,t[e[2]="ABC"]=2,t[e[3]="MIDI"]=3,t[e[4]="MUSICNET"]=4,t}(),e.Parser=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_PARSER"]=0,t[e[1]="MUSIC21"]=1,t[e[2]="PRETTY_MIDI"]=2,t[e[3]="MAGENTA_MUSIC_XML"]=3,t[e[4]="MAGENTA_MUSICNET"]=4,t[e[5]="MAGENTA_ABC"]=5,t[e[6]="TONEJS_MIDI_CONVERT"]=6,t}(),e}(),e.TextAnnotation=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.quantizedStep=c.Long?c.Long.fromBits(0,0,!1):0,e.prototype.text="",e.prototype.annotationType=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.text&&e.hasOwnProperty("text")&&t.uint32(18).string(e.text),null!=e.annotationType&&e.hasOwnProperty("annotationType")&&t.uint32(24).int32(e.annotationType),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&t.uint32(32).int64(e.quantizedStep),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.TextAnnotation;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 4:r.quantizedStep=c.Long?e.int64().toNumber():e.int64();break;case 2:r.text=e.string();break;case 3:r.annotationType=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time)return"time: number expected";if(null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&!(c.isInteger(e.quantizedStep)||e.quantizedStep&&c.isInteger(e.quantizedStep.low)&&c.isInteger(e.quantizedStep.high)))return"quantizedStep: integer|Long expected";if(null!=e.text&&e.hasOwnProperty("text")&&!c.isString(e.text))return"text: string expected";if(null!=e.annotationType&&e.hasOwnProperty("annotationType"))switch(e.annotationType){default:return"annotationType: enum value expected";case 0:case 1:case 2:}return null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.TextAnnotation)return e;var t=new u.tensorflow.magenta.NoteSequence.TextAnnotation;switch(null!=e.time&&(t.time=Number(e.time)),null!=e.quantizedStep&&(c.Long?(t.quantizedStep=c.Long.fromValue(e.quantizedStep)).unsigned=!1:"string"==typeof e.quantizedStep?t.quantizedStep=parseInt(e.quantizedStep,10):"number"==typeof e.quantizedStep?t.quantizedStep=e.quantizedStep:"object"==typeof e.quantizedStep&&(t.quantizedStep=new c.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber())),null!=e.text&&(t.text=String(e.text)),e.annotationType){case"UNKNOWN":case 0:t.annotationType=0;break;case"CHORD_SYMBOL":case 1:t.annotationType=1;break;case"BEAT":case 2:t.annotationType=2}return t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,n.text="",n.annotationType=t.enums===String?"UNKNOWN":0,c.Long){var r=new c.Long(0,0,!1);n.quantizedStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedStep=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.text&&e.hasOwnProperty("text")&&(n.text=e.text),null!=e.annotationType&&e.hasOwnProperty("annotationType")&&(n.annotationType=t.enums===String?u.tensorflow.magenta.NoteSequence.TextAnnotation.TextAnnotationType[e.annotationType]:e.annotationType),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&("number"==typeof e.quantizedStep?n.quantizedStep=t.longs===String?String(e.quantizedStep):e.quantizedStep:n.quantizedStep=t.longs===String?c.Long.prototype.toString.call(e.quantizedStep):t.longs===Number?new c.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber():e.quantizedStep),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e.TextAnnotationType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN"]=0,t[e[1]="CHORD_SYMBOL"]=1,t[e[2]="BEAT"]=2,t}(),e}(),e.QuantizationInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.stepsPerQuarter=0,e.prototype.stepsPerSecond=0,Object.defineProperty(e.prototype,"resolution",{get:c.oneOfGetter(t=["stepsPerQuarter","stepsPerSecond"]),set:c.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&t.uint32(8).int32(e.stepsPerQuarter),null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")&&t.uint32(16).int32(e.stepsPerSecond),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.QuantizationInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.stepsPerQuarter=e.int32();break;case 2:r.stepsPerSecond=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t={};if(null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&(t.resolution=1,!c.isInteger(e.stepsPerQuarter)))return"stepsPerQuarter: integer expected";if(null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")){if(1===t.resolution)return"resolution: multiple values";if(t.resolution=1,!c.isInteger(e.stepsPerSecond))return"stepsPerSecond: integer expected"}return null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.QuantizationInfo)return e;var t=new u.tensorflow.magenta.NoteSequence.QuantizationInfo;return null!=e.stepsPerQuarter&&(t.stepsPerQuarter=0|e.stepsPerQuarter),null!=e.stepsPerSecond&&(t.stepsPerSecond=0|e.stepsPerSecond),t},e.toObject=function(e,t){t||(t={});var n={};return null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&(n.stepsPerQuarter=e.stepsPerQuarter,t.oneofs&&(n.resolution="stepsPerQuarter")),null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")&&(n.stepsPerSecond=e.stepsPerSecond,t.oneofs&&(n.resolution="stepsPerSecond")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.SubsequenceInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.startTimeOffset=0,e.prototype.endTimeOffset=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&t.uint32(9).double(e.startTimeOffset),null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&t.uint32(17).double(e.endTimeOffset),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.SubsequenceInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.startTimeOffset=e.double();break;case 2:r.endTimeOffset=e.double();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&"number"!=typeof e.startTimeOffset?"startTimeOffset: number expected":null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&"number"!=typeof e.endTimeOffset?"endTimeOffset: number expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.SubsequenceInfo)return e;var t=new u.tensorflow.magenta.NoteSequence.SubsequenceInfo;return null!=e.startTimeOffset&&(t.startTimeOffset=Number(e.startTimeOffset)),null!=e.endTimeOffset&&(t.endTimeOffset=Number(e.endTimeOffset)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.startTimeOffset=0,n.endTimeOffset=0),null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&(n.startTimeOffset=t.json&&!isFinite(e.startTimeOffset)?String(e.startTimeOffset):e.startTimeOffset),null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&(n.endTimeOffset=t.json&&!isFinite(e.endTimeOffset)?String(e.endTimeOffset):e.endTimeOffset),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.SectionAnnotation=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.sectionId=c.Long?c.Long.fromBits(0,0,!1):0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&t.uint32(32).int64(e.sectionId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.SectionAnnotation;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 4:r.sectionId=c.Long?e.int64().toNumber():e.int64();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.sectionId&&e.hasOwnProperty("sectionId")&&!(c.isInteger(e.sectionId)||e.sectionId&&c.isInteger(e.sectionId.low)&&c.isInteger(e.sectionId.high))?"sectionId: integer|Long expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.SectionAnnotation)return e;var t=new u.tensorflow.magenta.NoteSequence.SectionAnnotation;return null!=e.time&&(t.time=Number(e.time)),null!=e.sectionId&&(c.Long?(t.sectionId=c.Long.fromValue(e.sectionId)).unsigned=!1:"string"==typeof e.sectionId?t.sectionId=parseInt(e.sectionId,10):"number"==typeof e.sectionId?t.sectionId=e.sectionId:"object"==typeof e.sectionId&&(t.sectionId=new c.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber())),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,c.Long){var r=new c.Long(0,0,!1);n.sectionId=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.sectionId=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&("number"==typeof e.sectionId?n.sectionId=t.longs===String?String(e.sectionId):e.sectionId:n.sectionId=t.longs===String?c.Long.prototype.toString.call(e.sectionId):t.longs===Number?new c.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber():e.sectionId),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.Section=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.sectionId=c.Long?c.Long.fromBits(0,0,!1):0,e.prototype.sectionGroup=null,Object.defineProperty(e.prototype,"sectionType",{get:c.oneOfGetter(t=["sectionId","sectionGroup"]),set:c.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&t.uint32(8).int64(e.sectionId),null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")&&u.tensorflow.magenta.NoteSequence.SectionGroup.encode(e.sectionGroup,t.uint32(18).fork()).ldelim(),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.Section;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.sectionId=c.Long?e.int64().toNumber():e.int64();break;case 2:r.sectionGroup=u.tensorflow.magenta.NoteSequence.SectionGroup.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t={};if(null!=e.sectionId&&e.hasOwnProperty("sectionId")&&(t.sectionType=1,!(c.isInteger(e.sectionId)||e.sectionId&&c.isInteger(e.sectionId.low)&&c.isInteger(e.sectionId.high))))return"sectionId: integer|Long expected";if(null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")){if(1===t.sectionType)return"sectionType: multiple values";t.sectionType=1;var n=u.tensorflow.magenta.NoteSequence.SectionGroup.verify(e.sectionGroup);if(n)return"sectionGroup."+n}return null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.Section)return e;var t=new u.tensorflow.magenta.NoteSequence.Section;if(null!=e.sectionId&&(c.Long?(t.sectionId=c.Long.fromValue(e.sectionId)).unsigned=!1:"string"==typeof e.sectionId?t.sectionId=parseInt(e.sectionId,10):"number"==typeof e.sectionId?t.sectionId=e.sectionId:"object"==typeof e.sectionId&&(t.sectionId=new c.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber())),null!=e.sectionGroup){if("object"!=typeof e.sectionGroup)throw TypeError(".tensorflow.magenta.NoteSequence.Section.sectionGroup: object expected");t.sectionGroup=u.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(e.sectionGroup)}return t},e.toObject=function(e,t){t||(t={});var n={};return null!=e.sectionId&&e.hasOwnProperty("sectionId")&&("number"==typeof e.sectionId?n.sectionId=t.longs===String?String(e.sectionId):e.sectionId:n.sectionId=t.longs===String?c.Long.prototype.toString.call(e.sectionId):t.longs===Number?new c.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber():e.sectionId,t.oneofs&&(n.sectionType="sectionId")),null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")&&(n.sectionGroup=u.tensorflow.magenta.NoteSequence.SectionGroup.toObject(e.sectionGroup,t),t.oneofs&&(n.sectionType="sectionGroup")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e.SectionGroup=function(){function e(e){if(this.sections=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sections=c.emptyArray,e.prototype.numTimes=0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=a.create()),null!=e.sections&&e.sections.length)for(var n=0;n<e.sections.length;++n)u.tensorflow.magenta.NoteSequence.Section.encode(e.sections[n],t.uint32(10).fork()).ldelim();return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&t.uint32(16).int32(e.numTimes),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.SectionGroup;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.sections&&r.sections.length||(r.sections=[]),r.sections.push(u.tensorflow.magenta.NoteSequence.Section.decode(e,e.uint32()));break;case 2:r.numTimes=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.sections&&e.hasOwnProperty("sections")){if(!Array.isArray(e.sections))return"sections: array expected";for(var t=0;t<e.sections.length;++t){var n=u.tensorflow.magenta.NoteSequence.Section.verify(e.sections[t]);if(n)return"sections."+n}}return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&!c.isInteger(e.numTimes)?"numTimes: integer expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.SectionGroup)return e;var t=new u.tensorflow.magenta.NoteSequence.SectionGroup;if(e.sections){if(!Array.isArray(e.sections))throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: array expected");t.sections=[];for(var n=0;n<e.sections.length;++n){if("object"!=typeof e.sections[n])throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: object expected");t.sections[n]=u.tensorflow.magenta.NoteSequence.Section.fromObject(e.sections[n])}}return null!=e.numTimes&&(t.numTimes=0|e.numTimes),t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.sections=[]),t.defaults&&(n.numTimes=0),e.sections&&e.sections.length){n.sections=[];for(var r=0;r<e.sections.length;++r)n.sections[r]=u.tensorflow.magenta.NoteSequence.Section.toObject(e.sections[r],t)}return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&(n.numTimes=e.numTimes),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),e}(),r.SequenceMetadata=function(){function e(e){if(this.genre=[],this.composers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.title="",e.prototype.artist="",e.prototype.genre=c.emptyArray,e.prototype.composers=c.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=a.create()),null!=e.title&&e.hasOwnProperty("title")&&t.uint32(10).string(e.title),null!=e.artist&&e.hasOwnProperty("artist")&&t.uint32(18).string(e.artist),null!=e.genre&&e.genre.length)for(var n=0;n<e.genre.length;++n)t.uint32(26).string(e.genre[n]);if(null!=e.composers&&e.composers.length)for(n=0;n<e.composers.length;++n)t.uint32(34).string(e.composers[n]);return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.SequenceMetadata;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.title=e.string();break;case 2:r.artist=e.string();break;case 3:r.genre&&r.genre.length||(r.genre=[]),r.genre.push(e.string());break;case 4:r.composers&&r.composers.length||(r.composers=[]),r.composers.push(e.string());break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.title&&e.hasOwnProperty("title")&&!c.isString(e.title))return"title: string expected";if(null!=e.artist&&e.hasOwnProperty("artist")&&!c.isString(e.artist))return"artist: string expected";if(null!=e.genre&&e.hasOwnProperty("genre")){if(!Array.isArray(e.genre))return"genre: array expected";for(var t=0;t<e.genre.length;++t)if(!c.isString(e.genre[t]))return"genre: string[] expected"}if(null!=e.composers&&e.hasOwnProperty("composers")){if(!Array.isArray(e.composers))return"composers: array expected";for(t=0;t<e.composers.length;++t)if(!c.isString(e.composers[t]))return"composers: string[] expected"}return null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.SequenceMetadata)return e;var t=new u.tensorflow.magenta.SequenceMetadata;if(null!=e.title&&(t.title=String(e.title)),null!=e.artist&&(t.artist=String(e.artist)),e.genre){if(!Array.isArray(e.genre))throw TypeError(".tensorflow.magenta.SequenceMetadata.genre: array expected");t.genre=[];for(var n=0;n<e.genre.length;++n)t.genre[n]=String(e.genre[n])}if(e.composers){if(!Array.isArray(e.composers))throw TypeError(".tensorflow.magenta.SequenceMetadata.composers: array expected");for(t.composers=[],n=0;n<e.composers.length;++n)t.composers[n]=String(e.composers[n])}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.genre=[],n.composers=[]),t.defaults&&(n.title="",n.artist=""),null!=e.title&&e.hasOwnProperty("title")&&(n.title=e.title),null!=e.artist&&e.hasOwnProperty("artist")&&(n.artist=e.artist),e.genre&&e.genre.length){n.genre=[];for(var r=0;r<e.genre.length;++r)n.genre[r]=e.genre[r]}if(e.composers&&e.composers.length)for(n.composers=[],r=0;r<e.composers.length;++r)n.composers[r]=e.composers[r];return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),r.VelocityRange=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.min=0,e.prototype.max=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.min&&e.hasOwnProperty("min")&&t.uint32(8).int32(e.min),null!=e.max&&e.hasOwnProperty("max")&&t.uint32(16).int32(e.max),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.VelocityRange;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.min=e.int32();break;case 2:r.max=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.min&&e.hasOwnProperty("min")&&!c.isInteger(e.min)?"min: integer expected":null!=e.max&&e.hasOwnProperty("max")&&!c.isInteger(e.max)?"max: integer expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.VelocityRange)return e;var t=new u.tensorflow.magenta.VelocityRange;return null!=e.min&&(t.min=0|e.min),null!=e.max&&(t.max=0|e.max),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.min=0,n.max=0),null!=e.min&&e.hasOwnProperty("min")&&(n.min=e.min),null!=e.max&&e.hasOwnProperty("max")&&(n.max=e.max),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,o.util.toJSONOptions)},e}(),r),i),e.exports=u},function(e,t,n){"use strict";n.r(t),n.d(t,"ChordQuality",(function(){return a})),n.d(t,"ChordSymbolException",(function(){return c})),n.d(t,"ChordEncodingException",(function(){return u})),n.d(t,"ChordSymbols",(function(){return l})),n.d(t,"ChordEncoder",(function(){return p})),n.d(t,"chordEncoderFromType",(function(){return h})),n.d(t,"MajorMinorChordEncoder",(function(){return d})),n.d(t,"TriadChordEncoder",(function(){return m})),n.d(t,"PitchChordEncoder",(function(){return f}));var r=n(0),i=n(7),o=n(1);const s=[["1P","3M","5P"],["1P","3m","5P"],["1P","3M","5A"],["1P","3m","5d"]];var a;!function(e){e[e.Major=0]="Major",e[e.Minor=1]="Minor",e[e.Augmented=2]="Augmented",e[e.Diminished=3]="Diminished",e[e.Other=4]="Other"}(a||(a={}));class c extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class u extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class l{static pitches(e){if(!i.Chord.tokenize(e)[0]||!i.Chord.exists(e))throw new c(`Unrecognized chord symbol: ${e}`);return i.Chord.notes(e).map(i.Note.chroma)}static root(e){const t=i.Chord.tokenize(e)[0];if(!t)throw new c(`Chord symbol has unknown root: ${e}`);return i.Note.chroma(t)}static quality(e){if(!i.Chord.exists(e))throw new c(`Unrecognized chord symbol: ${e}`);const t=i.Chord.intervals(e),n=s.map(e=>e.every(e=>t.includes(e))),r=n.indexOf(!0),o=n.lastIndexOf(!0);return r>=0&&r===o?r:a.Other}}class p{encodeProgression(e,t){const n=e.map(e=>this.encode(e)),i=Array.from(Array(t).keys()).map(e=>Math.floor(e*n.length/t));return r.stack(i.map(e=>n[e]))}}function h(e){switch(e){case"MajorMinorChordEncoder":return new d;case"TriadChordEncoder":return new m;case"PitchChordEncoder":return new f;default:throw new Error(`Unknown chord encoder type: ${e}`)}}class d extends p{constructor(){super(...arguments),this.depth=1+2*o.NUM_PITCH_CLASSES}index(e){if(e===o.NO_CHORD)return 0;const t=l.root(e),n=1+l.quality(e)*o.NUM_PITCH_CLASSES+t;if(n>=this.depth)throw new u(`Chord is neither major nor minor: ${e}`);return n}encode(e){return r.tidy(()=>r.oneHot(r.tensor1d([this.index(e)],"int32"),this.depth).as1D())}}class m extends p{constructor(){super(...arguments),this.depth=1+4*o.NUM_PITCH_CLASSES}index(e){if(e===o.NO_CHORD)return 0;const t=l.root(e),n=1+l.quality(e)*o.NUM_PITCH_CLASSES+t;if(n>=this.depth)throw new u(`Chord is not a standard triad: ${e}`);return n}encode(e){return r.tidy(()=>r.oneHot(r.tensor1d([this.index(e)],"int32"),this.depth).as1D())}}class f extends p{constructor(){super(...arguments),this.depth=1+3*o.NUM_PITCH_CLASSES}encode(e){return r.tidy(()=>{if(e===o.NO_CHORD)return r.oneHot(r.tensor1d([0],"int32"),this.depth).as1D();const t=l.root(e),n=r.oneHot(r.tensor1d([t],"int32"),o.NUM_PITCH_CLASSES).as1D(),i=r.buffer([o.NUM_PITCH_CLASSES]);l.pitches(e).forEach(e=>i.set(1,e));const s=i.toTensor().as1D(),a=n;return r.concat1d([r.tensor1d([0]),n,s,a])})}}},function(e,t){e.exports=require("fft.js")},function(e,t){e.exports=require("protobufjs/minimal")},function(e,t,n){"use strict";n.r(t),n.d(t,"auxiliaryInputFromSpec",(function(){return i})),n.d(t,"AuxiliaryInput",(function(){return o})),n.d(t,"BinaryCounter",(function(){return s}));var r=n(0);function i(e){switch(e.type){case"BinaryCounter":return new s(e.args);default:throw new Error(`Unknown auxiliary input: ${e}`)}}class o{constructor(e){this.depth=e}}class s extends o{constructor(e){super(e.numBits)}getTensors(e){const t=r.buffer([e,this.depth]);for(let n=0;n<e;++n)for(let e=0;e<this.depth;++e)t.set(Math.floor((n+1)/Math.pow(2,e))%2?1:-1,n,e);return t.toTensor().as2D(e,this.depth)}}},function(e,t){e.exports=require("ndarray")},function(e,t){e.exports=require("ndarray-resample")},function(e,t){e.exports=require("midiconvert")},function(e,t){e.exports=require("staffrender")},function(e,t,n){"use strict";n.r(t);var r=n(2);n.d(t,"NoteSequence",(function(){return r.a}))},function(e,t,n){"use strict";n.r(t);var r=n(15),i=n(12),o=n(1),s=n(9),a=n(5),c=n(10),u=n(6),l=n(3);const p=4;class h{}class d{constructor(e,t=1){this.clicksPerQuarter=1,this.muted=!1,this.loClick=new l.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toMaster(),this.hiClick=new l.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toMaster(),this.loClickNote="c5",this.hiClickNote="g5",this.ticking=!1,this.startedAt=null,this.step=-1,this.reset(),this.callbackObject=e,this.clicksPerQuarter=t}isTicking(){return this.ticking}getStartedAt(){return this.startedAt}getOffsetTime(){return l.immediate()-this.startedAt}start(e=120){this.reset(),this.ticking=!0,this.callbackObject.click||(this.callbackObject.click=()=>{}),this.callbackObject.quarter||(this.callbackObject.quarter=()=>{}),this.callbackObject.bar||(this.callbackObject.bar=()=>{});let t=0;const n=p*this.clicksPerQuarter;l.Transport.scheduleRepeat(e=>{this.startedAt||(this.startedAt=e);const r=e-this.startedAt;this.step++;const i=this.step%n,o=Math.floor(i/this.clicksPerQuarter),s=i%this.clicksPerQuarter;this.callbackObject.click(r,i),0===s&&this.callbackObject.quarter(r,o),this.muted||(0===i?this.hiClick.triggerAttack(this.hiClickNote,e,.1):this.loClick.triggerAttack(this.loClickNote,e,.1)),0===i&&(this.callbackObject.bar(r,t),t++)},`${n}n`),l.Transport.bpm.value=e,l.Transport.start()}stop(){this.ticking=!1,l.Transport.cancel(),l.Transport.stop()}reset(){this.muted=!1,this.ticking=!1,this.step=-1,this.startedAt=null}}var m=n(18),f=n(2);class g extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}function S(e){const t=m.parse(e),n=f.a.create();n.ticksPerQuarter=t.header.PPQ,n.sourceInfo=f.a.SourceInfo.create({parser:f.a.SourceInfo.Parser.TONEJS_MIDI_CONVERT,encodingType:f.a.SourceInfo.EncodingType.MIDI}),t.header.timeSignature?n.timeSignatures.push(f.a.TimeSignature.create({time:0,numerator:t.header.timeSignature[0],denominator:t.header.timeSignature[1]})):n.timeSignatures.push(f.a.TimeSignature.create({time:0,numerator:4,denominator:4})),n.tempos.push(f.a.Tempo.create({time:0,qpm:t.header.bpm}));let r=-1;for(const e of t.tracks){e.notes.length>0&&(r+=1);for(const t of e.notes){const i=t.time,s=i+t.duration;n.notes.push(f.a.Note.create({instrument:r,program:e.instrumentNumber,startTime:i,endTime:s,pitch:t.midi,velocity:Math.floor(t.velocity*o.MIDI_VELOCITIES),isDrum:e.isPercussion})),s>n.totalTime&&(n.totalTime=s)}}return n}function y(e){u.isQuantizedSequence(e)&&(e=u.unquantizeSequence(e));const t=e=>0===e||void 0===e;if(e.tempos&&0!==e.tempos.length||(e.tempos=[{time:0,qpm:o.DEFAULT_QUARTERS_PER_MINUTE}]),e.timeSignatures&&0!==e.timeSignatures.length||(e.timeSignatures=[{time:0,numerator:4,denominator:4}]),1!==e.tempos.length||!t(e.tempos[0].time))throw new g("NoteSequence must have exactly 1 tempo at time 0");if(1!==e.timeSignatures.length||!t(e.timeSignatures[0].time))throw new g("NoteSequence must have exactly 1 time signature at time 0");const n={header:{bpm:e.tempos[0].qpm,PPQ:e.ticksPerQuarter?e.ticksPerQuarter:o.DEFAULT_TICKS_PER_QUARTER,timeSignature:[e.timeSignatures[0].numerator,e.timeSignatures[0].denominator]},tracks:[]},r=new Map;for(const t of e.notes){const e=t.instrument?t.instrument:0;r.has(e)||r.set(e,[]),r.get(e).push(t)}const i=Array.from(r.keys()).sort((e,t)=>e-t);for(let e=0;e<i.length;e++){if(e!==i[e])throw new g("Instrument list must be continuous and start at 0");const t=r.get(e),s={id:e,notes:[],isPercussion:void 0!==t[0].isDrum&&t[0].isDrum,channelNumber:t[0].isDrum?o.DRUM_CHANNEL:o.DEFAULT_CHANNEL,instrumentNumber:void 0===t[0].program?o.DEFAULT_PROGRAM:t[0].program};s.notes=t.map(e=>{const t=void 0===e.velocity?o.DEFAULT_VELOCITY:e.velocity;return{midi:e.pitch,time:e.startTime,duration:e.endTime-e.startTime,velocity:(t+1)/o.MIDI_VELOCITIES}}),n.tracks.push(s)}return new Uint8Array(m.fromJSON(n).toArray())}function w(e){return new Promise((t,n)=>{fetch(e).then(e=>e.blob()).then(e=>{t(e)}).catch(e=>n(e))})}function b(e){return new Promise((t,n)=>{const r=new FileReader;r.onload=e=>{try{const e=S(r.result);t(e)}catch(e){n(e)}},r.onerror=e=>n(e),r.readAsBinaryString(e)})}function v(e){return w(e).then(b)}class N{constructor(e){this.FADE_SECONDS=.1,this.baseURL=e,this.buffers=new l.Buffers([]),this.sourceMap=new Map,this.initialized=!1}async initialize(){await fetch(`${this.baseURL}/instrument.json`).then(e=>e.json()).then(e=>{this.name=e.name,this.minPitch=e.minPitch,this.maxPitch=e.maxPitch,this.durationSeconds=e.durationSeconds,this.releaseSeconds=e.releaseSeconds,this.percussive=e.percussive,this.velocities=e.velocities,this.initialized=!0})}sampleInfoToName(e){return this.velocities?`p${e.pitch}_v${e.velocity}`:`p${e.pitch}`}sampleNameToURL(e){return`${this.baseURL}/${e}.mp3`}nearestVelocity(e){if(!this.velocities)return e;e||(e=o.DEFAULT_VELOCITY);let t=void 0,n=o.MIDI_VELOCITIES;return this.velocities.forEach(r=>{const i=Math.abs(r-e);i<n&&(t=r,n=i)}),t}async loadSamples(e){this.initialized||await this.initialize();const t=e.filter(e=>!(e.pitch<this.minPitch||e.pitch>this.maxPitch)||(a.log(`Pitch ${e.pitch} is outside the valid range for ${this.name}, ignoring.`,"SoundFont"),!1)).map(e=>this.sampleInfoToName({pitch:e.pitch,velocity:this.nearestVelocity(e.velocity)})),n=Array.from(new Set(t)).filter(e=>!this.buffers.has(e)).map(e=>({name:e,url:this.sampleNameToURL(e)}));n.length>0&&(n.forEach(e=>this.buffers.add(e.name,e.url)),await new Promise(e=>l.Buffer.on("load",e)),a.log(`Loaded samples for ${this.name}.`,"SoundFont"))}playNote(e,t,n,r,i){const o=this.getBuffer(e,t);r>this.durationSeconds&&a.log(`Requested note duration longer than sample duration: ${r} > ${this.durationSeconds}`,"SoundFont");const s=new l.BufferSource({buffer:o,fadeOut:this.FADE_SECONDS}).connect(i);if(s.start(n,0,void 0,1,0),!this.percussive&&r<this.durationSeconds){const e=new l.BufferSource(o).connect(i);s.stop(n+r+this.FADE_SECONDS),e.start(n+r,this.durationSeconds,void 0,1,this.FADE_SECONDS)}}playNoteDown(e,t,n){const r=this.getBuffer(e,t),i=new l.BufferSource(r).connect(n);i.start(0,0,void 0,1,0),this.sourceMap.has(e)&&this.sourceMap.get(e).stop(l.now()+this.FADE_SECONDS,this.FADE_SECONDS),this.sourceMap.set(e,i)}playNoteUp(e,t,n){if(!this.sourceMap.has(e))return;const r=this.getBuffer(e,t);new l.BufferSource(r).connect(n).start(0,this.durationSeconds,void 0,1,this.FADE_SECONDS),this.sourceMap.get(e).stop(l.now()+this.FADE_SECONDS,this.FADE_SECONDS),this.sourceMap.delete(e)}getBuffer(e,t){if(!this.initialized)throw new Error("Instrument is not initialized.");if(e<this.minPitch||e>this.maxPitch)return void a.log(`Pitch ${e} is outside the valid range for ${this.name} (${this.minPitch}-${this.maxPitch})`,"SoundFont");const n=this.sampleInfoToName({pitch:e,velocity:this.nearestVelocity(t)});if(!this.buffers.has(n))throw new Error(`Buffer not found for ${this.name}: ${n}`);const r=this.buffers.get(n);if(!r.loaded)throw new Error(`Buffer not loaded for ${this.name}: ${n}`);return r}}class T{constructor(e){this.baseURL=e,this.instruments=new Map,this.initialized=!1}async initialize(){await fetch(`${this.baseURL}/soundfont.json`).then(e=>e.json()).then(e=>{this.name=e.name;for(const t in e.instruments){const n=`${this.baseURL}/${e.instruments[t]}`;this.instruments.set("drums"===t?"drums":+t,new N(n))}this.initialized=!0})}async loadSamples(e){this.initialized||await this.initialize();const t=new Map;e.forEach(e=>{e.isDrum=e.isDrum||!1,e.program=e.program||0;const n=e.isDrum?"drums":e.program,r={pitch:e.pitch,velocity:e.velocity};t.has(n)?t.get(n).push(r):this.instruments.has(n)?t.set(n,[r]):a.log(`No instrument in ${this.name} for: program=${e.program}, isDrum=${e.isDrum}`,"SoundFont")}),await Promise.all(Array.from(t.keys()).map(e=>this.instruments.get(e).loadSamples(t.get(e))))}playNote(e,t,n,r,i=0,o=!1,s){const c=o?"drums":i;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(c)?this.instruments.get(c).playNote(e,t,n,r,s):a.log(`No instrument in ${this.name} for: program=${i}, isDrum=${o}`,"SoundFont")}playNoteDown(e,t,n=0,r=!1,i){const o=r?"drums":n;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(o)?this.instruments.get(o).playNoteDown(e,t,i):a.log(`No instrument in ${this.name} for: program=${n}, isDrum=${r}`,"SoundFont")}playNoteUp(e,t,n=0,r=!1,i){const o=r?"drums":n;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(o)?this.instruments.get(o).playNoteUp(e,t,i):a.log(`No instrument in ${this.name} for: program=${n}, isDrum=${r}`,"SoundFont")}}function P(e,t){return e.quantizedStartStep<t.quantizedStartStep?-1:e.quantizedStartStep>t.quantizedStartStep?1:e.pitch<t.pitch?-1:1}class q{}class O{constructor(e=!1,t){this.playClick=e,this.callbackObject=t,this.desiredQPM=void 0}setTempo(e){this.desiredQPM=e,"started"===l.Transport.state&&(l.Transport.bpm.value=e)}makeClickSequence(e){const t=u.clone(e),n=t.notes.map(e=>e.quantizedEndStep),r=Math.max(...n);for(let e=0;e<r;e+=4){const n={pitch:e%16==0?o.LO_CLICK_PITCH:o.HI_CLICK_PITCH,quantizedStartStep:e,isDrum:!0,quantizedEndStep:e+1};t.notes.push(n)}return t.notes.sort(P),t}resumeContext(){l.context.resume()}start(e,t){this.resumeContext();const n=u.isQuantizedSequence(e);if(this.playClick&&n&&(e=this.makeClickSequence(e)),t?l.Transport.bpm.value=t:e.tempos&&e.tempos.length>0&&e.tempos[0].qpm>0?l.Transport.bpm.value=e.tempos[0].qpm:l.Transport.bpm.value=o.DEFAULT_QUARTERS_PER_MINUTE,n)e=u.unquantizeSequence(e,t);else if(t)throw new Error("Cannot specify a `qpm` for a non-quantized sequence.");return this.currentPart=new l.Part((e,t)=>{(this.playClick||t.pitch!==o.LO_CLICK_PITCH&&t.pitch!==o.HI_CLICK_PITCH)&&this.playNote(e,t),this.callbackObject&&l.Draw.schedule(()=>{this.callbackObject.run(t,e)},e)},e.notes.map(e=>[e.startTime,e])),this.desiredQPM&&(l.Transport.bpm.value=this.desiredQPM),this.currentPart.start(),"started"!==l.Transport.state&&l.Transport.start(),new Promise(t=>{this.scheduledStop=l.Transport.schedule(()=>{this.stop(),t(),this.callbackObject&&this.callbackObject.stop()},`+${e.totalTime}`)})}stop(){this.currentPart&&(this.currentPart.stop(),l.Transport.stop(),this.currentPart=null),l.Transport.clear(this.scheduledStop),this.scheduledStop=void 0,this.desiredQPM=void 0}pause(){l.Transport.pause()}resume(){l.Transport.start()}isPlaying(){return!!this.currentPart}getPlayState(){return l.Transport.state}}class I{constructor(){this.DRUM_PITCH_TO_CLASS=new Map,this.kick=(new l.MembraneSynth).toMaster(),this.tomLow=new l.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toMaster(),this.tomMid=new l.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toMaster(),this.tomHigh=new l.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toMaster(),this.closedHihat=new l.MetalSynth({frequency:400,envelope:{attack:.001,decay:.1,release:.8},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1}).toMaster(),this.openHihat=new l.MetalSynth({frequency:400,envelope:{attack:.001,decay:.5,release:.8,sustain:1},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1}).toMaster(),this.ride=(new l.MetalSynth).toMaster(),this.crash=new l.MetalSynth({frequency:300,envelope:{attack:.001,decay:1,release:3},harmonicity:5.1,modulationIndex:64,resonance:4e3,octaves:1.5}).toMaster(),this.snare=new l.NoiseSynth({noise:{type:"white"},envelope:{attack:.005,decay:.05,sustain:.1,release:.4}}).toMaster(),this.loClick=new l.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toMaster(),this.hiClick=new l.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toMaster(),this.pitchPlayers=[(e,t=1)=>this.kick.triggerAttackRelease("C2","8n",e,t),(e,t=1)=>this.snare.triggerAttackRelease("16n",e,t),(e,t=1)=>this.closedHihat.triggerAttack(e,.3,t),(e,t=1)=>this.openHihat.triggerAttack(e,.3,t),(e,t=.5)=>this.tomLow.triggerAttack("G3",e,t),(e,t=.5)=>this.tomMid.triggerAttack("C4",e,t),(e,t=.5)=>this.tomHigh.triggerAttack("F4",e,t),(e,t=1)=>this.crash.triggerAttack(e,1,t),(e,t=1)=>this.ride.triggerAttack(e,.5,t),(e,t=.5)=>this.loClick.triggerAttack("G5",e,t),(e,t=.5)=>this.hiClick.triggerAttack("C6",e,t)];for(let e=0;e<s.DEFAULT_DRUM_PITCH_CLASSES.length;++e)s.DEFAULT_DRUM_PITCH_CLASSES[e].forEach(t=>{this.DRUM_PITCH_TO_CLASS.set(t,e)});this.DRUM_PITCH_TO_CLASS.set(o.LO_CLICK_PITCH,o.LO_CLICK_CLASS),this.DRUM_PITCH_TO_CLASS.set(o.HI_CLICK_PITCH,o.HI_CLICK_CLASS)}static getInstance(){return I.instance||(I.instance=new I),I.instance}playNote(e,t,n){this.pitchPlayers[this.DRUM_PITCH_TO_CLASS.get(e)](t,n)}}class A extends O{constructor(){super(...arguments),this.drumKit=I.getInstance(),this.bassSynth=new l.Synth({volume:5,oscillator:{type:"triangle"}}).toMaster(),this.polySynth=new l.PolySynth(10).toMaster()}playNote(e,t){const n=t.hasOwnProperty("velocity")?t.velocity/o.MAX_MIDI_VELOCITY:void 0;if(t.isDrum)this.drumKit.playNote(t.pitch,e,n);else{const r=new l.Frequency(t.pitch,"midi"),i=t.endTime-t.startTime;this.getSynth(t.instrument,t.program).triggerAttackRelease(r,i,e,n)}}getSynth(e,t){return void 0!==t&&t>=32&&t<=39?this.bassSynth:this.polySynth}}A.tone=l;class E extends O{constructor(e,t=l.Master,n,r,i){super(!1,i),this.soundFont=new T(e),this.output=t,this.programOutputs=n,this.drumOutputs=r}async loadSamples(e){await this.soundFont.loadSamples(e.notes.map(e=>({pitch:e.pitch,velocity:e.velocity,program:e.program||0,isDrum:e.isDrum||!1})))}async loadAllSamples(e=0,t=!1){const n=f.a.create(),r=t?o.MIN_DRUM_PITCH:o.MIN_PIANO_PITCH,i=t?o.MAX_DRUM_PITCH:o.MAX_PIANO_PITCH;for(let s=r;s<=i;s++)for(let r=o.MIN_MIDI_VELOCITY;r<o.MAX_MIDI_VELOCITY;r++)n.notes.push({pitch:s,velocity:r,program:e,isDrum:t});return this.loadSamples(n)}resumeContext(){l.context.resume()}start(e,t){return this.resumeContext(),this.loadSamples(e).then(()=>super.start(e,t))}playNote(e,t){this.soundFont.playNote(t.pitch,t.velocity,e,t.endTime-t.startTime,t.program,t.isDrum,this.getAudioNodeOutput(t))}playNoteDown(e){this.soundFont.playNoteDown(e.pitch,e.velocity,e.program,e.isDrum,this.getAudioNodeOutput(e))}playNoteUp(e){this.soundFont.playNoteUp(e.pitch,e.velocity,e.program,e.isDrum,this.getAudioNodeOutput(e))}getAudioNodeOutput(e){let t=this.output;return this.programOutputs&&!e.isDrum?this.programOutputs.has(e.program)&&(t=this.programOutputs.get(e.program)):this.drumOutputs&&e.isDrum&&this.drumOutputs.has(e.pitch)&&(t=this.drumOutputs.get(e.pitch)),t}}class z extends A{constructor(e){super(!0,e)}}class k extends O{constructor(e){super(!1,e),this.outputs=[],this.outputChannel=0,this.availableOutputs=[],this.NOTE_ON=144,this.NOTE_OFF=128}async requestMIDIAccess(){return navigator.requestMIDIAccess?new Promise((e,t)=>{navigator.requestMIDIAccess().then(t=>{t.addEventListener("statechange",e=>this.initOutputs(t)),e(this.initOutputs(t))},e=>console.log("Something went wrong",t(e)))}):null}initOutputs(e){const t=e.outputs.values();for(let e=t.next();e&&!e.done;e=t.next())this.availableOutputs.push(e.value);return this.availableOutputs}playNote(e,t){const n=t.velocity||100,r=1e3*(t.endTime-t.startTime),i=[this.NOTE_ON+this.outputChannel,t.pitch,n],o=[this.NOTE_OFF+this.outputChannel,t.pitch,n],s=this.outputs?this.outputs:this.availableOutputs;for(let e=0;e<s.length;e++)this.sendMessageToOutput(s[e],i),this.sendMessageToOutput(s[e],o,window.performance.now()+r)}sendMessageToOutput(e,t,n){e&&e.send(t,n)}playNoteDown(e){const t=[this.NOTE_ON,e.pitch,e.velocity],n=this.outputs?this.outputs:this.availableOutputs;for(let e=0;e<n.length;e++)this.sendMessageToOutput(n[e],t)}playNoteUp(e){const t=[this.NOTE_OFF,e.pitch,e.velocity],n=this.outputs?this.outputs:this.availableOutputs;for(let r=0;r<n.length;r++)this.sendMessageToOutput(n[r],t,e.endTime-e.startTime)}}class _{}class C{constructor(e={},t){this.notes=[],this.midiInputs=[],this.loClick=new l.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toMaster(),this.hiClick=new l.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toMaster(),this.config={playClick:e.playClick,qpm:e.qpm||o.DEFAULT_QUARTERS_PER_MINUTE,playCountIn:e.playCountIn,startRecordingAtFirstNote:e.startRecordingAtFirstNote||!1},this.callbackObject=t,this.recording=!1,this.onNotes=new Map}async initialize(){await navigator.requestMIDIAccess().then(e=>this.midiReady(e),e=>console.log("Something went wrong",e))}midiReady(e){a.log("Initialized Recorder","Recorder");const t=e.inputs.values();for(let e=t.next();e&&!e.done;e=t.next())this.midiInputs.push(e.value)}isRecording(){return this.recording}setTempo(e){this.config.qpm=e,"started"===l.Transport.state&&(l.Transport.bpm.value=e)}enablePlayClick(e){this.config.playClick=e}enablePlayCountIn(e){this.config.playCountIn=e}initClickLoop(){let e=0;this.clickLoop=new l.Loop(t=>{e%4==0?this.loClick.triggerAttack("G5",t):this.hiClick.triggerAttack("C6",t),e++,this.config.playCountIn&&4===e&&(l.Transport.stop(),this.clickLoop.stop())},"4n")}getMIDIInputs(){return this.midiInputs}start(e){const t=e||this.midiInputs;for(const e of t)e.onmidimessage=e=>{this.midiMessageReceived(e)};if(this.config.playClick||this.config.playCountIn?(this.initClickLoop(),l.Transport.bpm.value=this.config.qpm,l.Transport.start(),this.clickLoop.start()):this.clickLoop=null,this.recording=!0,this.firstNoteTimestamp=void 0,this.notes=[],this.onNotes=new Map,!this.startRecordingAtFirstNote){const e=Date.now();this.firstNoteTimestamp=e}}stop(){this.recording=!1;const e=Date.now();this.onNotes.forEach((t,n)=>{this.noteOff(n,e)});for(const e of this.midiInputs)e.onmidimessage=null;return this.clickLoop&&(l.Transport.stop(),this.clickLoop.stop()),0===this.notes.length?null:this.getNoteSequence()}getNoteSequence(){return 0===this.notes.length?null:f.a.create({notes:this.notes,totalTime:this.notes[this.notes.length-1].endTime})}reset(){const e=this.stop();return this.firstNoteTimestamp=void 0,this.notes=[],this.onNotes=new Map,e}midiMessageReceived(e){if(!this.recording)return;let t;const n=(t=void 0!==e.timeStamp&&0!==e.timeStamp?e.timeStamp:performance.now())+performance.timing.navigationStart;void 0===this.firstNoteTimestamp&&(this.firstNoteTimestamp=n);const r=e.data[0]>>4,i=e.data[1],o=e.data.length>2?e.data[2]:1,s=e.srcElement;8===r||9===r&&0===o?(this.callbackObject&&this.callbackObject.noteOff&&this.callbackObject.noteOff(i,o,s),this.noteOff(i,n),this.callbackObject&&this.callbackObject.run&&this.callbackObject.run(this.getNoteSequence())):9===r&&(this.callbackObject&&this.callbackObject.noteOn&&this.callbackObject.noteOn(i,o,s),this.noteOn(i,o,n))}noteOn(e,t,n){const r=new f.a.Note;r.pitch=e,r.startTime=(n-this.firstNoteTimestamp)/1e3,r.velocity=t,this.onNotes.set(e,r)}noteOff(e,t){const n=this.onNotes.get(e);n&&(n.endTime=(t-this.firstNoteTimestamp)/1e3,this.notes.push(n)),this.onNotes.delete(e)}}var x,M=n(19);class D{constructor(e,t={}){this.noteSequence=e,this.sequenceIsQuantized=u.isQuantizedSequence(this.noteSequence);if(this.config={noteHeight:t.noteHeight||6,noteSpacing:t.noteSpacing||1,pixelsPerTimeStep:t.pixelsPerTimeStep||30,noteRGB:t.noteRGB||"8, 41, 64",activeNoteRGB:t.activeNoteRGB||"240, 84, 119",minPitch:t.minPitch,maxPitch:t.maxPitch},this.sequenceIsQuantized){const t=e.quantizationInfo.stepsPerQuarter;this.config.pixelsPerTimeStep=t?this.config.pixelsPerTimeStep/t:7}const n=this.getSize();this.width=n.width,this.height=n.height}getSize(){if(void 0===this.config.minPitch||void 0===this.config.maxPitch){this.config.minPitch=o.MAX_MIDI_PITCH,this.config.maxPitch=o.MIN_MIDI_PITCH;for(const e of this.noteSequence.notes)this.config.minPitch=Math.min(e.pitch,this.config.minPitch),this.config.maxPitch=Math.max(e.pitch,this.config.maxPitch);this.config.minPitch-=2,this.config.maxPitch+=2}const e=(this.config.maxPitch-this.config.minPitch)*this.config.noteHeight,t=this.sequenceIsQuantized?this.noteSequence.totalQuantizedSteps:this.noteSequence.totalTime;if(!t)throw new Error("The sequence you are using with the mm.PianoRollSVGVisualizer does not have a "+(this.sequenceIsQuantized?"totalQuantizedSteps":"totalTime")+" field set, so the visualizer can't be horizontally sized correctly.");return{width:t*this.config.pixelsPerTimeStep,height:e}}getNotePosition(e,t){const n=this.getNoteStartTime(e)*this.config.pixelsPerTimeStep,r=this.config.pixelsPerTimeStep*(this.getNoteEndTime(e)-this.getNoteStartTime(e))-this.config.noteSpacing;return{x:n,y:this.height-(e.pitch-this.config.minPitch)*this.config.noteHeight,w:r,h:this.config.noteHeight}}scrollIntoViewIfNeeded(e,t){if(e&&this.parentElement){const e=this.parentElement.getBoundingClientRect().width;t>this.parentElement.scrollLeft+e&&(this.parentElement.scrollLeft=t-20)}}getNoteStartTime(e){return this.sequenceIsQuantized?e.quantizedStartStep:Math.round(1e8*e.startTime)/1e8}getNoteEndTime(e){return this.sequenceIsQuantized?e.quantizedEndStep:Math.round(1e8*e.endTime)/1e8}isPaintingActiveNote(e,t){const n=this.getNoteStartTime(e)===this.getNoteStartTime(t),r=this.getNoteStartTime(e)<=this.getNoteStartTime(t)&&this.getNoteEndTime(e)>=this.getNoteEndTime(t);return n||r}}class L extends D{constructor(e,t,n={}){super(e,n),this.ctx=t.getContext("2d"),this.parentElement=t.parentElement;const r=window.devicePixelRatio||1;this.ctx&&(this.ctx.canvas.width=r*this.width,this.ctx.canvas.height=r*this.height,t.style.width=`${this.width}px`,t.style.height=`${this.height}px`,this.ctx.scale(r,r)),this.redraw()}redraw(e,t){let n;this.clear();for(let t=0;t<this.noteSequence.notes.length;t++){const r=this.noteSequence.notes[t],i=this.getNotePosition(r,t),o=.2,s=r.velocity?r.velocity/100+o:1,a=e&&this.isPaintingActiveNote(r,e),c=`rgba(${a?this.config.activeNoteRGB:this.config.noteRGB},\n  ${s})`;this.redrawNote(i.x,i.y,i.w,i.h,c),a&&r===e&&(n=i.x)}return this.scrollIntoViewIfNeeded(t,n),n}clear(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}redrawNote(e,t,n,r,i){this.ctx.fillStyle=i,this.ctx.fillRect(Math.round(e),Math.round(t),Math.round(n),Math.round(r))}}class R extends L{constructor(e,t,n={}){super(e,t,n),a.log("mm.Visualizer is deprecated, and will be removed in a future          version. Please use mm.PianoRollCanvasVisualizer instead","mm.Visualizer",5)}}class F extends D{constructor(e,t,n={}){if(super(e,n),!(t instanceof SVGSVGElement))throw new Error("mm.PianoRollSVGVisualizer requires an <svg> element to display the visualization");this.svg=t,this.parentElement=t.parentElement,this.drawn=!1,this.svg.style.width=`${this.width}px`,this.svg.style.height=`${this.height}px`,this.clear(),this.draw()}redraw(e,t){if(this.drawn||this.draw(),!e)return null;const n=this.svg.querySelectorAll("rect.active");for(let e=0;e<n.length;++e){const t=n[e],r=this.getNoteFillColor(this.noteSequence.notes[parseInt(t.getAttribute("data-index"),10)],!1);t.setAttribute("fill",r),t.removeAttribute("class")}let r;for(let t=0;t<this.noteSequence.notes.length;t++){const n=this.noteSequence.notes[t];if(!(e&&this.isPaintingActiveNote(n,e)))continue;const i=this.svg.querySelector(`rect[data-index="${t}"]`),o=this.getNoteFillColor(n,!0);i.setAttribute("fill",o),i.setAttribute("class","active"),n===e&&(r=parseFloat(i.getAttribute("x")))}return this.scrollIntoViewIfNeeded(t,r),r}draw(){for(let e=0;e<this.noteSequence.notes.length;e++){const t=this.noteSequence.notes[e],n=this.getNotePosition(t,e),r=this.getNoteFillColor(t,!1);this.drawNote(n.x,n.y,n.w,n.h,r,e)}this.drawn=!0}getNoteFillColor(e,t){const n=e.velocity?e.velocity/100+.2:1;return`rgba(${t?this.config.activeNoteRGB:this.config.noteRGB},\n  ${n})`}drawNote(e,t,n,r,i,o){if(!this.svg)return;const s=document.createElementNS("http://www.w3.org/2000/svg","rect");s.setAttribute("fill",i),s.setAttribute("x",`${Math.round(e)}`),s.setAttribute("y",`${Math.round(t)}`),s.setAttribute("width",`${Math.round(n)}`),s.setAttribute("height",`${Math.round(r)}`),s.setAttribute("data-index",`${o}`),this.svg.appendChild(s)}clear(){this.svg.innerHTML="",this.drawn=!1}}!function(e){e[e.PAGE=0]="PAGE",e[e.NOTE=1]="NOTE",e[e.BAR=2]="BAR"}(x||(x={}));class j extends D{constructor(e,t,n={}){super(e,n),(void 0===n.pixelsPerTimeStep||n.pixelsPerTimeStep<=0)&&(this.config.pixelsPerTimeStep=0),this.instruments=n.instruments||[],this.render=new M.StaffSVGRender(this.getScoreInfo(e),{noteHeight:this.config.noteHeight,noteSpacing:this.config.noteSpacing,pixelsPerTimeStep:this.config.pixelsPerTimeStep,noteRGB:this.config.noteRGB,activeNoteRGB:this.config.activeNoteRGB,defaultKey:n.defaultKey||0,scrollType:n.scrollType||x.PAGE},t),this.drawnNotes=e.notes.length,this.clear(),this.redraw()}clear(){this.render.clear()}redraw(e,t){this.drawnNotes!==this.noteSequence.notes.length&&(this.render.scoreInfo=this.getScoreInfo(this.noteSequence));const n=e?this.getNoteInfo(e):void 0;return this.render.redraw(n,t)}isNoteInInstruments(e){return void 0===e.instrument||0===this.instruments.length||this.instruments.indexOf(e.instrument)>=0}timeToQuarters(e){const t=e*this.noteSequence.tempos[0].qpm/60;return Math.round(16*t)/16}quantizedStepsToQuarters(e){const t=e/this.noteSequence.quantizationInfo.stepsPerQuarter;return Math.round(16*t)/16}getNoteInfo(e){const t=this.sequenceIsQuantized?this.quantizedStepsToQuarters(e.quantizedStartStep):this.timeToQuarters(e.startTime);return{start:t,length:(this.sequenceIsQuantized?this.quantizedStepsToQuarters(e.quantizedEndStep):this.timeToQuarters(e.endTime))-t,pitch:e.pitch,intensity:e.velocity}}getScoreInfo(e){const t=[];return e.notes.forEach(e=>{this.isNoteInInstruments(e)&&t.push(this.getNoteInfo(e))}),{notes:t,tempos:e.tempos?e.tempos.map(e=>({start:this.timeToQuarters(e.time),qpm:e.qpm})):[],keySignatures:e.keySignatures?e.keySignatures.map(e=>({start:this.timeToQuarters(e.time),key:e.key})):[],timeSignatures:e.timeSignatures?e.timeSignatures.map(e=>({start:this.timeToQuarters(e.time),numerator:e.numerator,denominator:e.denominator})):[]}}}n.d(t,"aux_inputs",(function(){return r})),n.d(t,"chords",(function(){return i})),n.d(t,"constants",(function(){return o})),n.d(t,"data",(function(){return s})),n.d(t,"logging",(function(){return a})),n.d(t,"performance",(function(){return c})),n.d(t,"sequences",(function(){return u})),n.d(t,"MetronomeCallbackObject",(function(){return h})),n.d(t,"Metronome",(function(){return d})),n.d(t,"MidiConversionError",(function(){return g})),n.d(t,"midiToSequenceProto",(function(){return S})),n.d(t,"sequenceProtoToMidi",(function(){return y})),n.d(t,"urlToBlob",(function(){return w})),n.d(t,"blobToNoteSequence",(function(){return b})),n.d(t,"urlToNoteSequence",(function(){return v})),n.d(t,"BasePlayerCallback",(function(){return q})),n.d(t,"BasePlayer",(function(){return O})),n.d(t,"Player",(function(){return A})),n.d(t,"SoundFontPlayer",(function(){return E})),n.d(t,"PlayerWithClick",(function(){return z})),n.d(t,"MIDIPlayer",(function(){return k})),n.d(t,"BaseRecorderCallback",(function(){return _})),n.d(t,"Recorder",(function(){return C})),n.d(t,"BaseVisualizer",(function(){return D})),n.d(t,"PianoRollCanvasVisualizer",(function(){return L})),n.d(t,"Visualizer",(function(){return R})),n.d(t,"PianoRollSVGVisualizer",(function(){return F})),n.d(t,"ScrollType",(function(){return x})),n.d(t,"StaffSVGVisualizer",(function(){return j}))},function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(5),o=n(13),s=n(8);const a=.0661371661726,c=.113718730221,u=.8,l=0,p=16e3,h=64e3,d=512,m=2048,f=[[1,1,1.0087615084725814],[2,1,.029087889211125567],[2,2,.958243896036208],[3,2,.5326346877272624],[3,3,.45988057223186607],[4,3,1.0072850129664943],[5,4,1.0050894259864507],[6,4,.016233689242197466],[6,5,.9763230964529687],[7,5,.5149287456976357],[7,6,.48299891928441196],[8,6,1.0020339883784544],[9,7,1.0013940582804204],[10,7,.004285414445239434],[10,8,.9936677765505681],[11,8,.4979349533263788],[11,9,.5020647178266697],[12,9,.9896782321684733],[12,10,.006967080931645349],[13,10,1.0022486641537054],[14,11,1.0033233953996759],[15,11,.4782757843614299],[15,12,.5183887055972138],[16,12,.9736767011426267],[16,13,.01804416217807709],[17,13,1.0056329663266226],[18,14,1.00808642668908],[19,14,.4576416347984229],[19,15,.5340800956534676],[20,15,.9582897445862256],[20,16,.028988367857957848],[21,16,1.008754652772106],[22,17,1.0122552436937966],[23,17,.4380796830853842],[23,18,.5491738237632201],[24,18,.9434838949694413],[24,19,.039794474296176746],[25,19,1.0116287566447584],[26,20,1.0158945544322868],[27,20,.41952402212367873],[27,21,.5637020154076856],[28,21,.9292283399303117],[28,22,.05045785324282485],[29,22,1.0142694870195312],[30,23,1.0190617246342517],[31,23,.40191289323704393],[31,24,.5776942788784806],[32,24,.915494649120402],[32,25,.060974426459003916],[33,25,1.016690283888679],[34,26,1.0218076651124588],[35,26,.3851885348435194],[35,27,.5911779611807773],[36,27,.9022565352474414],[36,28,.07134062388959171],[37,28,1.0189038677945517],[38,29,1.0241776077147466],[39,29,.369297000124277],[39,30,.6041783722578726],[40,30,.8894896443111251],[40,31,.08155334505527755],[41,31,1.0209222848386956],[42,32,1.0262117836546005],[43,32,.35418795675261777],[43,33,.6167189821271176],[44,33,.87717137085618],[44,34,.09160992335204851],[45,34,1.0227569476841007],[46,35,1.0279460165329002],[47,35,.3398144781420294],[47,36,.628821594757742],[48,36,.8652806947525041],[48,37,.10150809298528844],[49,37,1.0244186730654867],[50,38,1.029412240942602],[51,38,.32613283297317347],[51,39,.6405065019041107],[52,39,.8537980365619783],[52,40,.11124595830527892],[53,40,1.0259177162406141],[54,41,1.030638956235277],[55,41,.3131022777355948],[55,42,.6517926196031543],[56,42,.8427051290118196],[56,43,.12082196533877268],[57,43,1.0272638027474759],[58,44,1.031651623831845],[59,44,.3006848555240512],[59,45,.6626976096262132],[60,45,.8319849024715039],[60,46,.13023487533380312],[61,46,1.0284661577762764],[62,47,1.0324730153919173],[63,47,.28884520321029805],[63,48,.6732379878311283],[64,48,.821621382643116],[64,49,.1394837401591093],[65,49,1.0295335334192939],[66,50,1.0331235182054521],[67,50,.27755036829985363],[67,51,.68342922107227],[68,51,.8115995989355603],[68,52,.148567879414825],[69,52,1.0304742340231496],[70,53,1.0336214033370148],[71,53,.2667696361817086],[71,54,.6932858140884962],[72,54,.8019055022130549],[72,55,.1574868591255191],[73,55,1.031296139836255],[74,56,1.0339830613212895],[75,56,.2564743680536822],[75,57,.7028213875855097],[76,57,.7925258907912134],[76,58,.16624047189958738],[77,58,1.032006729117501],[78,59,1.0342232095724524],[79,59,.24663784949713183],[79,60,.7120487485622758],[80,60,.7834483437084975],[80,61,.17482871845079165],[81,61,1.032613098850059],[82,62,1.0343550751159198],[83,62,.2372351494674972],[83,63,.7209799537859948],[84,63,.7746611604312031],[84,64,.18325179038711914],[85,64,1.0331219841851924],[86,65,1.0343905557724016],[87,65,.22824298931879333],[87,66,.7296263672031092],[88,66,.7661533062642226],[88,67,.19151005417692718],[89,67,1.0335397767254908],[90,68,1.0343403625078313],[91,68,.21963962139622123],[91,69,.7379987119645334],[92,69,.7579143628308538],[92,70,.19960403621540457],[93,70,1.0338725417430177],[94,71,1.0342141453043734],[95,71,.21140471667072153],[95,72,.746107117663542],[96,72,.7499344830670268],[96,73,.20753440891552338],[97,73,1.0341260344172454],[98,74,1.034020604597683],[99,74,.20351926086574523],[99,75,.7539611633021215],[100,75,.7422043502477234],[100,76,.2153019777561019],[101,76,1.0343057151671131],[102,77,1.0337675900563705],[103,77,.19596545852169872],[103,78,.7615699164421695],[104,78,.734715140616724],[104,79,.22290766922455862],[105,79,1.034416764143981],[106,80,1.03346218824938],[107,80,.1887266444456389],[107,81,.7689419689404797],[108,81,.7274584892496355],[108,82,.23035251959385997],[109,82,1.0344640949448594],[110,83,1.0331108005456808],[111,83,.18178720201436843],[111,84,.7760854696185804],[112,84,.7204264588178948],[112,85,.23763766448199494],[113,85,1.0344523675990727],[114,86,1.032719212418228],[115,86,.1751324878193402],[115,87,.7830081541774375],[116,87,.7136115109646374],[116,88,.2447643291417676],[117,88,1.0343860008764458],[118,89,1.0322926551739824],[119,89,.16874876216974247],[119,90,.789717372631832],[120,90,.7070064800338803],[120,91,.2517338194331562],[121,91,1.0342691839607763],[122,92,1.0318358610025598],[123,92,.16262312499771858],[123,93,.7962201145052664],[124,93,.7006045489251309],[124,94,.25854751343650967],[125,94,1.0341058875275075],[126,95,1.0313531121234998],[127,95,.15674345673841866],[127,96,.8025230320033012],[128,96,.6943992268713032],[128,97,.2652068536620191],[129,97,1.033899874262366],[130,98,1.030848284714744],[131,98,.1510983637896712],[131,99,.8086324613545763],[132,99,.6883843289574696],[132,100,.2717133398209474],[133,100,1.033654708853177],[134,101,1.0303248882205327],[135,101,.14567712818173575],[135,102,.8145544424922615],[136,102,.6825539572209546],[136,103,.2780685221191216],[137,103,1.033373767485838],[138,104,1.0297861005632643],[139,104,.14046966111762169],[139,105,.8202947372282664],[140,105,.6769024831869065],[140,106,.28427399504058354],[141,106,1.0330602468722847],[142,107,1.029234799720434],[143,107,.13546646006984392],[143,108,.8258588460540109],[144,108,.671424531713726],[144,109,.290331391589362],[145,109,1.0327171728357682],[146,110,1.0286735920712562],[147,110,.13065856914309196],[147,111,.8312520236957351],[148,111,.6661149660273628],[148,112,.2962423779602388],[149,112,1.03234740847843],[150,113,1.0281048378703825],[151,113,.12603754244145],[151,114,.8364792935255917],[152,114,.6609688738465388],[152,115,.30200864860954885],[153,115,1.0319536619522978],[154,116,1.0275306741623285],[155,116,.12159541018943322],[155,117,.8415454609370665],[156,117,.655981554500098],[156,118,.3076319217011811],[157,118,1.031538493855763],[158,119,1.0269530354146845],[159,119,.11732464738966399],[159,120,.846455125764718],[160,120,.6511485069565366],[160,121,.3131139349019227],[161,121,1.0311043242739946],[162,122,1.0263736721146446],[163,122,.11321814480714538],[163,123,.851212693834753],[164,123,.6464654186857061],[164,124,.3184564415055735],[165,124,1.0306534394819706],[166,125,1.0257941675461106],[167,125,.10926918209624069],[167,126,.8558223877141483],[168,126,.6419281552876014],[168,127,.32366120686047056],[169,127,1.0301879983273805],[170,128,1.0252159529388847],[171,128,.10547140289367021],[171,129,.8602882567276612],[172,129,.6375327508240597],[172,130,.32873000508360367],[173,130,1.0297100383091813],[174,131,1.0246403211604227],[175,131,.10181879172477112],[175,132,.8646141862987496],[176,132,.6332753987956673],[176,133,.33366461604209907],[177,133,1.0292214813668379],[178,134,1.0240684391009978],[179,134,.09830565257411007],[179,135,.8688039066707689],[180,135,.6291524437169539],[180,136,.3384668225808326],[181,136,1.0287241393952773],[182,137,1.0235013588866442],[183,137,.0949265889928822],[183,138,.8728610010546515],[184,138,.6251603732380943],[184,139,.3431384079843332],[185,139,1.0282197194980238],[186,140,1.0229400280388043],[187,140,.09167648561647405],[187,141,.8767889132518744],[188,141,.6212958107744541],[188,142,.3476811536535296],[189,142,1.0277098289923983],[190,143,1.0223852986877378],[191,143,.08855049098843445],[191,144,.8805909547856343],[192,144,.6175555086043407],[192,145,.35209683698566024],[193,145,1.0271959801772084],[194,146,1.021837935933431],[195,146,.08554400158179727],[195,147,.8842703115872171],[196,147,.6139363413989273],[196,148,.35638722943949186],[197,148,1.026679594876984],[198,149,1.0212986254395027],[199,149,.082652646931321],[199,150,.8878300502607867],[200,150,.6104353001536761],[200,151,.3605540947783916],[201,151,1.0261620087703698],[202,152,1.020767980334856],[203,152,.07987227578640096],[203,153,.8912731239662092],[204,153,.6070494864912312],[204,154,.364599187472458],[205,154,1.025644475516362],[206,155,1.0202465474911722],[207,155,.07719894321045902],[207,156,.8946023779404728],[208,156,.6037761073076129],[208,157,.36852425125748506],[209,157,1.0251281706842847],[210,158,1.0197348132361097],[211,158,.07462889855138014],[211,159,.8978205546916732],[212,159,.6006124697383151],[212,160,.3723310178292769],[213,160,1.0246141955013988],[214,161,1.0192332085569418],[215,161,.07215857422040488],[215,162,.9009302988805],[216,162,.5975559764226185],[216,163,.37602120567284064],[217,163,1.024103580422386],[218,164,1.018742113842709],[219,164,.06978457521665815],[219,165,.9039341619174114],[220,165,.5946041210439893],[220,166,.3795965190111676],[221,166,1.0235972885322195],[222,167,1.0182618632088625],[223,167,.0675036693443592],[223,168,.9068346062921914],[224,168,.5917544841265701],[224,169,.3830586468674795],[225,169,1.0230962187892327],[226,170,1.0177927484431766],[227,170,.06531277806896706],[227,171,.9096340096561174],[228,171,.5890047290713193],[228,172,.38640926223293437],[229,172,1.0226012091159231],[230,173,1.017335022608167],[231,173,.0632089679653424],[231,174,.9123346686734497],[232,174,.586352598418078],[232,175,.3896500213288084],[233,175,1.0221130393455482],[234,176,1.0168889033326205],[235,176,.06118944272087777],[235,177,.914938802652698],[236,177,.5837959103122896],[236,178,.39278256296329067],[237,178,1.0216324340290364],[238,179,1.0164545758191],[239,179,.05925153564332089],[239,180,.9174485569826359],[240,180,.5813325551691159],[240,181,.3958085079669357],[241,181,1.0211600651125134],[242,182,1.01603219559476],[243,182,.05739270264601734],[243,183,.919866006375456],[244,183,.578960492519135],[244,184,.39872945870775167],[245,184,1.020696554488055],[246,185,1.0156218910279706],[247,185,.055610515672866775],[247,186,.9221931579354511],[248,186,.5766777480237313],[248,187,.4015469986761612],[249,187,1.0202424764259312],[250,188,1.0152237656316911],[251,188,.05390265653168126],[251,189,.9244319540637365],[252,189,.5744824106486663],[252,190,.4042626921377848],[253,190,1.0197983598926021],[254,191,1.0148379001729047],[255,191,.052266911108559244],[255,192,.9265842752073952],[256,192,.5723726299899468],[256,193,.40687808384383367],[257,193,1.0193646907609162],[258,194,1.0144643546050645],[259,194,.05070116393653833],[259,195,.9286519424651887],[260,195,.5703466137364466],[260,196,.4093946987997115],[261,196,1.0189419139168765],[262,197,1.014103169839173],[263,197,.04920339309393266],[263,198,.9306367200572258],[264,198,.5684026252644323],[264,199,.41181404208517797],[265,199,1.0185304352678317],[266,200,1.0137543693675302],[267,200,.04777166540942449],[267,201,.9325403176671191],[268,201,.5665389813575877],[268,202,.4141375987198434],[269,202,1.0181306236573189],[270,203,1.0134179607527265],[271,203,.04640413195303674],[271,204,.934364392667829],[272,204,.5647540500383554],[272,205,.4163668335733731],[273,205,1.017742812691386],[274,206,1.0130939369942324],[275,206,.04509902379599986],[275,207,.9361105522297561],[276,207,.5630462485124229],[276,208,.4185031913161667],[277,208,1.0173673024779883],[278,209,1.0127822777820206],[279,209,.043854648017688035],[279,210,.9377803553285139],[280,210,.5614140412123577],[280,211,.42054809640522234],[281,211,1.0170043612872055],[282,212,1.0124829506474082],[283,212,.042669383945431606],[283,213,.9393753146522579],[284,213,.5598559379382144],[284,214,.42250295310432634],[285,214,1.016654227133528],[286,215,1.0121959120202477],[287,215,.04154167961383383],[287,216,.9408968984130733],[288,216,.5583704920894111],[288,217,.42436914553372207],[289,217,1.0163171092845467],[290,218,1.0119211081990869],[291,218,.04047004842376173],[291,219,.9423465320743504],[292,219,.5569562989809166],[292,220,.4261480377490578],[293,220,1.0159931896995795],[294,221,1.0116584762427925],[295,221,.03945306599345366],[295,222,.9437255999933521],[296,222,.5556119942410062],[296,223,.4278409738424421],[297,223,1.0156826244024533],[298,224,1.0114079447897668],[299,224,.038489367187566605],[299,225,.9450354469842541],[300,225,.5543362522836106],[300,226,.42944927807097044],[301,226,1.015385544788648],[302,227,1.0111694348102989],[303,227,.03757764331096192],[303,228,.9462773798108762],[304,228,.5531277848528364],[304,229,.4309742550012965],[305,229,1.0151020588742643],[306,230,1.010942860298229],[307,230,.036716639459590646],[307,231,.9474526686068676],[308,231,.5519853396352962],[308,232,.4324171896758833],[309,232,1.0148322524854105],[310,233,1.0107281289063446],[311,233,.03590515201636021],[311,234,.9485625482321702],[312,234,.5509076989367998],[312,235,.43377934779319954],[313,235,1.0145761903940136],[314,236,1.0105251425307091],[315,236,.03514202628559325],[315,237,.9496082195647421],[316,237,.5498936784177629],[316,238,.4350619759070698],[317,238,1.014333917399279],[318,239,1.0103337978471305],[319,239,.03442615425358563],[319,240,.9505908507379167],[320,240,.5489421258861396],[320,241,.43626630163460317],[321,241,1.0141054593619083],[322,242,1.01015398680447],[323,242,.03375647247069698],[323,243,.9515115783174108],[324,243,.5480519201477565],[324,244,.43739353387882146],[325,244,1.0138908241879996],[326,245,1.0099855970782285],[327,245,.033131960048180864],[327,246,.9523715084281075],[328,246,.5472219699015581],[328,247,.438444863061944],[329,247,1.013690002769195],[330,248,1.009828512486449],[331,248,.0325516367573507],[331,249,.9531717178331495],[332,249,.5464512126887197],[332,250,.43942146136466664],[333,250,1.0135029698801676],[334,251,1.0096826133725936],[335,251,.03201456123217285],[335,252,.9539132549610332],[336,252,.5457386138858732],[336,253,.4403244829779182],[337,253,1.0133296850325435],[338,254,1.009547776957031],[339,254,.03151982926510845],[339,255,.9545971408911784],[340,255,.5450831657405287],[340,256,.44115506435778573],[341,256,1.0131700932920482],[342,257,1.0094238776594737],[343,257,.031066572189892106],[343,258,.9552243702967873],[344,258,.5444838864501296],[344,259,.44191432448690826],[345,259,1.013024126057376],[346,260,1.0093107873949636],[347,260,.030653955347715485],[347,261,.9557959123477745],[348,261,.5439398192781751],[348,262,.44260336514265247],[349,262,1.01289170180302],[350,263,1.0092083758457435],[351,263,.03028117663272106],[351,264,.956312711573757],[352,264,.5434500317097861],[352,265,.44322327116676213],[353,265,1.012772726788603],[354,266,1.0091165107105933],[355,266,.029947465111254432],[355,267,.9567756886915669],[356,267,.5430136146404813],[356,268,.443775110739594],[357,268,1.0126670957357586],[358,269,1.0090350579329337],[359,269,.02965207970869547],[359,270,.9571857414000476],[360,270,.5426296815994802],[360,271,.44425993565630856],[361,271,1.012574692474406],[362,272,1.0089638819102829],[363,272,.029394307963707546],[363,273,.9575437451393404],[364,273,.5422973680058967],[364,274,.4446787816043237],[365,274,1.0124953905592755],[366,275,1.0089028456858484],[367,275,.029173464843693937],[367,276,.9578505538209541],[368,276,.5420158304528419],[368,277,.44503266844280676],[369,277,1.0124290538587923],[370,278,1.0088518111235036],[371,278,.028988891617224174],[371,279,.9581070005279474],[372,279,.5417842460227992],[372,280,.4453226004830567],[373,280,1.012375537116488],[374,281,1.0088106390682976],[375,281,.028839954783933083],[375,282,.9583138981860433],[376,282,.5416018116287169],[376,283,.4455495667668758],[377,283,1.0123346864882432],[378,284,1.008779189492711],[379,284,.02872604505481853],[379,285,.9584720402070429],[380,285,.5414677433849261],[380,286,.44571454134485444],[381,286,1.0123063400541175],[382,287,1.008757321629678],[383,287,.028646576380597488],[383,288,.9585822011116006],[384,288,.5413812759956369],[384,289,.4458184835568685],[385,289,1.0122903283078832],[386,290,1.0087448940943453],[387,290,.028600985028178233],[387,291,.9586451371206854],[388,291,.541341662177547],[388,292,.44586233830592226],[389,292,1.0122864746237836],[390,293,1.0087417649949195],[391,293,.028588728701898054],[391,294,.9586615867284015],[392,294,.5413481720936798],[392,295,.44584703633543826],[393,295,1.0122945957030358],[394,296,1.0087477920325896],[395,296,.028609285702619672],[395,297,.958632271251788],[396,297,.5414000928186515],[396,298,.44577349450072723],[397,298,1.0123145019997328],[398,299,1.0087628325926643],[399,299,.028662154128659946],[399,300,.9585578953591529],[400,300,.5414967278190544],[400,301,.4456426160405528],[401,301,1.0123459981276965],[402,302,1.0087867438270437],[403,302,.028746851113718195],[403,303,.9584391475775814],[404,303,.5416373964555454],[404,304,.4454552908447334],[405,304,1.0123888832492127],[406,305,1.0088193827286074],[407,305,.02886291209986826],[407,306,.9582767007831089],[408,306,.541821433501071],[408,307,.44521239571891796],[409,307,1.0124429514472502],[410,308,1.0088606061980132],[411,308,.029009890142771087],[411,309,.9580712126699451],[412,309,.5420481886827784],[412,310,.4449147946460895],[413,310,1.01250799207953],[414,311,1.0089102711038211],[415,311,.029187355249536997],[415,312,.9578233262044412],[416,312,.5423170262339921],[416,313,.44456333904778883],[417,313,1.0125837901172945],[418,314,1.0089682343360202],[419,314,.02939489374516595],[419,315,.9575336700623188],[420,315,.5426273244683578],[420,316,.4441588680360723],[421,316,1.0126701264704934],[422,317,1.0090343528545804],[423,317,.029632107670909735],[423,318,.9572028590461733],[424,318,.5429784753662162],[424,319,.44370220866623333],[425,319,1.0127667782967882],[426,320,1.0091084837312583],[427,320,.02989861420426184],[427,321,.9568314944924141],[428,321,.5433698841780775],[428,322,.44319417618582607],[429,322,1.0128735192969558],[430,323,1.0091904841873789],[431,323,.03019404510848359],[431,324,.9564201646615609],[432,324,.5438009690392793],[432,325,.442635574278337],[433,325,1.0129901199984148],[434,326,1.0092802116265451],[435,326,.030518046204357472],[435,327,.9559694451142186],[436,327,.5442711606026257],[436,328,.4420271953022404],[437,328,1.013116348025554],[438,329,1.0093775236632159],[439,329,.030870276865616747],[439,330,.9554798990737882],[440,330,.5447799016825403],[440,331,.4413698205263152],[441,331,1.0132519683584005],[442,332,1.009482278147551],[443,332,.03125040953717358],[443,333,.9549520777754482],[444,333,.5453266469100869],[444,334,.4406642203630321],[445,334,1.0133967435791398],[446,335,1.009594333186143],[447,335,.031658129272365214],[447,336,.9543865208053518],[448,336,.5459108623998897],[448,337,.43991115459682073],[449,337,1.0135504341086077],[450,338,1.0097135471594447],[451,338,.03209313328990995],[451,339,.9537837564264052],[452,339,.5465320254328632],[452,340,.4391113726049666],[453,340,1.013712798432744],[454,341,1.009839778736762],[455,341,.03255513055252836],[455,342,.9531443018899375],[456,342,.5471896241467579],[456,343,.43826561357805704],[457,343,1.0138835933177033],[458,344,1.0099728868869051],[459,344,.033043841357819334],[459,345,.9524686637453139],[460,345,.5478831572348231],[460,346,.437374606734874],[461,346,1.0140625740178375],[462,347,1.0101127308880269],[463,347,.03355899695286791],[463,348,.9517573381261256],[464,348,.5486121336621822],[464,349,.436439071532636],[465,349,1.0142494944714182],[466,350,1.0102591703335964],[467,350,.03410033916008615],[467,351,.9510108110386514],[468,351,.5493760723833191],[468,352,.4354597178717026],[469,352,1.0144441074918717],[470,353,1.0104120651366326],[471,353,.03466762001996195],[471,354,.9502295586328896],[472,354,.5501745020753853],[472,355,.43443724629963687],[473,355,1.0146461649465606],[474,356,1.0105712755316636],[475,356,.035260601448092795],[475,357,.9494140474694148],[476,357,.5510069608761691],[476,358,.43337234820709825],[477,358,1.0148554179311553],[478,359,1.0107366620751033],[479,359,.035879054907258415],[479,360,.9485647347731454],[480,360,.5518729961339426],[480,361,.4322657060211073],[481,361,1.0150716169344107],[482,362,1.0109080856433987],[483,362,.036522761091017805],[483,363,.9476820686815849],[484,363,.5527721641646695],[484,364,.4311179933933358],[485,364,1.0152945119966836],[486,365,1.011085407429963],[487,365,.037191509621709105],[487,366,.9467664884832998],[488,366,.5537040300164661],[488,367,.42992987538427074],[489,367,1.0155238528614574],[490,368,1.0112684889404733],[491,368,.03788509876006132],[491,369,.945818424848663],[492,369,.5546681672409077],[492,370,.42870200864543534],[493,370,1.015759389119438],[494,371,1.0114571919861517],[495,371,.038603335123549486],[495,372,.9448383000574974],[496,372,.5556641576735553],[496,373,.42743504159139284],[497,373,1.016000870349307],[498,374,1.0116513786769457],[499,374,.03934603342038135],[499,375,.9438265282100843],[500,375,.556691591222498],[500,376,.42612961457530607],[501,376,1.0162480462474877],[502,377,1.011850911412824],[503,377,.0401130161915153],[503,378,.9427835154401112],[504,378,.5577500656591832],[504,379,.42478636005357434],[505,379,1.0165006667574357],[506,380,1.012055652873517],[507,380,.04090411356002747],[507,381,.9417096601187289],[508,381,.5588391864205529],[508,382,.4234059027505881],[509,382,1.016758482190165],[510,383,1.0122654660085202],[511,383,.04171916299559172],[511,384,.940605353048487],[512,384,.5599585664146272],[512,385,.4219888598177451],[513,385,1.0170212433404524],[514,386,1.0124802140252198],[515,386,.04255800908365318],[515,387,.9394709776545362],[516,387,.5611078258344457],[516,388,.42053584098827806],[517,388,1.0172887015980372],[518,389,1.0126997603766286],[519,389,.04342050330548295],[519,390,.9383069101697904],[520,390,.5622865919744513],[520,391,.4190474487280153],[521,391,1.0175606090547666],[522,392,1.0129239687479124],[523,392,.044306503823998804],[523,393,.9371135198133816],[524,393,.5634944990567509],[524,394,.41752427838399275],[525,394,1.017836718605313],[526,395,1.0131527030429122],[527,395,.04521587528078427],[527,396,.9358911689630978],[528,396,.5647311880602439],[528,397,.4159669183258934],[529,397,1.0181167840454461],[530,398,1.013385827369556],[531,398,.04614848859869256],[531,399,.9346402133241121],[532,399,.5659963065530312],[532,400,.41437595008823225],[533,400,1.0184005601646522],[534,401,1.0136232060250132],[535,401,.04710422079259773],[535,402,.9333610020906034],[536,402,.5672895085344858],[536,403,.41275194850334485],[537,403,1.0186878028359048],[538,404,1.0138647034793364],[539,404,.048082954782625906],[539,405,.9320538781067357],[540,405,.5686104542795039],[540,406,.4110954818363832],[541,406,1.0189782691001303],[542,407,1.0141101843606544],[543,407,.04908457922335384],[543,408,.9307191780153855],[544,408,.5699588101870642],[544,409,.40940711191046436],[545,409,1.0192717172488233],[546,410,1.0143595134378742],[547,410,.05010898832967291],[547,411,.9293572324099554],[548,411,.571334248633412],[548,412,.4076873942350095],[549,412,1.0195679069010588],[550,413,1.014612555604275],[551,413,.05115608171422347],[551,414,.9279683659767549],[552,414,.5727364478324755],[552,415,.4059368781231612],[553,415,1.0198665990790994],[554,416,1.0148691758602966],[555,416,.05222576422885553],[555,417,.9265528976348417],[556,417,.5741650916958022],[556,418,.40415610681371494],[557,418,1.0201675562784311],[558,419,1.0151292392959954],[559,419,.05331794581129548],[559,420,.9251111406735011],[560,420,.575619869698764],[560,421,.40234561758289383],[561,421,1.020470542537326],[562,422,1.0153926110734461],[563,422,.05443254133751677],[563,423,.9236434028815992],[564,423,.577100476753225],[564,424,.40050594185671334],[565,424,1.0207753235006762],[566,425,1.0156591564087798],[567,425,.05556947047932675],[567,426,.9221499866777003],[568,426,.5786066130792553],[568,427,.3986376053171075],[569,427,1.021081666483685],[570,428,1.0159287405542117],[571,428,.056728657567230105],[571,429,.9206311892316345],[572,429,.5801379840824749],[572,430,.3967411280111777],[573,430,1.0213893405291132],[574,431,1.016201228779567],[575,431,.057910031456259455],[575,432,.9190873025878152],[576,432,.5816943002369833],[576,433,.39481702444623007],[577,433,1.021698116466727],[578,434,1.0164764863538518],[579,434,.05911352539724152],[579,435,.9175186137811212],[580,435,.5832752769689779],[580,436,.3928658036922941],[581,436,1.0220077669657777],[582,437,1.0167543785266802],[583,437,.06033907691219022],[583,438,.9159254049505173],[584,438,.5848806345442068],[584,439,.3908879694785636],[585,439,1.022318066586335],[586,440,1.017034770509633],[587,440,.061586627674206584],[587,441,.914307953451257],[588,441,.58651009795775],[588,442,.3888840202832941],[589,442,1.0226287918300547],[590,443,1.017317527457434],[591,443,.06285612338957339],[591,444,.9126665319603182],[592,444,.5881633968320044],[592,445,.3868544494242516],[593,445,1.0229397211858324],[594,446,1.0176025144493452],[595,446,.06414751368695158],[595,447,.9110014085827639],[596,447,.5898402653081352],[596,448,.3847997451452973],[597,448,1.0232506351759092],[598,449,1.0178895964699735],[599,449,.06546075200505637],[599,450,.9093128469516464],[600,450,.5915404419502857],[600,451,.38272039070347513],[601,451,1.0235613163962847],[602,452,1.018178638390636],[603,452,.06679579548876291],[603,453,.9076011063291527],[604,453,.5932636696450677],[604,454,.3806168644453139],[605,454,1.0238715495601471],[606,455,1.0184695049504477],[607,455,.06815260488510425],[607,456,.9058664416991429],[608,456,.5950096955107654],[608,457,.37848963988927037],[609,457,1.024181121533852],[610,458,1.0187620607370533],[611,458,.06953114444294146],[611,459,.9041091038666588],[612,459,.5967782707982764],[612,460,.3763391858013562],[613,460,1.0244898213757605],[614,461,1.0190561701684775],[615,461,.07093138181829654],[615,462,.9023293395404434],[616,462,.5985691508103589],[616,463,.37416596626748977],[617,463,1.0247974403689852],[618,464,1.0193516974735164],[619,464,.07235328797779521],[619,465,.9005273914292568],[620,465,.6003820948062436],[620,466,.37197044076689306],[621,466,1.0251037720559506],[622,467,1.0196485066733956],[623,467,.07379683710904351],[623,468,.8987034983230944],[624,468,.6022168659211814],[624,469,.3697530642404009],[625,469,1.025408612268551],[626,470,1.01994646156273],[627,470,.07526200653052777],[627,471,.8968578951803935],[628,471,.6040732310832857],[628,472,.36751428715382667],[629,472,1.0257117591594511],[630,473,1.0202454256910738],[631,473,.07674877660715493],[631,474,.8949908132065928],[632,474,.6059509609308075],[632,475,.3652545555682938],[633,475,1.0260130132278693],[634,476,1.0205452623441595],[635,476,.07825713066499564],[635,477,.8931024799348216],[636,477,.6078498297369068],[636,478,.36297431119783957],[637,478,1.026312177347325],[638,479,1.0208458345252258],[639,479,.07978705490923481],[639,480,.8911931193041005],[640,480,.6097696153313106],[640,481,.360673991471839],[641,481,1.0266090567901067],[642,482,1.021147004936792],[643,482,.08133853834681559],[643,483,.8892629517341233],[644,483,.6117100990244927],[644,484,.3583540295921792],[645,484,1.0269034592511874],[646,485,1.0214486359623245],[647,485,.08291157270803175],[647,486,.8873121941972261],[648,486,.6136710655396947],[648,487,.35601485458732646],[649,487,1.0271951948700204],[650,488,1.0217505896477503],[651,488,.08450615237016054],[651,489,.885341060291742],[652,489,.6156523029400911],[652,490,.3536568913681695],[653,490,1.0274840762511013],[654,491,1.022052727683594],[655,491,.08612227428601159],[655,492,.8833497603088218],[656,492,.6176536025590085],[656,493,.3512805607832744],[657,493,1.02776991848203],[658,494,1.0223549113867765],[659,494,.08775993791161714],[659,495,.8813385013049766],[660,495,.6196747589336273],[660,496,.34888627966024516],[661,496,1.028052539155018],[662,497,1.0226570016825074],[663,497,.08941914513388247],[663,498,.8793074871648813],[664,498,.621715569739104],[664,499,.346474460866357],[665,499,1.0283317583791294],[666,500,1.0229588590871557],[667,500,.09109990020637701],[667,501,.8772569186645972],[668,501,.6237758357289777],[668,502,.34404551334349676],[669,502,1.0286073987990987],[670,503,1.023260343690056],[671,503,.09280220968027517],[671,504,.8751869935378795],[672,504,.6258553606671395],[672,505,.3415998421603758],[673,505,1.0288792856085094],[674,506,1.0235613151361742],[675,506,.09452608233896752],[675,507,.8730979065358732],[676,507,.6279539512706841],[676,508,.33913784855416224],[677,508,1.0291472465628844],[678,509,1.0238616326091752],[679,509,.09627152913686766],[679,510,.8709898494841083],[680,510,.6300714171530707],[680,511,.3366599299694516],[681,511,1.0294111119920568],[682,512,1.0241611548135297],[683,512,.09803856313307117],[683,513,.8688630113461538],[684,513,.6322075707612916],[684,514,.3341664801038121],[685,514,1.0296707148107829],[686,515,1.0244597399582411],[687,515,.09982719943517422],[687,516,.8667175782751595],[688,516,.6343622273238361],[688,517,.33165788894132453],[689,517,1.029925890529174],[690,518,1.024757245739534],[691,518,.10163745513498708],[691,519,.864553733672022],[692,519,.6365352047963319],[692,520,.32913454279236454],[693,520,1.0301764772610114],[694,521,1.0250535293244536],[695,521,.10346934925456013],[695,522,.8623716582378126],[696,522,.6387263238040831],[696,523,.32659682433041565],[697,523,1.0304223157317631],[698,524,1.0253484473338592],[699,524,.10532290268142636],[699,525,.8601715300305955],[700,525,.6409354075949926],[700,526,.32404511262442137],[701,526,1.0306632492858765],[702,527,1.0256418558269649],[703,527,.10719813812199533],[703,528,.8579535245094766],[704,528,.6431622819855923],[704,529,.3214797831731655],[705,529,1.0308991238920382],[706,530,1.0259336102845216],[707,530,.10909508003982304],[707,531,.855717814591042],[708,531,.6454067753119441],[708,532,.3189012079363341],[709,532,1.03112978814904],[710,533,1.0262235655929648],[711,533,.11101375459950885],[711,534,.8534645706974212],[712,534,.6476687183847731],[712,535,.31630975536452444],[713,535,1.0313550932895121],[714,536,1.0265115760290215],[715,536,.11295418962138112],[715,537,.8511939607995829],[716,537,.6499479444348513],[716,538,.3137057904341974],[717,538,1.0315748931821125],[718,539,1.0267974952437684],[719,539,.11491641452111552],[719,540,.8489061504692988],[720,540,.6522442890739327],[720,541,.3110896746693046],[721,541,1.0317890443354898],[722,542,1.027081176247435],[723,542,.11690046026072583],[723,543,.8466013029223681],[724,543,.6545575902471419],[724,544,.3084617661720711],[725,544,1.0319974058989068],[726,545,1.0273624713942857],[727,545,.11890635929917114],[727,546,.8442795790631381],[728,546,.6568876881880987],[728,547,.3058224196480645],[729,547,1.0321998396634169],[730,548,1.0276412323675237],[731,548,.12093414553884717],[731,549,.8419411375296247],[732,549,.6592344253774453],[732,550,.3031719864317822],[733,550,1.0323962100616533],[734,551,1.027917310164898],[735,551,.12298385427920393],[735,552,.8395861347312832],[736,552,.661597646501151],[736,553,.30051081451364153],[737,553,1.0325863841657408],[738,554,1.028190555083932],[739,554,.12505552216817234],[739,555,.8372147248951822],[740,555,.6639771984076539],[740,556,.2978392485576317],[741,556,1.0327702316879357],[742,557,1.0284608167076257],[743,557,.12714918714905468],[743,558,.8348270601054527],[744,558,.6663729300704698],[744,559,.2951576299293991],[745,559,1.0329476249762861],[746,560,1.0287279438905246],[747,560,.12926488841857217],[747,561,.8324232903405301],[748,561,.6687846925454237],[748,562,.2924662967182933],[749,562,1.0331184390116956],[750,563,1.0289917847447467],[751,563,.13140266637549056],[751,564,.8300035635173267],[752,564,.6712123389365675],[752,565,.28976558374944045],[753,565,1.033282551406384],[754,566,1.0292521866268258],[755,566,.13356256257828694],[755,567,.8275680255195722],[756,567,.6736557243576808],[756,568,.28705582261488644],[757,568,1.0334398423957492],[758,569,1.0295089961237516],[759,569,.1357446196959754],[759,570,.8251168202441111],[760,570,.6761147058925864],[760,571,.2843373416864493],[761,571,1.0335901948361186],[762,572,1.0297620590403478],[763,572,.13794888146102224],[763,573,.822650089632257],[764,573,.6785891425651428],[764,574,.2816104661359854],[765,574,1.0337334941973482],[766,575,1.0300112203862977],[767,575,.1401753926301894],[767,576,.8201679737037143],[768,576,.6810788952992894],[768,577,.278875517953921],[769,577,1.0338696285566522],[770,578,1.0302563243634062],[771,578,.14242419893016717],[771,579,.8176706105975015],[772,579,.6835838268889712],[772,580,.2761328159639002],[773,580,1.0339984885922306],[774,581,1.0304972143534852],[775,581,.14469534702456693],[775,582,.8151581365963325],[776,582,.6861038019600981],[776,583,.2733826758448351],[777,583,1.0341199675739228],[778,584,1.0307337329063364],[779,584,.14698888445850505],[779,585,.8126306861670012],[780,585,.6886386869453004],[780,586,.2706254101402667],[781,586,1.0342339613562985],[782,587,1.0309657217274584],[783,587,.14930485962229872],[783,588,.810088391991206],[784,588,.6911883500416512],[784,589,.267861328280309],[785,589,1.0343403683692496],[786,590,1.0311930216672842],[787,590,.1516433217043255],[787,591,.80753138499415],[788,591,.6937526611907388],[788,592,.2650907365900638],[789,592,1.0344390896084676],[790,593,1.0314154727094134],[791,593,.1540043206504027],[791,594,.8049597943767033],[792,594,.6963314920402311],[792,595,.2623139383094437],[793,595,1.034530028625162],[794,596,1.0316329139598897],[795,596,.1563879071152346],[795,597,.8023737476471726],[796,597,.6989247159176777],[796,598,.25953123360660696],[797,598,1.0346130915153564],[798,599,1.0318451836365417],[799,599,.15879413242528773],[799,600,.799773370648628],[800,600,.7015322078013413],[800,601,.256742919587031],[801,601,1.0346881869094755],[802,602,1.0320521190584917],[803,602,.16122304853347555],[803,603,.7971587875884961],[804,603,.7041538442893039],[804,604,.2539492903120581],[805,604,1.0347552259598483],[806,605,1.032253556636297],[807,605,.16367470797552194],[807,606,.7945301210672343],[808,606,.7067895035746306],[808,607,.2511506368077842],[809,607,1.0348141223290412],[810,608,1.0324493318619021],[811,608,.16614916382632547],[811,609,.7918874921076472],[812,609,.709439065413448],[812,610,.24834724708249672],[813,610,1.0348647921767888],[814,611,1.032639279299876],[815,611,.1686464696616927],[815,612,.7892310201754584],[816,612,.7121024111062217],[816,613,.24553940613187852],[817,613,1.0349071541468273],[818,614,1.0328232325774014],[819,614,.17116667951302045],[819,615,.7865608232133336],[820,615,.7147794234616441],[820,616,.24272739595679857],[821,616,1.0349411293537],[822,617,1.0330010243763053],[823,617,.17370984782335191],[823,618,.7838770176637189],[824,618,.7174699867799718],[824,619,.23991149556876706],[825,619,1.0349666413686411],[826,620,1.033172486424039],[827,620,.17627602940857415],[827,621,.7811797184924586],[828,621,.720173986819918],[828,622,.23709198101021747],[829,622,1.0349836162040225],[830,623,1.0333374494861536],[831,623,.1788652794118951],[831,624,.7784690392157592],[832,624,.7228913107823544],[832,625,.234269125354749],[833,625,1.0349919822996723],[834,626,1.0334957433581187],[835,626,.18147765326305537],[835,627,.7757450919251534],[836,627,.7256218472813651],[836,628,.23144319872166874],[837,628,1.0349916705072433],[838,629,1.033647196858036],[839,629,.1841132066386375],[839,630,.773007987305413],[840,630,.7283654863202004],[840,631,.22861446829229304],[841,631,1.0349826140730403],[842,632,1.033791637819688],[843,632,.1867719954109858],[843,633,.7702578346682248],[844,633,.7311221192693971],[844,634,.2257831983137577],[845,634,1.0349647486235953],[846,635,1.0339288930859631],[847,635,.18945407561392777],[847,636,.7674947419659374],[848,636,.7338916388459672],[848,637,.22294965011006523],[849,637,1.0349380121480094],[850,638,1.0342420464149167],[851,638,.1924281237940313],[851,639,.5378425839134362],[852,639,.5202524171708031],[852,640,.4568109772775498],[852,641,.05199677850209752],[853,640,.24351254102567055],[853,641,.5225687624093359],[853,642,.2921493228893563],[854,642,.25538328243481595],[854,643,.5241438210153896],[854,644,.23257172527298814],[855,643,.011987787701546808],[855,644,.3172219958151092],[855,645,.4868674616302827],[855,646,.176468024136203],[856,645,.07357769424953754],[856,646,.38294232266815553],[856,647,.4259205416014665],[856,648,.11753224171517974],[857,647,.13246196705929972],[857,648,.4398303708699065],[857,649,.36708371923835004],[857,650,.06067586883292038],[858,649,.18926719214302565],[858,650,.4946697651421086],[858,651,.3040061179704405],[858,652,.005602736230038195],[859,651,.23906249586178907],[859,652,.5231149368578739],[859,653,.2495840468006932],[860,653,.2897970473112013],[860,654,.5026442283960142],[860,655,.20274559579570214],[861,654,.04664315619110009],[861,655,.3473240465998149],[861,656,.4526192727121032],[861,657,.1523595035438806],[862,656,.09766699822939251],[862,657,.3969699779916487],[862,658,.40188113292822186],[862,659,.1034820659161816],[863,658,.14649823031506354],[863,659,.44395391725661004],[863,660,.3530826952522148],[863,661,.056517279244449437],[864,660,.193417537810633],[864,661,.48905272813711814],[864,662,.30196784607077015],[864,663,.011088189502860925],[865,662,.235165441654809],[865,663,.5161755064939912],[865,664,.25593745749264785],[866,664,.27598857145168865],[866,665,.5055165820237347],[866,666,.21733399798014585],[867,665,.03142691535889764],[867,666,.321995701601107],[867,667,.4677769922252197],[867,668,.17692400337387545],[868,667,.07312870986769164],[868,668,.3630952451007391],[868,669,.4264378437134144],[868,670,.13731285791147696],[869,669,.11270032695167025],[869,670,.4009509624326517],[869,671,.38688927555227676],[869,672,.09946833663506985],[870,671,.15050630725355646],[870,672,.43706477714430675],[870,673,.34910378546507886],[870,674,.06336347754327785],[871,673,.1865736616624162],[871,674,.4714631653468664],[871,675,.3125696686315781],[871,676,.028869775846049314],[872,675,.22058655357283705],[872,676,.502393455771382],[872,677,.27458473006488804],[873,677,.24983886475629993],[873,678,.5137748593109537],[873,679,.24315322539257223],[874,678,.0036240101488931717],[874,679,.2812413419420975],[874,680,.49584386088869215],[874,681,.2153614227018543],[875,680,.034735500335029305],[875,681,.3144060917430617],[875,682,.46485314373790926],[875,683,.18595981453922283],[876,682,.0641063484572785],[876,683,.34219859962945964],[876,684,.43549740951782173],[876,685,.15817234633893226],[877,684,.091864261548934],[877,685,.3683988258245694],[877,686,.407752916631107],[877,687,.13197572785525458],[878,686,.11803256264694018],[878,687,.3930296465168421],[878,688,.3815964769154389],[878,689,.10734720976073055],[879,688,.1426340315995158],[879,689,.4161134070872291],[879,690,.35700543857338174],[879,691,.08426456699687354],[880,690,.16569092182506315],[880,691,.43767193845249674],[880,692,.33395766972405766],[880,693,.06270608273067858],[881,692,.1872249764612122],[881,693,.457726572814142],[881,694,.3124315425508366],[881,695,.04265053289025597],[882,694,.20725744392861123],[882,695,.47629815883858434],[882,696,.29240591801936916],[882,697,.024077171256560802],[883,696,.22580909293436022],[883,697,.49340707629100294],[883,698,.272739666255128],[883,699,.006906252371233933],[884,698,.24190643067177103],[884,699,.5047275543873398],[884,700,.2549459812508028],[885,700,.2567100539467806],[885,701,.5031577036963546],[885,702,.24065881914660317],[886,701,.008634717813202674],[886,702,.27224949572145724],[886,703,.49094674236787206],[886,704,.22719544196570912],[887,703,.02292373131969297],[887,704,.28597629401801355],[887,705,.47672398599653515],[887,706,.2143533208320832],[888,705,.035751602096786475],[888,706,.29743237559552355],[888,707,.46390276826706217],[888,708,.20289630196958544],[889,707,.04719579903029385],[889,708,.3075210742305127],[889,709,.45246460115847775],[889,710,.19280622955805915],[890,709,.057274491299496445],[890,710,.3162602301176305],[890,711,.4423913913890736],[890,712,.18406533389761395],[891,711,.0660054606502899],[891,712,.3236673045470217],[891,713,.43366542899845073],[891,714,.17665622026124392],[892,713,.07340611260620647],[892,714,.3297593908476435],[892,715,.4262693763198494],[892,716,.17056185812791913],[893,715,.07949348729590157],[893,716,.33455322495703466],[893,717,.42018625732795906],[893,718,.16576557078065143],[894,717,.0842842699121286],[894,718,.3380651956328206],[894,719,.41539944734620887],[894,720,.16225102525634236],[895,719,.0877948008176482],[895,720,.3403113543186734],[895,721,.41189266310148215],[895,722,.1600022226324315],[896,721,.09004108530992379],[896,722,.3413074246800344],[896,723,.4096499531105413],[896,724,.15900348863810745],[897,723,.0910388030604564],[897,724,.341068811820455],[897,725,.4086556883871424],[897,726,.15923946457791555],[898,725,.09080331723824445],[898,726,.33961061119156805],[898,727,.40889455345709996],[898,728,.16069509855546693],[899,727,.08934968333179105],[899,728,.33694761720865024],[899,729,.41035153766953336],[899,730,.1633556369851302],[900,729,.08669265767999552],[900,730,.33309433158306806],[900,731,.41301192679237225],[900,732,.16720661638248935],[901,731,.08284670572359325],[901,732,.32806497138102175],[901,733,.41686129488304347],[901,734,.17223385542154263],[902,733,.0778260099865808],[902,734,.3218734768206457],[902,735,.421885496422382],[902,736,.17842344724960524],[903,735,.07164447779930824],[903,736,.31453351881588426],[903,737,.42807065870301164],[903,738,.185761752049803],[904,737,.06431574877136567],[904,738,.3060585062772846],[904,739,.435403174462235],[904,740,.19423538984244326],[905,739,.05585320202451507],[905,740,.29646159317816856],[905,741,.4438696947508069],[905,742,.20383123351642937],[906,741,.04626996319383157],[906,742,.2857556853951481],[906,743,.4534571220289279],[906,744,.21453640208174513],[907,743,.03557891120608933],[907,744,.27395344733160587],[907,745,.4640838862781736],[907,746,.2259711147745072],[908,745,.02378916236694485],[908,746,.26064383557298154],[908,747,.4744097020055178],[908,748,.23741469023048611],[908,749,.0029874664482454345],[909,747,.010888485342882084],[909,748,.24524012825579347],[909,749,.47705262348683797],[909,750,.25146343127990345],[909,751,.018030374036361534],[910,750,.23051594568994063],[910,751,.4659638155007443],[910,752,.26789265476733026],[910,753,.034103962104678205],[911,752,.2157780537828917],[911,753,.4490488012027463],[911,754,.28394240197843773],[911,755,.051207169174446954],[912,754,.19869680451466967],[912,755,.4309201309554197],[912,756,.3010279740476113],[912,757,.06933596927309439],[913,756,.18059146729117878],[913,757,.4117775174928008],[913,758,.3191380672559441],[913,759,.08847923890660256],[914,758,.16147315955443303],[914,759,.3916318997027402],[914,760,.33826157637971177],[914,761,.10862604895508292],[915,760,.14135280401108383],[915,761,.37049402581791996],[915,762,.35838758963377015],[915,763,.12976565972904766],[916,762,.12024113359574008],[916,763,.34837445826725],[916,764,.3795053837685538],[916,765,.15188751617588445],[917,764,.0981486962833266],[917,765,.32528357838026745],[917,766,.40160441931520835],[917,767,.17498124323033803],[918,766,.07508585975635881],[918,767,.30123159095005636],[918,768,.42467433597326765],[918,769,.19903664130457108],[919,768,.05106281593203439],[919,769,.2762285286588279],[919,770,.4480441892579001],[919,771,.22091817857346802],[920,770,.02605116606412028],[920,771,.24679268601046497],[920,772,.4613333588465915],[920,773,.24636316696152993],[920,774,.026661594315488448],[921,772,.00017143112777602207],[921,773,.22016507993495968],[921,774,.4450006731455823],[921,775,.27654268563105877],[921,776,.05450703342817279],[922,775,.19537707282293476],[922,776,.4169980825615683],[922,777,.3043455873211709],[922,778,.08322496813649063],[923,777,.16671893224886847],[923,778,.3873911007134449],[923,779,.333032487802997],[923,780,.11284587069811512],[924,779,.1371380798307044],[924,780,.3568813039463011],[924,781,.36262258254682433],[924,782,.14336176762117853],[925,781,.10666365535341012],[925,782,.32548606626333626],[925,783,.39310680323983005],[925,784,.17476372572452537],[926,783,.07530458232966944],[926,784,.2932141772790525],[926,785,.4235343782302751],[926,786,.20429957725699868],[927,785,.04297407877416276],[927,786,.2566282342451322],[927,787,.44609730979381396],[927,788,.23600300007995265],[927,789,.023774697332874434],[928,787,.00973561058609779],[928,788,.22213324067090034],[928,789,.4366882593279592],[928,790,.27231575108916795],[928,791,.058813271383982776],[929,790,.1899112794795718],[929,791,.4051174305988943],[929,792,.3087329260703045],[929,793,.09459113946159277],[930,792,.15536737862587172],[930,793,.36909687837539557],[930,794,.3443998634306182],[930,795,.13113054742980831],[931,794,.11887833690004168],[931,795,.3317399346424034],[931,796,.3809015150071346],[931,797,.1684974582828263],[932,796,.08156315084174257],[932,797,.29356399783457987],[932,798,.4168389957384664],[932,799,.2027189344423823],[933,798,.043285265762028874],[933,799,.2496929999720567],[933,800,.44089395742648096],[933,801,.24052352812737388],[933,802,.03507425254057242],[934,800,.0043335535351657515],[934,801,.21027601904641954],[934,802,.42143856683278325],[934,803,.2844016743443022],[934,804,.07585590645285804],[935,803,.17353832434253885],[935,804,.38262846297038483],[935,805,.3257498632562316],[935,806,.11730189433403454],[936,805,.13268775789077444],[936,806,.3407519309130924],[936,807,.3670972990020704],[936,808,.15947396875496164],[937,807,.09057464650490143],[937,808,.2978183751219168],[937,809,.40749895190525254],[937,810,.19795010289674397],[938,809,.0474866463063797],[938,810,.24850494279526708],[938,811,.4346436181876547],[938,812,.2403211224239381],[938,813,.04014881320170647],[939,811,.003878639500178961],[939,812,.2047038150773143],[939,813,.41157455841171137],[939,814,.28957529821809164],[939,815,.08560320920592149],[940,814,.16385621221760913],[940,815,.36828320787286745],[940,816,.33550406688664397],[940,817,.13164677712134118],[941,816,.11836297424309958],[941,817,.32185871977911545],[941,818,.3799973298161782],[941,819,.17581896778117206],[942,818,.07143918326167292],[942,819,.2705029465809176],[942,820,.4180894904987747],[942,821,.22040151023922497],[942,822,.023261093492508676],[943,820,.023754358875460287],[943,821,.22082957274806367],[943,822,.41735892037093947],[943,823,.26975946681527463],[943,824,.07244459405934162],[944,823,.17462856886910824],[944,824,.376380003235797],[944,825,.32258384746152186],[944,826,.12234695850241085],[945,825,.12764964491952732],[945,826,.32754202842781277],[945,827,.3705351976091778],[945,828,.17002290467196218],[946,827,.07705703864783364],[946,828,.27228373423426855],[946,829,.4119493110954956],[946,830,.21796235075295245],[946,831,.024608216085607083],[947,829,.025780053026113373],[947,830,.2190518649272109],[947,831,.41169318411556594],[947,832,.27077590916361477],[947,833,.07732052594065236],[948,832,.1695115580680664],[948,833,.36773423672329814],[948,834,.3275311475162098],[948,835,.13077893984001213],[949,834,.11922966876699366],[949,835,.31565346594837984],[949,836,.37813100062036553],[949,837,.17991281790206778],[950,836,.06510103041600655],[950,837,.25463712967072577],[950,838,.4162975451493948],[950,839,.23222690463246418],[950,840,.043347365043106205],[951,838,.010682336294089382],[951,839,.20025854636251755],[951,840,.3947874901107556],[951,841,.2917173663646273],[951,842,.09950708368621437],[952,841,.14911244770443477],[952,842,.3431424199239878],[952,843,.3480530442639449],[952,844,.15411315971947762],[953,843,.0934299055238343],[953,844,.2830893937829872],[953,845,.3971235804951196],[953,846,.20716078374370134],[953,847,.020137203526012115],[954,845,.036025540013401365],[954,846,.22261124110739972],[954,847,.40630997808531094],[954,848,.2648205963423913],[954,849,.07872881878459281],[955,848,.16692727676480973],[955,849,.35954874836594064],[955,850,.328443108696204],[955,851,.13751082396144756],[956,850,.11152248261980105],[956,851,.3006327942159715],[956,852,.3829521945790107],[956,853,.1916328343080391],[956,854,.0076262937092498664],[957,852,.0514953905500914],[957,853,.2343500090068106],[957,854,.41021535649217705],[957,855,.25030428726128284],[957,856,.06835964516566889],[958,855,.17563114080501685],[958,856,.3667504924135684],[958,857,.31835263030310357],[958,858,.1299663000321827],[959,857,.11940718803292909],[959,858,.3065438045294419],[959,859,.37569491987401304],[959,860,.18605528589059708],[959,861,.004834820768368334],[960,859,.05684866493974193],[960,860,.2366688077210537],[960,861,.4085057240274029],[960,862,.24678375999468344],[960,863,.06783571840441664],[961,862,.17558642045742334],[961,863,.36451985113857055],[961,864,.3173137388508224],[961,865,.13129392160626782],[962,864,.11725721455632943],[962,865,.3008194332920608],[962,866,.37580301677160466],[962,867,.19024874552861262],[962,868,.011245575393110812],[963,866,.05231298976932004],[963,867,.23017401181136463],[963,868,.40175554736854613],[963,869,.2536595659979476],[963,870,.07679940668774121],[964,869,.16706057585212106],[964,870,.35303258747063304],[964,871,.3251768586309606],[964,872,.14116418004635392],[965,871,.10550294433561781],[965,872,.28424844668945237],[965,873,.38249269088982873],[965,874,.2036626805762719],[965,875,.02684871916582402],[966,873,.03836058116912999],[966,874,.21480488879977247],[966,875,.389260042863657],[966,876,.27095452974310497],[966,877,.09504101254228686],[967,876,.1502807743955375],[967,877,.3328577086192332],[967,878,.3421239629983485],[967,879,.15918522100542254],[968,878,.08474515454977341],[968,879,.25820758590913884],[968,880,.3938397310124852],[968,881,.22523159171338067],[968,882,.05190695217080459],[969,880,.015820211753405387],[969,881,.19007905592596833],[969,882,.36921246833932636],[969,883,.2980889913883655],[969,884,.12132017371569158],[970,883,.1247775639085626],[970,884,.3015570552958629],[970,885,.36552163552482225],[970,886,.18684713857492927],[970,887,.014284415706242481],[971,885,.055013622481818666],[971,886,.2263705108609403],[971,887,.39186593267986564],[971,888,.2561333080985603],[971,889,.08592049273991473],[972,888,.1575841200944441],[972,889,.3370827060887002],[972,890,.33284859953655166],[972,891,.15390042438231766],[973,890,.08972988049108406],[973,891,.2590326783958039],[973,892,.38812639016604245],[973,893,.22348813860080616],[973,894,.054161074977768404],[974,892,.017081968749935856],[974,893,.18740927170107446],[974,894,.3625874079443392],[974,895,.2990263270079478],[974,896,.12613079428882987],[975,895,.11819045745461297],[975,896,.28905735771716573],[975,897,.36789499357104777],[975,898,.19628130377264577],[975,899,.02735424128922767],[976,897,.04494375361325131],[976,898,.21330043570426716],[976,899,.37902147922066165],[976,900,.2697531768133337],[976,901,.10241904377888808],[977,900,.14130067843136315],[977,901,.3150246804904708],[977,902,.3480110183643501],[977,903,.1725701388645175],[977,904,.005966983373903607],[978,902,.06884101502859519],[978,903,.23351128359258333],[978,904,.3898863909020141],[978,905,.24593198700119934],[978,906,.08224765045066],[979,905,.1597942440306211],[979,906,.3346851109670727],[979,907,.3285973743088808],[979,908,.15444027476874822],[980,907,.08792661347585409],[980,908,.2508895640647832],[980,909,.38533070676895603],[980,910,.22893712756876922],[980,911,.06583953763953361],[981,909,.01060737785460527],[981,910,.17530908392596897],[981,911,.34707093920704996],[981,912,.3101853041457825],[981,913,.1404924603408273],[982,912,.1016482122325276],[982,913,.2640331008343238],[982,914,.3757885914855772],[982,915,.21658719088481612],[982,916,.05379076081392352],[983,914,.023321537452804155],[983,915,.1869789080592518],[983,916,.35433193126746176],[983,917,.2960976478285003],[983,918,.13047091456929613],[984,917,.11086010315035294],[984,918,.272590889791831],[984,919,.3683410258652817],[984,920,.20801518542415245],[984,921,.04616290894518408],[985,919,.03202626907959427],[985,920,.1942489952348069],[985,921,.35801621736570555],[985,922,.2871844809716754],[985,923,.12448425960359358],[986,922,.11614980664040801],[986,923,.2769245860037902],[986,924,.3634503371272694],[986,925,.20337777894188264],[986,926,.04278533591281287],[987,924,.036633170664026604],[987,925,.19735437260885233],[987,926,.3585975660673821],[987,927,.28298312203941667],[987,928,.12237172260813765],[988,927,.11761764880185657],[988,928,.2769347836061358],[988,929,.3613222869658947],[988,930,.20269252495682932],[988,931,.04352084243134597],[989,929,.03715658569409518],[989,930,.19646584076452728],[989,931,.3563193376763676],[989,932,.28325914825402143],[989,933,.12401877287718965],[990,932,.11535841088563661],[990,933,.2726772185957825],[990,934,.36193002492598775],[990,935,.2058724789923987],[990,936,.04828585408934835],[991,934,.03368059076582972],[991,935,.19166681871807822],[991,936,.35120102320155516],[991,937,.2879669101334489],[991,938,.12934311950798513],[992,937,.10947528483272252],[992,938,.2643619456949593],[992,939,.36503164238003943],[992,940,.21273290367631378],[992,941,.05704255868679827],[993,939,.026351338857843194],[993,940,.18296002570453515],[993,941,.3430562989307297],[993,942,.29724916938947604],[993,943,.13830626997954892],[994,942,.10006782116457263],[994,943,.2523219642979947],[994,944,.3701807952606593],[994,945,.22297333198451888],[994,946,.06976592160365215],[995,944,.015392306252147629],[995,945,.17030051412165803],[995,946,.33152253946088156],[995,947,.31147369956054877],[995,948,.1509473916728322],[996,947,.087196881644584],[996,948,.2369586950063475],[996,949,.376718339613223],[996,950,.2345765114615184],[996,951,.08521591343298078],[997,949,.0011357385555340561],[997,950,.15263475001807864],[997,951,.311827742306229],[997,952,.32860504822914505],[997,953,.16942021655341175],[997,954,.016626147439510436],[998,952,.07024774813594223],[998,953,.2212622403680772],[998,954,.36621398307130515],[998,955,.2523140266095425],[998,956,.10329850546808812],[999,955,.13345393361930616],[999,956,.2868146645965228],[999,957,.3438149621043634],[999,958,.19052159754051476],[999,959,.038598535306774456],[1e3,957,.04874340776161587],[1e3,958,.20027433884645776],[1e3,959,.35045072214288214],[1e3,960,.2752172040116266],[1e3,961,.1246081801436533],[1001,960,.11153410463061227],[1001,961,.25968030157128735],[1001,962,.3589611456155988],[1001,963,.21376355164890676],[1001,964,.06462574300561937],[1002,962,.024112239164856285],[1002,963,.1744379670887302],[1002,964,.32884307142135794],[1002,965,.3038963549633426],[1002,966,.14989396525089382],[1002,967,.002787631885767016],[1003,965,.08652179776851913],[1003,966,.23158274748299973],[1003,967,.37014802862444746],[1003,968,.23660182809114255],[1003,969,.09233857620429504],[1004,968,.14320871996140178],[1004,969,.2949268298641504],[1004,970,.33370967770704096],[1004,971,.1821563205430922],[1004,972,.03341416685633306],[1005,970,.05691996613850173],[1005,971,.2048164607341282],[1005,972,.34996958396767003],[1005,973,.26846185022737096],[1005,974,.12203613352843197],[1006,973,.11270360292617912],[1006,974,.2573174820670815],[1006,975,.35551075517876596],[1006,976,.21342439841857963],[1006,977,.06808655521031844],[1007,975,.02300584415020569],[1007,976,.1693741701851818],[1007,977,.31909197071849676],[1007,978,.3064750144925845],[1007,979,.1569666027177789],[1007,980,.01237576860780718],[1008,978,.07918600624195261],[1008,979,.22224585329482],[1008,980,.36060022658704466],[1008,981,.24542280629144228],[1008,982,.10372340547250797],[1009,981,.13025049048804305],[1009,982,.2755544084078468],[1009,983,.34173289952302016],[1009,984,.19757209548510224],[1009,985,.052414383405106256],[1010,983,.04055057399599624],[1010,984,.18602861646793578],[1010,985,.3325126760154172],[1010,986,.28836807114447566],[1010,987,.1417402962688462],[1010,988,.0007268068329768394],[1011,986,.0921230324039655],[1011,987,.23132424535108578],[1011,988,.3651955312519228],[1011,989,.23251096307120944],[1011,990,.09383068210249161],[1012,989,.1395300348660987],[1012,990,.2846106560560243],[1012,991,.33325384799782276],[1012,992,.18901293891606955],[1012,993,.045352651706964286],[1013,991,.0492531143811913],[1013,992,.19272260635298227],[1013,993,.33561458168523745],[1013,994,.27986377343343843],[1013,995,.13637852619084528],[1014,994,.09650852938196901],[1014,995,.2338020594070448],[1014,996,.36193613166585775],[1014,997,.22898317334607854],[1014,998,.09193468643195023],[1015,996,.002457496874436509],[1015,997,.14093777570167637],[1015,998,.28368384860268375],[1015,999,.33027760738271117],[1015,1e3,.1884400273628213],[1015,1001,.046968846655108074],[1016,999,.04899295849310335],[1016,1e3,.19034003312195327],[1016,1001,.3313219755276299],[1016,1002,.28105052006571385],[1016,1003,.13948843868730657],[1016,1004,.0023949943264103815],[1017,1002,.09296476581718328],[1017,1003,.22852898102309294],[1017,1004,.35981389159869226],[1017,1005,.23289594529521537],[1017,1006,.09793041579114306],[1018,1005,.13381394889325862],[1018,1006,.27358691892030107],[1018,1007,.33460745416509985],[1018,1008,.1955825556102765],[1018,1009,.05665143264068217],[1019,1007,.040361378819567154],[1019,1008,.17925977203170015],[1019,1009,.31806447498945245],[1019,1010,.2909077306146313],[1019,1011,.1516962543781077],[1019,1012,.01525050343287846],[1020,1010,.08150854362929537],[1020,1011,.21698349128246774],[1020,1012,.3497669475500838],[1020,1013,.24583808157633427],[1020,1014,.11136370502634059],[1021,1013,.1194990282921764],[1021,1014,.25479878825131264],[1021,1015,.34346022054644576],[1021,1016,.20933239464254857],[1021,1017,.07400664151417581],[1022,1015,.023670383811016393],[1022,1016,.1594303860158249],[1022,1017,.29640289279632487],[1022,1018,.3088876485347881],[1022,1019,.17249814489158258],[1022,1020,.03643709112995095],[1023,1018,.062217701784737935],[1023,1019,.19815982330648652],[1023,1020,.3337745723213922],[1023,1021,.3700921432339217],[1023,1022,.3700921432339217]];function g(){const e=r.buffer([1024,1024]);for(let t=0;t<f.length;t++){const n=f[t];e.set(n[2],n[0],n[1])}return e.toTensor()}function S(e,t,n){return r.div(r.sub(e,n),t)}async function y(e){return function(e,t){const n=e.length,r=e[0].length/2,i=t.winLength||r,o=t.hopLength||Math.floor(i/4),a=t.center||!1;let c=Object(s.b)(i);for(let e=0;e<c.length;e++)c[e]=c[e]/1.5;c=Object(s.f)(c,r);const u=r+o*(n-1),l=new Float32Array(u);for(let t=0;t<n;t++){const n=t*o;let i=b(e[t]);i=v(i=Object(s.a)(i,c),l.slice(n,n+r)),l.set(i,n)}let p=0,d=u;a?(p=r/2,d=l.length-r/2):(p=u-h,d=l.length-p);return l.slice(p,d)}(e,{nFFt:m,winLength:m,hopLength:d,sampleRate:p,center:!1})}async function w(e){const t=r.tidy(()=>{const t=function(e){return r.tidy(()=>{const t=g().expandDims(0),n=S(e,a,c),i=r.exp(n),o=r.matMul(i,t);return r.sqrt(o)})}(r.slice(e,[0,0,0,0],[1,-1,-1,1]).reshape([1,128,1024])),n=function(e){return r.tidy(()=>{const t=g().expandDims(0),n=S(e,u,l),i=r.cumsum(r.mul(n,Math.PI),1);return r.matMul(i,t)})}(r.slice(e,[0,0,0,1],[1,-1,-1,1]).reshape([1,128,1024]));let i=t.mul(r.cos(n));const o=r.reverse(i.slice([0,0,0],[1,128,1023]),2);i=r.concat([i,o],2);let s=t.mul(r.sin(n));const p=r.reverse(s.slice([0,0,0],[1,128,1023]),2);return[i,s=r.concat([s,r.mul(p,-1)],2)]}),n=await function(e,t){const n=r.tidy(()=>{let n=r.concat([e,t],0).expandDims(3);n=r.pad(n,[[0,0],[0,0],[1,0],[0,0]]);return r.batchToSpaceND(n,[1,2],[[0,0],[0,0]]).reshape([128,4096])}),i=n.dataSync(),o=[];for(let e=0;e<128;e++)o[e]=i.slice(4096*e,4096*(e+1));return n.dispose(),o}(t[0],t[1]),i=await y(n);return t.forEach(e=>e.dispose()),i}function b(e){const t=e.length/2,n=new o(t),r=n.createComplexArray();return n.inverseTransform(r,e),n.fromComplexArray(r)}function v(e,t){if(e.length!==t.length)return console.error(`Array lengths must be equal to add: ${e.length}, ${e.length}`),null;const n=new Float32Array(e.length);for(let r=0;r<e.length;r++)n[r]=e[r]+t[r];return n}class N extends r.layers.Layer{constructor(e=1e-8,t={}){super(t),this.epsilon=e,this.layerConfig=t,this.supportsMasking=!0}computeOutputShape(e){return[e[0],e[1],e[2],e[3]]}call(e){return r.tidy(()=>{let t=e;Array.isArray(t)&&(t=t[0]);const n=r.mean(r.square(t),[3],!0);return r.mul(t,r.rsqrt(r.add(n,this.epsilon)))})}getClassName(){return"PixelNorm"}}function T(e=1e-8,t={}){return new N(e,t)}class P extends r.layers.Layer{constructor(e=2,t=16,n={}){super(n),this.kernelH=e,this.kernelW=t,this.layerConfig=n,this.supportsMasking=!0}computeOutputShape(e){return[e[0],2*(this.kernelH-1)+e[1],2*(this.kernelW-1)+e[2],e[3]]}call(e){let t=e;Array.isArray(t)&&(t=t[0]);const n=this.kernelH-1,i=this.kernelW-1;return r.pad(t,[[0,0],[n,n],[i,i],[0,0]])}getClassName(){return"InitialPad"}}class q extends r.layers.Layer{constructor(e=2){super({}),this.scale=e,this.supportsMasking=!0}computeOutputShape(e){return[e[0],this.scale*e[1],this.scale*e[2],e[3]]}call(e){return r.tidy(()=>{let t=e;Array.isArray(t)&&(t=t[0]);const n=r.tile(t,[this.scale**2,1,1,1]);return r.batchToSpaceND(n,[this.scale,this.scale],[[0,0],[0,0]])})}getClassName(){return"BoxUpscale"}}function O(e=2){return new q(e)}class I{constructor(e){this.nn=r.sequential(),this.nLatents=256,this.nPitches=61,this.minMidiPitch=24,this.maxMidiPitch=84,this.midiPitches=this.maxMidiPitch-this.minMidiPitch+1,this.checkpointURL=e}async initialize(){const e=performance.now(),t=await fetch(`${this.checkpointURL}/weights_manifest.json`).then(e=>e.json()).then(e=>r.io.loadWeights(e,this.checkpointURL));r.tidy(()=>{for(const e in t)if(e.includes("kernel")){const n=t[e].shape[0]*t[e].shape[1]*t[e].shape[2],i=t[e];t[e]=r.mul(i,r.sqrt(2/n)),i.dispose()}this.build(t),this.initialized=!0,i.logWithDuration("Initialized model",e,"GANSynth")}),Object.keys(t).map(e=>t[e].dispose())}dispose(){this.initialized&&(this.nn.dispose(),this.initialized=!1)}isInitialized(){return this.initialized}build(e){r.tidy(()=>{const t={filters:256,kernelSize:[2,16],strides:[1,1],activation:"linear",useBias:!0,padding:"valid",dilationRate:[1,1],trainable:!1},n={inputShape:[1,1,this.nLatents+this.nPitches]};this.nn.add(T(1e-8,n)),this.nn.add(function(e=2,t=16,n={}){return new P(e,t,n)}(2,16)),this.nn.add(r.layers.conv2d(t)),this.nn.add(r.layers.leakyReLU({alpha:.2})),this.nn.add(T()),t.padding="same",t.kernelSize=[3,3],this.nn.add(r.layers.conv2d(t)),this.nn.add(r.layers.leakyReLU({alpha:.2})),this.nn.add(T());const i=[256,256,256,128,64,32];for(let e=0;e<i.length;e++)this.nn.add(O(2)),t.filters=i[e],this.nn.add(r.layers.conv2d(t)),this.nn.add(r.layers.leakyReLU({alpha:.2})),this.nn.add(T()),this.nn.add(r.layers.conv2d(t)),this.nn.add(r.layers.leakyReLU({alpha:.2})),this.nn.add(T());t.filters=2,t.kernelSize=[1,1],t.activation="tanh",this.nn.add(r.layers.conv2d(t)),this.setWeights(e)})}setWeights(e){function t(t){const n=e[t];if(void 0===n)throw Error(`Variable not found: ${t}`);return n}const n="Generator/progressive_gan_generator/progressive_gan_block_",r=[t(`${n}1/conv0/conv2d/kernel/ExponentialMovingAverage`),t(`${n}1/conv0/bias/ExponentialMovingAverage`),t(`${n}1/conv1/conv2d/kernel/ExponentialMovingAverage`),t(`${n}1/conv1/bias/ExponentialMovingAverage`),t(`${n}2/conv0/conv2d/kernel/ExponentialMovingAverage`),t(`${n}2/conv0/bias/ExponentialMovingAverage`),t(`${n}2/conv1/conv2d/kernel/ExponentialMovingAverage`),t(`${n}2/conv1/bias/ExponentialMovingAverage`),t(`${n}3/conv0/conv2d/kernel/ExponentialMovingAverage`),t(`${n}3/conv0/bias/ExponentialMovingAverage`),t(`${n}3/conv1/conv2d/kernel/ExponentialMovingAverage`),t(`${n}3/conv1/bias/ExponentialMovingAverage`),t(`${n}4/conv0/conv2d/kernel/ExponentialMovingAverage`),t(`${n}4/conv0/bias/ExponentialMovingAverage`),t(`${n}4/conv1/conv2d/kernel/ExponentialMovingAverage`),t(`${n}4/conv1/bias/ExponentialMovingAverage`),t(`${n}5/conv0/conv2d/kernel/ExponentialMovingAverage`),t(`${n}5/conv0/bias/ExponentialMovingAverage`),t(`${n}5/conv1/conv2d/kernel/ExponentialMovingAverage`),t(`${n}5/conv1/bias/ExponentialMovingAverage`),t(`${n}6/conv0/conv2d/kernel/ExponentialMovingAverage`),t(`${n}6/conv0/bias/ExponentialMovingAverage`),t(`${n}6/conv1/conv2d/kernel/ExponentialMovingAverage`),t(`${n}6/conv1/bias/ExponentialMovingAverage`),t(`${n}7/conv0/conv2d/kernel/ExponentialMovingAverage`),t(`${n}7/conv0/bias/ExponentialMovingAverage`),t(`${n}7/conv1/conv2d/kernel/ExponentialMovingAverage`),t(`${n}7/conv1/bias/ExponentialMovingAverage`),t(`${n}7/to_rgb/conv2d/kernel/ExponentialMovingAverage`),t(`${n}7/to_rgb/bias/ExponentialMovingAverage`)];this.nn.setWeights(r)}predict(e,t){return this.nn.predict(e,{batchSize:t})}randomSample(e){return r.tidy(()=>{const t=r.randomNormal([1,this.nLatents],0,1,"float32"),n=r.tensor1d([e-this.minMidiPitch],"int32"),i=r.oneHot(n,this.midiPitches),o=r.concat([t,i],1).expandDims(1).expandDims(1);return this.predict(o,1)})}specgramsToAudio(e){return w(e)}}n.d(t,"GANSynth",(function(){return I}))},function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(8),o=n(5);const s=16e3,a=512,c=a/s,u=229,l=21,p=108-l+1;var h=n(2);const d=3;function m(e,t,n){return 1===e.shape[0]?e:r.tidy(()=>{const i=e.slice([0,0],[1,t]);let o=n%t;o<=d&&(o+=t);const s=e.slice([e.shape[0]-1,e.shape[1]-o],[-1,-1]);let a=[i,s];if(e.shape[0]>2){const n=e.shape[0]-2;a=[i,e.slice([1,d],[n,t]).as3D(1,n*t,-1),s]}return r.concat(a,1)})}class f{constructor(e,t=250){this.checkpointURL=e,this.chunkLength=t}async initialize(){this.dispose();const e=performance.now(),t=await fetch(`${this.checkpointURL}/weights_manifest.json`).then(e=>e.json()).then(e=>r.io.loadWeights(e,this.checkpointURL));this.build(t),Object.keys(t).map(e=>t[e].dispose()),this.initialized=!0,o.logWithDuration("Initialized model",e,"O&F")}dispose(){this.initialized&&(this.onsetsCnn.dispose(),this.onsetsRnn.dispose(),this.activationCnn.dispose(),this.frameRnn.dispose(),this.velocityCnn.dispose(),this.initialized=!1)}isInitialized(){return this.initialized}async transcribeFromMelSpec(e,t=4){this.isInitialized()||this.initialize();const n=performance.now();o.log("Computing onsets, frames, and velocities...","O&F",20);const[i,s,a]=r.tidy(()=>{const n=function(e,t){let n=Math.ceil(e.length/t),i=e.length%t,o=0;if(n>1&&i>0&&i<=d&&(n-=1,o=i,i=0),1===n)return r.tensor2d(e).expandDims(0);const s=t+2*d,a=r.tensor2d(e.slice(0,s)).expandDims(0),c=r.tensor2d(e.slice(e.length-s)).expandDims(0);if(2===n)return r.concat([a,c],0);let u;u=i?r.tensor2d(e).pad([[0,t-i],[0,0]]).as3D(n,t,-1):r.tensor2d(e.slice(0,e.length-o)).as3D(n,t,-1);const l=r.slice(u,[0,t-d],[n-2,-1]),p=r.slice(u,[2,0],[-1,d]),h=r.concat([l,u.slice(1,n-2),p],1);return r.concat([a,h,c],0)}(e,this.chunkLength);return this.processBatches(n,this.chunkLength,e.length,t)});o.log("Converting to NoteSequence...","O&F",20);const u=async function(e,t,n,i=.5,o=.5){const s=h.a.create(),a=new Uint32Array(p),u=new Uint8Array(p);let d=new Uint8Array(p);function m(e,t){s.notes.push(h.a.Note.create({pitch:e+l,startTime:(a[e]-1)*c,endTime:t*c,velocity:u[e]})),a[e]=0}function f(e,t,n){a[e]?d[e]||(m(e,t),a[e]=t+1,u[e]=n):(a[e]=t+1,u[e]=n)}const g=r.tidy(()=>{let s=r.greater(t,i),a=r.greater(e,o);return s=s.pad([[0,1],[0,0]]),a=a.pad([[0,1],[0,0]]),n=n.pad([[0,1],[0,0]]),[a=r.logicalOr(a,s),s,n]}),[S,y,w]=await Promise.all(g.map(e=>e.data()));g.forEach(e=>e.dispose());const b=e.shape[0];for(let e=0;e<b+1;++e){for(let t=0;t<p;++t){const n=e*p+t;y[n]?f(t,e,w[n]):!S[n]&&a[t]&&m(t,e)}d=y.slice(e*p,(e+1)*p)}return s.totalTime=b*c,s}(i,s,a);return u.then(()=>{i.dispose(),s.dispose(),a.dispose(),o.logWithDuration("Transcribed from mel spec",n,"O&F")}),u}async transcribeFromAudioBuffer(e,t=4){const n=performance.now(),r=async function(e){const t=await Object(i.h)(e);return Object(i.g)(Object(i.e)(t,{sampleRate:s,hopLength:a,nMels:u,nFft:2048,fMin:30}))}(e);return r.then(()=>o.logWithDuration("Converted audio to mel spec",n,"O&F",20)),r.then(e=>this.transcribeFromMelSpec(e.map(e=>Array.from(e),t)))}async transcribeFromAudioFile(e){const t=await Object(i.c)(e);return this.transcribeFromAudioBuffer(t)}async transcribeFromAudioURL(e){const t=await Object(i.d)(e);return this.transcribeFromAudioBuffer(t)}processBatches(e,t,n,i){const o=e=>[this.onsetsCnn.predict(e,i),this.activationCnn.predict(e,i),this.velocityCnn.predict(e,i)];let s,a,c;if(1===e.shape[0])[s,a,c]=o(e.expandDims(-1));else{const r=o(e.expandDims(-1)),i=[];for(let e=0;e<3;++e)i.push(m(r[e],t,n));[s,a,c]=i}const u=this.onsetsRnn.predict(s,this.chunkLength);s.dispose();const l=r.concat3d([u,a],-1);a.dispose();const p=this.frameRnn.predict(l,this.chunkLength),h=r.clipByValue(c,0,1).mul(r.scalar(80)).add(r.scalar(10)).toInt();return c.dispose(),[p.squeeze(),u.squeeze(),h.squeeze()]}build(e){r.tidy(()=>{this.onsetsCnn=new g,this.onsetsCnn.setWeights(e,"onsets"),this.onsetsRnn=new S([null,this.onsetsCnn.outputShape[2]]),this.onsetsRnn.setWeights(e,"onsets","onset_probs"),this.activationCnn=new g("sigmoid"),this.activationCnn.setWeights(e,"frame","activation_probs"),this.frameRnn=new S([null,2*p]),this.frameRnn.setWeights(e,"frame","frame_probs"),this.velocityCnn=new g("linear"),this.velocityCnn.setWeights(e,"velocity","onset_velocities")})}}class g{constructor(e){this.nn=r.sequential();const t={filters:48,kernelSize:[3,3],activation:"linear",useBias:!1,padding:"same",dilationRate:[1,1],inputShape:[null,u,1],trainable:!1},n={scale:!1,trainable:!1};this.nn.add(r.layers.conv2d(t)),this.nn.add(r.layers.batchNormalization(n)),this.nn.add(r.layers.activation({activation:"relu"})),t.inputShape=null,this.nn.add(r.layers.conv2d(t)),this.nn.add(r.layers.batchNormalization(n)),this.nn.add(r.layers.activation({activation:"relu"})),this.nn.add(r.layers.maxPooling2d({poolSize:[1,2],strides:[1,2]})),t.filters=96,this.nn.add(r.layers.conv2d(t)),this.nn.add(r.layers.batchNormalization(n)),this.nn.add(r.layers.activation({activation:"relu"})),this.nn.add(r.layers.maxPooling2d({poolSize:[1,2],strides:[1,2]}));const i=this.nn.outputShape;this.nn.add(r.layers.reshape({targetShape:[i[1],i[2]*i[3]]})),this.nn.add(r.layers.dense({units:768,activation:"relu",trainable:!1})),e&&this.nn.add(r.layers.dense({units:p,activation:e,trainable:!1})),this.outputShape=this.nn.outputShape}dispose(){this.nn.dispose()}predict(e,t){return this.nn.predict(e,{batchSize:t})}setWeights(e,t,n){function r(t){const n=e[t];if(void 0===n)throw Error(`Variable not found: ${t}`);return n}let i=[r(`${t}/conv0/weights`),r(`${t}/conv0/BatchNorm/beta`),r(`${t}/conv0/BatchNorm/moving_mean`),r(`${t}/conv0/BatchNorm/moving_variance`),r(`${t}/conv1/weights`),r(`${t}/conv1/BatchNorm/beta`),r(`${t}/conv1/BatchNorm/moving_mean`),r(`${t}/conv1/BatchNorm/moving_variance`),r(`${t}/conv2/weights`),r(`${t}/conv2/BatchNorm/beta`),r(`${t}/conv2/BatchNorm/moving_mean`),r(`${t}/conv2/BatchNorm/moving_variance`),r(`${t}/fc_end/weights`),r(`${t}/fc_end/biases`)];n&&(i=i.concat([r(`${t}/${n}/weights`),r(`${t}/${n}/biases`)])),this.nn.setWeights(i)}}class S{constructor(e,t=384){this.dense=r.sequential(),this.units=t,this.lstm=function(){const n=r.layers.lstm({inputShape:e,units:t,returnSequences:!0,recurrentActivation:"sigmoid",returnState:!0,kernelInitializer:"zeros",recurrentInitializer:"zeros",biasInitializer:"zeros",trainable:!1}),i=[r.input({shape:e}),r.input({shape:[t]}),r.input({shape:[t]})],o=n.apply(i);return r.model({inputs:i,outputs:o})}(),this.dense.add(r.layers.dense({inputShape:[null,t],units:p,activation:"sigmoid",trainable:!1}))}dispose(){this.lstm.dispose(),this.dense.dispose()}setWeights(e,t,n){function i(t){const n=e[t];if(void 0===n)throw Error(`Variable not found: ${t}`);return n}const o=(e,t=0)=>{const[n,i,o,s]=r.split(e,4,-1);return r.concat([n,o.add(r.scalar(t)),i,s],-1)},s=e=>r.split(o(e),[e.shape[0]-this.units,this.units]),a="cudnn_lstm/rnn/multi_rnn_cell/cell_0/cudnn_compatible_lstm_cell";(e=>e.setWeights(s(i(`${t}/${a}/kernel`)).concat(o(i(`${t}/${a}/bias`),1))))(this.lstm),this.dense.setWeights([i(`${t}/${n}/weights`),i(`${t}/${n}/biases`)])}predict(e,t){return r.tidy(()=>this.predictImpl(e,t))}predictImpl(e,t){const n=e.shape[1],i=Math.ceil(n/t);let o=[r.zeros([1,this.units]),r.zeros([1,this.units])];const s=[];for(let n=0;n<i;++n){const r=e.slice([0,n*t],[-1,n<i-1?t:-1]),a=this.lstm.predict([r,o[0],o[1]]);s.push(this.dense.predict(a[0])),o=a.slice(1)}return 1===s.length?s[0]:r.concat3d(s,1)}}n.d(t,"OnsetsAndFrames",(function(){return f}))},function(e,t,n){"use strict";n.r(t);var r=n(4),i=n(5),o=n(6),s=n(2);const a=/iPad|iPhone|iPod/.test(navigator.userAgent),c=46,u=36,l=4;const p={useSoftmaxLoss:!0,batchNormVarianceEpsilon:1e-7,numInstruments:4,numFilters:128,numLayers:33,numRegularConvLayers:0,dilation:[[1,1],[2,2],[4,4],[8,8],[16,16],[16,32],[1,1],[2,2],[4,4],[8,8],[16,16],[16,32],[1,1],[2,2],[4,4],[8,8],[16,16],[16,32],[1,1],[2,2],[4,4],[8,8],[16,16],[16,32],[1,1],[2,2],[4,4],[8,8],[16,16],[16,32]],layers:null,interleaveSplitEveryNLayers:16,numPointwiseSplits:4};class h{constructor(e,t){this.residualPeriod=2,this.outputForResidual=null,this.residualCounter=-1,this.rawVars=null,this.spec=e,this.rawVars=t}dispose(){null!==this.rawVars&&r.dispose(this.rawVars),this.outputForResidual&&this.outputForResidual.dispose()}predictFromPianoroll(e,t){return r.tidy(()=>{let n=this.getConvnetInput(e,t);const r=this.spec.layers.length;for(let e=0;e<r;e++){this.residualCounter+=1,this.residualSave(n);let t=null;this.spec.interleaveSplitEveryNLayers&&e>0&&e<r-2&&e%(this.spec.interleaveSplitEveryNLayers+1)==0&&(t=this.spec.numPointwiseSplits),n=this.applyConvolution(n,this.spec.layers[e],e,e>=this.spec.numRegularConvLayers,t),n=this.applyResidual(n,0===e,e===r-1,e),n=this.applyActivation(n,this.spec.layers[e],e),n=this.applyPooling(n,this.spec.layers[e],e)}return this.computePredictions(n)})}computePredictions(e){return this.spec.useSoftmaxLoss?e.transpose([0,1,3,2]).softmax().transpose([0,1,3,2]):e.sigmoid()}residualReset(){this.outputForResidual=null,this.residualCounter=0}residualSave(e){this.residualCounter%this.residualPeriod==1&&(this.outputForResidual=e)}applyResidual(e,t,n,r){return null==this.outputForResidual?e:this.outputForResidual.shape[this.outputForResidual.shape.length-1]!==e.shape[e.shape.length-1]?(this.residualReset(),e):(this.residualCounter%this.residualPeriod==0&&(t||n||(e=e.add(this.outputForResidual))),e)}getVar(e,t){const n=`model/conv${t}/${e}`;return this.rawVars[n]}getSepConvVar(e,t){const n=`model/conv${t}/SeparableConv2d/${e}`;return this.rawVars[n]}getPointwiseSplitVar(e,t,n){const r=`model/conv${t}/split_${t}_${n}/${e}`;return this.rawVars[r]}applyConvolution(e,t,n,i,o){if(null==t.filters)return e;const s=t.filters,a=t.convStride||1,c=t.convPad?t.convPad.toLowerCase():"same";let u=null;if(i){const i=this.getSepConvVar("depthwise_weights",n);if(o){u=r.depthwiseConv2d(e,i,[a,a],c,"NHWC",t.dilation);const l=r.split(u,o,u.rank-1),p=[];for(let e=0;e<o;e++){const t=s[3]/o,i=this.getPointwiseSplitVar("kernel",n,e),a=this.getPointwiseSplitVar("bias",n,e),c=r.matMul(l[e].reshape([-1,t]),i,!1,!1),u=r.add(c,a);p.push(u.reshape([l[e].shape[0],l[e].shape[1],l[e].shape[2],t]))}u=r.concat(p,u.rank-1)}else{const o=this.getSepConvVar("pointwise_weights",n),s=this.getSepConvVar("biases",n);u=r.separableConv2d(e,i,o,[a,a],c,t.dilation,"NHWC").add(s)}}else{const i=this.getVar("weights",n),o=t.convStride||1,s=t.convPad?t.convPad.toLowerCase():"same";u=r.conv2d(e,i,[o,o],s,"NHWC",[1,1])}return this.applyBatchnorm(u,n)}applyBatchnorm(e,t){const n=this.getVar("gamma",t),i=this.getVar("beta",t),o=this.getVar("popmean",t),s=this.getVar("popvariance",t);if(a){const t=s.arraySync()[0][0][0],a=r.tensor(t.map(e=>Math.sqrt(e+this.spec.batchNormVarianceEpsilon)));return e.sub(o).mul(n.div(a)).add(i)}return r.batchNorm(e,r.squeeze(o),r.squeeze(s),r.squeeze(i),r.squeeze(n),this.spec.batchNormVarianceEpsilon)}applyActivation(e,t,n){return"identity"===t.activation?e:e.relu()}applyPooling(e,t,n){if(null==t.pooling)return e;const i=t.pooling,o=t.poolPad?t.poolPad.toLowerCase():"same";return r.maxPool(e,[i[0],i[1]],[i[0],i[1]],o)}getConvnetInput(e,t){return e=r.scalar(1,"float32").sub(t).mul(e),t=r.scalar(1,"float32").sub(t),e.concat(t,3)}}class d{constructor(e){this.spec=null,this.initialized=!1,this.checkpointURL=e,this.spec=p}async initialize(){this.dispose();const e=performance.now();this.instantiateFromSpec();const t=await fetch(`${this.checkpointURL}/weights_manifest.json`).then(e=>e.json()).then(e=>r.io.loadWeights(e,this.checkpointURL));this.convnet=new h(this.spec,t),this.initialized=!0,i.logWithDuration("Initialized model",e,"Coconet")}dispose(){this.convnet&&this.convnet.dispose(),this.initialized=!1}isInitialized(){return this.initialized}instantiateFromSpec(){this.spec.layers=[],this.spec.layers.push({filters:[3,3,2*this.spec.numInstruments,this.spec.numFilters]});for(let e=0;e<this.spec.numLayers-3;e++)this.spec.layers.push({filters:[3,3,this.spec.numFilters,this.spec.numFilters],dilation:this.spec.dilation?this.spec.dilation[e]:null});this.spec.layers.push({filters:[2,2,this.spec.numFilters,this.spec.numFilters]}),this.spec.layers.push({filters:[2,2,this.spec.numFilters,this.spec.numInstruments],activation:"identity"})}async infill(e,t){if(o.assertIsRelativeQuantizedSequence(e),0===e.notes.length)throw new Error(`NoteSequence ${e.id} does not have any notes to infill.`);const n=e.totalQuantizedSteps||e.notes[e.notes.length-1].quantizedEndStep,a=function(e,t){const n=r.tidy(()=>r.zeros([t,c,l]).arraySync());return e.notes.forEach(r=>{const o=r.pitch-u,s=r.quantizedStartStep,a=r.quantizedEndStep-r.quantizedStartStep,c=r.instrument;if(c<0||c>=l)i.log(`Found invalid voice ${c}. Skipping.`,"Coconet",5);else{if(s+a>t)throw new Error(`NoteSequence ${e.id} has notes that are longer than the sequence's\n          totalQuantizedSteps.`);for(let e=s;e<s+a;e++)n[e][o][c]=1}}),r.tensor([n])}(e,n);let p,h=.99,d=96;t?(d=t.numIterations||d,h=t.temperature||h,p=this.getCompletionMaskFromInput(t.infillMask,a)):p=this.getCompletionMask(a);const m=await this.run(a,d,h,p),f=function(e,t){const n=r.tidy(()=>e.reshape([t,c,l]).arraySync()),i=s.a.create(),o=[];for(let e=0;e<t;e++)for(let t=0;t<c;t++)for(let r=0;r<l;r++){if(1===n[e][t][r]){const n=s.a.Note.create({pitch:t+u,instrument:r,quantizedStartStep:e,quantizedEndStep:e+1});o.push(n)}}return i.notes=o,i.totalQuantizedSteps=o[o.length-1].quantizedEndStep,i.quantizationInfo={stepsPerQuarter:4},i}(m,n);return a.dispose(),m.dispose(),p.dispose(),f}async run(e,t,n,r){return this.gibbs(e,t,n,r)}getCompletionMaskFromInput(e,t){if(e){const n=r.buffer([t.shape[1],4]);for(let t=0;t<e.length;t++)n.set(1,e[t].step,e[t].voice);return r.tidy(()=>n.toTensor().expandDims(1).tile([1,c,1]).expandDims(0))}return this.getCompletionMask(t)}getCompletionMask(e){return r.tidy(()=>{const t=e.sum(2,!0).equal(r.scalar(0,"float32"));return r.cast(t,"float32").add(r.zerosLike(e))})}async gibbs(e,t,n,i){const o=r.scalar(t,"float32");let s=e.clone();for(let e=0;e<t;e++){const t=this.yaoSchedule(e,o),a=this.bernoulliMask(s.shape,t,i);await r.nextFrame();const c=r.tidy(()=>this.convnet.predictFromPianoroll(s,a));await r.nextFrame(),s=r.tidy(()=>{const e=this.samplePredictions(c,n),i=r.where(r.cast(a,"bool"),e,s);return s.dispose(),c.dispose(),a.dispose(),t.dispose(),i}),await r.nextFrame()}return o.dispose(),s}yaoSchedule(e,t){return r.tidy(()=>{const n=r.scalar(.1,"float32"),i=r.scalar(.9,"float32"),o=r.scalar(.7,"float32"),s=i.sub(n).mul(r.scalar(e,"float32")).div(t),a=i.sub(s).div(o);return n.reshape([1]).concat(a.reshape([1])).max()})}bernoulliMask(e,t,n){return r.tidy(()=>{const[i,o,s,a]=e,c=r.tile(r.randomUniform([i,o,1,a],0,1,"float32"),[1,1,s,1]).less(t);return r.cast(c,"float32").mul(n)})}samplePredictions(e,t){return r.tidy(()=>{e=r.pow(e,r.scalar(1/t,"float32"));const n=r.cumsum(e,2,!1,!1),i=n.slice([0,0,n.shape[2]-1,0],[n.shape[0],n.shape[1],1,n.shape[3]]),o=r.randomUniform(i.shape,0,1,"float32").mul(i).less(n).argMax(2);return r.oneHot(o.flatten(),e.shape[2],1,0).reshape([e.shape[0],e.shape[1],e.shape[3],e.shape[2]]).transpose([0,1,3,2])})}}n.d(t,"Coconet",(function(){return d}))},function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(5);class o extends r.layers.Layer{constructor(){super({})}computeOutputShape(e){return e[0]}call(e){return r.tidy(()=>{const[t,n]=e;return r.add(r.mul(r.randomNormal(n.shape),n),t)})}getClassName(){return"SamplingLayer"}}class s{constructor(e={}){this.trained=!1,this.initialized=!1,this.config={encoder_layers:e.encoder_layers||[1024,256,64],decoder_layers:e.decoder_layers||[64,256,1024],input_size:e.input_size||256,latent_size:e.latent_size||4,beta:e.beta||1,epochs:e.epochs||10}}dispose(){this.initialized&&(this.encoder.dispose(),this.decoder.dispose(),this.vae.dispose(),this.initialized=!1)}initialize(){this.dispose();const e=performance.now(),t=r.input({shape:[this.config.input_size]});this.encoder=this.getEncoder(t);const[n,,]=this.encoder.apply(t);this.decoder=this.getDecoder(n.shape.slice(1));const o=this.decoder.apply(n);this.vae=r.model({inputs:t,outputs:o,name:"vae"}),this.initialized=!0,i.logWithDuration("Initialized model",e,"MidiMe")}async train(e,t){const n=performance.now();this.trained=!1;let o=.001;!1===r.ENV.get("WEBGL_RENDER_FLOAT32_ENABLED")&&!1===r.ENV.get("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&1===r.ENV.get("WEBGL_VERSION")&&(o=5e-5);const s=r.train.adam(o);for(let n=0;n<this.config.epochs;n++)await r.nextFrame(),await s.minimize(()=>r.tidy(()=>{const[,r,i]=this.encoder.predict(e),o=this.vae.predict(e),s=this.loss(r,i,o,e);return t&&t(n,{y:o,total:s.totalLoss.arraySync(),losses:[s.reconLoss.arraySync(),s.latentLoss.arraySync()]}),s.totalLoss})),await r.nextFrame();i.logWithDuration("Training finished",n,"MidiMe"),this.trained=!0,s.dispose()}async sample(e=1){return this.initialized||await this.initialize(),r.tidy(()=>{const t=r.randomNormal([e,this.config.latent_size]);return this.decoder.predict(t)})}async decode(e){return this.initialized||await this.initialize(),this.decoder.predict(e)}async encode(e){this.initialized||await this.initialize();const[t,,]=this.encoder.predict(e);return t}predict(e){return this.vae.predict(e)}getEncoder(e){let t=e;for(let e=0;e<this.config.encoder_layers.length;e++)t=r.layers.dense({units:this.config.encoder_layers[e],activation:"relu"}).apply(t);const n=this.getAffineLayers(t,this.config.latent_size,e,!1),i=this.getAffineLayers(t,this.config.latent_size,e,!0),s=(new o).apply([n,i]);return r.model({inputs:e,outputs:[s,n,i],name:"encoder"})}getDecoder(e){const t=r.input({shape:e});let n=t;for(let e=0;e<this.config.decoder_layers.length;e++)n=r.layers.dense({units:this.config.decoder_layers[e],activation:"relu"}).apply(n);const i=this.getAffineLayers(n,this.config.input_size,t,!1);return r.model({inputs:t,outputs:i,name:"decoder"})}loss(e,t,n,i){return r.tidy(()=>{const o=this.klLoss(e,t),s=this.reconstructionLoss(i,n);return{latentLoss:o,reconLoss:s,totalLoss:r.add(s,r.mul(o,this.config.beta))}})}reconstructionLoss(e,t){return r.tidy(()=>{const n=r.pow(r.sub(e,t),2),i=r.div(n,r.mul(2,r.pow(r.ones([1]),2)));return r.mean(r.sum(i,-1))})}klLoss(e,t){return r.tidy(()=>{const n=r.pow(e,2),i=r.pow(t,2),o=r.add(1,r.log(i)),s=r.add(n,i),a=r.sub(o,s),c=r.div(r.mean(r.sum(a,-1)),2);return r.mul(-1,c)})}getAffineLayers(e,t,n,i){const o=r.layers.dense({units:t}).apply(e);return i?r.layers.activation({activation:"softplus"}).apply(o):o}}var a=n(12),c=n(1),u=n(9);class l{constructor(e,t){if(void 0===e)throw Error("`kernel` is undefined.");if(void 0===t)throw Error("`bias` is undefined.");this.kernel=e,this.bias=t}}function p(e,t){return t.matMul(e.kernel).add(e.bias)}class h{}class d extends h{constructor(e,t,n){super(),this.lstmFwVars=e,this.lstmBwVars=t,this.muVars=n,this.zDims=n?this.muVars.bias.shape[0]:null}encode(e,t){if(t)throw new Error("Variable-length segments not supported in flat encoder");return r.tidy(()=>{const t=this.singleDirection(e,!0),n=this.singleDirection(e,!1),i=r.concat([t[1],n[1]],1);return this.muVars?p(this.muVars,i):i})}singleDirection(e,t){const n=e.shape[0],i=e.shape[1],o=t?this.lstmFwVars:this.lstmBwVars;let s=[r.zeros([n,o.bias.shape[0]/4]),r.zeros([n,o.bias.shape[0]/4])];const a=r.scalar(1),c=(e,t)=>r.basicLSTMCell(a,o.kernel,o.bias,e,t[0],t[1]),u=r.split(e.toFloat(),i,1);for(const e of t?u:u.reverse())s=c(e.squeeze([1]),s);return s}}class m extends h{constructor(e,t,n){super(),this.baseEncoders=e,this.numSteps=t,this.muVars=n,this.zDims=this.muVars.bias.shape[0]}encode(e,t){if(t){if(1!==e.shape[0])throw new Error("When using variable-length segments, batch size must be 1.");if(t.length!==this.numSteps[0])throw new Error("Must provide length for all variable-length segments.")}return r.tidy(()=>{let n=e;for(let e=0;e<this.baseEncoders.length;++e){const i=this.numSteps[e],o=r.split(n,i,1),s=[];for(let n=0;n<i;++n)s.push(this.baseEncoders[e].encode(0===e&&t?r.slice3d(o[n],[0,0,0],[1,t[n],-1]):o[n]));n=r.stack(s,1)}return p(this.muVars,n.squeeze([1]))})}}function f(e,t,n){const i=[],o=[],s=[],a=r.split(p(n,e).tanh(),2*t.length,1);for(let e=0;e<t.length;++e){const n=t[e],c=r.scalar(1);i.push((e,t,i)=>r.basicLSTMCell(c,n.kernel,n.bias,e,t,i)),o.push(a[2*e]),s.push(a[2*e+1])}return{cell:i,c:o,h:s}}class g{}class S extends g{constructor(e,t,n,r){super(),this.lstmCellVars=e,this.zToInitStateVars=t,this.outputProjectVars=n,this.zDims=this.zToInitStateVars.kernel.shape[0],this.outputDims=r||n.bias.shape[0]}decode(e,t,n,i,o){const s=e.shape[0];return r.tidy(()=>{const a=f(e,this.lstmCellVars,this.zToInitStateVars),c=[];let u=n||r.zeros([s,this.outputDims]);const l=o?r.split(r.tile(o,[s,1]),o.shape[0]):void 0;for(let n=0;n<t;++n){const t=l?[u,e,l[n]]:[u,e];[a.c,a.h]=r.multiRNNCell(a.cell,r.concat(t,1),a.c,a.h);const o=p(this.outputProjectVars,a.h[a.h.length-1]);u=this.sample(o,i),c.push(u)}return r.stack(c,1)})}}class y extends S{sample(e,t){const n=e,i=t?r.multinomial(n.div(r.scalar(t)),1).as1D():n.argMax(1).as1D();return r.oneHot(i,this.outputDims).toFloat()}}class w extends S{constructor(e,t,n,r){super(e,t,n,r.numDims),this.nade=r}sample(e,t){const[n,i]=r.split(e,[this.nade.numHidden,this.nade.numDims],1);return this.nade.sample(n,i)}}class b extends S{sample(e,t){let[n,i,o]=r.split(e,3,1);if(i=r.sigmoid(i),o=r.tanh(o),t){n=r.sigmoid(n.div(r.scalar(t)));const e=r.randomUniform(n.shape,0,1);n=r.greater(n,e).toFloat()}else n=r.greater(r.sigmoid(n),.5).toFloat();return r.concat([n,i,o],1)}}class v extends g{constructor(e,t,n,r){super(),this.coreDecoders=e,this.lstmCellVars=t,this.zToInitStateVars=n,this.numSteps=r,this.zDims=this.zToInitStateVars.kernel.shape[0],this.outputDims=this.coreDecoders.reduce((e,t)=>e+t.outputDims,0)}decode(e,t,n,i,o){const s=e.shape[0];return r.tidy(()=>{const n=f(e,this.lstmCellVars,this.zToInitStateVars),a=[];let c=this.coreDecoders.map(e=>void 0);const u=r.zeros([s,1]),l=o?r.split(o,this.numSteps):void 0;for(let e=0;e<this.numSteps;++e){[n.c,n.h]=r.multiRNNCell(n.cell,u,n.c,n.h);const o=[];for(let r=0;r<this.coreDecoders.length;++r)o.push(this.coreDecoders[r].decode(n.h[n.h.length-1],t/this.numSteps,c[r],i,l?l[e]:void 0));a.push(r.concat(o,-1)),c=o.map(e=>e.slice([0,e.shape[1]-1,0],[s,1,e.shape[e.rank-1]]).squeeze([1]).toFloat())}return r.concat(a,1)})}}class N{constructor(e,t){this.numDims=e.shape[0],this.numHidden=e.shape[2],this.encWeights=e.as2D(this.numDims,this.numHidden),this.decWeightsT=t.as2D(this.numDims,this.numHidden)}sample(e,t){const n=e.shape[0];return r.tidy(()=>{const i=[];let o=e.clone();for(let e=0;e<this.numDims;e++){const s=r.sigmoid(o),a=this.encWeights.slice([e,0],[1,this.numHidden]).as1D(),c=this.decWeightsT.slice([e,0],[1,this.numHidden]),u=t.slice([0,e],[n,1]).add(r.matMul(s,c,!1,!0)).sigmoid().greaterEqual(r.scalar(.5)).toFloat().as1D();e<this.numDims-1&&(o=o.add(r.outerProduct(u.toFloat(),a))),i.push(u)}return r.stack(i,1)})}}class T{constructor(e,t){this.initialized=!1,this.checkpointURL=e,this.spec=t}instantiateFromSpec(){this.dataConverter=u.converterFromSpec(this.spec.dataConverter),this.chordEncoder=this.spec.chordEncoder?a.chordEncoderFromType(this.spec.chordEncoder):void 0}dispose(){void 0!==this.rawVars&&Object.keys(this.rawVars).forEach(e=>this.rawVars[e].dispose()),this.encoder=void 0,this.decoder=void 0,this.initialized=!1}getLstmLayers(e,t){const n=[];let r=0;for(;;){const i=e.replace("%d",r.toString());if(!(i+"kernel"in t))break;n.push(new l(t[i+"kernel"],t[i+"bias"])),++r}return n}async initialize(){this.dispose();const e=performance.now();this.spec||await fetch(`${this.checkpointURL}/config.json`).then(e=>e.json()).then(e=>{if("MusicVAE"!==e.type)throw new Error(`Attempted to instantiate MusicVAE model with incorrect type:\n                  ${e.type}`);this.spec=e}),this.instantiateFromSpec();const t="cell_%d/bidirectional_rnn/%s/multi_rnn_cell/cell_0/lstm_cell/",n=`encoder/${t}`,o=`encoder/hierarchical_level_%d/${t.replace("%d","0")}`,s=await fetch(`${this.checkpointURL}/weights_manifest.json`).then(e=>e.json()).then(e=>r.io.loadWeights(e,this.checkpointURL));this.rawVars=s;const a=new l(s["encoder/mu/kernel"],s["encoder/mu/bias"]);if(this.dataConverter.numSegments){const e=this.getLstmLayers(o.replace("%s","fw"),s),t=this.getLstmLayers(o.replace("%s","bw"),s);if(e.length!==t.length||2!==e.length)throw Error("Only 2 hierarchical encoder levels are supported. "+`Got ${e.length} forward and ${t.length} `+"backward.");const n=[0,1].map(n=>new d(e[n],t[n]));this.encoder=new m(n,[this.dataConverter.numSegments,1],a)}else{const e=this.getLstmLayers(n.replace("%s","fw"),s),t=this.getLstmLayers(n.replace("%s","bw"),s);if(e.length!==t.length||1!==e.length)throw Error("Only single-layer bidirectional encoders are supported. "+`Got ${e.length} forward and ${t.length} `+"backward.");this.encoder=new d(e[0],t[0],a)}const c=this.dataConverter.numSegments?"core_decoder/":"",u=[];if(this.dataConverter.NUM_SPLITS)for(let e=0;e<this.dataConverter.NUM_SPLITS;++e)u.push(`${c}core_decoder_${e}/decoder/`);else u.push(`${c}decoder/`);const p=u.map(e=>{const t=this.getLstmLayers(e+"multi_rnn_cell/cell_%d/lstm_cell/",s),n=new l(s[`${e}z_to_initial_state/kernel`],s[`${e}z_to_initial_state/bias`]),r=new l(s[`${e}output_projection/kernel`],s[`${e}output_projection/bias`]);return`${e}nade/w_enc`in s?new w(t,n,r,new N(s[`${e}nade/w_enc`],s[`${e}nade/w_dec_t`])):"GrooveConverter"===this.spec.dataConverter.type?new b(t,n,r):new y(t,n,r)});if(this.dataConverter.numSegments){const e=this.getLstmLayers("decoder/hierarchical_level_0/cell_%d/lstm_cell/",s),t=new l(s["decoder/hierarchical_level_0/initial_state/kernel"],s["decoder/hierarchical_level_0/initial_state/bias"]);this.decoder=new v(p,e,t,this.dataConverter.numSegments)}else{if(1!==p.length)throw Error("Unexpected number of base decoders without conductor: "+`${p.length}`);this.decoder=p[0]}this.initialized=!0,i.logWithDuration("Initialized model",e,"MusicVAE")}isInitialized(){return this.initialized}async interpolate(e,t,n,o){if(this.chordEncoder&&!o)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&o)throw new Error("Unexpected chord progression provided.");this.initialized||await this.initialize();const s=await this.encode(e,o),a=r.tidy(()=>this.getInterpolatedZs(s,t));s.dispose();const c=this.decode(a,n,o);return a.dispose(),c.then(()=>i.logWithDuration("Interpolation completed",0,"MusicVAE",20)),c}async getSegmentLengths(e){if(e.shape[0]>1)throw new Error("Variable-length segments not supported for batch size > 1.");const t=this.dataConverter.numSteps,n=this.dataConverter.numSegments,i=r.tidy(()=>r.min(r.equal(e.squeeze([0]),this.dataConverter.endTensor.expandDims(0)),1)),o=await i.data();i.dispose();const s=t/n,a=[];let c=0,u=o.indexOf(1);for(;-1!==u;)a.push(u-c+1),c+=s,u=o.indexOf(1,c);if(a.length!==n)throw new Error(`Incorrect number of segments: ${a.length} != ${n}`);return a}encodeChordProgression(e){const t=this.dataConverter.numSteps,n=this.dataConverter.numSegments,i=this.dataConverter.SEGMENTED_BY_TRACK?t/n:t,o=this.dataConverter.SEGMENTED_BY_TRACK?r.concat2d([this.chordEncoder.encode(c.NO_CHORD).expandDims(0),this.chordEncoder.encodeProgression(e,i-1)],0):this.chordEncoder.encodeProgression(e,i);return this.dataConverter.SEGMENTED_BY_TRACK?r.tile(o,[n,1]):o}async encode(e,t){if(this.chordEncoder&&!t)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&t)throw new Error("Unexpected chord progression provided.");if(this.chordEncoder&&this.dataConverter.endTensor&&t.length>1)throw new Error("Multiple chords not supported when using variable-length segments.");this.initialized||await this.initialize();const n=performance.now();let o=r.tidy(()=>r.stack(e.map(e=>this.dataConverter.toTensor(e))));const s=this.dataConverter.endTensor?await this.getSegmentLengths(o):void 0;if(this.chordEncoder){const n=r.tidy(()=>{const n=this.encodeChordProgression(t),i=r.tile(r.expandDims(n,0),[e.length,1,1]);return o.concat(i,2)});o.dispose(),o=n}const a=this.encoder.encode(o,s);return o.dispose(),i.logWithDuration("Encoding completed",n,"MusicVAE",20),a}async decode(e,t,n,o=c.DEFAULT_STEPS_PER_QUARTER,s=c.DEFAULT_QUARTERS_PER_MINUTE){if(this.chordEncoder&&!n)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&n)throw new Error("Unexpected chord progression provided.");if(this.chordEncoder&&this.dataConverter.endTensor&&n.length>1)throw new Error("Multiple chords not supported when using variable-length segments.");this.initialized||await this.initialize();const a=performance.now(),u=this.dataConverter.numSteps,l=r.tidy(()=>{const i=this.chordEncoder?this.encodeChordProgression(n):void 0,o=this.decoder.decode(e,u,void 0,t,i);return r.split(o,o.shape[0]).map(e=>e.squeeze([0]))}),p=[];for(const e of l)p.push(await this.dataConverter.toNoteSequence(e,o,s)),e.dispose();return i.logWithDuration("Decoding completed",a,"MusicVAE",20),p}getInterpolatedZs(e,t){if("number"==typeof t&&(t=[t]),2!==e.shape[0]&&4!==e.shape[0])throw new Error("Invalid number of input sequences. Requires length 2, or 4");if(1!==t.length&&2!==t.length)throw new Error("Invalid number of dimensions. Requires length 1, or 2.");const n=t[0],i=2===t.length?t[1]:n;return r.tidy(()=>{const t=r.linspace(0,1,n),o=e.slice([0,0],[1,e.shape[1]]).as1D(),s=e.slice([1,0],[1,e.shape[1]]).as1D();if(2===e.shape[0]){const e=s.sub(o);return r.outerProduct(t,e).add(o)}if(4===e.shape[0]){const a=r.linspace(0,1,i),c=e.slice([2,0],[1,e.shape[1]]).as1D(),u=e.slice([3,0],[1,e.shape[1]]).as1D(),l=r.scalar(1).sub(t),p=r.scalar(1).sub(a);let h=o.mul(r.outerProduct(p,l).as3D(i,n,1));return h=r.addStrict(h,s.mul(r.outerProduct(a,l).as3D(i,n,1))),h=r.addStrict(h,c.mul(r.outerProduct(p,t).as3D(i,n,1))),(h=r.addStrict(h,u.mul(r.outerProduct(a,t).as3D(i,n,1)))).as2D(n*i,e.shape[1])}throw new Error("Invalid number of note sequences. Requires length 2, or 4")})}async sample(e,t=.5,n,o=c.DEFAULT_STEPS_PER_QUARTER,s=c.DEFAULT_QUARTERS_PER_MINUTE){if(this.chordEncoder&&!n)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&n)throw new Error("Unexpected chord progression provided.");this.initialized||await this.initialize();const a=performance.now(),u=r.tidy(()=>r.randomNormal([e,this.decoder.zDims])),l=this.decode(u,t,n,o);return u.dispose(),l.then(()=>i.logWithDuration("Sampling completed",a,"MusicVAE",20)),l}}n.d(t,"MidiMe",(function(){return s})),n.d(t,"Decoder",(function(){return g})),n.d(t,"Encoder",(function(){return h})),n.d(t,"MusicVAE",(function(){return T}))},function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(15),o=n(12),s=n(9),a=n(5),c=n(6);const u="attention_cell_wrapper/";class l{constructor(e,t,n){this.cells=e,this.attnLength=t,this.attnSize=n}static isWrapped(e){return`rnn/${u}kernel`in e}initialize(e){const t=`rnn/${u}`;this.attnInputMatrix=e[`${t}kernel`],this.attnInputBias=e[`${t}bias`],this.attnW=e[`${t}attention/attn_w`],this.attnV=e[`${t}attention/attn_v`],this.attnMatrix=e[`${t}attention/kernel`],this.attnBias=e[`${t}attention/bias`],this.attnOutputMatrix=e[`${t}attention_output_projection/kernel`],this.attnOutputBias=e[`${t}attention_output_projection/bias`]}initState(){return{attention:r.zeros([this.attnSize]),attentionState:r.zeros([1,this.attnSize*this.attnLength])}}call(e,t,n,i){const o=r.concat([e,i.attention.as2D(1,-1)],1),s=r.add(r.matMul(o,this.attnInputMatrix),this.attnInputBias.as2D(1,-1));[t,n]=r.multiRNNCell(this.cells,s,t,n);const a=r.reshape(i.attentionState,[-1,this.attnLength,1,this.attnSize]),c=r.conv2d(a,this.attnW,[1,1],"same"),u=[];for(let e=0;e<t.length;e++)u.push(t[e]),u.push(n[e]);const l=r.concat(u,1),p=r.matMul(l,this.attnMatrix).reshape([-1,1,1,this.attnSize]),h=r.sum(r.mul(this.attnV,r.tanh(r.add(c,p))),[2,3]),d=r.softmax(h),m=r.sum(r.mul(r.reshape(d,[-1,this.attnLength,1,1]),a),[1,2]).reshape([-1,this.attnSize]),f=i.attentionState.reshape([-1,this.attnLength,this.attnSize]),g=r.slice(f,[0,1,0],[f.shape[0],f.shape[1]-1,f.shape[2]]),S=r.add(r.matMul(r.concat([n[2],m],1),this.attnOutputMatrix),this.attnOutputBias),y=m.flatten(),w=r.concat([g,S.as3D(S.shape[0],1,S.shape[1])],1).reshape([-1,this.attnLength*this.attnSize]);return{output:S,c:t,h:n,attentionState:{attention:y,attentionState:w}}}}const p="multi_rnn_cell/cell_%d/basic_lstm_cell/";class h{constructor(e,t){this.checkpointURL=e,this.spec=t,this.initialized=!1,this.rawVars={},this.biasShapes=[],this.lstmCells=[]}isInitialized(){return this.initialized}instantiateFromSpec(){this.dataConverter=s.converterFromSpec(this.spec.dataConverter),this.attentionLength=this.spec.attentionLength,this.chordEncoder=this.spec.chordEncoder?o.chordEncoderFromType(this.spec.chordEncoder):void 0,this.auxInputs=this.spec.auxInputs?this.spec.auxInputs.map(e=>i.auxiliaryInputFromSpec(e)):void 0}async initialize(){this.dispose();const e=performance.now();this.spec||await fetch(`${this.checkpointURL}/config.json`).then(e=>e.json()).then(e=>{if("MusicRNN"!==e.type)throw new Error(`Attempted to instantiate MusicRNN model with incorrect type:\n                  ${e.type}`);this.spec=e}),this.instantiateFromSpec();const t=await fetch(`${this.checkpointURL}/weights_manifest.json`).then(e=>e.json()).then(e=>r.io.loadWeights(e,this.checkpointURL)),n=l.isWrapped(t),i=n?`rnn/${u}`:"rnn/";this.forgetBias=r.scalar(1),this.lstmCells.length=0,this.biasShapes.length=0;let o=0;for(;;){const e=i+p.replace("%d",o.toString());if(!(`${e}kernel`in t))break;this.lstmCells.push((n,i,o)=>r.basicLSTMCell(this.forgetBias,t[`${e}kernel`],t[`${e}bias`],n,i,o)),this.biasShapes.push(t[`${e}bias`].shape[0]),++o}this.lstmFcW=t["fully_connected/weights"],this.lstmFcB=t["fully_connected/biases"],n&&(this.attentionWrapper=new l(this.lstmCells,this.attentionLength,this.biasShapes[0]/4),this.attentionWrapper.initialize(t)),this.rawVars=t,this.initialized=!0,a.logWithDuration("Initialized model",e,"MusicRNN")}dispose(){Object.keys(this.rawVars).forEach(e=>this.rawVars[e].dispose()),this.rawVars={},this.forgetBias&&(this.forgetBias.dispose(),this.forgetBias=void 0),this.initialized=!1}async continueSequence(e,t,n,r){return(await this.continueSequenceImpl(e,t,n,r,!1)).sequence}async continueSequenceAndReturnProbabilities(e,t,n,r){return this.continueSequenceImpl(e,t,n,r,!0)}async continueSequenceImpl(e,t,n,i,o){if(c.assertIsRelativeQuantizedSequence(e),this.chordEncoder&&!i)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&i)throw new Error("Unexpected chord progression provided.");this.initialized||await this.initialize();const s=performance.now(),u=r.tidy(()=>{const s=this.dataConverter.toTensor(e),a=s.shape[0],c=s.shape[1],u=this.chordEncoder?this.chordEncoder.encodeProgression(i,a+t):void 0,l=this.auxInputs?r.concat(this.auxInputs.map(e=>e.getTensors(a+t)),1):void 0,p=this.sampleRnn(s,t,n,u,l,o),h=p.samples;return{samples:r.stack(h).as2D(h.length,c),probs:p.probs}}),l=await u,p=this.dataConverter.toNoteSequence(l.samples,e.quantizationInfo.stepsPerQuarter),h=[];if(o)for(let e=0;e<l.probs.length;e++)h.push(await l.probs[e].data()),l.probs[e].dispose();return u.samples.dispose(),p.then(()=>a.logWithDuration("Continuation completed",s,"MusicRNN",20)),{sequence:p,probs:h}}sampleRnn(e,t,n,i,o,s){const a=e.shape[0],c=e.shape[1];let u=[],l=[];for(let e=0;e<this.biasShapes.length;e++)u.push(r.zeros([1,this.biasShapes[e]/4])),l.push(r.zeros([1,this.biasShapes[e]/4]));let p,h=this.attentionWrapper?this.attentionWrapper.initState():null;e=e.toFloat();const d=[],m=[],f=r.split(e.toFloat(),a),g=i?r.split(i,i.shape[0]):void 0,S=o?r.split(o,o.shape[0]):void 0;for(let e=0;e<a+t;e++){let i;if(e<a)i=f[e];else{let e,t=p.matMul(this.lstmFcW).add(this.lstmFcB).as1D();n?(t=t.div(r.scalar(n)),e=r.multinomial(t,1).as1D()):e=t.argMax().as1D(),s&&m.push(r.softmax(t)),i=r.oneHot(e,c).toFloat(),d.push(i.as1D())}if(e===a+t-1)break;const o=[];if(g&&o.push(g[e+1]),o.push(i),S&&o.push(S[e]),i=r.concat(o,1),this.attentionWrapper){const e=this.attentionWrapper.call(i,u,l,h);u=e.c,l=e.h,h=e.attentionState,p=e.output}else[u,l]=r.multiRNNCell(this.lstmCells,i,u,l),p=l[l.length-1]}return{samples:d,probs:m}}}n.d(t,"MusicRNN",(function(){return h}))},function(e,t,n){"use strict";n.r(t);var r=n(0);const i=31.25,o=32,s=2,a=128,c=8,u=88;function l(e){for(let t=0;t<s;++t)e.c[t].dispose(),e.h[t].dispose()}function p(e,t,n){if((t=void 0!==t?t:1)<0||t>1)throw new Error("Invalid temperature specified");let i;if(0===t)i=r.argMax(e,0);else{t<1&&(e=r.div(e,r.scalar(t,"float32")));const o=r.reshape(r.softmax(e,0),[1,-1]),s=r.multinomial(o,1,n,!0);i=r.reshape(s,[])}return i}class h{constructor(e){this.checkpointURL=e,this.initialized=!1}isInitialized(){return this.initialized}async initialize(e){if(this.initialized&&this.dispose(),void 0===this.checkpointURL&&void 0===e)throw new Error("Need to specify either URI or static variables");if(void 0===e){const e=await fetch(`${this.checkpointURL}/weights_manifest.json`).then(e=>e.json()).then(e=>r.io.loadWeights(e,this.checkpointURL));this.modelVars=e}else this.modelVars=e;this.decLSTMCells=[],this.decForgetBias=r.scalar(1,"float32");for(let e=0;e<s;++e){const t=`phero_model/decoder/rnn/rnn/multi_rnn_cell/cell_${e}/lstm_cell/`;this.decLSTMCells.push((e,n,i)=>r.basicLSTMCell(this.decForgetBias,this.modelVars[t+"kernel"],this.modelVars[t+"bias"],e,n,i))}this.resetState(),this.initialized=!0,this.next(0),this.resetState()}getRnnInputFeats(){return r.tidy(()=>{const e=r.tensor1d([this.button],"float32");return r.sub(r.mul(2,r.div(e,c-1)),1).as1D()})}next(e,t,n){return this.nextWithCustomSamplingFunction(e,e=>p(e,t,n))}nextFromKeyWhitelist(e,t,n,i){return this.nextWithCustomSamplingFunction(e,e=>{const o=r.tensor1d(t,"int32");let s=p(e=r.gather(e,o),n,i);const a=r.gather(o,r.reshape(s,[1]));return s=r.reshape(a,[])})}nextWithCustomSamplingFunction(e,t){const n=this.lastState;this.button=e;const r=this.getRnnInputFeats(),[i,o]=this.evaluateModelAndSample(r,n,t);return r.dispose(),l(this.lastState),this.lastState=i,o}evaluateModelAndSample(e,t,n){if(!this.initialized)throw new Error("Model is not initialized.");const[i,o]=r.tidy(()=>{let i=r.matMul(r.expandDims(e,0),this.modelVars["phero_model/decoder/rnn_input/dense/kernel"]);i=r.add(i,this.modelVars["phero_model/decoder/rnn_input/dense/bias"]);const[o,a]=r.multiRNNCell(this.decLSTMCells,i,t.c,t.h),c={c:o,h:a};let l=r.matMul(a[s-1],this.modelVars["phero_model/decoder/pitches/dense/kernel"]);l=r.add(l,this.modelVars["phero_model/decoder/pitches/dense/bias"]);const p=r.reshape(l,[u]);return[c,n(p).dataSync()[0]]});return[i,o]}resetState(){void 0!==this.lastState&&l(this.lastState),this.lastState=function(){const e={c:[],h:[]};for(let t=0;t<s;++t)e.c.push(r.zeros([1,a],"float32")),e.h.push(r.zeros([1,a],"float32"));return e}()}dispose(){this.initialized&&(Object.keys(this.modelVars).forEach(e=>this.modelVars[e].dispose()),this.decForgetBias.dispose(),l(this.lastState),this.initialized=!1)}}class d extends h{getRnnInputFeats(){return r.tidy(()=>{const e=[super.getRnnInputFeats()],t=this.lastOutput,n=this.lastTime,s=this.time;let a;void 0===this.deltaTimeOverride?a=(s.getTime()-n.getTime())/1e3:(a=this.deltaTimeOverride,this.deltaTimeOverride=void 0);const c=r.scalar(t,"int32"),l=r.addStrict(c,r.scalar(1,"int32")),p=r.cast(r.oneHot(l,u+1),"float32");e.push(p);const h=r.scalar(a,"float32"),d=r.round(r.mul(h,i)),m=r.minimum(d,o),f=r.cast(r.add(m,1e-4),"int32"),g=r.oneHot(f,o+1),S=r.cast(g,"float32");return e.push(S),this.lastTime=s,r.concat1d(e)})}nextWithCustomSamplingFunction(e,t){this.time=new Date;const n=super.nextWithCustomSamplingFunction(e,t);return this.lastOutput=n,this.lastTime=this.time,n}overrideLastOutput(e){this.lastOutput=e}overrideDeltaTime(e){this.deltaTimeOverride=e}resetState(){super.resetState(),this.lastOutput=-1,this.lastTime=new Date,this.lastTime.setSeconds(this.lastTime.getSeconds()-1e5),this.time=new Date}}var m,f;!function(e){e[e.None=0]="None",e[e.C=1]="C",e[e.Cs=2]="Cs",e[e.D=3]="D",e[e.Eb=4]="Eb",e[e.E=5]="E",e[e.F=6]="F",e[e.Fs=7]="Fs",e[e.G=8]="G",e[e.Ab=9]="Ab",e[e.A=10]="A",e[e.Bb=11]="Bb",e[e.B=12]="B"}(m||(m={})),function(e){e[e.None=0]="None",e[e.Maj=1]="Maj",e[e.Min=2]="Min",e[e.Aug=3]="Aug",e[e.Dim=4]="Dim",e[e.Seven=5]="Seven",e[e.Maj7=6]="Maj7",e[e.Min7=7]="Min7",e[e.Min7b5=8]="Min7b5"}(f||(f={}));class g extends d{getRnnInputFeats(){return r.tidy(()=>{const e=[super.getRnnInputFeats()],t=r.scalar(this.chordRoot,"int32"),n=r.subStrict(t,r.scalar(1,"int32")),i=r.cast(r.oneHot(n,12),"float32");e.push(i);const o=r.scalar(this.chordFamily,"int32"),s=r.subStrict(o,r.scalar(1,"int32")),a=r.cast(r.oneHot(s,8),"float32");return e.push(a),r.concat1d(e)})}setChordRoot(e){this.chordRoot=e}setChordFamily(e){this.chordFamily=e}resetState(){super.resetState(),this.chordRoot=m.None,this.chordFamily=f.None}}class S extends d{getRnnInputFeats(){return r.tidy(()=>{const e=[super.getRnnInputFeats()],t=r.scalar(this.keySignature,"int32"),n=r.subStrict(t,r.scalar(1,"int32")),i=r.cast(r.oneHot(n,12),"float32");return e.push(i),r.concat1d(e)})}setKeySignature(e){this.keySignature=e}resetState(){super.resetState(),this.keySignature=m.None}}class y extends S{getRnnInputFeats(){return r.tidy(()=>{const e=[super.getRnnInputFeats()],t=r.scalar(this.chordRoot,"int32"),n=r.subStrict(t,r.scalar(1,"int32")),i=r.cast(r.oneHot(n,12),"float32");e.push(i);const o=r.scalar(this.chordFamily,"int32"),s=r.subStrict(o,r.scalar(1,"int32")),a=r.cast(r.oneHot(s,8),"float32");return e.push(a),r.concat1d(e)})}setChordRoot(e){this.chordRoot=e}setChordFamily(e){this.chordFamily=e}resetState(){super.resetState(),this.chordRoot=m.None,this.chordFamily=f.None}}class w extends S{getRnnInputFeats(){return r.tidy(()=>{const e=[super.getRnnInputFeats()],t=r.scalar(this.chordFamily,"int32"),n=r.subStrict(t,r.scalar(1,"int32")),i=r.cast(r.oneHot(n,8),"float32");return e.push(i),r.concat1d(e)})}setChordFamily(e){this.chordFamily=e}resetState(){super.resetState(),this.chordFamily=f.None}}class b extends d{}class v extends g{}class N extends S{}class T extends y{}class P extends w{}n.d(t,"PianoGenie",(function(){return b})),n.d(t,"PianoGenieKeysig",(function(){return N})),n.d(t,"PianoGenieChord",(function(){return v})),n.d(t,"PianoGenieKeysigChordFamily",(function(){return P})),n.d(t,"PianoGenieKeysigChord",(function(){return T}))},function(e,t,n){"use strict";n.r(t);var r=n(0);n.d(t,"tf",(function(){return r}));var i=n(21);n.d(t,"aux_inputs",(function(){return i.aux_inputs})),n.d(t,"chords",(function(){return i.chords})),n.d(t,"constants",(function(){return i.constants})),n.d(t,"data",(function(){return i.data})),n.d(t,"logging",(function(){return i.logging})),n.d(t,"performance",(function(){return i.performance})),n.d(t,"sequences",(function(){return i.sequences})),n.d(t,"MetronomeCallbackObject",(function(){return i.MetronomeCallbackObject})),n.d(t,"Metronome",(function(){return i.Metronome})),n.d(t,"MidiConversionError",(function(){return i.MidiConversionError})),n.d(t,"midiToSequenceProto",(function(){return i.midiToSequenceProto})),n.d(t,"sequenceProtoToMidi",(function(){return i.sequenceProtoToMidi})),n.d(t,"urlToBlob",(function(){return i.urlToBlob})),n.d(t,"blobToNoteSequence",(function(){return i.blobToNoteSequence})),n.d(t,"urlToNoteSequence",(function(){return i.urlToNoteSequence})),n.d(t,"BasePlayerCallback",(function(){return i.BasePlayerCallback})),n.d(t,"BasePlayer",(function(){return i.BasePlayer})),n.d(t,"Player",(function(){return i.Player})),n.d(t,"SoundFontPlayer",(function(){return i.SoundFontPlayer})),n.d(t,"PlayerWithClick",(function(){return i.PlayerWithClick})),n.d(t,"MIDIPlayer",(function(){return i.MIDIPlayer})),n.d(t,"BaseRecorderCallback",(function(){return i.BaseRecorderCallback})),n.d(t,"Recorder",(function(){return i.Recorder})),n.d(t,"BaseVisualizer",(function(){return i.BaseVisualizer})),n.d(t,"PianoRollCanvasVisualizer",(function(){return i.PianoRollCanvasVisualizer})),n.d(t,"Visualizer",(function(){return i.Visualizer})),n.d(t,"PianoRollSVGVisualizer",(function(){return i.PianoRollSVGVisualizer})),n.d(t,"ScrollType",(function(){return i.ScrollType})),n.d(t,"StaffSVGVisualizer",(function(){return i.StaffSVGVisualizer}));var o=n(24);n.d(t,"Coconet",(function(){return o.Coconet}));var s=n(26);n.d(t,"MusicRNN",(function(){return s.MusicRNN}));var a=n(25);n.d(t,"MidiMe",(function(){return a.MidiMe})),n.d(t,"Decoder",(function(){return a.Decoder})),n.d(t,"Encoder",(function(){return a.Encoder})),n.d(t,"MusicVAE",(function(){return a.MusicVAE}));var c=n(27);n.d(t,"PianoGenie",(function(){return c.PianoGenie})),n.d(t,"PianoGenieKeysig",(function(){return c.PianoGenieKeysig})),n.d(t,"PianoGenieChord",(function(){return c.PianoGenieChord})),n.d(t,"PianoGenieKeysigChordFamily",(function(){return c.PianoGenieKeysigChordFamily})),n.d(t,"PianoGenieKeysigChord",(function(){return c.PianoGenieKeysigChord}));var u=n(20);n.d(t,"NoteSequence",(function(){return u.NoteSequence}));var l=n(23);n.d(t,"OnsetsAndFrames",(function(){return l.OnsetsAndFrames}));var p=n(22);n.d(t,"GANSynth",(function(){return p.GANSynth}))},function(e,t,n){"use strict";n.r(t);var r=n(28);window.mm=r}])}));