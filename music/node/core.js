!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.mm=t():e.mm=t()}(global,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=26)}([function(e,t){e.exports=require("@tensorflow/tfjs")},function(e,t,n){"use strict";n.r(t),n.d(t,"DEFAULT_QUARTERS_PER_MINUTE",(function(){return r})),n.d(t,"DEFAULT_STEPS_PER_BAR",(function(){return o})),n.d(t,"DEFAULT_STEPS_PER_QUARTER",(function(){return i})),n.d(t,"DEFAULT_STEPS_PER_SECOND",(function(){return s})),n.d(t,"DEFAULT_VELOCITY",(function(){return a})),n.d(t,"DEFAULT_PROGRAM",(function(){return c})),n.d(t,"DEFAULT_TICKS_PER_QUARTER",(function(){return u})),n.d(t,"DEFAULT_CHANNEL",(function(){return l})),n.d(t,"DRUM_CHANNEL",(function(){return p})),n.d(t,"NON_DRUM_CHANNELS",(function(){return h})),n.d(t,"DEFAULT_DRUM_PITCH_CLASSES",(function(){return m})),n.d(t,"MIN_MIDI_VELOCITY",(function(){return d})),n.d(t,"MAX_MIDI_VELOCITY",(function(){return f})),n.d(t,"MIDI_VELOCITIES",(function(){return g})),n.d(t,"NO_CHORD",(function(){return S})),n.d(t,"NUM_PITCH_CLASSES",(function(){return y})),n.d(t,"MIN_MIDI_PITCH",(function(){return w})),n.d(t,"MAX_MIDI_PITCH",(function(){return N})),n.d(t,"MIDI_PITCHES",(function(){return b})),n.d(t,"MIN_PIANO_PITCH",(function(){return T})),n.d(t,"MAX_PIANO_PITCH",(function(){return O})),n.d(t,"MIN_DRUM_PITCH",(function(){return P})),n.d(t,"MAX_DRUM_PITCH",(function(){return q})),n.d(t,"MIN_MIDI_PROGRAM",(function(){return I})),n.d(t,"MAX_MIDI_PROGRAM",(function(){return v})),n.d(t,"LO_CLICK_PITCH",(function(){return A})),n.d(t,"HI_CLICK_PITCH",(function(){return E})),n.d(t,"LO_CLICK_CLASS",(function(){return k})),n.d(t,"HI_CLICK_CLASS",(function(){return _}));const r=120,o=16,i=4,s=100,a=80,c=0,u=220,l=0,p=9,h=[0,1,2,3,4,5,6,7,8,10,11,12,13,14,15],m=[[36,35],[38,27,28,31,32,33,34,37,39,40,56,65,66,75,85],[42,44,54,68,69,70,71,73,78,80],[46,67,72,74,79,81],[45,29,41,61,64,84],[48,47,60,63,77,86,87],[50,30,43,62,76,83],[49,55,57,58],[51,52,53,59,82]],d=0,f=127,g=f-d+1,S="N.C.",y=12,w=0,N=127,b=N-w+1,T=21,O=108,P=35,q=81,I=0,v=127,A=89,E=90,k=9,_=10},function(e,t){e.exports=require("tone")},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(13),o=r.tensorflow.magenta.NoteSequence},function(e,t,n){"use strict";n.r(t),n.d(t,"Level",(function(){return r})),n.d(t,"verbosity",(function(){return i})),n.d(t,"setVerbosity",(function(){return s})),n.d(t,"log",(function(){return a})),n.d(t,"logWithDuration",(function(){return c}));var r,o=n(6);!function(e){e[e.NONE=0]="NONE",e[e.WARN=5]="WARN",e[e.INFO=10]="INFO",e[e.DEBUG=20]="DEBUG"}(r||(r={}));let i=10;function s(e){e=e}function a(e,t="Magenta.js",n=10){if(0===n)throw Error("Logging level cannot be NONE.");if(i>=n){(5===n?console.warn:console.log)(`%c ${t} `,"background:magenta; color:white",e)}}function c(e,t,n="Magenta.js",r=10){a(`${e} in ${((o.d.now()-t)/1e3).toPrecision(3)}s`,n,r)}},function(e,t,n){"use strict";n.r(t),n.d(t,"MultipleTimeSignatureException",(function(){return i})),n.d(t,"BadTimeSignatureException",(function(){return s})),n.d(t,"NegativeTimeException",(function(){return a})),n.d(t,"MultipleTempoException",(function(){return c})),n.d(t,"QuantizationStatusException",(function(){return u})),n.d(t,"clone",(function(){return l})),n.d(t,"stepsPerQuarterToStepsPerSecond",(function(){return p})),n.d(t,"quantizeToStep",(function(){return h})),n.d(t,"quantizeNoteSequence",(function(){return f})),n.d(t,"isQuantizedSequence",(function(){return g})),n.d(t,"assertIsQuantizedSequence",(function(){return S})),n.d(t,"isRelativeQuantizedSequence",(function(){return y})),n.d(t,"assertIsRelativeQuantizedSequence",(function(){return w})),n.d(t,"isAbsoluteQuantizedSequence",(function(){return N})),n.d(t,"assertIsAbsoluteQuantizedSequence",(function(){return b})),n.d(t,"unquantizeSequence",(function(){return T})),n.d(t,"createQuantizedNoteSequence",(function(){return O})),n.d(t,"mergeInstruments",(function(){return P})),n.d(t,"replaceInstruments",(function(){return q})),n.d(t,"mergeConsecutiveNotes",(function(){return I})),n.d(t,"applySustainControlChanges",(function(){return v})),n.d(t,"concatenate",(function(){return A})),n.d(t,"trim",(function(){return E})),n.d(t,"split",(function(){return z}));var r=n(3),o=n(1);class i extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class s extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class a extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class c extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class u extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}function l(e){return r.a.decode(r.a.encode(e).finish())}function p(e,t){return e*t/60}function h(e,t,n=.5){const r=e*t;return Math.floor(r+(1-n))}function m(e){return e.controlChanges.concat(e.textAnnotations)}function d(e){if(e.tempos&&0!==e.tempos.length){if(e.tempos.sort((e,t)=>e.time-t.time),0!==e.tempos[0].time&&e.tempos[0].qpm!==o.DEFAULT_QUARTERS_PER_MINUTE)throw new c("NoteSequence has an implicit tempo change from initial "+o.DEFAULT_QUARTERS_PER_MINUTE+" qpm to "+`${e.tempos[0].qpm} qpm at ${e.tempos[0].time} seconds.`);for(let t=1;t<e.tempos.length;t++)if(e.tempos[t].qpm!==e.tempos[0].qpm)throw new c(`NoteSequence has at least one tempo change from ${e.tempos[0].qpm} qpm to ${e.tempos[t].qpm}qpm at ${e.tempos[t].time} seconds.`)}}function f(e,t){const n=l(e);if(n.quantizationInfo=r.a.QuantizationInfo.create({stepsPerQuarter:t}),n.timeSignatures.length>0){if(n.timeSignatures.sort((e,t)=>e.time-t.time),0!==n.timeSignatures[0].time&&(4!==n.timeSignatures[0].numerator||4!==n.timeSignatures[0].denominator))throw new i(`NoteSequence has an implicit change from initial 4/4 time signature to ${n.timeSignatures[0].numerator}/`+n.timeSignatures[0].denominator+" at "+n.timeSignatures[0].time+" seconds.");for(let e=1;e<n.timeSignatures.length;e++){const t=n.timeSignatures[e];if(t.numerator!==n.timeSignatures[0].numerator||t.denominator!==n.timeSignatures[0].denominator)throw new i("NoteSequence has at least one time signature change from "+n.timeSignatures[0].numerator+"/"+n.timeSignatures[0].denominator+" to "+`${t.numerator}/${t.denominator} `+`at ${t.time} seconds`)}n.timeSignatures[0].time=0,n.timeSignatures=[n.timeSignatures[0]]}else{const e=r.a.TimeSignature.create({numerator:4,denominator:4,time:0});n.timeSignatures.push(e)}const c=n.timeSignatures[0];if(!(u=c.denominator)||0!=(u&u-1))throw new s(`Denominator is not a power of 2. Time signature: ${c.numerator}/${c.denominator}`);var u;if(0===c.numerator)throw new s(`Numerator is 0. Time signature: ${c.numerator}/${c.denominator}`);if(n.tempos.length>0)d(n),n.tempos[0].time=0,n.tempos=[n.tempos[0]];else{const e=r.a.Tempo.create({qpm:o.DEFAULT_QUARTERS_PER_MINUTE,time:0});n.tempos.push(e)}const f=p(t,n.tempos[0].qpm);return n.totalQuantizedSteps=h(e.totalTime,f),function(e,t){for(const n of e.notes){if(n.quantizedStartStep=h(n.startTime,t),n.quantizedEndStep=h(n.endTime,t),n.quantizedEndStep===n.quantizedStartStep&&(n.quantizedEndStep+=1),n.quantizedStartStep<0||n.quantizedEndStep<0)throw new a("Got negative note time: start_step = "+n.quantizedStartStep+", end_step = "+n.quantizedEndStep);n.quantizedEndStep>e.totalQuantizedSteps&&(e.totalQuantizedSteps=n.quantizedEndStep)}m(e).forEach(e=>{if(e.quantizedStep=h(e.time,t),e.quantizedStep<0)throw new a("Got negative event time: step = "+e.quantizedStep)})}(n,f),n}function g(e){return e.quantizationInfo&&(e.quantizationInfo.stepsPerQuarter>0||e.quantizationInfo.stepsPerSecond>0)}function S(e){if(!g(e))throw new u(`NoteSequence ${e.id} is not quantized (missing quantizationInfo)`)}function y(e){return e.quantizationInfo&&e.quantizationInfo.stepsPerQuarter>0}function w(e){if(!y(e))throw new u(`NoteSequence ${e.id} is not quantized or is quantized based on absolute timing`)}function N(e){return e.quantizationInfo&&e.quantizationInfo.stepsPerSecond>0}function b(e){if(!N(e))throw new u(`NoteSequence ${e.id} is not quantized or is quantized based on relative timing`)}function T(e,t){w(e),d(e);const n=l(e);t?n.tempos&&n.tempos.length>0?n.tempos[0].qpm=t:n.tempos.push(r.a.Tempo.create({time:0,qpm:t})):t=e.tempos&&e.tempos.length>0?n.tempos[0].qpm:o.DEFAULT_QUARTERS_PER_MINUTE;const i=e=>e/n.quantizationInfo.stepsPerQuarter*(60/t);return n.totalTime=i(n.totalQuantizedSteps),n.notes.forEach(e=>{e.startTime=i(e.quantizedStartStep),e.endTime=i(e.quantizedEndStep),n.totalTime=Math.max(n.totalTime,e.endTime),delete e.quantizedStartStep,delete e.quantizedEndStep}),m(n).forEach(e=>{e.time=i(e.time)}),delete n.totalQuantizedSteps,delete n.quantizationInfo,n}function O(e=o.DEFAULT_STEPS_PER_QUARTER,t=o.DEFAULT_QUARTERS_PER_MINUTE){return r.a.create({quantizationInfo:{stepsPerQuarter:e},tempos:[{qpm:t}]})}function P(e){const t=l(e),n=t.notes.concat(t.pitchBends).concat(t.controlChanges),r=Array.from(new Set(n.filter(e=>!e.isDrum).map(e=>e.program)));return n.forEach(e=>{e.isDrum?(e.program=0,e.instrument=r.length):e.instrument=r.indexOf(e.program)}),t}function q(e,t){const n=new Set(e.notes.map(e=>e.instrument)),o=new Set(t.notes.map(e=>e.instrument)),i=[];e.notes.forEach(e=>{o.has(e.instrument)||i.push(r.a.Note.create(e))}),t.notes.forEach(e=>{n.has(e.instrument)&&i.push(r.a.Note.create(e))});const s=l(e);return s.notes=i.sort((e,t)=>{const n=e.instrument-t.instrument;return n||e.quantizedStartStep-t.quantizedStartStep}),s}function I(e){S(e);const t=l(e);t.notes=[];const n=e.notes.sort((e,t)=>{const n=e.instrument-t.instrument;return n||e.quantizedStartStep-t.quantizedStartStep}),o=new r.a.Note;o.pitch=n[0].pitch,o.instrument=n[0].instrument,o.quantizedStartStep=n[0].quantizedStartStep,o.quantizedEndStep=n[0].quantizedEndStep,t.notes.push(o);let i=0;for(let e=1;e<n.length;e++){const o=n[e],s=t.notes[i];if(s.instrument===o.instrument&&s.pitch===o.pitch&&o.quantizedStartStep===s.quantizedEndStep&&o.quantizedStartStep%16!=0)t.notes[i].quantizedEndStep+=o.quantizedEndStep-o.quantizedStartStep;else{const o=new r.a.Note;o.pitch=n[e].pitch,o.instrument=n[e].instrument,o.quantizedStartStep=n[e].quantizedStartStep,o.quantizedEndStep=n[e].quantizedEndStep,t.notes.push(o),i++}}return t}function v(e,t=64){let n;!function(e){e[e.SUSTAIN_ON=0]="SUSTAIN_ON",e[e.SUSTAIN_OFF=1]="SUSTAIN_OFF",e[e.NOTE_ON=2]="NOTE_ON",e[e.NOTE_OFF=3]="NOTE_OFF"}(n||(n={}));if(g(e))throw new Error("Can only apply sustain to unquantized NoteSequence.");const r=l(e),o=[];for(const e of r.notes)!1===e.isDrum&&(null!==e.startTime&&o.push({time:e.startTime,type:n.NOTE_ON,event:e}),null!==e.endTime&&o.push({time:e.endTime,type:n.NOTE_OFF,event:e}));for(const e of r.controlChanges)if(e.controlNumber===t){const t=e.controlValue;t>=64?o.push({time:e.time,type:n.SUSTAIN_ON,event:e}):t<64&&o.push({time:e.time,type:n.SUSTAIN_OFF,event:e})}o.sort((e,t)=>e.time-t.time);const i={},s={};let a=0;for(const e of o){a=e.time;const t=e.type,o=e.event;if(t===n.SUSTAIN_ON)s[o.instrument]=!0;else if(t===n.SUSTAIN_OFF){s[o.instrument]=!1;const e=[];o.instrument in i||(i[o.instrument]=[]);for(const t of i[o.instrument])t.endTime<a?(t.endTime=a,a>r.totalTime&&(r.totalTime=a)):e.push(t);i[o.instrument]=e}else if(t===n.NOTE_ON){if(!0===s[o.instrument]){const e=[];o.instrument in i||(i[o.instrument]=[]);for(const t of i[o.instrument])t.pitch===o.pitch?(t.endTime=a,t.startTime===t.endTime&&r.notes.push(t)):e.push(t);i[o.instrument]=e}o.instrument in i||(i[o.instrument]=[]),i[o.instrument].push(o)}else if(t===n.NOTE_OFF)if(!0===s[o.instrument]);else{const e=i[o.instrument].indexOf(o);e>-1&&i[o.instrument].splice(e,1)}}for(const e of Object.values(i))for(const t of e)t.endTime=a,r.totalTime=a;return r}function A(e,t){if(t&&t.length!==e.length)throw new Error("Number of sequences to concatenate and their individual\n durations does not match.");if(g(e[0])){for(let t=0;t<e.length;++t)if(S(e[t]),e[t].quantizationInfo.stepsPerQuarter!==e[0].quantizationInfo.stepsPerQuarter)throw new Error("Not all sequences have the same quantizationInfo");return k(e,"totalQuantizedSteps","quantizedStartStep","quantizedEndStep",t)}return k(e,"totalTime","startTime","endTime",t)}function E(e,t,n,r){return g(e)?_(e,t,n,"totalQuantizedSteps","quantizedStartStep","quantizedEndStep",r):_(e,t,n,"totalTime","startTime","endTime",r)}function k(e,t,n,o,i){let s,a=0;for(let c=0;c<e.length;++c){const u=i?i[c]:e[c][t];if(0===u)throw Error(`Sequence ${e[c].id} has no ${t}, and no individual duration was provided.`);0===c?s=l(e[0]):Array.prototype.push.apply(s.notes,e[c].notes.map(e=>{const t=r.a.Note.create(e);return t[n]+=a,t[o]+=a,t})),a+=u}return s[t]=a,s}function _(e,t,n,r,o,i,s){const a=l(e);a[r]=n,a.notes=a.notes.filter(e=>e[o]>=t&&e[o]<=n&&(s||e[i]<=n)),a[r]-=t;for(let e=0;e<a.notes.length;e++)a.notes[e][o]-=t,a.notes[e][i]-=t,s&&(a.notes[e][i]=Math.min(a.notes[e][i],a[r]));return a}function z(e,t){S(e);const n=l(e),o=n.notes.sort((e,t)=>e.quantizedStartStep-t.quantizedStartStep),i=[];let s=0,a=[];for(let e=0;e<o.length;e++){const c=o[e],u=c.quantizedStartStep,p=c.quantizedEndStep;if(c.quantizedStartStep-=s,c.quantizedEndStep-=s,!(c.quantizedStartStep<0))if(c.quantizedEndStep<=t)a.push(c);else{if(c.quantizedStartStep<t){const e=r.a.Note.create(c);e.quantizedEndStep=t,e.startTime=e.endTime=void 0,a.push(e),c.quantizedStartStep=s+t,c.quantizedEndStep=p}else c.quantizedStartStep=u,c.quantizedEndStep=p;if((c.quantizedEndStep>t||c.quantizedStartStep>t)&&(e-=1),0!==a.length){const e=l(n);e.notes=a,e.totalQuantizedSteps=t,i.push(e)}a=[],s+=t}}if(0!==a.length){const e=l(n);e.notes=a,e.totalQuantizedSteps=t,i.push(e)}return i}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"d",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return s}));const r=n(18),o=n(19);n(21);function i(){throw new Error("Cannot check if Safari in Node.js")}function s(e){throw new Error("Cannot use offline audio context in Node.js")}},,,function(e,t){e.exports=require("tonal")},function(e,t,n){"use strict";n.r(t),n.d(t,"NO_EVENT",(function(){return s})),n.d(t,"NOTE_OFF",(function(){return a})),n.d(t,"Melody",(function(){return c})),n.d(t,"MelodyRhythm",(function(){return u})),n.d(t,"MelodyShape",(function(){return l})),n.d(t,"MelodyRegister",(function(){return p}));var r=n(0),o=n(3),i=n(5);const s=0,a=1;class c{constructor(e,t,n){this.events=e,this.minPitch=t,this.maxPitch=n}static fromNoteSequence(e,t,n,r=!0,o){i.assertIsQuantizedSequence(e);const s=e.notes.sort((e,t)=>e.quantizedStartStep===t.quantizedStartStep?t.pitch-e.pitch:e.quantizedStartStep-t.quantizedStartStep),u=new Int32Array(o||e.totalQuantizedSteps);let l=-1;return s.forEach(e=>{if(e.quantizedStartStep===l){if(r)return;throw new Error("`NoteSequence` is not monophonic.")}if(e.pitch<t||e.pitch>n)throw Error("`NoteSequence` has a pitch outside of the valid range: "+e.pitch);u[e.quantizedStartStep]=e.pitch-t+2,u[e.quantizedEndStep]=a,l=e.quantizedStartStep}),new c(u,t,n)}toNoteSequence(e,t){const n=i.createQuantizedNoteSequence(e,t);let r=null;for(let e=0;e<this.events.length;++e){const t=this.events[e];switch(t){case s:break;case a:r&&(r.quantizedEndStep=e,n.notes.push(r),r=null);break;default:r&&(r.quantizedEndStep=e,n.notes.push(r)),r=o.a.Note.create({pitch:t-2+this.minPitch,quantizedStartStep:e})}}return r&&(r.quantizedEndStep=this.events.length,n.notes.push(r)),n.totalQuantizedSteps=this.events.length,n}}class u{constructor(){this.depth=1}extract(e){const t=e.events.length,n=r.buffer([t,1]);for(let r=0;r<t;++r)n.set(e.events[r]>=2?1:0,r,0);return n.toTensor().as2D(t,1)}}class l{constructor(){this.depth=3}extract(e){const t=e.events.length,n=r.buffer([t,3]);let o=null,i=null;for(let r=0;r<t;++r)if(e.events[r]>=2){if(null!==o){let t;0===n.get(o,0)&&0===n.get(o,1)&&0===n.get(o,2)&&(o=-1),t=e.events[r]<i?0:e.events[r]>i?2:1;for(let e=r;e>o;--e)n.set(1,e,t)}o=r,i=e.events[r]}if(o!==t-1)if(null===o||0===n.get(o,0)&&0===n.get(o,1)&&0===n.get(o,2))for(let e=0;e<t;++e)n.set(1,e,1);else for(let e=t-1;e>o;--e)for(let t=0;t<3;t++)n.set(n.get(o,t),e,t);return n.toTensor().as2D(t,3)}}class p{constructor(e){this.boundaryPitches=e,this.depth=e.length+1}meanMelodyPitch(e){let t=0,n=0,r=null;for(let o=0;o<e.events.length;++o)e.events[o]===a?r=null:e.events[o]>=2&&(r=e.minPitch+e.events[o]-2),null!==r&&(t+=r,n+=1);return n?t/n:null}extract(e){const t=e.events.length,n=this.meanMelodyPitch(e);if(null===n)return r.zeros([t,this.depth]);let o=0;for(;o<this.boundaryPitches.length&&n>=this.boundaryPitches[o];)o++;const i=r.buffer([t,this.depth]);for(let e=0;e<t;++e)i.set(1,e,o);return i.toTensor().as2D(t,this.depth)}}},,function(e,t,n){"use strict";n.r(t),n.d(t,"Performance",(function(){return a}));var r=n(3),o=n(1),i=n(5),s=n(4);class a{constructor(e,t,n,r,o){this.events=e,this.maxShiftSteps=t,this.numVelocityBins=n,this.program=r,this.isDrum=o}static fromNoteSequence(e,t,n,r){i.assertIsQuantizedSequence(e);const s=e.notes.filter((e,t)=>void 0===r||e.instrument===r),c=s.sort((e,t)=>e.startTime===t.startTime?e.pitch-t.pitch:e.startTime-t.startTime),u=c.map((e,t)=>({step:e.quantizedStartStep,index:t,isOffset:0})),l=c.map((e,t)=>({step:e.quantizedEndStep,index:t,isOffset:1})),p=u.concat(l).sort((e,t)=>e.step===t.step?e.index===t.index?e.isOffset-t.isOffset:e.index-t.index:e.step-t.step),h=n?Math.ceil((o.MIDI_VELOCITIES-1)/n):void 0,m=[];let d=0,f=n;for(const e of p){if(e.step>d){for(;e.step>d+t;)m.push({type:"time-shift",steps:t}),d+=t;m.push({type:"time-shift",steps:e.step-d}),d=e.step}if(e.isOffset)m.push({type:"note-off",pitch:c[e.index].pitch});else{if(h){const t=Math.floor((c[e.index].velocity-o.MIN_MIDI_VELOCITY-1)/h)+1;t!==f&&(m.push({type:"velocity-change",velocityBin:t}),f=t)}m.push({type:"note-on",pitch:c[e.index].pitch})}}const g=!!s.some(e=>e.isDrum)&&(!s.some(e=>!e.isDrum)||void 0),S=Array.from(new Set(s.map(e=>e.program))),y=g||1!==S.length?void 0:S[0],w=new a(m,t,n,y,g);return w.setNumSteps(e.totalQuantizedSteps),w}getNumSteps(){return this.events.filter(e=>"time-shift"===e.type).map(e=>e.steps).reduce((e,t)=>e+t,0)}setNumSteps(e){let t=this.getNumSteps();if(t<e){if(this.events.length){const n=this.events[this.events.length-1];if("time-shift"===n.type){const r=Math.min(e-t,this.maxShiftSteps-n.steps);n.steps+=r,t+=r}}for(;t<e;)t+this.maxShiftSteps>e?(this.events.push({type:"time-shift",steps:e-t}),t=e):(this.events.push({type:"time-shift",steps:this.maxShiftSteps}),t+=this.maxShiftSteps)}else if(t>e)for(;this.events.length&&t>e;){const n=this.events[this.events.length-1];"time-shift"===n.type?t-n.steps<e?(n.steps-=t-e,t=e):(this.events.pop(),t-=n.steps):this.events.pop()}}toNoteSequence(e){const t=this.numVelocityBins?Math.ceil((o.MIDI_VELOCITIES-1)/this.numVelocityBins):void 0,n=r.a.create();let i=0,a=void 0;const c=new Map;for(let e=o.MIN_MIDI_PITCH;e<=o.MAX_MIDI_PITCH;++e)c.set(e,[]);for(const u of this.events)switch(u.type){case"note-on":c.get(u.pitch).push([i,a]);break;case"note-off":const l=c.get(u.pitch);if(l.length){const[t,o]=l.shift();i>t?n.notes.push(r.a.Note.create({pitch:u.pitch,velocity:o,instrument:e,quantizedStartStep:t,quantizedEndStep:i,program:this.program,isDrum:this.isDrum})):s.log(`Ignoring zero-length note: (pitch = ${u.pitch}, step = ${i})`,"Performance")}else s.log(`Ignoring note-off with no previous note-on:(pitch = ${u.pitch}, step = ${i})`,"Performance");break;case"time-shift":i+=u.steps;break;case"velocity-change":if(!t)throw new Error("Unexpected velocity change event: "+u);a=o.MIN_MIDI_VELOCITY+(u.velocityBin-1)*t+1;break;default:throw new Error("Unrecognized performance event: "+u)}return c.forEach((t,o)=>{for(const[a,c]of t)i>a?n.notes.push(r.a.Note.create({pitch:o,velocity:c,instrument:e,quantizedStartStep:a,quantizedEndStep:i,program:this.program,isDrum:this.isDrum})):s.log(`Ignoring zero-length note: (pitch = ${o}, step = ${i})`,"Performance")}),n.totalQuantizedSteps=i,n}}},function(e,t,n){"use strict";var r,o,i=n(24),s=i.Reader,a=i.Writer,c=i.util,u=i.roots.default||(i.roots.default={});u.tensorflow=((o={}).magenta=((r={}).NoteSequence=function(){function e(e){if(this.timeSignatures=[],this.keySignatures=[],this.tempos=[],this.notes=[],this.pitchBends=[],this.controlChanges=[],this.partInfos=[],this.textAnnotations=[],this.sectionAnnotations=[],this.sectionGroups=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t,n;return e.prototype.id="",e.prototype.filename="",e.prototype.referenceNumber=c.Long?c.Long.fromBits(0,0,!1):0,e.prototype.collectionName="",e.prototype.ticksPerQuarter=0,e.prototype.timeSignatures=c.emptyArray,e.prototype.keySignatures=c.emptyArray,e.prototype.tempos=c.emptyArray,e.prototype.notes=c.emptyArray,e.prototype.totalTime=0,e.prototype.totalQuantizedSteps=c.Long?c.Long.fromBits(0,0,!1):0,e.prototype.pitchBends=c.emptyArray,e.prototype.controlChanges=c.emptyArray,e.prototype.partInfos=c.emptyArray,e.prototype.sourceInfo=null,e.prototype.textAnnotations=c.emptyArray,e.prototype.sectionAnnotations=c.emptyArray,e.prototype.sectionGroups=c.emptyArray,e.prototype.quantizationInfo=null,e.prototype.subsequenceInfo=null,e.prototype.sequenceMetadata=null,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=a.create()),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(10).string(e.id),null!=e.filename&&e.hasOwnProperty("filename")&&t.uint32(18).string(e.filename),null!=e.collectionName&&e.hasOwnProperty("collectionName")&&t.uint32(26).string(e.collectionName),null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&t.uint32(32).int32(e.ticksPerQuarter),null!=e.timeSignatures&&e.timeSignatures.length)for(var n=0;n<e.timeSignatures.length;++n)u.tensorflow.magenta.NoteSequence.TimeSignature.encode(e.timeSignatures[n],t.uint32(42).fork()).ldelim();if(null!=e.keySignatures&&e.keySignatures.length)for(n=0;n<e.keySignatures.length;++n)u.tensorflow.magenta.NoteSequence.KeySignature.encode(e.keySignatures[n],t.uint32(50).fork()).ldelim();if(null!=e.tempos&&e.tempos.length)for(n=0;n<e.tempos.length;++n)u.tensorflow.magenta.NoteSequence.Tempo.encode(e.tempos[n],t.uint32(58).fork()).ldelim();if(null!=e.notes&&e.notes.length)for(n=0;n<e.notes.length;++n)u.tensorflow.magenta.NoteSequence.Note.encode(e.notes[n],t.uint32(66).fork()).ldelim();if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&t.uint32(73).double(e.totalTime),null!=e.pitchBends&&e.pitchBends.length)for(n=0;n<e.pitchBends.length;++n)u.tensorflow.magenta.NoteSequence.PitchBend.encode(e.pitchBends[n],t.uint32(82).fork()).ldelim();if(null!=e.controlChanges&&e.controlChanges.length)for(n=0;n<e.controlChanges.length;++n)u.tensorflow.magenta.NoteSequence.ControlChange.encode(e.controlChanges[n],t.uint32(90).fork()).ldelim();if(null!=e.partInfos&&e.partInfos.length)for(n=0;n<e.partInfos.length;++n)u.tensorflow.magenta.NoteSequence.PartInfo.encode(e.partInfos[n],t.uint32(98).fork()).ldelim();if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&u.tensorflow.magenta.NoteSequence.SourceInfo.encode(e.sourceInfo,t.uint32(106).fork()).ldelim(),null!=e.textAnnotations&&e.textAnnotations.length)for(n=0;n<e.textAnnotations.length;++n)u.tensorflow.magenta.NoteSequence.TextAnnotation.encode(e.textAnnotations[n],t.uint32(114).fork()).ldelim();if(null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&u.tensorflow.magenta.NoteSequence.QuantizationInfo.encode(e.quantizationInfo,t.uint32(122).fork()).ldelim(),null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&t.uint32(128).int64(e.totalQuantizedSteps),null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&u.tensorflow.magenta.NoteSequence.SubsequenceInfo.encode(e.subsequenceInfo,t.uint32(138).fork()).ldelim(),null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&t.uint32(144).int64(e.referenceNumber),null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&u.tensorflow.magenta.SequenceMetadata.encode(e.sequenceMetadata,t.uint32(154).fork()).ldelim(),null!=e.sectionAnnotations&&e.sectionAnnotations.length)for(n=0;n<e.sectionAnnotations.length;++n)u.tensorflow.magenta.NoteSequence.SectionAnnotation.encode(e.sectionAnnotations[n],t.uint32(162).fork()).ldelim();if(null!=e.sectionGroups&&e.sectionGroups.length)for(n=0;n<e.sectionGroups.length;++n)u.tensorflow.magenta.NoteSequence.SectionGroup.encode(e.sectionGroups[n],t.uint32(170).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.id=e.string();break;case 2:r.filename=e.string();break;case 18:r.referenceNumber=c.Long?e.int64().toNumber():e.int64();break;case 3:r.collectionName=e.string();break;case 4:r.ticksPerQuarter=e.int32();break;case 5:r.timeSignatures&&r.timeSignatures.length||(r.timeSignatures=[]),r.timeSignatures.push(u.tensorflow.magenta.NoteSequence.TimeSignature.decode(e,e.uint32()));break;case 6:r.keySignatures&&r.keySignatures.length||(r.keySignatures=[]),r.keySignatures.push(u.tensorflow.magenta.NoteSequence.KeySignature.decode(e,e.uint32()));break;case 7:r.tempos&&r.tempos.length||(r.tempos=[]),r.tempos.push(u.tensorflow.magenta.NoteSequence.Tempo.decode(e,e.uint32()));break;case 8:r.notes&&r.notes.length||(r.notes=[]),r.notes.push(u.tensorflow.magenta.NoteSequence.Note.decode(e,e.uint32()));break;case 9:r.totalTime=e.double();break;case 16:r.totalQuantizedSteps=c.Long?e.int64().toNumber():e.int64();break;case 10:r.pitchBends&&r.pitchBends.length||(r.pitchBends=[]),r.pitchBends.push(u.tensorflow.magenta.NoteSequence.PitchBend.decode(e,e.uint32()));break;case 11:r.controlChanges&&r.controlChanges.length||(r.controlChanges=[]),r.controlChanges.push(u.tensorflow.magenta.NoteSequence.ControlChange.decode(e,e.uint32()));break;case 12:r.partInfos&&r.partInfos.length||(r.partInfos=[]),r.partInfos.push(u.tensorflow.magenta.NoteSequence.PartInfo.decode(e,e.uint32()));break;case 13:r.sourceInfo=u.tensorflow.magenta.NoteSequence.SourceInfo.decode(e,e.uint32());break;case 14:r.textAnnotations&&r.textAnnotations.length||(r.textAnnotations=[]),r.textAnnotations.push(u.tensorflow.magenta.NoteSequence.TextAnnotation.decode(e,e.uint32()));break;case 20:r.sectionAnnotations&&r.sectionAnnotations.length||(r.sectionAnnotations=[]),r.sectionAnnotations.push(u.tensorflow.magenta.NoteSequence.SectionAnnotation.decode(e,e.uint32()));break;case 21:r.sectionGroups&&r.sectionGroups.length||(r.sectionGroups=[]),r.sectionGroups.push(u.tensorflow.magenta.NoteSequence.SectionGroup.decode(e,e.uint32()));break;case 15:r.quantizationInfo=u.tensorflow.magenta.NoteSequence.QuantizationInfo.decode(e,e.uint32());break;case 17:r.subsequenceInfo=u.tensorflow.magenta.NoteSequence.SubsequenceInfo.decode(e,e.uint32());break;case 19:r.sequenceMetadata=u.tensorflow.magenta.SequenceMetadata.decode(e,e.uint32());break;default:e.skipType(7&o)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.id&&e.hasOwnProperty("id")&&!c.isString(e.id))return"id: string expected";if(null!=e.filename&&e.hasOwnProperty("filename")&&!c.isString(e.filename))return"filename: string expected";if(null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&!(c.isInteger(e.referenceNumber)||e.referenceNumber&&c.isInteger(e.referenceNumber.low)&&c.isInteger(e.referenceNumber.high)))return"referenceNumber: integer|Long expected";if(null!=e.collectionName&&e.hasOwnProperty("collectionName")&&!c.isString(e.collectionName))return"collectionName: string expected";if(null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&!c.isInteger(e.ticksPerQuarter))return"ticksPerQuarter: integer expected";if(null!=e.timeSignatures&&e.hasOwnProperty("timeSignatures")){if(!Array.isArray(e.timeSignatures))return"timeSignatures: array expected";for(var t=0;t<e.timeSignatures.length;++t)if(n=u.tensorflow.magenta.NoteSequence.TimeSignature.verify(e.timeSignatures[t]))return"timeSignatures."+n}if(null!=e.keySignatures&&e.hasOwnProperty("keySignatures")){if(!Array.isArray(e.keySignatures))return"keySignatures: array expected";for(t=0;t<e.keySignatures.length;++t)if(n=u.tensorflow.magenta.NoteSequence.KeySignature.verify(e.keySignatures[t]))return"keySignatures."+n}if(null!=e.tempos&&e.hasOwnProperty("tempos")){if(!Array.isArray(e.tempos))return"tempos: array expected";for(t=0;t<e.tempos.length;++t)if(n=u.tensorflow.magenta.NoteSequence.Tempo.verify(e.tempos[t]))return"tempos."+n}if(null!=e.notes&&e.hasOwnProperty("notes")){if(!Array.isArray(e.notes))return"notes: array expected";for(t=0;t<e.notes.length;++t)if(n=u.tensorflow.magenta.NoteSequence.Note.verify(e.notes[t]))return"notes."+n}if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&"number"!=typeof e.totalTime)return"totalTime: number expected";if(null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&!(c.isInteger(e.totalQuantizedSteps)||e.totalQuantizedSteps&&c.isInteger(e.totalQuantizedSteps.low)&&c.isInteger(e.totalQuantizedSteps.high)))return"totalQuantizedSteps: integer|Long expected";if(null!=e.pitchBends&&e.hasOwnProperty("pitchBends")){if(!Array.isArray(e.pitchBends))return"pitchBends: array expected";for(t=0;t<e.pitchBends.length;++t)if(n=u.tensorflow.magenta.NoteSequence.PitchBend.verify(e.pitchBends[t]))return"pitchBends."+n}if(null!=e.controlChanges&&e.hasOwnProperty("controlChanges")){if(!Array.isArray(e.controlChanges))return"controlChanges: array expected";for(t=0;t<e.controlChanges.length;++t)if(n=u.tensorflow.magenta.NoteSequence.ControlChange.verify(e.controlChanges[t]))return"controlChanges."+n}if(null!=e.partInfos&&e.hasOwnProperty("partInfos")){if(!Array.isArray(e.partInfos))return"partInfos: array expected";for(t=0;t<e.partInfos.length;++t)if(n=u.tensorflow.magenta.NoteSequence.PartInfo.verify(e.partInfos[t]))return"partInfos."+n}if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&(n=u.tensorflow.magenta.NoteSequence.SourceInfo.verify(e.sourceInfo)))return"sourceInfo."+n;if(null!=e.textAnnotations&&e.hasOwnProperty("textAnnotations")){if(!Array.isArray(e.textAnnotations))return"textAnnotations: array expected";for(t=0;t<e.textAnnotations.length;++t)if(n=u.tensorflow.magenta.NoteSequence.TextAnnotation.verify(e.textAnnotations[t]))return"textAnnotations."+n}if(null!=e.sectionAnnotations&&e.hasOwnProperty("sectionAnnotations")){if(!Array.isArray(e.sectionAnnotations))return"sectionAnnotations: array expected";for(t=0;t<e.sectionAnnotations.length;++t)if(n=u.tensorflow.magenta.NoteSequence.SectionAnnotation.verify(e.sectionAnnotations[t]))return"sectionAnnotations."+n}if(null!=e.sectionGroups&&e.hasOwnProperty("sectionGroups")){if(!Array.isArray(e.sectionGroups))return"sectionGroups: array expected";for(t=0;t<e.sectionGroups.length;++t){var n;if(n=u.tensorflow.magenta.NoteSequence.SectionGroup.verify(e.sectionGroups[t]))return"sectionGroups."+n}}return null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&(n=u.tensorflow.magenta.NoteSequence.QuantizationInfo.verify(e.quantizationInfo))?"quantizationInfo."+n:null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&(n=u.tensorflow.magenta.NoteSequence.SubsequenceInfo.verify(e.subsequenceInfo))?"subsequenceInfo."+n:null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&(n=u.tensorflow.magenta.SequenceMetadata.verify(e.sequenceMetadata))?"sequenceMetadata."+n:null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence)return e;var t=new u.tensorflow.magenta.NoteSequence;if(null!=e.id&&(t.id=String(e.id)),null!=e.filename&&(t.filename=String(e.filename)),null!=e.referenceNumber&&(c.Long?(t.referenceNumber=c.Long.fromValue(e.referenceNumber)).unsigned=!1:"string"==typeof e.referenceNumber?t.referenceNumber=parseInt(e.referenceNumber,10):"number"==typeof e.referenceNumber?t.referenceNumber=e.referenceNumber:"object"==typeof e.referenceNumber&&(t.referenceNumber=new c.LongBits(e.referenceNumber.low>>>0,e.referenceNumber.high>>>0).toNumber())),null!=e.collectionName&&(t.collectionName=String(e.collectionName)),null!=e.ticksPerQuarter&&(t.ticksPerQuarter=0|e.ticksPerQuarter),e.timeSignatures){if(!Array.isArray(e.timeSignatures))throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: array expected");t.timeSignatures=[];for(var n=0;n<e.timeSignatures.length;++n){if("object"!=typeof e.timeSignatures[n])throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: object expected");t.timeSignatures[n]=u.tensorflow.magenta.NoteSequence.TimeSignature.fromObject(e.timeSignatures[n])}}if(e.keySignatures){if(!Array.isArray(e.keySignatures))throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: array expected");for(t.keySignatures=[],n=0;n<e.keySignatures.length;++n){if("object"!=typeof e.keySignatures[n])throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: object expected");t.keySignatures[n]=u.tensorflow.magenta.NoteSequence.KeySignature.fromObject(e.keySignatures[n])}}if(e.tempos){if(!Array.isArray(e.tempos))throw TypeError(".tensorflow.magenta.NoteSequence.tempos: array expected");for(t.tempos=[],n=0;n<e.tempos.length;++n){if("object"!=typeof e.tempos[n])throw TypeError(".tensorflow.magenta.NoteSequence.tempos: object expected");t.tempos[n]=u.tensorflow.magenta.NoteSequence.Tempo.fromObject(e.tempos[n])}}if(e.notes){if(!Array.isArray(e.notes))throw TypeError(".tensorflow.magenta.NoteSequence.notes: array expected");for(t.notes=[],n=0;n<e.notes.length;++n){if("object"!=typeof e.notes[n])throw TypeError(".tensorflow.magenta.NoteSequence.notes: object expected");t.notes[n]=u.tensorflow.magenta.NoteSequence.Note.fromObject(e.notes[n])}}if(null!=e.totalTime&&(t.totalTime=Number(e.totalTime)),null!=e.totalQuantizedSteps&&(c.Long?(t.totalQuantizedSteps=c.Long.fromValue(e.totalQuantizedSteps)).unsigned=!1:"string"==typeof e.totalQuantizedSteps?t.totalQuantizedSteps=parseInt(e.totalQuantizedSteps,10):"number"==typeof e.totalQuantizedSteps?t.totalQuantizedSteps=e.totalQuantizedSteps:"object"==typeof e.totalQuantizedSteps&&(t.totalQuantizedSteps=new c.LongBits(e.totalQuantizedSteps.low>>>0,e.totalQuantizedSteps.high>>>0).toNumber())),e.pitchBends){if(!Array.isArray(e.pitchBends))throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: array expected");for(t.pitchBends=[],n=0;n<e.pitchBends.length;++n){if("object"!=typeof e.pitchBends[n])throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: object expected");t.pitchBends[n]=u.tensorflow.magenta.NoteSequence.PitchBend.fromObject(e.pitchBends[n])}}if(e.controlChanges){if(!Array.isArray(e.controlChanges))throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: array expected");for(t.controlChanges=[],n=0;n<e.controlChanges.length;++n){if("object"!=typeof e.controlChanges[n])throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: object expected");t.controlChanges[n]=u.tensorflow.magenta.NoteSequence.ControlChange.fromObject(e.controlChanges[n])}}if(e.partInfos){if(!Array.isArray(e.partInfos))throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: array expected");for(t.partInfos=[],n=0;n<e.partInfos.length;++n){if("object"!=typeof e.partInfos[n])throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: object expected");t.partInfos[n]=u.tensorflow.magenta.NoteSequence.PartInfo.fromObject(e.partInfos[n])}}if(null!=e.sourceInfo){if("object"!=typeof e.sourceInfo)throw TypeError(".tensorflow.magenta.NoteSequence.sourceInfo: object expected");t.sourceInfo=u.tensorflow.magenta.NoteSequence.SourceInfo.fromObject(e.sourceInfo)}if(e.textAnnotations){if(!Array.isArray(e.textAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: array expected");for(t.textAnnotations=[],n=0;n<e.textAnnotations.length;++n){if("object"!=typeof e.textAnnotations[n])throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: object expected");t.textAnnotations[n]=u.tensorflow.magenta.NoteSequence.TextAnnotation.fromObject(e.textAnnotations[n])}}if(e.sectionAnnotations){if(!Array.isArray(e.sectionAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: array expected");for(t.sectionAnnotations=[],n=0;n<e.sectionAnnotations.length;++n){if("object"!=typeof e.sectionAnnotations[n])throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: object expected");t.sectionAnnotations[n]=u.tensorflow.magenta.NoteSequence.SectionAnnotation.fromObject(e.sectionAnnotations[n])}}if(e.sectionGroups){if(!Array.isArray(e.sectionGroups))throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: array expected");for(t.sectionGroups=[],n=0;n<e.sectionGroups.length;++n){if("object"!=typeof e.sectionGroups[n])throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: object expected");t.sectionGroups[n]=u.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(e.sectionGroups[n])}}if(null!=e.quantizationInfo){if("object"!=typeof e.quantizationInfo)throw TypeError(".tensorflow.magenta.NoteSequence.quantizationInfo: object expected");t.quantizationInfo=u.tensorflow.magenta.NoteSequence.QuantizationInfo.fromObject(e.quantizationInfo)}if(null!=e.subsequenceInfo){if("object"!=typeof e.subsequenceInfo)throw TypeError(".tensorflow.magenta.NoteSequence.subsequenceInfo: object expected");t.subsequenceInfo=u.tensorflow.magenta.NoteSequence.SubsequenceInfo.fromObject(e.subsequenceInfo)}if(null!=e.sequenceMetadata){if("object"!=typeof e.sequenceMetadata)throw TypeError(".tensorflow.magenta.NoteSequence.sequenceMetadata: object expected");t.sequenceMetadata=u.tensorflow.magenta.SequenceMetadata.fromObject(e.sequenceMetadata)}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.timeSignatures=[],n.keySignatures=[],n.tempos=[],n.notes=[],n.pitchBends=[],n.controlChanges=[],n.partInfos=[],n.textAnnotations=[],n.sectionAnnotations=[],n.sectionGroups=[]),t.defaults){if(n.id="",n.filename="",n.collectionName="",n.ticksPerQuarter=0,n.totalTime=0,n.sourceInfo=null,n.quantizationInfo=null,c.Long){var r=new c.Long(0,0,!1);n.totalQuantizedSteps=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.totalQuantizedSteps=t.longs===String?"0":0;n.subsequenceInfo=null,c.Long?(r=new c.Long(0,0,!1),n.referenceNumber=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.referenceNumber=t.longs===String?"0":0,n.sequenceMetadata=null}if(null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.filename&&e.hasOwnProperty("filename")&&(n.filename=e.filename),null!=e.collectionName&&e.hasOwnProperty("collectionName")&&(n.collectionName=e.collectionName),null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&(n.ticksPerQuarter=e.ticksPerQuarter),e.timeSignatures&&e.timeSignatures.length){n.timeSignatures=[];for(var o=0;o<e.timeSignatures.length;++o)n.timeSignatures[o]=u.tensorflow.magenta.NoteSequence.TimeSignature.toObject(e.timeSignatures[o],t)}if(e.keySignatures&&e.keySignatures.length)for(n.keySignatures=[],o=0;o<e.keySignatures.length;++o)n.keySignatures[o]=u.tensorflow.magenta.NoteSequence.KeySignature.toObject(e.keySignatures[o],t);if(e.tempos&&e.tempos.length)for(n.tempos=[],o=0;o<e.tempos.length;++o)n.tempos[o]=u.tensorflow.magenta.NoteSequence.Tempo.toObject(e.tempos[o],t);if(e.notes&&e.notes.length)for(n.notes=[],o=0;o<e.notes.length;++o)n.notes[o]=u.tensorflow.magenta.NoteSequence.Note.toObject(e.notes[o],t);if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&(n.totalTime=t.json&&!isFinite(e.totalTime)?String(e.totalTime):e.totalTime),e.pitchBends&&e.pitchBends.length)for(n.pitchBends=[],o=0;o<e.pitchBends.length;++o)n.pitchBends[o]=u.tensorflow.magenta.NoteSequence.PitchBend.toObject(e.pitchBends[o],t);if(e.controlChanges&&e.controlChanges.length)for(n.controlChanges=[],o=0;o<e.controlChanges.length;++o)n.controlChanges[o]=u.tensorflow.magenta.NoteSequence.ControlChange.toObject(e.controlChanges[o],t);if(e.partInfos&&e.partInfos.length)for(n.partInfos=[],o=0;o<e.partInfos.length;++o)n.partInfos[o]=u.tensorflow.magenta.NoteSequence.PartInfo.toObject(e.partInfos[o],t);if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&(n.sourceInfo=u.tensorflow.magenta.NoteSequence.SourceInfo.toObject(e.sourceInfo,t)),e.textAnnotations&&e.textAnnotations.length)for(n.textAnnotations=[],o=0;o<e.textAnnotations.length;++o)n.textAnnotations[o]=u.tensorflow.magenta.NoteSequence.TextAnnotation.toObject(e.textAnnotations[o],t);if(null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&(n.quantizationInfo=u.tensorflow.magenta.NoteSequence.QuantizationInfo.toObject(e.quantizationInfo,t)),null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&("number"==typeof e.totalQuantizedSteps?n.totalQuantizedSteps=t.longs===String?String(e.totalQuantizedSteps):e.totalQuantizedSteps:n.totalQuantizedSteps=t.longs===String?c.Long.prototype.toString.call(e.totalQuantizedSteps):t.longs===Number?new c.LongBits(e.totalQuantizedSteps.low>>>0,e.totalQuantizedSteps.high>>>0).toNumber():e.totalQuantizedSteps),null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&(n.subsequenceInfo=u.tensorflow.magenta.NoteSequence.SubsequenceInfo.toObject(e.subsequenceInfo,t)),null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&("number"==typeof e.referenceNumber?n.referenceNumber=t.longs===String?String(e.referenceNumber):e.referenceNumber:n.referenceNumber=t.longs===String?c.Long.prototype.toString.call(e.referenceNumber):t.longs===Number?new c.LongBits(e.referenceNumber.low>>>0,e.referenceNumber.high>>>0).toNumber():e.referenceNumber),null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&(n.sequenceMetadata=u.tensorflow.magenta.SequenceMetadata.toObject(e.sequenceMetadata,t)),e.sectionAnnotations&&e.sectionAnnotations.length)for(n.sectionAnnotations=[],o=0;o<e.sectionAnnotations.length;++o)n.sectionAnnotations[o]=u.tensorflow.magenta.NoteSequence.SectionAnnotation.toObject(e.sectionAnnotations[o],t);if(e.sectionGroups&&e.sectionGroups.length)for(n.sectionGroups=[],o=0;o<e.sectionGroups.length;++o)n.sectionGroups[o]=u.tensorflow.magenta.NoteSequence.SectionGroup.toObject(e.sectionGroups[o],t);return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e.Note=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.pitch=0,e.prototype.pitchName=0,e.prototype.velocity=0,e.prototype.startTime=0,e.prototype.quantizedStartStep=c.Long?c.Long.fromBits(0,0,!1):0,e.prototype.endTime=0,e.prototype.quantizedEndStep=c.Long?c.Long.fromBits(0,0,!1):0,e.prototype.numerator=0,e.prototype.denominator=0,e.prototype.instrument=0,e.prototype.program=0,e.prototype.isDrum=!1,e.prototype.part=0,e.prototype.voice=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.pitch&&e.hasOwnProperty("pitch")&&t.uint32(8).int32(e.pitch),null!=e.velocity&&e.hasOwnProperty("velocity")&&t.uint32(16).int32(e.velocity),null!=e.startTime&&e.hasOwnProperty("startTime")&&t.uint32(25).double(e.startTime),null!=e.endTime&&e.hasOwnProperty("endTime")&&t.uint32(33).double(e.endTime),null!=e.numerator&&e.hasOwnProperty("numerator")&&t.uint32(40).int32(e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&t.uint32(48).int32(e.denominator),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(56).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(64).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(72).bool(e.isDrum),null!=e.part&&e.hasOwnProperty("part")&&t.uint32(80).int32(e.part),null!=e.pitchName&&e.hasOwnProperty("pitchName")&&t.uint32(88).int32(e.pitchName),null!=e.voice&&e.hasOwnProperty("voice")&&t.uint32(96).int32(e.voice),null!=e.quantizedStartStep&&e.hasOwnProperty("quantizedStartStep")&&t.uint32(104).int64(e.quantizedStartStep),null!=e.quantizedEndStep&&e.hasOwnProperty("quantizedEndStep")&&t.uint32(112).int64(e.quantizedEndStep),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.Note;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.pitch=e.int32();break;case 11:r.pitchName=e.int32();break;case 2:r.velocity=e.int32();break;case 3:r.startTime=e.double();break;case 13:r.quantizedStartStep=c.Long?e.int64().toNumber():e.int64();break;case 4:r.endTime=e.double();break;case 14:r.quantizedEndStep=c.Long?e.int64().toNumber():e.int64();break;case 5:r.numerator=e.int32();break;case 6:r.denominator=e.int32();break;case 7:r.instrument=e.int32();break;case 8:r.program=e.int32();break;case 9:r.isDrum=e.bool();break;case 10:r.part=e.int32();break;case 12:r.voice=e.int32();break;default:e.skipType(7&o)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.pitch&&e.hasOwnProperty("pitch")&&!c.isInteger(e.pitch))return"pitch: integer expected";if(null!=e.pitchName&&e.hasOwnProperty("pitchName"))switch(e.pitchName){default:return"pitchName: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 32:case 33:case 34:case 35:}return null!=e.velocity&&e.hasOwnProperty("velocity")&&!c.isInteger(e.velocity)?"velocity: integer expected":null!=e.startTime&&e.hasOwnProperty("startTime")&&"number"!=typeof e.startTime?"startTime: number expected":null!=e.quantizedStartStep&&e.hasOwnProperty("quantizedStartStep")&&!(c.isInteger(e.quantizedStartStep)||e.quantizedStartStep&&c.isInteger(e.quantizedStartStep.low)&&c.isInteger(e.quantizedStartStep.high))?"quantizedStartStep: integer|Long expected":null!=e.endTime&&e.hasOwnProperty("endTime")&&"number"!=typeof e.endTime?"endTime: number expected":null!=e.quantizedEndStep&&e.hasOwnProperty("quantizedEndStep")&&!(c.isInteger(e.quantizedEndStep)||e.quantizedEndStep&&c.isInteger(e.quantizedEndStep.low)&&c.isInteger(e.quantizedEndStep.high))?"quantizedEndStep: integer|Long expected":null!=e.numerator&&e.hasOwnProperty("numerator")&&!c.isInteger(e.numerator)?"numerator: integer expected":null!=e.denominator&&e.hasOwnProperty("denominator")&&!c.isInteger(e.denominator)?"denominator: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!c.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!c.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!=typeof e.isDrum?"isDrum: boolean expected":null!=e.part&&e.hasOwnProperty("part")&&!c.isInteger(e.part)?"part: integer expected":null!=e.voice&&e.hasOwnProperty("voice")&&!c.isInteger(e.voice)?"voice: integer expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.Note)return e;var t=new u.tensorflow.magenta.NoteSequence.Note;switch(null!=e.pitch&&(t.pitch=0|e.pitch),e.pitchName){case"UNKNOWN_PITCH_NAME":case 0:t.pitchName=0;break;case"F_FLAT_FLAT":case 1:t.pitchName=1;break;case"C_FLAT_FLAT":case 2:t.pitchName=2;break;case"G_FLAT_FLAT":case 3:t.pitchName=3;break;case"D_FLAT_FLAT":case 4:t.pitchName=4;break;case"A_FLAT_FLAT":case 5:t.pitchName=5;break;case"E_FLAT_FLAT":case 6:t.pitchName=6;break;case"B_FLAT_FLAT":case 7:t.pitchName=7;break;case"F_FLAT":case 8:t.pitchName=8;break;case"C_FLAT":case 9:t.pitchName=9;break;case"G_FLAT":case 10:t.pitchName=10;break;case"D_FLAT":case 11:t.pitchName=11;break;case"A_FLAT":case 12:t.pitchName=12;break;case"E_FLAT":case 13:t.pitchName=13;break;case"B_FLAT":case 14:t.pitchName=14;break;case"F":case 15:t.pitchName=15;break;case"C":case 16:t.pitchName=16;break;case"G":case 17:t.pitchName=17;break;case"D":case 18:t.pitchName=18;break;case"A":case 19:t.pitchName=19;break;case"E":case 20:t.pitchName=20;break;case"B":case 21:t.pitchName=21;break;case"F_SHARP":case 22:t.pitchName=22;break;case"C_SHARP":case 23:t.pitchName=23;break;case"G_SHARP":case 24:t.pitchName=24;break;case"D_SHARP":case 25:t.pitchName=25;break;case"A_SHARP":case 26:t.pitchName=26;break;case"E_SHARP":case 27:t.pitchName=27;break;case"B_SHARP":case 28:t.pitchName=28;break;case"F_SHARP_SHARP":case 29:t.pitchName=29;break;case"C_SHARP_SHARP":case 30:t.pitchName=30;break;case"G_SHARP_SHARP":case 31:t.pitchName=31;break;case"D_SHARP_SHARP":case 32:t.pitchName=32;break;case"A_SHARP_SHARP":case 33:t.pitchName=33;break;case"E_SHARP_SHARP":case 34:t.pitchName=34;break;case"B_SHARP_SHARP":case 35:t.pitchName=35}return null!=e.velocity&&(t.velocity=0|e.velocity),null!=e.startTime&&(t.startTime=Number(e.startTime)),null!=e.quantizedStartStep&&(c.Long?(t.quantizedStartStep=c.Long.fromValue(e.quantizedStartStep)).unsigned=!1:"string"==typeof e.quantizedStartStep?t.quantizedStartStep=parseInt(e.quantizedStartStep,10):"number"==typeof e.quantizedStartStep?t.quantizedStartStep=e.quantizedStartStep:"object"==typeof e.quantizedStartStep&&(t.quantizedStartStep=new c.LongBits(e.quantizedStartStep.low>>>0,e.quantizedStartStep.high>>>0).toNumber())),null!=e.endTime&&(t.endTime=Number(e.endTime)),null!=e.quantizedEndStep&&(c.Long?(t.quantizedEndStep=c.Long.fromValue(e.quantizedEndStep)).unsigned=!1:"string"==typeof e.quantizedEndStep?t.quantizedEndStep=parseInt(e.quantizedEndStep,10):"number"==typeof e.quantizedEndStep?t.quantizedEndStep=e.quantizedEndStep:"object"==typeof e.quantizedEndStep&&(t.quantizedEndStep=new c.LongBits(e.quantizedEndStep.low>>>0,e.quantizedEndStep.high>>>0).toNumber())),null!=e.numerator&&(t.numerator=0|e.numerator),null!=e.denominator&&(t.denominator=0|e.denominator),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),null!=e.part&&(t.part=0|e.part),null!=e.voice&&(t.voice=0|e.voice),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(n.pitch=0,n.velocity=0,n.startTime=0,n.endTime=0,n.numerator=0,n.denominator=0,n.instrument=0,n.program=0,n.isDrum=!1,n.part=0,n.pitchName=t.enums===String?"UNKNOWN_PITCH_NAME":0,n.voice=0,c.Long){var r=new c.Long(0,0,!1);n.quantizedStartStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedStartStep=t.longs===String?"0":0;c.Long?(r=new c.Long(0,0,!1),n.quantizedEndStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r):n.quantizedEndStep=t.longs===String?"0":0}return null!=e.pitch&&e.hasOwnProperty("pitch")&&(n.pitch=e.pitch),null!=e.velocity&&e.hasOwnProperty("velocity")&&(n.velocity=e.velocity),null!=e.startTime&&e.hasOwnProperty("startTime")&&(n.startTime=t.json&&!isFinite(e.startTime)?String(e.startTime):e.startTime),null!=e.endTime&&e.hasOwnProperty("endTime")&&(n.endTime=t.json&&!isFinite(e.endTime)?String(e.endTime):e.endTime),null!=e.numerator&&e.hasOwnProperty("numerator")&&(n.numerator=e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&(n.denominator=e.denominator),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),null!=e.part&&e.hasOwnProperty("part")&&(n.part=e.part),null!=e.pitchName&&e.hasOwnProperty("pitchName")&&(n.pitchName=t.enums===String?u.tensorflow.magenta.NoteSequence.PitchName[e.pitchName]:e.pitchName),null!=e.voice&&e.hasOwnProperty("voice")&&(n.voice=e.voice),null!=e.quantizedStartStep&&e.hasOwnProperty("quantizedStartStep")&&("number"==typeof e.quantizedStartStep?n.quantizedStartStep=t.longs===String?String(e.quantizedStartStep):e.quantizedStartStep:n.quantizedStartStep=t.longs===String?c.Long.prototype.toString.call(e.quantizedStartStep):t.longs===Number?new c.LongBits(e.quantizedStartStep.low>>>0,e.quantizedStartStep.high>>>0).toNumber():e.quantizedStartStep),null!=e.quantizedEndStep&&e.hasOwnProperty("quantizedEndStep")&&("number"==typeof e.quantizedEndStep?n.quantizedEndStep=t.longs===String?String(e.quantizedEndStep):e.quantizedEndStep:n.quantizedEndStep=t.longs===String?c.Long.prototype.toString.call(e.quantizedEndStep):t.longs===Number?new c.LongBits(e.quantizedEndStep.low>>>0,e.quantizedEndStep.high>>>0).toNumber():e.quantizedEndStep),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),e.PitchName=(t={},(n=Object.create(t))[t[0]="UNKNOWN_PITCH_NAME"]=0,n[t[1]="F_FLAT_FLAT"]=1,n[t[2]="C_FLAT_FLAT"]=2,n[t[3]="G_FLAT_FLAT"]=3,n[t[4]="D_FLAT_FLAT"]=4,n[t[5]="A_FLAT_FLAT"]=5,n[t[6]="E_FLAT_FLAT"]=6,n[t[7]="B_FLAT_FLAT"]=7,n[t[8]="F_FLAT"]=8,n[t[9]="C_FLAT"]=9,n[t[10]="G_FLAT"]=10,n[t[11]="D_FLAT"]=11,n[t[12]="A_FLAT"]=12,n[t[13]="E_FLAT"]=13,n[t[14]="B_FLAT"]=14,n[t[15]="F"]=15,n[t[16]="C"]=16,n[t[17]="G"]=17,n[t[18]="D"]=18,n[t[19]="A"]=19,n[t[20]="E"]=20,n[t[21]="B"]=21,n[t[22]="F_SHARP"]=22,n[t[23]="C_SHARP"]=23,n[t[24]="G_SHARP"]=24,n[t[25]="D_SHARP"]=25,n[t[26]="A_SHARP"]=26,n[t[27]="E_SHARP"]=27,n[t[28]="B_SHARP"]=28,n[t[29]="F_SHARP_SHARP"]=29,n[t[30]="C_SHARP_SHARP"]=30,n[t[31]="G_SHARP_SHARP"]=31,n[t[32]="D_SHARP_SHARP"]=32,n[t[33]="A_SHARP_SHARP"]=33,n[t[34]="E_SHARP_SHARP"]=34,n[t[35]="B_SHARP_SHARP"]=35,n),e.TimeSignature=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.numerator=0,e.prototype.denominator=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.numerator&&e.hasOwnProperty("numerator")&&t.uint32(16).int32(e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&t.uint32(24).int32(e.denominator),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.TimeSignature;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.time=e.double();break;case 2:r.numerator=e.int32();break;case 3:r.denominator=e.int32();break;default:e.skipType(7&o)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.numerator&&e.hasOwnProperty("numerator")&&!c.isInteger(e.numerator)?"numerator: integer expected":null!=e.denominator&&e.hasOwnProperty("denominator")&&!c.isInteger(e.denominator)?"denominator: integer expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.TimeSignature)return e;var t=new u.tensorflow.magenta.NoteSequence.TimeSignature;return null!=e.time&&(t.time=Number(e.time)),null!=e.numerator&&(t.numerator=0|e.numerator),null!=e.denominator&&(t.denominator=0|e.denominator),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.numerator=0,n.denominator=0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.numerator&&e.hasOwnProperty("numerator")&&(n.numerator=e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&(n.denominator=e.denominator),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),e.KeySignature=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.key=0,e.prototype.mode=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.key&&e.hasOwnProperty("key")&&t.uint32(16).int32(e.key),null!=e.mode&&e.hasOwnProperty("mode")&&t.uint32(24).int32(e.mode),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.KeySignature;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.time=e.double();break;case 2:r.key=e.int32();break;case 3:r.mode=e.int32();break;default:e.skipType(7&o)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time)return"time: number expected";if(null!=e.key&&e.hasOwnProperty("key"))switch(e.key){default:return"key: enum value expected";case 0:case 1:case 1:case 2:case 3:case 3:case 4:case 5:case 6:case 6:case 7:case 8:case 8:case 9:case 10:case 10:case 11:}if(null!=e.mode&&e.hasOwnProperty("mode"))switch(e.mode){default:return"mode: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:}return null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.KeySignature)return e;var t=new u.tensorflow.magenta.NoteSequence.KeySignature;switch(null!=e.time&&(t.time=Number(e.time)),e.key){case"C":case 0:t.key=0;break;case"C_SHARP":case 1:t.key=1;break;case"D_FLAT":case 1:t.key=1;break;case"D":case 2:t.key=2;break;case"D_SHARP":case 3:t.key=3;break;case"E_FLAT":case 3:t.key=3;break;case"E":case 4:t.key=4;break;case"F":case 5:t.key=5;break;case"F_SHARP":case 6:t.key=6;break;case"G_FLAT":case 6:t.key=6;break;case"G":case 7:t.key=7;break;case"G_SHARP":case 8:t.key=8;break;case"A_FLAT":case 8:t.key=8;break;case"A":case 9:t.key=9;break;case"A_SHARP":case 10:t.key=10;break;case"B_FLAT":case 10:t.key=10;break;case"B":case 11:t.key=11}switch(e.mode){case"MAJOR":case 0:t.mode=0;break;case"MINOR":case 1:t.mode=1;break;case"NOT_SPECIFIED":case 2:t.mode=2;break;case"MIXOLYDIAN":case 3:t.mode=3;break;case"DORIAN":case 4:t.mode=4;break;case"PHRYGIAN":case 5:t.mode=5;break;case"LYDIAN":case 6:t.mode=6;break;case"LOCRIAN":case 7:t.mode=7}return t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.key=t.enums===String?"C":0,n.mode=t.enums===String?"MAJOR":0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.key&&e.hasOwnProperty("key")&&(n.key=t.enums===String?u.tensorflow.magenta.NoteSequence.KeySignature.Key[e.key]:e.key),null!=e.mode&&e.hasOwnProperty("mode")&&(n.mode=t.enums===String?u.tensorflow.magenta.NoteSequence.KeySignature.Mode[e.mode]:e.mode),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e.Key=function(){var e={},t=Object.create(e);return t[e[0]="C"]=0,t[e[1]="C_SHARP"]=1,t.D_FLAT=1,t[e[2]="D"]=2,t[e[3]="D_SHARP"]=3,t.E_FLAT=3,t[e[4]="E"]=4,t[e[5]="F"]=5,t[e[6]="F_SHARP"]=6,t.G_FLAT=6,t[e[7]="G"]=7,t[e[8]="G_SHARP"]=8,t.A_FLAT=8,t[e[9]="A"]=9,t[e[10]="A_SHARP"]=10,t.B_FLAT=10,t[e[11]="B"]=11,t}(),e.Mode=function(){var e={},t=Object.create(e);return t[e[0]="MAJOR"]=0,t[e[1]="MINOR"]=1,t[e[2]="NOT_SPECIFIED"]=2,t[e[3]="MIXOLYDIAN"]=3,t[e[4]="DORIAN"]=4,t[e[5]="PHRYGIAN"]=5,t[e[6]="LYDIAN"]=6,t[e[7]="LOCRIAN"]=7,t}(),e}(),e.Tempo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.qpm=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.qpm&&e.hasOwnProperty("qpm")&&t.uint32(17).double(e.qpm),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.Tempo;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.time=e.double();break;case 2:r.qpm=e.double();break;default:e.skipType(7&o)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.qpm&&e.hasOwnProperty("qpm")&&"number"!=typeof e.qpm?"qpm: number expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.Tempo)return e;var t=new u.tensorflow.magenta.NoteSequence.Tempo;return null!=e.time&&(t.time=Number(e.time)),null!=e.qpm&&(t.qpm=Number(e.qpm)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.qpm=0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.qpm&&e.hasOwnProperty("qpm")&&(n.qpm=t.json&&!isFinite(e.qpm)?String(e.qpm):e.qpm),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),e.PitchBend=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.bend=0,e.prototype.instrument=0,e.prototype.program=0,e.prototype.isDrum=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.bend&&e.hasOwnProperty("bend")&&t.uint32(16).int32(e.bend),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(24).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(32).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(40).bool(e.isDrum),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.PitchBend;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.time=e.double();break;case 2:r.bend=e.int32();break;case 3:r.instrument=e.int32();break;case 4:r.program=e.int32();break;case 5:r.isDrum=e.bool();break;default:e.skipType(7&o)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.bend&&e.hasOwnProperty("bend")&&!c.isInteger(e.bend)?"bend: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!c.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!c.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!=typeof e.isDrum?"isDrum: boolean expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.PitchBend)return e;var t=new u.tensorflow.magenta.NoteSequence.PitchBend;return null!=e.time&&(t.time=Number(e.time)),null!=e.bend&&(t.bend=0|e.bend),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.bend=0,n.instrument=0,n.program=0,n.isDrum=!1),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.bend&&e.hasOwnProperty("bend")&&(n.bend=e.bend),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),e.ControlChange=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.quantizedStep=c.Long?c.Long.fromBits(0,0,!1):0,e.prototype.controlNumber=0,e.prototype.controlValue=0,e.prototype.instrument=0,e.prototype.program=0,e.prototype.isDrum=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&t.uint32(16).int32(e.controlNumber),null!=e.controlValue&&e.hasOwnProperty("controlValue")&&t.uint32(24).int32(e.controlValue),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(32).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(40).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(48).bool(e.isDrum),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&t.uint32(56).int64(e.quantizedStep),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.ControlChange;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.time=e.double();break;case 7:r.quantizedStep=c.Long?e.int64().toNumber():e.int64();break;case 2:r.controlNumber=e.int32();break;case 3:r.controlValue=e.int32();break;case 4:r.instrument=e.int32();break;case 5:r.program=e.int32();break;case 6:r.isDrum=e.bool();break;default:e.skipType(7&o)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&!(c.isInteger(e.quantizedStep)||e.quantizedStep&&c.isInteger(e.quantizedStep.low)&&c.isInteger(e.quantizedStep.high))?"quantizedStep: integer|Long expected":null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&!c.isInteger(e.controlNumber)?"controlNumber: integer expected":null!=e.controlValue&&e.hasOwnProperty("controlValue")&&!c.isInteger(e.controlValue)?"controlValue: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!c.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!c.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!=typeof e.isDrum?"isDrum: boolean expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.ControlChange)return e;var t=new u.tensorflow.magenta.NoteSequence.ControlChange;return null!=e.time&&(t.time=Number(e.time)),null!=e.quantizedStep&&(c.Long?(t.quantizedStep=c.Long.fromValue(e.quantizedStep)).unsigned=!1:"string"==typeof e.quantizedStep?t.quantizedStep=parseInt(e.quantizedStep,10):"number"==typeof e.quantizedStep?t.quantizedStep=e.quantizedStep:"object"==typeof e.quantizedStep&&(t.quantizedStep=new c.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber())),null!=e.controlNumber&&(t.controlNumber=0|e.controlNumber),null!=e.controlValue&&(t.controlValue=0|e.controlValue),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,n.controlNumber=0,n.controlValue=0,n.instrument=0,n.program=0,n.isDrum=!1,c.Long){var r=new c.Long(0,0,!1);n.quantizedStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedStep=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&(n.controlNumber=e.controlNumber),null!=e.controlValue&&e.hasOwnProperty("controlValue")&&(n.controlValue=e.controlValue),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&("number"==typeof e.quantizedStep?n.quantizedStep=t.longs===String?String(e.quantizedStep):e.quantizedStep:n.quantizedStep=t.longs===String?c.Long.prototype.toString.call(e.quantizedStep):t.longs===Number?new c.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber():e.quantizedStep),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),e.PartInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.part=0,e.prototype.name="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.part&&e.hasOwnProperty("part")&&t.uint32(8).int32(e.part),null!=e.name&&e.hasOwnProperty("name")&&t.uint32(18).string(e.name),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.PartInfo;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.part=e.int32();break;case 2:r.name=e.string();break;default:e.skipType(7&o)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.part&&e.hasOwnProperty("part")&&!c.isInteger(e.part)?"part: integer expected":null!=e.name&&e.hasOwnProperty("name")&&!c.isString(e.name)?"name: string expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.PartInfo)return e;var t=new u.tensorflow.magenta.NoteSequence.PartInfo;return null!=e.part&&(t.part=0|e.part),null!=e.name&&(t.name=String(e.name)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.part=0,n.name=""),null!=e.part&&e.hasOwnProperty("part")&&(n.part=e.part),null!=e.name&&e.hasOwnProperty("name")&&(n.name=e.name),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),e.SourceInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sourceType=0,e.prototype.encodingType=0,e.prototype.parser=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.sourceType&&e.hasOwnProperty("sourceType")&&t.uint32(8).int32(e.sourceType),null!=e.encodingType&&e.hasOwnProperty("encodingType")&&t.uint32(16).int32(e.encodingType),null!=e.parser&&e.hasOwnProperty("parser")&&t.uint32(24).int32(e.parser),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.SourceInfo;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.sourceType=e.int32();break;case 2:r.encodingType=e.int32();break;case 3:r.parser=e.int32();break;default:e.skipType(7&o)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.sourceType&&e.hasOwnProperty("sourceType"))switch(e.sourceType){default:return"sourceType: enum value expected";case 0:case 1:case 2:}if(null!=e.encodingType&&e.hasOwnProperty("encodingType"))switch(e.encodingType){default:return"encodingType: enum value expected";case 0:case 1:case 2:case 3:case 4:}if(null!=e.parser&&e.hasOwnProperty("parser"))switch(e.parser){default:return"parser: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:}return null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.SourceInfo)return e;var t=new u.tensorflow.magenta.NoteSequence.SourceInfo;switch(e.sourceType){case"UNKNOWN_SOURCE_TYPE":case 0:t.sourceType=0;break;case"SCORE_BASED":case 1:t.sourceType=1;break;case"PERFORMANCE_BASED":case 2:t.sourceType=2}switch(e.encodingType){case"UNKNOWN_ENCODING_TYPE":case 0:t.encodingType=0;break;case"MUSIC_XML":case 1:t.encodingType=1;break;case"ABC":case 2:t.encodingType=2;break;case"MIDI":case 3:t.encodingType=3;break;case"MUSICNET":case 4:t.encodingType=4}switch(e.parser){case"UNKNOWN_PARSER":case 0:t.parser=0;break;case"MUSIC21":case 1:t.parser=1;break;case"PRETTY_MIDI":case 2:t.parser=2;break;case"MAGENTA_MUSIC_XML":case 3:t.parser=3;break;case"MAGENTA_MUSICNET":case 4:t.parser=4;break;case"MAGENTA_ABC":case 5:t.parser=5;break;case"TONEJS_MIDI_CONVERT":case 6:t.parser=6}return t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.sourceType=t.enums===String?"UNKNOWN_SOURCE_TYPE":0,n.encodingType=t.enums===String?"UNKNOWN_ENCODING_TYPE":0,n.parser=t.enums===String?"UNKNOWN_PARSER":0),null!=e.sourceType&&e.hasOwnProperty("sourceType")&&(n.sourceType=t.enums===String?u.tensorflow.magenta.NoteSequence.SourceInfo.SourceType[e.sourceType]:e.sourceType),null!=e.encodingType&&e.hasOwnProperty("encodingType")&&(n.encodingType=t.enums===String?u.tensorflow.magenta.NoteSequence.SourceInfo.EncodingType[e.encodingType]:e.encodingType),null!=e.parser&&e.hasOwnProperty("parser")&&(n.parser=t.enums===String?u.tensorflow.magenta.NoteSequence.SourceInfo.Parser[e.parser]:e.parser),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e.SourceType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_SOURCE_TYPE"]=0,t[e[1]="SCORE_BASED"]=1,t[e[2]="PERFORMANCE_BASED"]=2,t}(),e.EncodingType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_ENCODING_TYPE"]=0,t[e[1]="MUSIC_XML"]=1,t[e[2]="ABC"]=2,t[e[3]="MIDI"]=3,t[e[4]="MUSICNET"]=4,t}(),e.Parser=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_PARSER"]=0,t[e[1]="MUSIC21"]=1,t[e[2]="PRETTY_MIDI"]=2,t[e[3]="MAGENTA_MUSIC_XML"]=3,t[e[4]="MAGENTA_MUSICNET"]=4,t[e[5]="MAGENTA_ABC"]=5,t[e[6]="TONEJS_MIDI_CONVERT"]=6,t}(),e}(),e.TextAnnotation=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.quantizedStep=c.Long?c.Long.fromBits(0,0,!1):0,e.prototype.text="",e.prototype.annotationType=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.text&&e.hasOwnProperty("text")&&t.uint32(18).string(e.text),null!=e.annotationType&&e.hasOwnProperty("annotationType")&&t.uint32(24).int32(e.annotationType),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&t.uint32(32).int64(e.quantizedStep),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.TextAnnotation;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.time=e.double();break;case 4:r.quantizedStep=c.Long?e.int64().toNumber():e.int64();break;case 2:r.text=e.string();break;case 3:r.annotationType=e.int32();break;default:e.skipType(7&o)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time)return"time: number expected";if(null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&!(c.isInteger(e.quantizedStep)||e.quantizedStep&&c.isInteger(e.quantizedStep.low)&&c.isInteger(e.quantizedStep.high)))return"quantizedStep: integer|Long expected";if(null!=e.text&&e.hasOwnProperty("text")&&!c.isString(e.text))return"text: string expected";if(null!=e.annotationType&&e.hasOwnProperty("annotationType"))switch(e.annotationType){default:return"annotationType: enum value expected";case 0:case 1:case 2:}return null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.TextAnnotation)return e;var t=new u.tensorflow.magenta.NoteSequence.TextAnnotation;switch(null!=e.time&&(t.time=Number(e.time)),null!=e.quantizedStep&&(c.Long?(t.quantizedStep=c.Long.fromValue(e.quantizedStep)).unsigned=!1:"string"==typeof e.quantizedStep?t.quantizedStep=parseInt(e.quantizedStep,10):"number"==typeof e.quantizedStep?t.quantizedStep=e.quantizedStep:"object"==typeof e.quantizedStep&&(t.quantizedStep=new c.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber())),null!=e.text&&(t.text=String(e.text)),e.annotationType){case"UNKNOWN":case 0:t.annotationType=0;break;case"CHORD_SYMBOL":case 1:t.annotationType=1;break;case"BEAT":case 2:t.annotationType=2}return t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,n.text="",n.annotationType=t.enums===String?"UNKNOWN":0,c.Long){var r=new c.Long(0,0,!1);n.quantizedStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedStep=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.text&&e.hasOwnProperty("text")&&(n.text=e.text),null!=e.annotationType&&e.hasOwnProperty("annotationType")&&(n.annotationType=t.enums===String?u.tensorflow.magenta.NoteSequence.TextAnnotation.TextAnnotationType[e.annotationType]:e.annotationType),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&("number"==typeof e.quantizedStep?n.quantizedStep=t.longs===String?String(e.quantizedStep):e.quantizedStep:n.quantizedStep=t.longs===String?c.Long.prototype.toString.call(e.quantizedStep):t.longs===Number?new c.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber():e.quantizedStep),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e.TextAnnotationType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN"]=0,t[e[1]="CHORD_SYMBOL"]=1,t[e[2]="BEAT"]=2,t}(),e}(),e.QuantizationInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.stepsPerQuarter=0,e.prototype.stepsPerSecond=0,Object.defineProperty(e.prototype,"resolution",{get:c.oneOfGetter(t=["stepsPerQuarter","stepsPerSecond"]),set:c.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&t.uint32(8).int32(e.stepsPerQuarter),null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")&&t.uint32(16).int32(e.stepsPerSecond),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.QuantizationInfo;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.stepsPerQuarter=e.int32();break;case 2:r.stepsPerSecond=e.int32();break;default:e.skipType(7&o)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t={};if(null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&(t.resolution=1,!c.isInteger(e.stepsPerQuarter)))return"stepsPerQuarter: integer expected";if(null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")){if(1===t.resolution)return"resolution: multiple values";if(t.resolution=1,!c.isInteger(e.stepsPerSecond))return"stepsPerSecond: integer expected"}return null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.QuantizationInfo)return e;var t=new u.tensorflow.magenta.NoteSequence.QuantizationInfo;return null!=e.stepsPerQuarter&&(t.stepsPerQuarter=0|e.stepsPerQuarter),null!=e.stepsPerSecond&&(t.stepsPerSecond=0|e.stepsPerSecond),t},e.toObject=function(e,t){t||(t={});var n={};return null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&(n.stepsPerQuarter=e.stepsPerQuarter,t.oneofs&&(n.resolution="stepsPerQuarter")),null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")&&(n.stepsPerSecond=e.stepsPerSecond,t.oneofs&&(n.resolution="stepsPerSecond")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),e.SubsequenceInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.startTimeOffset=0,e.prototype.endTimeOffset=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&t.uint32(9).double(e.startTimeOffset),null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&t.uint32(17).double(e.endTimeOffset),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.SubsequenceInfo;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.startTimeOffset=e.double();break;case 2:r.endTimeOffset=e.double();break;default:e.skipType(7&o)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&"number"!=typeof e.startTimeOffset?"startTimeOffset: number expected":null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&"number"!=typeof e.endTimeOffset?"endTimeOffset: number expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.SubsequenceInfo)return e;var t=new u.tensorflow.magenta.NoteSequence.SubsequenceInfo;return null!=e.startTimeOffset&&(t.startTimeOffset=Number(e.startTimeOffset)),null!=e.endTimeOffset&&(t.endTimeOffset=Number(e.endTimeOffset)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.startTimeOffset=0,n.endTimeOffset=0),null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&(n.startTimeOffset=t.json&&!isFinite(e.startTimeOffset)?String(e.startTimeOffset):e.startTimeOffset),null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&(n.endTimeOffset=t.json&&!isFinite(e.endTimeOffset)?String(e.endTimeOffset):e.endTimeOffset),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),e.SectionAnnotation=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.sectionId=c.Long?c.Long.fromBits(0,0,!1):0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&t.uint32(32).int64(e.sectionId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.SectionAnnotation;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.time=e.double();break;case 4:r.sectionId=c.Long?e.int64().toNumber():e.int64();break;default:e.skipType(7&o)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!=typeof e.time?"time: number expected":null!=e.sectionId&&e.hasOwnProperty("sectionId")&&!(c.isInteger(e.sectionId)||e.sectionId&&c.isInteger(e.sectionId.low)&&c.isInteger(e.sectionId.high))?"sectionId: integer|Long expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.SectionAnnotation)return e;var t=new u.tensorflow.magenta.NoteSequence.SectionAnnotation;return null!=e.time&&(t.time=Number(e.time)),null!=e.sectionId&&(c.Long?(t.sectionId=c.Long.fromValue(e.sectionId)).unsigned=!1:"string"==typeof e.sectionId?t.sectionId=parseInt(e.sectionId,10):"number"==typeof e.sectionId?t.sectionId=e.sectionId:"object"==typeof e.sectionId&&(t.sectionId=new c.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber())),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,c.Long){var r=new c.Long(0,0,!1);n.sectionId=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.sectionId=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&("number"==typeof e.sectionId?n.sectionId=t.longs===String?String(e.sectionId):e.sectionId:n.sectionId=t.longs===String?c.Long.prototype.toString.call(e.sectionId):t.longs===Number?new c.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber():e.sectionId),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),e.Section=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.sectionId=c.Long?c.Long.fromBits(0,0,!1):0,e.prototype.sectionGroup=null,Object.defineProperty(e.prototype,"sectionType",{get:c.oneOfGetter(t=["sectionId","sectionGroup"]),set:c.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&t.uint32(8).int64(e.sectionId),null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")&&u.tensorflow.magenta.NoteSequence.SectionGroup.encode(e.sectionGroup,t.uint32(18).fork()).ldelim(),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.Section;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.sectionId=c.Long?e.int64().toNumber():e.int64();break;case 2:r.sectionGroup=u.tensorflow.magenta.NoteSequence.SectionGroup.decode(e,e.uint32());break;default:e.skipType(7&o)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";var t={};if(null!=e.sectionId&&e.hasOwnProperty("sectionId")&&(t.sectionType=1,!(c.isInteger(e.sectionId)||e.sectionId&&c.isInteger(e.sectionId.low)&&c.isInteger(e.sectionId.high))))return"sectionId: integer|Long expected";if(null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")){if(1===t.sectionType)return"sectionType: multiple values";t.sectionType=1;var n=u.tensorflow.magenta.NoteSequence.SectionGroup.verify(e.sectionGroup);if(n)return"sectionGroup."+n}return null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.Section)return e;var t=new u.tensorflow.magenta.NoteSequence.Section;if(null!=e.sectionId&&(c.Long?(t.sectionId=c.Long.fromValue(e.sectionId)).unsigned=!1:"string"==typeof e.sectionId?t.sectionId=parseInt(e.sectionId,10):"number"==typeof e.sectionId?t.sectionId=e.sectionId:"object"==typeof e.sectionId&&(t.sectionId=new c.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber())),null!=e.sectionGroup){if("object"!=typeof e.sectionGroup)throw TypeError(".tensorflow.magenta.NoteSequence.Section.sectionGroup: object expected");t.sectionGroup=u.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(e.sectionGroup)}return t},e.toObject=function(e,t){t||(t={});var n={};return null!=e.sectionId&&e.hasOwnProperty("sectionId")&&("number"==typeof e.sectionId?n.sectionId=t.longs===String?String(e.sectionId):e.sectionId:n.sectionId=t.longs===String?c.Long.prototype.toString.call(e.sectionId):t.longs===Number?new c.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber():e.sectionId,t.oneofs&&(n.sectionType="sectionId")),null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")&&(n.sectionGroup=u.tensorflow.magenta.NoteSequence.SectionGroup.toObject(e.sectionGroup,t),t.oneofs&&(n.sectionType="sectionGroup")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),e.SectionGroup=function(){function e(e){if(this.sections=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sections=c.emptyArray,e.prototype.numTimes=0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=a.create()),null!=e.sections&&e.sections.length)for(var n=0;n<e.sections.length;++n)u.tensorflow.magenta.NoteSequence.Section.encode(e.sections[n],t.uint32(10).fork()).ldelim();return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&t.uint32(16).int32(e.numTimes),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.NoteSequence.SectionGroup;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.sections&&r.sections.length||(r.sections=[]),r.sections.push(u.tensorflow.magenta.NoteSequence.Section.decode(e,e.uint32()));break;case 2:r.numTimes=e.int32();break;default:e.skipType(7&o)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.sections&&e.hasOwnProperty("sections")){if(!Array.isArray(e.sections))return"sections: array expected";for(var t=0;t<e.sections.length;++t){var n=u.tensorflow.magenta.NoteSequence.Section.verify(e.sections[t]);if(n)return"sections."+n}}return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&!c.isInteger(e.numTimes)?"numTimes: integer expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.NoteSequence.SectionGroup)return e;var t=new u.tensorflow.magenta.NoteSequence.SectionGroup;if(e.sections){if(!Array.isArray(e.sections))throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: array expected");t.sections=[];for(var n=0;n<e.sections.length;++n){if("object"!=typeof e.sections[n])throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: object expected");t.sections[n]=u.tensorflow.magenta.NoteSequence.Section.fromObject(e.sections[n])}}return null!=e.numTimes&&(t.numTimes=0|e.numTimes),t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.sections=[]),t.defaults&&(n.numTimes=0),e.sections&&e.sections.length){n.sections=[];for(var r=0;r<e.sections.length;++r)n.sections[r]=u.tensorflow.magenta.NoteSequence.Section.toObject(e.sections[r],t)}return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&(n.numTimes=e.numTimes),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),e}(),r.SequenceMetadata=function(){function e(e){if(this.genre=[],this.composers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.title="",e.prototype.artist="",e.prototype.genre=c.emptyArray,e.prototype.composers=c.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=a.create()),null!=e.title&&e.hasOwnProperty("title")&&t.uint32(10).string(e.title),null!=e.artist&&e.hasOwnProperty("artist")&&t.uint32(18).string(e.artist),null!=e.genre&&e.genre.length)for(var n=0;n<e.genre.length;++n)t.uint32(26).string(e.genre[n]);if(null!=e.composers&&e.composers.length)for(n=0;n<e.composers.length;++n)t.uint32(34).string(e.composers[n]);return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.SequenceMetadata;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.title=e.string();break;case 2:r.artist=e.string();break;case 3:r.genre&&r.genre.length||(r.genre=[]),r.genre.push(e.string());break;case 4:r.composers&&r.composers.length||(r.composers=[]),r.composers.push(e.string());break;default:e.skipType(7&o)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!=typeof e||null===e)return"object expected";if(null!=e.title&&e.hasOwnProperty("title")&&!c.isString(e.title))return"title: string expected";if(null!=e.artist&&e.hasOwnProperty("artist")&&!c.isString(e.artist))return"artist: string expected";if(null!=e.genre&&e.hasOwnProperty("genre")){if(!Array.isArray(e.genre))return"genre: array expected";for(var t=0;t<e.genre.length;++t)if(!c.isString(e.genre[t]))return"genre: string[] expected"}if(null!=e.composers&&e.hasOwnProperty("composers")){if(!Array.isArray(e.composers))return"composers: array expected";for(t=0;t<e.composers.length;++t)if(!c.isString(e.composers[t]))return"composers: string[] expected"}return null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.SequenceMetadata)return e;var t=new u.tensorflow.magenta.SequenceMetadata;if(null!=e.title&&(t.title=String(e.title)),null!=e.artist&&(t.artist=String(e.artist)),e.genre){if(!Array.isArray(e.genre))throw TypeError(".tensorflow.magenta.SequenceMetadata.genre: array expected");t.genre=[];for(var n=0;n<e.genre.length;++n)t.genre[n]=String(e.genre[n])}if(e.composers){if(!Array.isArray(e.composers))throw TypeError(".tensorflow.magenta.SequenceMetadata.composers: array expected");for(t.composers=[],n=0;n<e.composers.length;++n)t.composers[n]=String(e.composers[n])}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.genre=[],n.composers=[]),t.defaults&&(n.title="",n.artist=""),null!=e.title&&e.hasOwnProperty("title")&&(n.title=e.title),null!=e.artist&&e.hasOwnProperty("artist")&&(n.artist=e.artist),e.genre&&e.genre.length){n.genre=[];for(var r=0;r<e.genre.length;++r)n.genre[r]=e.genre[r]}if(e.composers&&e.composers.length)for(n.composers=[],r=0;r<e.composers.length;++r)n.composers[r]=e.composers[r];return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),r.VelocityRange=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.min=0,e.prototype.max=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=a.create()),null!=e.min&&e.hasOwnProperty("min")&&t.uint32(8).int32(e.min),null!=e.max&&e.hasOwnProperty("max")&&t.uint32(16).int32(e.max),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof s||(e=s.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new u.tensorflow.magenta.VelocityRange;e.pos<n;){var o=e.uint32();switch(o>>>3){case 1:r.min=e.int32();break;case 2:r.max=e.int32();break;default:e.skipType(7&o)}}return r},e.decodeDelimited=function(e){return e instanceof s||(e=new s(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=typeof e||null===e?"object expected":null!=e.min&&e.hasOwnProperty("min")&&!c.isInteger(e.min)?"min: integer expected":null!=e.max&&e.hasOwnProperty("max")&&!c.isInteger(e.max)?"max: integer expected":null},e.fromObject=function(e){if(e instanceof u.tensorflow.magenta.VelocityRange)return e;var t=new u.tensorflow.magenta.VelocityRange;return null!=e.min&&(t.min=0|e.min),null!=e.max&&(t.max=0|e.max),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.min=0,n.max=0),null!=e.min&&e.hasOwnProperty("min")&&(n.min=e.min),null!=e.max&&e.hasOwnProperty("max")&&(n.max=e.max),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,i.util.toJSONOptions)},e}(),r),o),e.exports=u},function(e,t,n){"use strict";n.r(t),n.d(t,"ChordQuality",(function(){return a})),n.d(t,"ChordSymbolException",(function(){return c})),n.d(t,"ChordEncodingException",(function(){return u})),n.d(t,"ChordSymbols",(function(){return l})),n.d(t,"ChordEncoder",(function(){return p})),n.d(t,"chordEncoderFromType",(function(){return h})),n.d(t,"MajorMinorChordEncoder",(function(){return m})),n.d(t,"TriadChordEncoder",(function(){return d})),n.d(t,"PitchChordEncoder",(function(){return f}));var r=n(0),o=n(9),i=n(1);const s=[["1P","3M","5P"],["1P","3m","5P"],["1P","3M","5A"],["1P","3m","5d"]];var a;!function(e){e[e.Major=0]="Major",e[e.Minor=1]="Minor",e[e.Augmented=2]="Augmented",e[e.Diminished=3]="Diminished",e[e.Other=4]="Other"}(a||(a={}));class c extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class u extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}class l{static pitches(e){if(!o.Chord.tokenize(e)[0]||!o.Chord.exists(e))throw new c("Unrecognized chord symbol: "+e);return o.Chord.notes(e).map(o.Note.chroma)}static root(e){const t=o.Chord.tokenize(e)[0];if(!t)throw new c("Chord symbol has unknown root: "+e);return o.Note.chroma(t)}static quality(e){if(!o.Chord.exists(e))throw new c("Unrecognized chord symbol: "+e);const t=o.Chord.intervals(e),n=s.map(e=>e.every(e=>t.includes(e))),r=n.indexOf(!0),i=n.lastIndexOf(!0);return r>=0&&r===i?r:a.Other}}class p{encodeProgression(e,t){const n=e.map(e=>this.encode(e)),o=Array.from(Array(t).keys()).map(e=>Math.floor(e*n.length/t));return r.stack(o.map(e=>n[e]))}}function h(e){switch(e){case"MajorMinorChordEncoder":return new m;case"TriadChordEncoder":return new d;case"PitchChordEncoder":return new f;default:throw new Error("Unknown chord encoder type: "+e)}}class m extends p{constructor(){super(...arguments),this.depth=1+2*i.NUM_PITCH_CLASSES}index(e){if(e===i.NO_CHORD)return 0;const t=l.root(e),n=1+l.quality(e)*i.NUM_PITCH_CLASSES+t;if(n>=this.depth)throw new u("Chord is neither major nor minor: "+e);return n}encode(e){return r.tidy(()=>r.oneHot(r.tensor1d([this.index(e)],"int32"),this.depth).as1D())}}class d extends p{constructor(){super(...arguments),this.depth=1+4*i.NUM_PITCH_CLASSES}index(e){if(e===i.NO_CHORD)return 0;const t=l.root(e),n=1+l.quality(e)*i.NUM_PITCH_CLASSES+t;if(n>=this.depth)throw new u("Chord is not a standard triad: "+e);return n}encode(e){return r.tidy(()=>r.oneHot(r.tensor1d([this.index(e)],"int32"),this.depth).as1D())}}class f extends p{constructor(){super(...arguments),this.depth=1+3*i.NUM_PITCH_CLASSES}encode(e){return r.tidy(()=>{if(e===i.NO_CHORD)return r.oneHot(r.tensor1d([0],"int32"),this.depth).as1D();const t=l.root(e),n=r.oneHot(r.tensor1d([t],"int32"),i.NUM_PITCH_CLASSES).as1D(),o=r.buffer([i.NUM_PITCH_CLASSES]);l.pitches(e).forEach(e=>o.set(1,e));const s=o.toTensor().as1D(),a=n;return r.concat1d([r.tensor1d([0]),n,s,a])})}}},function(e,t,n){"use strict";n.r(t),n.d(t,"converterFromSpec",(function(){return l})),n.d(t,"DataConverter",(function(){return p})),n.d(t,"DrumsConverter",(function(){return h})),n.d(t,"DrumRollConverter",(function(){return m})),n.d(t,"DrumsOneHotConverter",(function(){return d})),n.d(t,"MelodyConverter",(function(){return f})),n.d(t,"MelodyRhythmConverter",(function(){return S})),n.d(t,"MelodyShapeConverter",(function(){return y})),n.d(t,"TrioConverter",(function(){return w})),n.d(t,"TrioRhythmConverter",(function(){return N})),n.d(t,"MultitrackConverter",(function(){return b})),n.d(t,"GrooveConverter",(function(){return T}));var r=n(0),o=n(3),i=n(1);n.d(t,"DEFAULT_DRUM_PITCH_CLASSES",(function(){return i.DEFAULT_DRUM_PITCH_CLASSES}));var s=n(4),a=n(10),c=n(12),u=n(5);function l(e){switch(e.type){case"MelodyConverter":return new f(e.args);case"MelodyRhythmConverter":return new S(e.args);case"MelodyShapeConverter":return new y(e.args);case"DrumsConverter":return new h(e.args);case"DrumRollConverter":return new m(e.args);case"TrioConverter":return new w(e.args);case"TrioRhythmConverter":return new N(e.args);case"DrumsOneHotConverter":return new d(e.args);case"MultitrackConverter":return new b(e.args);case"GrooveConverter":return new T(e.args);default:throw new Error("Unknown DataConverter type: "+e)}}class p{constructor(e){this.NUM_SPLITS=0,this.SEGMENTED_BY_TRACK=!1,this.numSteps=e.numSteps,this.numSegments=e.numSegments}tensorSteps(e){return r.scalar(e.shape[0],"int32")}}class h extends p{constructor(e){super(e),this.pitchClasses=e.pitchClasses||i.DEFAULT_DRUM_PITCH_CLASSES,this.pitchToClass=new Map;for(let e=0;e<this.pitchClasses.length;++e)this.pitchClasses[e].forEach(t=>{this.pitchToClass.set(t,e)});this.depth=this.pitchClasses.length+1}toTensor(e){u.assertIsQuantizedSequence(e);const t=this.numSteps||e.totalQuantizedSteps,n=r.buffer([t,this.pitchClasses.length+1],"int32");for(let e=0;e<t;++e)n.set(1,e,-1);return e.notes.forEach(e=>{n.set(1,e.quantizedStartStep,this.pitchToClass.get(e.pitch)),n.set(0,e.quantizedStartStep,-1)}),n.toTensor()}async toNoteSequence(e,t,n){const r=u.createQuantizedNoteSequence(t,n),i=e.argMax(1),s=await i.data();i.dispose();for(let e=0;e<s.length;++e)for(let t=0;t<this.pitchClasses.length;t++)s[e]>>t&1&&r.notes.push(o.a.Note.create({pitch:this.pitchClasses[t][0],quantizedStartStep:e,quantizedEndStep:e+1,isDrum:!0}));return r.totalQuantizedSteps=s.length,r}}class m extends h{async toNoteSequence(e,t,n){const r=u.createQuantizedNoteSequence(t,n),i=await e.data();for(let t=0;t<e.shape[0];++t){const e=i.slice(t*this.pitchClasses.length,(t+1)*this.pitchClasses.length);for(let n=0;n<e.length;++n)e[n]&&r.notes.push(o.a.Note.create({pitch:this.pitchClasses[n][0],quantizedStartStep:t,quantizedEndStep:t+1,isDrum:!0}))}return r.totalQuantizedSteps=e.shape[0],r}}class d extends h{constructor(e){super(e),this.depth=Math.pow(2,this.pitchClasses.length)}toTensor(e){u.assertIsRelativeQuantizedSequence(e);const t=this.numSteps||e.totalQuantizedSteps,n=Array(t).fill(0);for(const{pitch:t,quantizedStartStep:r}of e.notes)n[r]+=Math.pow(2,this.pitchToClass.get(t));return r.tidy(()=>r.oneHot(r.tensor1d(n,"int32"),this.depth))}}class f extends p{constructor(e){super(e),this.NOTE_OFF=1,this.FIRST_PITCH=2,this.minPitch=e.minPitch,this.maxPitch=e.maxPitch,this.ignorePolyphony=e.ignorePolyphony,this.depth=e.maxPitch-e.minPitch+1+this.FIRST_PITCH}toTensor(e){const t=a.Melody.fromNoteSequence(e,this.minPitch,this.maxPitch,this.ignorePolyphony,this.numSteps);return r.tidy(()=>r.oneHot(r.tensor(t.events,[t.events.length],"int32"),this.depth))}async toNoteSequence(e,t,n){const r=e.argMax(1),o=await r.data();r.dispose();return new a.Melody(o,this.minPitch,this.maxPitch).toNoteSequence(t,n)}}class g extends p{constructor(e,t){super(e),this.minPitch=e.minPitch,this.maxPitch=e.maxPitch,this.ignorePolyphony=e.ignorePolyphony,this.melodyControl=t,this.depth=t.depth}toTensor(e){const t=a.Melody.fromNoteSequence(e,this.minPitch,this.maxPitch,this.ignorePolyphony,this.numSteps);return this.melodyControl.extract(t)}}class S extends g{constructor(e){super(e,new a.MelodyRhythm)}async toNoteSequence(e,t,n){const r=u.createQuantizedNoteSequence(t,n),s=await e.data();for(let e=0;e<s.length;++e)s[e]&&r.notes.push(o.a.Note.create({pitch:i.DEFAULT_DRUM_PITCH_CLASSES[1][0],quantizedStartStep:e,quantizedEndStep:e+1,isDrum:!0}));return r.totalQuantizedSteps=s.length,r}}class y extends g{constructor(e){super(e,new a.MelodyShape)}async toNoteSequence(e,t,n){const r=u.createQuantizedNoteSequence(t,n),i=e.argMax(1),a=await i.data();i.dispose();let c=Math.round((this.maxPitch+this.minPitch)/2);for(let e=0;e<a.length;++e){switch(a[e]){case 0:c-=1,c<this.minPitch&&(c=this.minPitch,s.log("Pitch range exceeded when creating NoteSequence from shape.","MelodyShapeConverter"));break;case 2:c+=1,c>this.maxPitch&&(c=this.maxPitch,s.log("Pitch range exceeded when creating NoteSequence from shape.","MelodyShapeConverter"))}r.notes.push(o.a.Note.create({pitch:c,quantizedStartStep:e,quantizedEndStep:e+1}))}return r.totalQuantizedSteps=a.length,r}}class w extends p{constructor(e){super(e),this.NUM_SPLITS=3,this.MEL_PROG_RANGE=[0,31],this.BASS_PROG_RANGE=[32,39],e.melArgs.numSteps=e.numSteps,e.bassArgs.numSteps=e.numSteps,e.drumsArgs.numSteps=e.numSteps,this.melConverter=new f(e.melArgs),this.bassConverter=new f(e.bassArgs),this.drumsConverter=new d(e.drumsArgs),this.depth=this.melConverter.depth+this.bassConverter.depth+this.drumsConverter.depth}toTensor(e){u.assertIsQuantizedSequence(e);const t=u.clone(e),n=u.clone(e),o=u.clone(e);return t.notes=e.notes.filter(e=>!e.isDrum&&e.program>=this.MEL_PROG_RANGE[0]&&e.program<=this.MEL_PROG_RANGE[1]),n.notes=e.notes.filter(e=>!e.isDrum&&e.program>=this.BASS_PROG_RANGE[0]&&e.program<=this.BASS_PROG_RANGE[1]),o.notes=e.notes.filter(e=>e.isDrum),r.tidy(()=>r.concat([this.melConverter.toTensor(t),this.bassConverter.toTensor(n),this.drumsConverter.toTensor(o)],-1))}async toNoteSequence(e,t,n){const o=r.split(e,[this.melConverter.depth,this.bassConverter.depth,this.drumsConverter.depth],-1),i=await this.melConverter.toNoteSequence(o[0],t,n);i.notes.forEach(e=>{e.instrument=0,e.program=0});const s=await this.bassConverter.toNoteSequence(o[1],t,n);i.notes.push(...s.notes.map(e=>(e.instrument=1,e.program=this.BASS_PROG_RANGE[0],e)));const a=await this.drumsConverter.toNoteSequence(o[2],t,n);return i.notes.push(...a.notes.map(e=>(e.instrument=2,e))),o.forEach(e=>e.dispose()),i}}class N extends p{constructor(e){super(e),this.NUM_SPLITS=3,this.trioConverter=new w(e),this.depth=3}toTensor(e){return r.tidy(()=>{const t=this.trioConverter.toTensor(e),n=r.split(t,[this.trioConverter.melConverter.depth,this.trioConverter.bassConverter.depth,this.trioConverter.drumsConverter.depth],1),o=r.argMax(n[0],1),i=r.argMax(n[1],1),s=r.argMax(n[2],1),a=r.greater(o,1),c=r.greater(i,1),u=r.greater(s,0);return r.stack([a,c,u],1)})}async toNoteSequence(e,t,n){const s=r.split(e,3,1),a=await Promise.all(s.map(e=>e.data())),c=u.createQuantizedNoteSequence(t,n);for(let e=0;e<this.numSteps;++e)a[0][e]&&c.notes.push(o.a.Note.create({pitch:72,quantizedStartStep:e,quantizedEndStep:e+1,instrument:0,program:0})),a[1][e]&&c.notes.push(o.a.Note.create({pitch:36,quantizedStartStep:e,quantizedEndStep:e+1,instrument:1,program:32})),a[2][e]&&c.notes.push(o.a.Note.create({pitch:i.DEFAULT_DRUM_PITCH_CLASSES[1][0],quantizedStartStep:e,quantizedEndStep:e+1,instrument:2,isDrum:!0}));return c.totalQuantizedSteps=this.numSteps,c}}class b extends p{constructor(e){super(e),this.SEGMENTED_BY_TRACK=!0,this.stepsPerQuarter=e.stepsPerQuarter,this.totalSteps=e.totalSteps,this.numVelocityBins=e.numVelocityBins,this.minPitch=e.minPitch?e.minPitch:i.MIN_MIDI_PITCH,this.maxPitch=e.maxPitch?e.maxPitch:i.MAX_MIDI_PITCH,this.numPitches=this.maxPitch-this.minPitch+1,this.performanceEventDepth=2*this.numPitches+this.totalSteps+this.numVelocityBins,this.numPrograms=i.MAX_MIDI_PROGRAM-i.MIN_MIDI_PROGRAM+2,this.endToken=this.performanceEventDepth+this.numPrograms,this.depth=this.endToken+1,this.endTensor=r.tidy(()=>r.oneHot(r.tensor1d([this.endToken],"int32"),this.depth).as1D())}trackToTensor(e){const t=this.numSteps/this.numSegments;let n=void 0;if(e){for(;e.events.length>t-2;)e.events.pop();n=r.buffer([e.events.length+2],"int32"),n.set(this.performanceEventDepth+(e.isDrum?this.numPrograms-1:e.program),0),e.events.forEach((e,t)=>{switch(e.type){case"note-on":n.set(e.pitch-this.minPitch,t+1);break;case"note-off":n.set(this.numPitches+e.pitch-this.minPitch,t+1);break;case"time-shift":n.set(2*this.numPitches+e.steps-1,t+1);break;case"velocity-change":n.set(2*this.numPitches+this.totalSteps+e.velocityBin-1,t+1);break;default:throw new Error("Unrecognized performance event: "+e)}}),n.set(this.endToken,e.events.length+1)}else n=r.buffer([1],"int32",new Int32Array([this.endToken]));return r.tidy(()=>{const e=r.oneHot(n.toTensor(),this.depth);return e.pad([[0,t-e.shape[0]],[0,0]])})}toTensor(e){if(u.assertIsRelativeQuantizedSequence(e),e.quantizationInfo.stepsPerQuarter!==this.stepsPerQuarter)throw new Error(`Steps per quarter note mismatch: ${e.quantizationInfo.stepsPerQuarter} != ${this.stepsPerQuarter}`);const t=u.clone(e);t.notes=e.notes.filter(e=>e.pitch>=this.minPitch&&e.pitch<=this.maxPitch);const n=new Set(t.notes.map(e=>e.instrument)),o=Array.from(n).map(e=>c.Performance.fromNoteSequence(t,this.totalSteps,this.numVelocityBins,e)).sort((e,t)=>t.isDrum?-1:e.isDrum?1:e.program-t.program);for(;o.length>this.numSegments;)o.pop();for(o.forEach(e=>e.setNumSteps(this.totalSteps));o.length<this.numSegments;)o.push(void 0);return r.tidy(()=>r.concat(o.map(e=>this.trackToTensor(e)),0))}tokensToTrack(e){const t=e.indexOf(this.endToken),n=t>=0?t:e.length,r=e.slice(0,n),o=r.filter(e=>e<this.performanceEventDepth),i=r.filter(e=>e>=this.performanceEventDepth),[s,a]=i.length?i[0]-this.performanceEventDepth<this.numPrograms-1?[i[0]-this.performanceEventDepth,!1]:[0,!0]:[0,!1],u=Array.from(o).map(e=>{if(e<this.numPitches)return{type:"note-on",pitch:this.minPitch+e};if(e<2*this.numPitches)return{type:"note-off",pitch:this.minPitch+e-this.numPitches};if(e<2*this.numPitches+this.totalSteps)return{type:"time-shift",steps:e-2*this.numPitches+1};if(e<2*this.numPitches+this.totalSteps+this.numVelocityBins)return{type:"velocity-change",velocityBin:e-2*this.numPitches-this.totalSteps+1};throw new Error("Invalid performance event token: "+e)});return new c.Performance(u,this.totalSteps,this.numVelocityBins,s,a)}async toNoteSequence(e,t=this.stepsPerQuarter,n){const o=u.createQuantizedNoteSequence(t,n);o.totalQuantizedSteps=this.totalSteps;const i=r.tidy(()=>r.split(e.argMax(1),this.numSegments));return(await Promise.all(i.map(async e=>{const t=await e.data(),n=this.tokensToTrack(t);return e.dispose(),n}))).forEach((e,t)=>{e.setNumSteps(this.totalSteps),o.notes.push(...e.toNoteSequence(t).notes)}),o}}class T extends p{constructor(e){super(e),this.TAPIFY_CHANNEL=3,this.stepsPerQuarter=e.stepsPerQuarter||i.DEFAULT_STEPS_PER_QUARTER,this.pitchClasses=e.pitchClasses||i.DEFAULT_DRUM_PITCH_CLASSES,this.pitchToClass=new Map;for(let e=0;e<this.pitchClasses.length;++e)this.pitchClasses[e].forEach(t=>{this.pitchToClass.set(t,e)});this.humanize=e.humanize||!1,this.tapify=e.tapify||!1,this.splitInstruments=e.splitInstruments||!1,this.depth=3}toTensor(e){const t=u.isRelativeQuantizedSequence(e)?e:u.quantizeNoteSequence(e,this.stepsPerQuarter),n=this.numSteps,o=t.tempos&&t.tempos.length?t.tempos[0].qpm:i.DEFAULT_QUARTERS_PER_MINUTE,s=60/o/this.stepsPerQuarter,a=[];for(let e=0;e<n;++e)a.push(new Map);t.notes.forEach(e=>{if(!this.tapify&&!this.pitchToClass.has(e.pitch))return;const t=e.quantizedStartStep;if(t>=a.length)throw Error(`Model does not support sequences with more than ${n} steps (${n*s} seconds at qpm ${o}).`);const r=this.tapify?this.TAPIFY_CHANNEL:this.pitchToClass.get(e.pitch);(!a[t].has(r)||a[t].get(r).velocity<e.velocity)&&a[t].set(r,e)});const c=this.pitchClasses.length,l=r.buffer([n,c]),p=r.buffer([n,c]),h=r.buffer([n,c]);function m(e){if(void 0===e.startTime)return 0;const t=e.startTime;return 2*(e.quantizedStartStep*s-t)/s}for(let e=0;e<n;++e)for(let t=0;t<c;++t){const n=a[e].get(t);l.set(n?1:0,e,t),this.humanize||this.tapify||p.set(n?n.velocity/i.MAX_MIDI_VELOCITY:0,e,t),this.humanize||h.set(n?m(n):0,e,t)}return r.tidy(()=>{const e=l.toTensor(),t=p.toTensor(),o=h.toTensor(),i=this.splitInstruments?n*c:n;return r.concat([e.as2D(i,-1),t.as2D(i,-1),o.as2D(i,-1)],1)})}async toNoteSequence(e,t,n=i.DEFAULT_QUARTERS_PER_MINUTE){if(t&&t!==this.stepsPerQuarter)throw Error("`stepsPerQuarter` is set by the model.");t=this.stepsPerQuarter;const r=this.splitInstruments?e.shape[0]/this.pitchClasses.length:e.shape[0],s=60/n/this.stepsPerQuarter,a=o.a.create({totalTime:r*s,tempos:[{qpm:n}]}),c=await e.data();function u(e,t,n){return Math.min(Math.max(e,t),n)}const l=this.pitchClasses.length;for(let e=0;e<r;++e){const t=c.slice(e*l*this.depth,(e+1)*l*this.depth);for(let n=0;n<l;++n){const r=t[this.splitInstruments?n*this.depth:n],c=t[this.splitInstruments?n*this.depth+1:l+n],p=t[this.splitInstruments?n*this.depth+2:2*l+n];if(r>.5){const t=u(Math.round(c*i.MAX_MIDI_VELOCITY),i.MIN_MIDI_VELOCITY,i.MAX_MIDI_VELOCITY),r=u(p/2,-.5,.5);a.notes.push(o.a.Note.create({pitch:this.pitchClasses[n][0],startTime:(e-r)*s,endTime:(e-r+1)*s,velocity:t,isDrum:!0}))}}}return a}}},,,function(e,t){e.exports=require("node-fetch")},function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"now",(function(){return o})),n.d(t,"timing",(function(){return i}));const r=e.process.hrtime(),o=()=>{const t=e.process.hrtime(r);return t[0]+t[1]/1e9},i={navigationStart:Date.now()}}.call(this,n(20))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";n.r(t),n.d(t,"userAgent",(function(){return r}));const r=""},,function(e,t,n){"use strict";n.r(t),n.d(t,"auxiliaryInputFromSpec",(function(){return o})),n.d(t,"AuxiliaryInput",(function(){return i})),n.d(t,"BinaryCounter",(function(){return s}));var r=n(0);function o(e){switch(e.type){case"BinaryCounter":return new s(e.args);default:throw new Error("Unknown auxiliary input: "+e)}}class i{constructor(e){this.depth=e}}class s extends i{constructor(e){super(e.numBits)}getTensors(e){const t=r.buffer([e,this.depth]);for(let n=0;n<e;++n)for(let e=0;e<this.depth;++e)t.set(Math.floor((n+1)/Math.pow(2,e))%2?1:-1,n,e);return t.toTensor().as2D(e,this.depth)}}},function(e,t){e.exports=require("protobufjs/minimal")},function(e,t){e.exports=require("@tonejs/midi")},function(e,t,n){"use strict";n.r(t),n.d(t,"aux_inputs",(function(){return r})),n.d(t,"chords",(function(){return o})),n.d(t,"constants",(function(){return i})),n.d(t,"data",(function(){return s})),n.d(t,"logging",(function(){return a})),n.d(t,"melodies",(function(){return c})),n.d(t,"performance",(function(){return u})),n.d(t,"sequences",(function(){return l})),n.d(t,"MetronomeCallbackObject",(function(){return h})),n.d(t,"Metronome",(function(){return m})),n.d(t,"MidiConversionError",(function(){return S})),n.d(t,"midiToSequenceProto",(function(){return y})),n.d(t,"sequenceProtoToMidi",(function(){return w})),n.d(t,"urlToBlob",(function(){return N})),n.d(t,"blobToNoteSequence",(function(){return b})),n.d(t,"urlToNoteSequence",(function(){return T})),n.d(t,"BasePlayerCallback",(function(){return I})),n.d(t,"BasePlayer",(function(){return v})),n.d(t,"Player",(function(){return E})),n.d(t,"SoundFontPlayer",(function(){return k})),n.d(t,"PlayerWithClick",(function(){return _})),n.d(t,"MIDIPlayer",(function(){return z})),n.d(t,"BaseRecorderCallback",(function(){return C})),n.d(t,"Recorder",(function(){return x})),n.d(t,"BaseVisualizer",(function(){return M})),n.d(t,"PianoRollCanvasVisualizer",(function(){return L})),n.d(t,"Visualizer",(function(){return R})),n.d(t,"BaseSVGVisualizer",(function(){return j})),n.d(t,"PianoRollSVGVisualizer",(function(){return F})),n.d(t,"WaterfallSVGVisualizer",(function(){return Q})),n.d(t,"ScrollType",(function(){return H})),n.d(t,"StaffSVGVisualizer",(function(){return U}));var r=n(23),o=n(14),i=n(1),s=n(15),a=n(4),c=n(10),u=n(12),l=n(5),p=n(2);class h{}class m{constructor(e,t=1){this.clicksPerQuarter=1,this.muted=!1,this.loClick=new p.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.hiClick=new p.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.loClickNote="c5",this.hiClickNote="g5",this.ticking=!1,this.startedAt=null,this.step=-1,this.reset(),this.callbackObject=e,this.clicksPerQuarter=t}isTicking(){return this.ticking}getStartedAt(){return this.startedAt}getOffsetTime(){return p.immediate()-this.startedAt}start(e=120){this.reset(),this.ticking=!0,this.callbackObject.click||(this.callbackObject.click=()=>{}),this.callbackObject.quarter||(this.callbackObject.quarter=()=>{}),this.callbackObject.bar||(this.callbackObject.bar=()=>{});let t=0;const n=4*this.clicksPerQuarter;p.Transport.scheduleRepeat(e=>{this.startedAt||(this.startedAt=e);const r=e-this.startedAt;this.step++;const o=this.step%n,i=Math.floor(o/this.clicksPerQuarter),s=o%this.clicksPerQuarter;this.callbackObject.click(r,o),0===s&&this.callbackObject.quarter(r,i),this.muted||(0===o?this.hiClick.triggerAttack(this.hiClickNote,e,.1):this.loClick.triggerAttack(this.loClickNote,e,.1)),0===o&&(this.callbackObject.bar(r,t),t++)},n+"n"),p.Transport.bpm.value=e,p.Transport.start()}stop(){this.ticking=!1,p.Transport.cancel(),p.Transport.stop()}reset(){this.muted=!1,this.ticking=!1,this.step=-1,this.startedAt=null}}var d=n(25),f=n(6),g=n(3);class S extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}function y(e){const t=new d.Midi(e),n=g.a.create();n.ticksPerQuarter=t.header.ppq,n.sourceInfo=g.a.SourceInfo.create({parser:g.a.SourceInfo.Parser.TONEJS_MIDI_CONVERT,encodingType:g.a.SourceInfo.EncodingType.MIDI});for(const e of t.header.timeSignatures)n.timeSignatures.push(g.a.TimeSignature.create({time:t.header.ticksToSeconds(e.ticks),numerator:e.timeSignature[0],denominator:e.timeSignature[1]}));n.timeSignatures.length||n.timeSignatures.push(g.a.TimeSignature.create({time:0,numerator:4,denominator:4}));for(const e of t.header.tempos)n.tempos.push(g.a.Tempo.create({time:e.time,qpm:e.bpm}));let r=-1;for(const e of t.tracks){e.notes.length>0&&(r+=1);for(const t of e.notes){const o=t.time,s=o+t.duration;n.notes.push(g.a.Note.create({instrument:r,program:e.instrument.number,startTime:o,endTime:s,pitch:t.midi,velocity:Math.floor(t.velocity*i.MIDI_VELOCITIES),isDrum:e.instrument.percussion})),s>n.totalTime&&(n.totalTime=s)}const t=Object.values(e.controlChanges),o=[].concat.apply([],t);for(const t of o)n.controlChanges.push(g.a.ControlChange.create({time:t.time,controlNumber:t.number,controlValue:Math.floor(t.value*(i.MIDI_VELOCITIES-1)),instrument:r,program:e.instrument.number,isDrum:e.instrument.percussion}))}return n}function w(e){l.isQuantizedSequence(e)&&(e=l.unquantizeSequence(e));const t=new d.Midi;t.fromJSON({header:{name:"",ppq:e.ticksPerQuarter||i.DEFAULT_TICKS_PER_QUARTER,tempos:[],timeSignatures:[],keySignatures:[],meta:[]},tracks:[]});const n=Array.from(e.tempos||[]);0===n.length&&n.push({time:0,qpm:i.DEFAULT_QUARTERS_PER_MINUTE}),n.sort((e,t)=>e.time-t.time);for(const e of n)t.header.tempos.push({ticks:t.header.secondsToTicks(e.time),bpm:e.qpm}),t.header.update();if(e.timeSignatures&&0!==e.timeSignatures.length)for(const n of e.timeSignatures)t.header.timeSignatures.push({ticks:t.header.secondsToTicks(n.time),timeSignature:[n.numerator,n.denominator]});else t.header.timeSignatures.push({ticks:0,timeSignature:[4,4]});t.header.update();const r=new Map;for(const t of e.notes){const e=t.instrument?t.instrument:0,n=void 0===t.program?i.DEFAULT_PROGRAM:t.program,o=!!t.isDrum,s=JSON.stringify([e,n,o]);r.has(s)||r.set(s,{notes:[],controlChanges:[]}),r.get(s).notes.push(t)}for(const t of e.controlChanges){const e=t.instrument?t.instrument:0,n=void 0===t.program?i.DEFAULT_PROGRAM:t.program,o=!!t.isDrum,s=JSON.stringify([e,n,o]);r.has(s)||r.set(s,{notes:[],controlChanges:[]}),r.get(s).controlChanges.push(t)}return r.forEach((e,n)=>{const[r,o]=JSON.parse(n).slice(1),s=t.addTrack();s.channel=o?i.DRUM_CHANNEL:i.NON_DRUM_CHANNELS[(t.tracks.length-1)%i.NON_DRUM_CHANNELS.length],s.instrument.number=r;for(const t of e.notes){const e=void 0===t.velocity?i.DEFAULT_VELOCITY:t.velocity;s.addNote({midi:t.pitch,time:t.startTime,duration:t.endTime-t.startTime,velocity:(e+1)/i.MIDI_VELOCITIES})}for(const t of e.controlChanges)s.addCC({number:t.controlNumber,value:t.controlValue,time:t.time})}),t.toArray()}function N(e){return new Promise((t,n)=>{Object(f.a)(e).then(e=>e.blob()).then(e=>{t(e)}).catch(e=>n(e))})}function b(e){return new Promise((t,n)=>{const r=new FileReader;r.onload=e=>{try{const e=y(r.result);t(e)}catch(e){n(e)}},r.onerror=e=>n(e),r.readAsArrayBuffer(e)})}function T(e){return N(e).then(b)}class O{constructor(e){this.FADE_SECONDS=.1,this.baseURL=e,this.buffers=new p.ToneAudioBuffers,this.sourceMap=new Map,this.initialized=!1}async initialize(){await Object(f.a)(this.baseURL+"/instrument.json").then(e=>e.json()).then(e=>{this.name=e.name,this.minPitch=e.minPitch,this.maxPitch=e.maxPitch,this.durationSeconds=e.durationSeconds,this.releaseSeconds=e.releaseSeconds,this.percussive=e.percussive,this.velocities=e.velocities,this.initialized=!0})}sampleInfoToName(e){return this.velocities?`p${e.pitch}_v${e.velocity}`:"p"+e.pitch}sampleNameToURL(e){return`${this.baseURL}/${e}.mp3`}nearestVelocity(e){if(!this.velocities)return e;e||(e=i.DEFAULT_VELOCITY);let t=void 0,n=i.MIDI_VELOCITIES;return this.velocities.forEach(r=>{const o=Math.abs(r-e);o<n&&(t=r,n=o)}),t}async loadSamples(e){this.initialized||await this.initialize();const t=e.filter(e=>!(e.pitch<this.minPitch||e.pitch>this.maxPitch)||(a.log(`Pitch ${e.pitch} is outside the valid range for ${this.name}, ignoring.`,"SoundFont"),!1)).map(e=>this.sampleInfoToName({pitch:e.pitch,velocity:this.nearestVelocity(e.velocity)})),n=Array.from(new Set(t)).filter(e=>!this.buffers.has(e)).map(e=>({name:e,url:this.sampleNameToURL(e)}));n.length>0&&(n.forEach(e=>this.buffers.add(e.name,e.url)),await p.loaded(),a.log(`Loaded samples for ${this.name}.`,"SoundFont"))}playNote(e,t,n,r,o){const i=this.getBuffer(e,t);if(!i)return;r>this.durationSeconds&&a.log(`Requested note duration longer than sample duration: ${r} > ${this.durationSeconds}`,"SoundFont");const s=new p.ToneBufferSource({url:i,fadeOut:this.FADE_SECONDS}).connect(o);if(s.start(n,0,void 0,1),!this.percussive&&r<this.durationSeconds){const e=new p.ToneBufferSource({url:i,fadeOut:this.FADE_SECONDS}).connect(o);s.stop(n+r+this.FADE_SECONDS),e.start(n+r,this.durationSeconds,void 0,1)}}playNoteDown(e,t,n){const r=this.getBuffer(e,t);if(!r)return;const o=new p.ToneBufferSource(r).connect(n);o.start(0,0,void 0,1),this.sourceMap.has(e)&&this.sourceMap.get(e).stop(p.now()+this.FADE_SECONDS,this.FADE_SECONDS),this.sourceMap.set(e,o)}playNoteUp(e,t,n){if(!this.sourceMap.has(e))return;const r=this.getBuffer(e,t);if(!r)return;new p.ToneBufferSource({url:r,fadeOut:this.FADE_SECONDS}).connect(n).start(0,this.durationSeconds,void 0,1),this.sourceMap.get(e).stop(p.now()+this.FADE_SECONDS,this.FADE_SECONDS),this.sourceMap.delete(e)}getBuffer(e,t){if(!this.initialized)throw new Error("Instrument is not initialized.");if(e<this.minPitch||e>this.maxPitch)return void a.log(`Pitch ${e} is outside the valid range for ${this.name} (${this.minPitch}-${this.maxPitch})`,"SoundFont");const n=this.sampleInfoToName({pitch:e,velocity:this.nearestVelocity(t)});if(!this.buffers.has(n))throw new Error(`Buffer not found for ${this.name}: ${n}`);const r=this.buffers.get(n);if(!r.loaded)throw new Error(`Buffer not loaded for ${this.name}: ${n}`);return r}}class P{constructor(e){this.baseURL=e,this.instruments=new Map,this.initialized=!1}async initialize(){await Object(f.a)(this.baseURL+"/soundfont.json").then(e=>e.json()).then(e=>{this.name=e.name;for(const t in e.instruments){const n=`${this.baseURL}/${e.instruments[t]}`;this.instruments.set("drums"===t?"drums":+t,new O(n))}this.initialized=!0})}async loadSamples(e){this.initialized||await this.initialize();const t=new Map;e.forEach(e=>{e.isDrum=e.isDrum||!1,e.program=e.program||0;const n=e.isDrum?"drums":e.program,r={pitch:e.pitch,velocity:e.velocity};t.has(n)?t.get(n).push(r):this.instruments.has(n)?t.set(n,[r]):a.log(`No instrument in ${this.name} for: program=${e.program}, isDrum=${e.isDrum}`,"SoundFont")}),await Promise.all(Array.from(t.keys()).map(e=>this.instruments.get(e).loadSamples(t.get(e))))}playNote(e,t,n,r,o=0,i=!1,s){const c=i?"drums":o;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(c)?this.instruments.get(c).playNote(e,t,n,r,s):a.log(`No instrument in ${this.name} for: program=${o}, isDrum=${i}`,"SoundFont")}playNoteDown(e,t,n=0,r=!1,o){const i=r?"drums":n;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(i)?this.instruments.get(i).playNoteDown(e,t,o):a.log(`No instrument in ${this.name} for: program=${n}, isDrum=${r}`,"SoundFont")}playNoteUp(e,t,n=0,r=!1,o){const i=r?"drums":n;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(i)?this.instruments.get(i).playNoteUp(e,t,o):a.log(`No instrument in ${this.name} for: program=${n}, isDrum=${r}`,"SoundFont")}}function q(e,t){return e.quantizedStartStep<t.quantizedStartStep?-1:e.quantizedStartStep>t.quantizedStartStep?1:e.pitch<t.pitch?-1:1}class I{}class v{constructor(e=!1,t){this.playClick=e,this.callbackObject=t,this.desiredQPM=void 0}setTempo(e){this.desiredQPM=e,"started"===p.Transport.state&&(p.Transport.bpm.value=e)}makeClickSequence(e){const t=l.clone(e),n=t.notes.map(e=>e.quantizedEndStep),r=Math.max(...n);for(let e=0;e<r;e+=4){const n={pitch:e%16==0?i.LO_CLICK_PITCH:i.HI_CLICK_PITCH,quantizedStartStep:e,isDrum:!0,quantizedEndStep:e+1};t.notes.push(n)}return t.notes.sort(q),t}resumeContext(){p.context.resume()}start(e,t,n=0){if("started"===this.getPlayState())throw new Error("Cannot start playback; player is already playing.");if("paused"===this.getPlayState())throw new Error("Cannot `start()` a paused player; use `resume()`.");if("stopped"!==p.Transport.state)throw new Error("Cannot start playback while `Tone.Transport` is in use.");this.resumeContext();const r=l.isQuantizedSequence(e);if(this.playClick&&r&&(e=this.makeClickSequence(e)),t?p.Transport.bpm.value=t:e.tempos&&e.tempos.length>0&&e.tempos[0].qpm>0?p.Transport.bpm.value=e.tempos[0].qpm:p.Transport.bpm.value=i.DEFAULT_QUARTERS_PER_MINUTE,r)e=l.unquantizeSequence(e,t);else if(t)throw new Error("Cannot specify a `qpm` for a non-quantized sequence.");const o=new p.Part((e,t)=>{this.currentPart===o&&(this.playNote(e,t),this.callbackObject&&p.Draw.schedule(()=>{this.callbackObject.run(t,e)},e))},e.notes.map(e=>[e.startTime,e]));return this.currentPart=o,this.desiredQPM&&(p.Transport.bpm.value=this.desiredQPM),this.currentPart.start(void 0,n),"started"!==p.Transport.state&&p.Transport.start(),new Promise(t=>{this.scheduledStop=p.Transport.schedule(()=>{this.stop(),t(),this.callbackObject&&this.callbackObject.stop()},"+"+e.totalTime)})}stop(){this.isPlaying()&&(this.currentPart.stop(),p.Transport.stop(),this.currentPart=null),p.Transport.clear(this.scheduledStop),this.scheduledStop=void 0,this.desiredQPM=void 0}pause(){if(!this.isPlaying())throw new Error("Cannot pause playback while the player is stopped.");p.Transport.pause()}resume(){if("paused"!==this.getPlayState())throw new Error(`Cannot resume playback while "${this.getPlayState()}".`);p.Transport.start()}seekTo(e){if(!this.isPlaying())throw new Error("Cannot seek while the player is stopped.");p.Transport.seconds=e}isPlaying(){return!!this.currentPart}getPlayState(){return this.isPlaying()?p.Transport.state:"stopped"}}class A{constructor(){this.DRUM_PITCH_TO_CLASS=new Map,this.kick=(new p.MembraneSynth).toDestination(),this.tomLow=new p.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination(),this.tomMid=new p.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination(),this.tomHigh=new p.MembraneSynth({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination(),this.closedHihat=new p.MetalSynth({frequency:400,envelope:{attack:.001,decay:.1,release:.8},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1}).toDestination(),this.openHihat=new p.MetalSynth({frequency:400,envelope:{attack:.001,decay:.5,release:.8,sustain:1},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1}).toDestination(),this.ride=(new p.MetalSynth).toDestination(),this.crash=new p.MetalSynth({frequency:300,envelope:{attack:.001,decay:1,release:3},harmonicity:5.1,modulationIndex:64,resonance:4e3,octaves:1.5}).toDestination(),this.snare=new p.NoiseSynth({noise:{type:"white"},envelope:{attack:.005,decay:.05,sustain:.1,release:.4}}).toDestination(),this.loClick=new p.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.hiClick=new p.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.pitchPlayers=[(e,t=1)=>this.kick.triggerAttackRelease("C2","8n",e,t),(e,t=1)=>this.snare.triggerAttackRelease("16n",e,t),(e,t=1)=>this.closedHihat.triggerAttack(e,.3,t),(e,t=1)=>this.openHihat.triggerAttack(e,.3,t),(e,t=.5)=>this.tomLow.triggerAttack("G3",e,t),(e,t=.5)=>this.tomMid.triggerAttack("C4",e,t),(e,t=.5)=>this.tomHigh.triggerAttack("F4",e,t),(e,t=1)=>this.crash.triggerAttack(e,1,t),(e,t=1)=>this.ride.triggerAttack(e,.5,t),(e,t=.5)=>this.loClick.triggerAttack("G5",e,t),(e,t=.5)=>this.hiClick.triggerAttack("C6",e,t)];for(let e=0;e<i.DEFAULT_DRUM_PITCH_CLASSES.length;++e)i.DEFAULT_DRUM_PITCH_CLASSES[e].forEach(t=>{this.DRUM_PITCH_TO_CLASS.set(t,e)});this.DRUM_PITCH_TO_CLASS.set(i.LO_CLICK_PITCH,i.LO_CLICK_CLASS),this.DRUM_PITCH_TO_CLASS.set(i.HI_CLICK_PITCH,i.HI_CLICK_CLASS)}static getInstance(){return A.instance||(A.instance=new A),A.instance}playNote(e,t,n){this.pitchPlayers[this.DRUM_PITCH_TO_CLASS.get(e)](t,n)}}class E extends v{constructor(){super(...arguments),this.drumKit=A.getInstance(),this.bassSynth=new p.Synth({volume:5,oscillator:{type:"triangle"}}).toDestination(),this.polySynth=(new p.PolySynth).toDestination()}playNote(e,t){const n=t.hasOwnProperty("velocity")?t.velocity/i.MAX_MIDI_VELOCITY:void 0;if(t.isDrum)this.drumKit.playNote(t.pitch,e,n);else{const r=p.Frequency(t.pitch,"midi").toFrequency(),o=t.endTime-t.startTime;this.getSynth(t.instrument,t.program).triggerAttackRelease(r,o,e,n)}}getSynth(e,t){return void 0!==t&&t>=32&&t<=39?this.bassSynth:this.polySynth}}E.tone=p;class k extends v{constructor(e,t=p.Master,n,r,o){super(!1,o),this.soundFont=new P(e),this.output=t,this.programOutputs=n,this.drumOutputs=r}async loadSamples(e){await this.soundFont.loadSamples(e.notes.map(e=>({pitch:e.pitch,velocity:e.velocity,program:e.program||0,isDrum:e.isDrum||!1})))}async loadAllSamples(e=0,t=!1){const n=g.a.create(),r=t?i.MIN_DRUM_PITCH:i.MIN_PIANO_PITCH,o=t?i.MAX_DRUM_PITCH:i.MAX_PIANO_PITCH;for(let s=r;s<=o;s++)for(let r=i.MIN_MIDI_VELOCITY;r<i.MAX_MIDI_VELOCITY;r++)n.notes.push({pitch:s,velocity:r,program:e,isDrum:t});return this.loadSamples(n)}resumeContext(){p.context.resume()}start(e,t,n=0){return this.resumeContext(),this.loadSamples(e).then(()=>super.start(e,t,n))}playNote(e,t){this.soundFont.playNote(t.pitch,t.velocity,e,t.endTime-t.startTime,t.program,t.isDrum,this.getAudioNodeOutput(t))}playNoteDown(e){this.soundFont.playNoteDown(e.pitch,e.velocity,e.program,e.isDrum,this.getAudioNodeOutput(e))}playNoteUp(e){this.soundFont.playNoteUp(e.pitch,e.velocity,e.program,e.isDrum,this.getAudioNodeOutput(e))}getAudioNodeOutput(e){let t=this.output;return this.programOutputs&&!e.isDrum?this.programOutputs.has(e.program)&&(t=this.programOutputs.get(e.program)):this.drumOutputs&&e.isDrum&&this.drumOutputs.has(e.pitch)&&(t=this.drumOutputs.get(e.pitch)),t}}class _ extends E{constructor(e){super(!0,e)}}class z extends v{constructor(e){super(!1,e),this.outputs=[],this.outputChannel=0,this.availableOutputs=[],this.NOTE_ON=144,this.NOTE_OFF=128}async requestMIDIAccess(){return navigator.requestMIDIAccess?new Promise((e,t)=>{navigator.requestMIDIAccess().then(t=>{t.addEventListener("statechange",e=>this.initOutputs(t)),e(this.initOutputs(t))},e=>console.log("Something went wrong",t(e)))}):null}initOutputs(e){const t=e.outputs.values();for(let e=t.next();e&&!e.done;e=t.next())this.availableOutputs.push(e.value);return this.availableOutputs}playNote(e,t){const n=t.velocity||100,r=1e3*(t.endTime-t.startTime),o=[this.NOTE_ON+this.outputChannel,t.pitch,n],i=[this.NOTE_OFF+this.outputChannel,t.pitch,n],s=this.outputs?this.outputs:this.availableOutputs;for(let e=0;e<s.length;e++)this.sendMessageToOutput(s[e],o),this.sendMessageToOutput(s[e],i,f.d.now()+r)}sendMessageToOutput(e,t,n){e&&e.send(t,n)}playNoteDown(e){const t=[this.NOTE_ON,e.pitch,e.velocity],n=this.outputs?this.outputs:this.availableOutputs;for(let e=0;e<n.length;e++)this.sendMessageToOutput(n[e],t)}playNoteUp(e){const t=[this.NOTE_OFF,e.pitch,e.velocity],n=this.outputs?this.outputs:this.availableOutputs;for(let r=0;r<n.length;r++)this.sendMessageToOutput(n[r],t,e.endTime-e.startTime)}}class C{}class x{constructor(e={},t){this.notes=[],this.midiInputs=[],this.loClick=new p.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.hiClick=new p.MembraneSynth({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.config={playClick:e.playClick,qpm:e.qpm||i.DEFAULT_QUARTERS_PER_MINUTE,playCountIn:e.playCountIn,startRecordingAtFirstNote:e.startRecordingAtFirstNote||!1},this.callbackObject=t,this.recording=!1,this.onNotes=new Map}async initialize(){await navigator.requestMIDIAccess().then(e=>this.midiReady(e),e=>console.log("Something went wrong",e))}midiReady(e){a.log("Initialized Recorder","Recorder");const t=e.inputs.values();for(let e=t.next();e&&!e.done;e=t.next())this.midiInputs.push(e.value)}isRecording(){return this.recording}setTempo(e){this.config.qpm=e,"started"===p.Transport.state&&(p.Transport.bpm.value=e)}enablePlayClick(e){this.config.playClick=e}enablePlayCountIn(e){this.config.playCountIn=e}initClickLoop(){let e=0;this.clickLoop=new p.Loop(t=>{e%4==0?this.loClick.triggerAttack("G5",t):this.hiClick.triggerAttack("C6",t),e++,this.config.playCountIn&&4===e&&(p.Transport.stop(),this.clickLoop.stop())},"4n")}getMIDIInputs(){return this.midiInputs}start(e){const t=e||this.midiInputs;for(const e of t)e.onmidimessage=e=>{this.midiMessageReceived(e)};if(this.config.playClick||this.config.playCountIn?(this.initClickLoop(),p.Transport.bpm.value=this.config.qpm,p.Transport.start(),this.clickLoop.start()):this.clickLoop=null,this.recording=!0,this.firstNoteTimestamp=void 0,this.notes=[],this.onNotes=new Map,!this.startRecordingAtFirstNote){const e=Date.now();this.firstNoteTimestamp=e}}stop(){this.recording=!1;const e=Date.now();this.onNotes.forEach((t,n)=>{this.noteOff(n,e)});for(const e of this.midiInputs)e.onmidimessage=null;return this.clickLoop&&(p.Transport.stop(),this.clickLoop.stop()),0===this.notes.length?null:this.getNoteSequence()}getNoteSequence(){return 0===this.notes.length?null:g.a.create({notes:this.notes,totalTime:this.notes[this.notes.length-1].endTime})}reset(){const e=this.stop();return this.firstNoteTimestamp=void 0,this.notes=[],this.onNotes=new Map,e}midiMessageReceived(e){if(!this.recording)return;let t;t=void 0!==e.timeStamp&&0!==e.timeStamp?e.timeStamp:f.d.now();const n=t+f.d.timing.navigationStart;void 0===this.firstNoteTimestamp&&(this.firstNoteTimestamp=n);const r=e.data[0]>>4,o=e.data[1],i=e.data.length>2?e.data[2]:1,s=e.srcElement;8===r||9===r&&0===i?(this.callbackObject&&this.callbackObject.noteOff&&this.callbackObject.noteOff(o,i,s),this.noteOff(o,n),this.callbackObject&&this.callbackObject.run&&this.callbackObject.run(this.getNoteSequence())):9===r&&(this.callbackObject&&this.callbackObject.noteOn&&this.callbackObject.noteOn(o,i,s),this.noteOn(o,i,n))}noteOn(e,t,n){const r=new g.a.Note;r.pitch=e,r.startTime=(n-this.firstNoteTimestamp)/1e3,r.velocity=t,this.onNotes.set(e,r)}noteOff(e,t){const n=this.onNotes.get(e);n&&(n.endTime=(t-this.firstNoteTimestamp)/1e3,this.notes.push(n)),this.onNotes.delete(e)}}var D=n(28);class M{constructor(e,t={}){const n=l.isQuantizedSequence(e),r=e.tempos&&e.tempos.length>0?e.tempos[0].qpm:void 0;this.noteSequence=n?l.unquantizeSequence(e,r):e;this.config={noteHeight:t.noteHeight||6,noteSpacing:t.noteSpacing||1,pixelsPerTimeStep:t.pixelsPerTimeStep||30,noteRGB:t.noteRGB||"8, 41, 64",activeNoteRGB:t.activeNoteRGB||"240, 84, 119",minPitch:t.minPitch,maxPitch:t.maxPitch};const o=this.getSize();this.width=o.width,this.height=o.height}updateMinMaxPitches(e=!1){if(!this.config.minPitch||!this.config.maxPitch){void 0===this.config.minPitch&&(this.config.minPitch=i.MAX_MIDI_PITCH),void 0===this.config.maxPitch&&(this.config.maxPitch=i.MIN_MIDI_PITCH);for(const e of this.noteSequence.notes)this.config.minPitch=Math.min(e.pitch,this.config.minPitch),this.config.maxPitch=Math.max(e.pitch,this.config.maxPitch);e||(this.config.minPitch-=2,this.config.maxPitch+=2)}}getSize(){this.updateMinMaxPitches();const e=(this.config.maxPitch-this.config.minPitch)*this.config.noteHeight,t=this.noteSequence.totalTime;if(!t)throw new Error("The sequence you are using with the visualizer does not have a totalQuantizedSteps or totalTime field set, so the visualizer can't be horizontally sized correctly.");return{width:t*this.config.pixelsPerTimeStep,height:e}}getNotePosition(e,t){const n=this.getNoteEndTime(e)-this.getNoteStartTime(e),r=this.getNoteStartTime(e)*this.config.pixelsPerTimeStep,o=Math.max(this.config.pixelsPerTimeStep*n-this.config.noteSpacing,1);return{x:r,y:this.height-(e.pitch-this.config.minPitch)*this.config.noteHeight,w:o,h:this.config.noteHeight}}scrollIntoViewIfNeeded(e,t){if(e&&this.parentElement){const e=this.parentElement.getBoundingClientRect().width;t>this.parentElement.scrollLeft+e&&(this.parentElement.scrollLeft=t-20)}}getNoteStartTime(e){return Math.round(1e8*e.startTime)/1e8}getNoteEndTime(e){return Math.round(1e8*e.endTime)/1e8}isPaintingActiveNote(e,t){const n=this.getNoteStartTime(e)===this.getNoteStartTime(t),r=this.getNoteStartTime(e)<=this.getNoteStartTime(t)&&this.getNoteEndTime(e)>=this.getNoteEndTime(t);return n||r}}class L extends M{constructor(e,t,n={}){super(e,n),this.ctx=t.getContext("2d"),this.parentElement=t.parentElement;const r=window.devicePixelRatio||1;this.ctx&&(this.ctx.canvas.width=r*this.width,this.ctx.canvas.height=r*this.height,t.style.width=this.width+"px",t.style.height=this.height+"px",this.ctx.scale(r,r)),this.redraw()}redraw(e,t){let n;this.clear();for(let t=0;t<this.noteSequence.notes.length;t++){const r=this.noteSequence.notes[t],o=this.getNotePosition(r,t),i=.2,s=r.velocity?r.velocity/100+i:1,a=e&&this.isPaintingActiveNote(r,e),c=`rgba(${a?this.config.activeNoteRGB:this.config.noteRGB},\n  ${s})`;this.redrawNote(o.x,o.y,o.w,o.h,c),a&&r===e&&(n=o.x)}return this.scrollIntoViewIfNeeded(t,n),n}clear(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}clearActiveNotes(){this.redraw()}redrawNote(e,t,n,r,o){this.ctx.fillStyle=o,this.ctx.fillRect(Math.round(e),Math.round(t),Math.round(n),Math.round(r))}}class R extends L{constructor(e,t,n={}){super(e,t,n),a.log("mm.Visualizer is deprecated, and will be removed in a future          version. Please use mm.PianoRollCanvasVisualizer instead","mm.Visualizer",5)}}class j extends M{constructor(e,t={}){super(e,t),this.drawn=!1}redraw(e,t){if(this.drawn||this.draw(),!e)return null;let n;this.unfillActiveRect(this.svg);for(let t=0;t<this.noteSequence.notes.length;t++){const r=this.noteSequence.notes[t];if(!(e&&this.isPaintingActiveNote(r,e)))continue;const o=this.svg.querySelector(`rect[data-index="${t}"]`);this.fillActiveRect(o,r),r===e&&(n=parseFloat(o.getAttribute("x")))}return this.scrollIntoViewIfNeeded(t,n),n}fillActiveRect(e,t){e.setAttribute("fill",this.getNoteFillColor(t,!0)),e.classList.add("active")}unfillActiveRect(e){const t=e.querySelectorAll("rect.active");for(let e=0;e<t.length;++e){const n=t[e],r=this.getNoteFillColor(this.noteSequence.notes[parseInt(n.getAttribute("data-index"),10)],!1);n.setAttribute("fill",r),n.classList.remove("active")}}draw(){for(let e=0;e<this.noteSequence.notes.length;e++){const t=this.noteSequence.notes[e],n=this.getNotePosition(t,e),r=this.getNoteFillColor(t,!1),o=[["index",e],["instrument",t.instrument],["program",t.program],["isDrum",!0===t.isDrum],["pitch",t.pitch]],i=[["--midi-velocity",String(void 0!==t.velocity?t.velocity:127)]];this.drawNote(n.x,n.y,n.w,n.h,r,o,i)}this.drawn=!0}getNoteFillColor(e,t){const n=e.velocity?e.velocity/100+.2:1;return`rgba(${t?this.config.activeNoteRGB:this.config.noteRGB},\n  ${n})`}drawNote(e,t,n,r,o,i,s){if(!this.svg)return;const a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.classList.add("note"),a.setAttribute("fill",o),a.setAttribute("x",""+Math.round(e)),a.setAttribute("y",""+Math.round(t)),a.setAttribute("width",""+Math.round(n)),a.setAttribute("height",""+Math.round(r)),i.forEach(([e,t])=>{void 0!==t&&(a.dataset[e]=""+t)}),s.forEach(([e,t])=>{a.style.setProperty(e,t)}),this.svg.appendChild(a)}clear(){this.svg.innerHTML="",this.drawn=!1}clearActiveNotes(){this.unfillActiveRect(this.svg)}}class F extends j{constructor(e,t,n={}){if(super(e,n),!(t instanceof SVGSVGElement))throw new Error("This visualizer requires an <svg> element to display the visualization");this.svg=t,this.parentElement=t.parentElement;const r=this.getSize();this.width=r.width,this.height=r.height,this.svg.style.width=this.width+"px",this.svg.style.height=this.height+"px",this.clear(),this.draw()}}class Q extends j{constructor(e,t,n={}){if(super(e,n),this.NOTES_PER_OCTAVE=12,this.WHITE_NOTES_PER_OCTAVE=7,this.LOW_C=24,this.firstDrawnOctave=0,this.lastDrawnOctave=6,!(t instanceof HTMLDivElement))throw new Error("This visualizer requires a <div> element to display the visualization");this.config.whiteNoteWidth=n.whiteNoteWidth||20,this.config.blackNoteWidth=n.blackNoteWidth||2*this.config.whiteNoteWidth/3,this.config.whiteNoteHeight=n.whiteNoteHeight||70,this.config.blackNoteHeight=n.blackNoteHeight||140/3,this.config.showOnlyOctavesUsed=n.showOnlyOctavesUsed,this.setupDOM(t);const r=this.getSize();this.width=r.width,this.height=r.height,this.svg.style.width=this.width+"px",this.svg.style.height=this.height+"px",this.svgPiano.style.width=this.width+"px",this.svgPiano.style.height=this.config.whiteNoteHeight+"px",this.parentElement.style.width=this.width+this.config.whiteNoteWidth+"px",this.parentElement.scrollTop=this.parentElement.scrollHeight,this.clear(),this.drawPiano(),this.draw()}setupDOM(e){this.parentElement=document.createElement("div"),this.parentElement.classList.add("waterfall-notes-container");const t=Math.max(e.getBoundingClientRect().height,200);this.parentElement.style.paddingTop=t-this.config.whiteNoteHeight+"px",this.parentElement.style.height=t-this.config.whiteNoteHeight+"px",this.parentElement.style.boxSizing="border-box",this.parentElement.style.overflowX="hidden",this.parentElement.style.overflowY="auto",this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgPiano=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.classList.add("waterfall-notes"),this.svgPiano.classList.add("waterfall-piano"),this.parentElement.appendChild(this.svg),e.innerHTML="",e.appendChild(this.parentElement),e.appendChild(this.svgPiano)}redraw(e,t){if(this.drawn||this.draw(),!e)return null;this.clearActiveNotes(),this.parentElement.style.paddingTop=this.parentElement.style.height;for(let t=0;t<this.noteSequence.notes.length;t++){const n=this.noteSequence.notes[t];if(!(e&&this.isPaintingActiveNote(n,e)))continue;const r=this.svg.querySelector(`rect[data-index="${t}"]`);this.fillActiveRect(r,n);const o=this.svgPiano.querySelector(`rect[data-pitch="${n.pitch}"]`);if(this.fillActiveRect(o,n),n===e){const e=parseFloat(r.getAttribute("y")),t=parseFloat(r.getAttribute("height"));return e<this.parentElement.scrollTop-t&&(this.parentElement.scrollTop=e+t),e}}return null}getSize(){this.updateMinMaxPitches(!0);let e=52;if(this.config.showOnlyOctavesUsed){let t=!1,n=!1;for(let e=1;e<7;e++){const r=this.LOW_C+this.NOTES_PER_OCTAVE*e;!t&&r>this.config.minPitch&&(this.firstDrawnOctave=e-1,t=!0),!n&&r>this.config.maxPitch&&(this.lastDrawnOctave=e-1,n=!0)}e=(this.lastDrawnOctave-this.firstDrawnOctave+1)*this.WHITE_NOTES_PER_OCTAVE}const t=e*this.config.whiteNoteWidth,n=this.noteSequence.totalTime;if(!n)throw new Error("The sequence you are using with the visualizer does not have a totalQuantizedSteps or totalTime field set, so the visualizer can't be horizontally sized correctly.");return{width:t,height:Math.max(n*this.config.pixelsPerTimeStep,1)}}getNotePosition(e,t){const n=this.svgPiano.querySelector(`rect[data-pitch="${e.pitch}"]`);if(!n)return null;const r=this.getNoteEndTime(e)-this.getNoteStartTime(e),o=Number(n.getAttribute("x")),i=Number(n.getAttribute("width")),s=Math.max(this.config.pixelsPerTimeStep*r-this.config.noteSpacing,1);return{x:o,y:this.height-this.getNoteStartTime(e)*this.config.pixelsPerTimeStep-s,w:i,h:s}}drawPiano(){this.svgPiano.innerHTML="";const e=this.config.whiteNoteWidth-this.config.blackNoteWidth/2,t=[1,3,6,8,10];let n=0,r=0;this.config.showOnlyOctavesUsed?r=this.firstDrawnOctave*this.NOTES_PER_OCTAVE+this.LOW_C:(r=this.LOW_C-3,this.drawWhiteKey(r,n),this.drawWhiteKey(r+2,this.config.whiteNoteWidth),r+=3,n=2*this.config.whiteNoteWidth);for(let e=this.firstDrawnOctave;e<=this.lastDrawnOctave;e++)for(let e=0;e<this.NOTES_PER_OCTAVE;e++)-1===t.indexOf(e)&&(this.drawWhiteKey(r,n),n+=this.config.whiteNoteWidth),r++;this.config.showOnlyOctavesUsed?(r=this.firstDrawnOctave*this.NOTES_PER_OCTAVE+this.LOW_C,n=-this.config.whiteNoteWidth):(this.drawWhiteKey(r,n),r=this.LOW_C-3,this.drawBlackKey(r+1,e),r+=3,n=this.config.whiteNoteWidth);for(let o=this.firstDrawnOctave;o<=this.lastDrawnOctave;o++)for(let o=0;o<this.NOTES_PER_OCTAVE;o++)-1!==t.indexOf(o)?this.drawBlackKey(r,n+e):n+=this.config.whiteNoteWidth,r++}drawWhiteKey(e,t){const n=document.createElementNS("http://www.w3.org/2000/svg","rect");return n.dataset.pitch=String(e),n.setAttribute("x",String(t)),n.setAttribute("y","0"),n.setAttribute("width",String(this.config.whiteNoteWidth)),n.setAttribute("height",String(this.config.whiteNoteHeight)),n.setAttribute("fill","white"),n.setAttribute("original-fill","white"),n.setAttribute("stroke","black"),n.setAttribute("stroke-width","3px"),n.classList.add("white"),this.svgPiano.appendChild(n),n}drawBlackKey(e,t){const n=document.createElementNS("http://www.w3.org/2000/svg","rect");return n.dataset.pitch=String(e),n.setAttribute("x",String(t)),n.setAttribute("y","0"),n.setAttribute("width",String(this.config.blackNoteWidth)),n.setAttribute("height",String(this.config.blackNoteHeight)),n.setAttribute("fill","black"),n.setAttribute("original-fill","black"),n.setAttribute("stroke","black"),n.setAttribute("stroke-width","3px"),n.classList.add("black"),this.svgPiano.appendChild(n),n}clearActiveNotes(){super.unfillActiveRect(this.svg);const e=this.svgPiano.querySelectorAll("rect.active");for(let t=0;t<e.length;++t){const n=e[t];n.setAttribute("fill",n.getAttribute("original-fill")),n.classList.remove("active")}}}var H;!function(e){e[e.PAGE=0]="PAGE",e[e.NOTE=1]="NOTE",e[e.BAR=2]="BAR"}(H||(H={}));class U extends M{constructor(e,t,n={}){super(e,n),(void 0===n.pixelsPerTimeStep||n.pixelsPerTimeStep<=0)&&(this.config.pixelsPerTimeStep=0),this.instruments=n.instruments||[],this.render=new D.StaffSVGRender(this.getScoreInfo(e),{noteHeight:this.config.noteHeight,noteSpacing:this.config.noteSpacing,pixelsPerTimeStep:this.config.pixelsPerTimeStep,noteRGB:this.config.noteRGB,activeNoteRGB:this.config.activeNoteRGB,defaultKey:n.defaultKey||0,scrollType:n.scrollType||H.PAGE},t),this.drawnNotes=e.notes.length,this.clear(),this.redraw()}clear(){this.render.clear()}redraw(e,t){this.drawnNotes!==this.noteSequence.notes.length&&(this.render.scoreInfo=this.getScoreInfo(this.noteSequence));const n=e?this.getNoteInfo(e):void 0;return this.render.redraw(n,t)}isNoteInInstruments(e){return void 0===e.instrument||0===this.instruments.length||this.instruments.indexOf(e.instrument)>=0}timeToQuarters(e){const t=e*this.noteSequence.tempos[0].qpm/60;return Math.round(16*t)/16}getNoteInfo(e){const t=this.timeToQuarters(e.startTime);return{start:t,length:this.timeToQuarters(e.endTime)-t,pitch:e.pitch,intensity:e.velocity}}getScoreInfo(e){const t=[];return e.notes.forEach(e=>{this.isNoteInInstruments(e)&&t.push(this.getNoteInfo(e))}),{notes:t,tempos:e.tempos?e.tempos.map(e=>({start:this.timeToQuarters(e.time),qpm:e.qpm})):[],keySignatures:e.keySignatures?e.keySignatures.map(e=>({start:this.timeToQuarters(e.time),key:e.key})):[],timeSignatures:e.timeSignatures?e.timeSignatures.map(e=>({start:this.timeToQuarters(e.time),numerator:e.numerator,denominator:e.denominator})):[]}}clearActiveNotes(){this.redraw()}}},,function(e,t){e.exports=require("staffrender")}])}));